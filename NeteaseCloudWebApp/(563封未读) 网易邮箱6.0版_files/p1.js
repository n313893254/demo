!function(a){function b(a){var b=this;b.uri=a.uri,b.name=a.uri.name,b.address=a.uri.address,b.key=b.address.toLowerCase(),b.valid=a.valid,q.superClass.initialize.call(b,a)}function c(){try{var b=$L("support.AddressSupport")}catch(c){return c}var d=this,e=d.id,f=d.getsub(d.name),g=d.getsub(d.address),h=d.name?'<strong class="nui-addr-name" unselectable="on">'+f+"</strong>":"",i=d.name?"&lt;"+g+"&gt;":g,j=d.valid?a.String.escapeHTML(d.address):"该地址格式有误，请双击修改",k="nui-editableAddr nui-addr nui-addr-hasAdd",l="";if(d.valid){var m=b.getAddrObj(d.address);m?(d[p]=m[p],l='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus"><b class="nui-ico nui-ico-edit"></b></a>'):l='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus">+</a>'}else k+=" nui-editableAddr-err",l='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus">x</a>';var n='<div id="'+e+'" class="js-component-emailblock '+k+'" title="'+j+'"  unselectable="on">'+h+'<em class="nui-addr-email" unselectable="on">'+i+"</em>"+l+"</div>";return n}function d(){return this.uri}function e(a){var b=this,c=b.ownerCt,d=b.getEl();return a?(c.selectItem(b),void 0):(d.addClass("nui-addr-active"),d.addClass("nui-editableAddr-active"),b.selected=!0,c.lastSelectItem=b,void 0)}function f(a){var b=this,c=b.ownerCt,d=b.getEl();return a?(c.unselectItem(b),void 0):(d.removeClass("nui-addr-active"),d.removeClass("nui-editableAddr-active"),this.selected=!1,void 0)}function g(b){var c=30,d=26;if(!b)return"";if(b.length<=c)return a.String.escapeHTML(b);if(-1!=b.indexOf("@")){var e=b.split("@"),f=e[0],g=e[1];return f.length>c&&(f=f.substr(0,d)+".."),g.length>50&&(g=g.substr(0,46)+".."),a.String.escapeHTML(f+"@"+g)}return a.String.escapeHTML(b.substr(0,d)+"..")}function h(a){var b=this;b.warn=!0;var c=this.getEl();if(1==a){var d=b.address.split("@"),e=d[0]+'<span class="nui-txt-err">@'+d[1]+"</span>";b.name&&(e="&lt;"+e+"&gt;");var f=c.dom,g=f.getElementsByTagName("EM")[0];g.innerHTML=e,c.attr({title:"该地址的域名可能不存在，请双击修改"})}else 0==a&&(c.addClass("nui-editableAddr-err"),c.attr({title:"您输入的地址可能有误，请双击修改"}))}function i(b){var c=this,d=this.getEl(),e=c.ownerCt;e.itemMap[c.key]=null,c.warn=!1,c.address=b.address||c.address,oUri=new o(c.address,c.name),oUri.valid=!0,c.uri=oUri,c.key=c.address.toLowerCase();var f=c.getsub(c.address),g=c.name?"&lt;"+f+"&gt;":f,h=a.String.escapeHTML(c.address),i=d.dom,j=i.getElementsByTagName("EM")[0];j.innerHTML=g,d.attr({title:h}),d.removeClass("nui-editableAddr-err")}function j(b){var c=this,d=c.getEl();c.name=b.name,c.address=b.address;var e=new o(c.address,c.name);e.valid=!0,c.uri=e;var f=d.dom,g=f.getElementsByTagName("STRONG")[0];if(g)g.innerHTML=c.getsub(c.name);else{g=document.createElement("STRONG"),g.className="nui-addr-name",g.unselectable="on",g.innerHTML=c.getsub(c.name);var h=f.getElementsByTagName("EM")[0];a(h).before(g)}if(!c[p]){c[p]=b.id;var i=f.getElementsByTagName("A")[0];i.innerHTML='<b class="nui-ico nui-ico-edit"></b>'}var j="<"+c.getsub(c.address)+">",h=f.getElementsByTagName("EM")[0];h.innerHTML=c.getsub(j)}function k(a){var b=this;if(b.valid!=a){b.valid=a;var c,d=b.getEl();if(a){var e=AddressSupport.getAddrObj(b.address);e?(b[p]=e[p],c='<b class="nui-ico nui-ico-edit"></b>'):c="+",d.removeClass("nui-editableAddr-err")}else d.addClass("nui-editableAddr-err"),c="x";var f=d.dom;f.getElementsByTagName("A")[0].innerHTML=c}}function l(){var a=this,b=a.ownerCt;b.emailinput.move("itemNext",a.getEl()),b.emailinput.set(a.uri),b.removeItem({item:a});var c=0;c=a.name?a.name.length+3:a.address.length,b.emailinput.setPos(c)}var m=a.Component,n=a.Object,o=a.Email,p=a.EMAIL_ID,q=a.createClass($N("component.emailinput.EmailBlock"));n.mix(q,m,{_listeners:[{name:"init",handler:function(){},custom:!0},{name:"keydown",handler:function(){}},{name:"mouseover",handler:function(){var a=m.getItem(this),b=a.getEl(),c=a.valid?"nui-addr-hover nui-editableAddr-hover":"nui-editableAddr-errHover";b.addClass(c)}},{name:"mouseout",handler:function(){var a=m.getItem(this),b=a.getEl(),c=a.valid?"nui-addr-hover nui-editableAddr-hover":"nui-editableAddr-errHover";b.removeClass(c)}},{name:"mousedown",handler:function(){var b=m.getItem(this),c=a.Event.getTarget();if("A"==c.tagName||"A"==c.parentNode.tagName);else{var d=a.Event.get();d.ctrlKey||d.metaKey?b.selected?b.unselect(!0):b.select(!0):b.selected||(b.ownerCt.resetSelectItem(),b.select(!0))}}},{name:"click",handler:function(){var b=m.getItem(this),c=a.Event.get();try{var d=$L("support.AddressSupport")}catch(e){return e}var f=a.Event.getTarget();if("A"==f.tagName||"A"==f.parentNode.tagName)if(b.valid)b[p]?d.contactDialog({type:"modify",addr:{id:b[p]},callback:function(a){b.refreshAddr(a)}}):d.contactDialog({type:"add",addr:{name:b.name,email:b.address},callback:function(a){b.refreshAddr(a)}});else{var g=b.ownerCt;g.removeItem({item:b}),a.Event.cancel()}else{var c=a.Event.get();c.ctrlKey||c.metaKey?b.ownerCt.selectData({allSelect:!0}):(3!=c.which&&b.selected&&(b.ownerCt.resetSelectItem(),b.select(!0)),b.ownerCt.selectData({value:b.getValue().toString()})),b.ownerCt.fire("containerfocus"),b.ownerCt.drag._start=!1}}},{name:"dblclick",handler:function(){var a=m.getItem(this);a.toEdit()}},{name:"render",handler:function(){var a=this;a.getEl().set("key",this.address)},custom:!0}],xtype:"emailblock"},{name:null,address:null,key:null,index:-1,selected:!1,valid:!0,initialize:b,html:c,getValue:d,select:e,unselect:f,getsub:g,setWarn:h,fixWarn:i,refreshAddr:j,setValid:k,toEdit:l})}($,window),function(a){function b(a){i.superClass.initialize.call(this,a)}function c(){var a={};return a}function d(b){a.String.trim(b)&&(this.input.dom.value=b,this.input.dom.select())}function e(){var b=this,c=b.ownerCt,d=c.emailinput,e=a.Event.get(),f=e.which;switch(f){case 8:case 46:c.lastSelectItem&&d.move("itemNext",c.lastSelectItem.getEl()),c.delSelectItem(),c.select();break;case 35:e.shiftKey?c.selectPos("inputRight"):(c.resetSelectItem(),d.move("last"));break;case 36:e.shiftKey?c.selectPos("inputLeft"):(c.resetSelectItem(),d.move("first"));break;case 37:case 38:e.shiftKey?c.selectPos("shiftLeft"):(c.resetSelectItem(),c.lastSelectItem&&d.move("itemPre",c.lastSelectItem.getEl()));break;case 39:case 40:e.shiftKey?c.selectPos("shiftRight"):(c.resetSelectItem(),c.lastSelectItem&&d.move("itemNext",c.lastSelectItem.getEl()));break;case 65:e.ctrlKey||e.metaKey?c.selectAllItem():a.Event.cancel();break;case 67:e.ctrlKey||e.metaKey||a.Event.cancel();break;case 86:e.ctrlKey||e.metaKey?a.Event.cancel():a.Event.cancel();break;case 88:e.ctrlKey||e.metaKey?c.delSelectItem():a.Event.cancel();break;default:a.Event.cancel()}}function f(){var b=this,c=b.ownerCt;c.emailinput;var d=a.Event.get(),e=d.which;switch(e){case 88:c.focus()}}var g=a.Component,h=a.Object,i=a.createClass($N("component.emailinput.EmailHide"));h.mix(i,g,{_template:'<div class="nui-fGetout"><input tabindex="-1" role="presentation" type="text" /></div>',_listeners:[{name:"render",handler:function(){var b=this;b.input=b.getEl().find("INPUT");for(var c=[{name:"keydown",handler:function(){b.keydownAction()}},{name:"keyup",handler:function(){b.keyupAction()}},{name:"focus",handler:function(){}},{name:"blur",handler:function(){}}],d=c.length-1;d>=0;d--){var e=c[d];a.Event.listen(b.input,e.name,e.handler)}},custom:!0}],xtype:"emailhide"},{initialize:b,_getData:c,selectData:d,keydownAction:e,keyupAction:f})}($,window),function(a,b){function c(a){w.superClass.initialize.call(this,a)}function d(a){var b={tabIndex:a.tabIndex>=0?"tabIndex='"+a.tabIndex+"'":"",inputLable:a.inputLable?"aria-label='"+a.inputLable+"'":""};return b}function e(){return this.input.dom.value}function f(a){this.input.dom.value=a,this.syncWidth()}function g(){this.input.dom.value=""}function h(a){var c=this.input.dom;if(a)b.setTimeout(function(){try{c.focus()}catch(a){}},0);else try{c.focus()}catch(d){}}function i(){var a=this.input.dom;a.select()}function j(){var a=this.input.dom;a.blur()}function k(){var b=this,c=b.ownerCt;c.clearTips();var d=b.get(),e=b.getPos(),f=a.Event.get(),g=f.which;switch(g){case 8:if(0==e.start){var h=b.getEl(),i=h.pre();c.removeItem({el:i})}break;case 16:break;case 27:break;case 46:if(d.length==e.start){var h=b.getEl(),j=h.next();c.removeItem({el:j})}break;case 35:f.shiftKey?""==v.trim(d)&&c.selectPos("inputRight"):d.length>0?e.end==d.length&&(c.addItem(d),b.clear(),b.move("last")):""==v.trim(d)&&b.move("last");break;case 36:f.shiftKey?""==v.trim(d)&&(c.selectPos("inputLeft"),a.Event.cancel()):d.length>0?0==e.start&&(c.addItem(d),b.clear(),b.move("first")):0==d.length&&b.move("first");break;case 37:f.shiftKey?""==v.trim(d)&&c.selectPos("shiftLeft"):d.length>0?0==e.start&&(c.addItem(d,"after"),b.clear()):""==v.trim(d)&&b.move("pre");break;case 38:break;case 39:f.shiftKey?""==v.trim(d)&&c.selectPos("shiftRight"):d.length>0?e.end==d.length&&(c.addItem(d),b.clear()):""==v.trim(d)&&b.move("next");break;case 40:break;case 65:(f.ctrlKey||f.metaKey)&&""==v.trim(d)?(c.selectAllItem(),a.Event.cancelBubble()):b.syncWidth();break;case 32:case 59:case 186:case 188:32!=g&&f.shiftKey||(-1==d.indexOf("@")?b.isMobile(d)&&(c.addItem(d),b.clear(),a.Event.cancel()):(c.addItem(d),b.clear(),a.Event.cancel())),b.syncWidth();break;case 86:if(f.ctrlKey||f.metaKey){var d=b.get();d||(b.keydownPaste=!0)}break;default:b.syncWidth()}this.autoComplete()}function l(){var b=this;b.ownerCt;var c=b.get(),d=a.Event.get(),e=d.which;switch(e){case 13:-1==c.indexOf("@")&&b.isMobile(c)&&(b.ownerCt.addItem(c),b.clear());break;case 17:case 91:case 86:b.keydownPaste&&b.paste(),b.syncWidth();break;case 9:case 35:case 36:case 37:case 38:case 39:case 40:break;case 59:case 186:case 188:break;default:b.syncWidth()}b.keydownPaste=!1}function m(){var b=this,c=v.trim(b.get());if(c){var d=a.Uri.getEmails(c,null,!0);d&&d.match&&d.match.length&&(c=c.replace(/[ \t]+ ?(?![^"]+"\s*<)/g,","),b.ownerCt.addItem(c),b.input.dom.value="")}}function n(){var a=this,b=a.get();b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /gi,"&nbsp;"),a.widthSpan.dom.innerHTML=b+"WW"}function o(a){if(!this.ownerCt.domain)return!1;a=a||this.get();var b=/^1\d{10}$/gi;return b.test(a)?!0:!1}function p(a,b,c){var d=this,e=d.ownerCt,f=e.getEl(),g=d.getEl(),h=g.dom;switch(v.trim(d.get())&&(e.addItem(d.get()),d.clear(),d.widthSpan.dom.innerHTML="W"),a){case"first":f.prepend(h);break;case"last":f.append(h);break;case"pre":var i=g.pre();i&&i.dom&&i.before(h);break;case"next":var j=g.next();j&&j.dom&&j.after(h);break;case"itemPre":b&&b.before(h);break;case"itemNext":b&&b.after(h)}c?d.focus(c):d.select()}function q(){function a(a){o.addItem(a),n.clear()}function b(a,b){if(""!=a){var c;try{var c=b.name,d=b.email,e=c.toLowerCase(),f=d.toLowerCase()}catch(g){return}a=v.trim(a).toLowerCase();var h=d;if(c&&(h='"'+c+'"<'+d+">"),""==a)return h;if(1==a.length){if(0==f.indexOf(a)||0==e.indexOf(a)||b.fpy&&0===b.fpy.indexOf(a))return h}else if(f.indexOf(a)>-1||e.indexOf(a)>-1||b.py&&b.py.indexOf(a)>-1||b.fpy&&b.fpy.indexOf(a)>-1)return h}}function c(a){o.addItem(i[a].CONTACTS),n.clear()}function d(a,b){a=v.trim(a).toLowerCase();var c=b.N.toLowerCase();return""==a?null:c.indexOf(a)>-1?!0:void 0}try{var e=$L("support.AddressSupport",this),f=$I("util.AutoComplete")}catch(g){return g}try{if(!e.dataInited)return;if(this.autoCompltedInited)return;this.autoCompltedInited=!0;for(var h=e.data.extDataMap.groupArray||[],i=[],j=0,k=h.length;k>j;j++){var l=h[j];if(l.N&&l.CONTACTS&&l.CONTACTS.length){var m=i.length;l.index=m,i[m]=l}}}catch(g){}var n=this,o=n.ownerCt,p=n.input;new f({product:"emailinput",input:p,fill:a,match:b,groupData:i,groupFill:c,groupMatch:d})}function r(a){var b=this.input.dom;if(b.setSelectionRange)b.focus(),b.setSelectionRange(a,a);else if(b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}}function s(){var a=this.input.dom,c=0,d=0,e=b.document;if(e.selection){var f=e.selection.createRange();f.setEndPoint("EndToStart",a.createTextRange()),c=(f.text||"").length,f=e.selection.createRange(),f.setEndPoint("StartToStart",a.createTextRange()),d=(f.text||"").length}else c=a.selectionStart,d=a.selectionEnd;return{start:c,end:d}}var t=a.Component,u=a.Object,v=a.String,w=a.createClass($N("component.emailinput.EmailInput"));u.mix(w,t,{_template:'<div class="nui-addr nui-editableAddr nui-editableAddr-edit"><input class="nui-editableAddr-ipt" type="text" role="combobox" #{tabIndex} #{inputLable} /><span class="nui-editableAddr-txt">W</span></div>',_listeners:[{name:"render",handler:function(){var b=this,c=this.getEl();b.input=c.find("INPUT"),b.widthSpan=c.find("SPAN");for(var d=[{name:"keydown",handler:function(){b.keydownAction()}},{name:"keyup",handler:function(){b.keyupAction()}},{name:"focus",handler:function(){b.ownerCt.fire("containerfocus")}},{name:"blur",handler:function(){b.ownerCt.addItem(b.get()),b.input.dom.value="",b.widthSpan.dom.innerHTML="W",b.ownerCt.fire("containerblur")}}],e=d.length-1;e>=0;e--){var f=d[e];a.Event.listen(b.input,f.name,f.handler)}},custom:!0}],xtype:"emailinput"},{index:-1,initialize:c,_getData:d,get:e,set:f,clear:g,focus:h,select:i,blur:j,keydownAction:k,keyupAction:l,paste:m,syncWidth:n,isMobile:o,move:p,autoComplete:q,setPos:r,getPos:s})}($,window),function(a){function b(a){var b={text:a.text};return b}var c=a.Component,d=a.Object,e=a.createClass($N("component.emailinput.EmailTips"));d.mix(e,c,{_template:'<label class="nui-ipt-placeholder">#{text}</label>',_listeners:[],xtype:"emailtips"},{_getData:b})}($,window),function(a,b){function c(a){var b=[];if(cb.isArray(a))for(var c=0;c<a.length;c++){var d=eb.getEmail(a[c]);d&&b.push(d)}else"object"==typeof a?b.push(eb.getEmail(a)):b=b.concat(eb.matchEmails(a));return b}function d(b,c){b=db.trim(b).replace(/[，；;]+/g,",");var d=[],e=_.getEmails(b,"Email");return e.match.length>0&&a.Array.each(e.match,function(a,b){b.valid=!0,d.push(b)}),c||e.wrong.length>0&&a.Array.each(e.wrong,function(a,b){var c=new Z(b);c.valid=!1,d.push(c)}),d}function e(a){var b=null;return"string"==typeof a&&db.trim(a)?(b=new _(a,_.type.EMAIL),b.type==_.type.EMAIL?b.valid=!0:(b=new Z(a),b.valid=!1)):"object"==typeof a&&(a.type==_.type.EMAIL?(b=a,b.valid=!0):a[$]&&(b=new Z(a[$],a.FN),b.valid=!0)),b}function f(a){var b=this;b.domain=a.domain,b.itemList=[],b.itemMap={},b.selectItemList=[],b.selectItemMap={},b.tipsItemList=[],b.key=a.key,eb.superClass.initialize.call(b,a),a.containerfocus&&b.listen("containerfocus",a.containerfocus),a.containerblur&&b.listen("containerblur",a.containerblur),a.containerresize&&b.listen("containerresize",a.containerresize),a.containerupdate&&b.listen("containerupdate",a.containerupdate),a.itemwarnremove&&b.listen("itemwarnremove",a.itemwarnremove)}function g(a){var b={cls_type:"",defaultValue:a.defaultValue?a.defaultValue:"",title:a.title?'title="'+a.title+'"':""};!a.tips||a.tips.pos&&"left"!=a.tips.pos||(a.items=[{xtype:"emailtips",type:"tips",text:a.tips.text}]);var c={xtype:"emailinput",tabIndex:a.tabIndex,inputLable:a.inputLable};return b.input=this._getChildHtml(c),b}function h(b){var c=this,d=c.itemList,e=[],f=[],g=[],h=null;if("object"==b&&c.build(!0),"empty"!=b&&"suc"!=b)for(var i=d.length,j=0;i>j;j++){var k=c.itemList[j],l=k.getValue();k.valid?e.push(l):f.push(l),g.push(l)}if("suc"==b){var m=c.getEl();if(m)for(var n=m.find("DIV"),o=n.doms,j=0,i=o.length;i>j;j++){var p=o[j],k=a.Component.getItem(p);if("emailblock"==k.xtype&&k.valid){var l=k.getValue();e.push(l)}}}switch(b){case"object":h={suc:e,fail:f};break;case"array":h=g;break;case"suc":h=e;break;case"fail":h=f;break;case"item":h=d;break;case"empty":h=d.length>0?!1:!0;break;case"dom":h=this.getEl.dom}return h}function i(a){var b=this,c=a.pos||"left";if("left"==c){var d={xtype:"emailtips",text:a.text},e=b.add(d);b.tipsItemList.push(e)}}function j(a,b,c){var d=this;if("string"==typeof a){if(""==db.trim(a))return;d.domain&&d.emailinput.isMobile(a)&&(a+="@"+d.domain)}d.clearTips();var e=d.emailinput.getEl(),f=eb.getEmails(a);b=b||"before";for(var g=!1,h=0;h<f.length;h++){var i=f[h];i.name=db.trim(i.name||"");var j=i.address.toLowerCase();if(!c||i.valid)if(d.itemMap[j]){var k=d.findItem(j);k.render(e.dom,b)}else{({xtype:"emailblock",uri:i,valid:i.valid});var k=new ab({parent:d,uri:i,valid:i.valid});d.add(k,!0),k.render(e.dom,b),d.itemList.push(k),d.itemMap[j]=k,g=!0}}d.checkHeight(),g&&d.fire("containerupdate")}function k(){var b=this;a.Array.each(b.itemList,function(a,b){b.destroy()}),b.itemList=[],b.itemMap={},b.checkHeight(),b.fire("containerupdate")}function l(a){this.clearItem(),this.addItem(a)}function m(a){for(var b=this,c=eb.getEmails(a),d=0;d<c.length;d++){var e=c[d].address.toLowerCase();b.removeItem({address:e})}}function n(a,b){for(var c=this,d=eb.getEmails(a),e=0;e<d.length;e++){var f=d[e].address.toLowerCase(),g=c.findItem(f);g&&g.setValid(b)}}function o(){}function p(){}function q(){this.emailinput.autoComplete()}function r(){return this.emailinput.get()}function s(){this.emailinput.select()}function t(){this.emailinput.focus()}function u(){this.emailinput.blur()}function v(a){var b=this,c=db.trim(b.getInputValue());c&&(b.addItem(c,null,a),b.emailinput.set(""))}function w(){var b=this;b.clearTips(),a.Array.each(b.itemList,function(a,b){b.destroy()}),b.tipsItemList&&b.tipsItemList.length&&a.Array.each(b.tipsItemList,function(a,b){b.destroy()}),b.menu&&b.menu.destroy(),delete b.itemList,delete b.selectItemList,delete b.tipsItemList,delete b.menu;for(var c in b.itemMap)delete b.itemMap[c];for(var c in b.selectItemMap)delete b.selectItemMap[c]}function x(){for(var b=this,c=b.getEl(),d=c.find("DIV"),e=d.doms,f=0,g=e.length;g>f;f++){var h=e[f];a.Component.getItem(h).index=f}}function y(b){var c=this;b=b.toLowerCase();var d=null;return a.Array.each(c.itemList,function(c,e){return e.key==b?(d=e,a.BREAK):void 0}),d}function z(b){var c=this;c.buildIndex();var d=[],e=c.emailinput.index;switch(b){case"shiftLeft":return c.shiftIndex--,c.shiftIndex+e<0&&(c.shiftIndex=-e),c.findItemsByPos("shift");case"shiftRight":return c.shiftIndex++,c.shiftIndex+e>c.itemList.length&&(c.shiftIndex=c.itemList.length-e),c.findItemsByPos("shift");case"shift":a.Array.each(c.itemList,function(a,b){(b.index<e&&b.index>=e+c.shiftIndex||b.index>e&&b.index<=e+c.shiftIndex)&&d.push(b)}),c.resetSelectItem(!0);break;case"inputLeft":a.Array.each(c.itemList,function(a,b){b.index<e&&d.push(b)}),c.resetSelectItem();break;case"inputRight":a.Array.each(c.itemList,function(a,b){b.index>e&&d.push(b)}),c.resetSelectItem()}return d}function A(b,c){for(;"DIV"!=b.tagName;)b=b.parentNode;if(b){var d=a.Component.getItem(b);if(d)return c?d.xtype==c?d:null:d}return null}function B(){var b=this,c="";a.Array.each(b.itemList,function(a,d){b.selectItemList.push(d),b.selectItemMap[d.key]=!0,d.select(),c+=d.getValue()+";"}),b.selectData({value:c})}function C(b){var c=this,d="";b.value&&(d=b.value),b.allSelect&&a.Array.each(c.selectItemList,function(a,b){d+=b.getValue()+";"}),c.emailhide.selectData(d)}function D(b){var c=this;a.Array.each(c.selectItemList,function(a,b){b.unselect()}),c.selectItemList=[],c.selectItemMap={},b||(c.shiftIndex=0)}function E(a){var b=this,c=a.key,d=b.selectItemMap;d[c]||(d[c]=a,b.selectItemList.push(a),a.select())}function F(a){for(var b=this,c="",d=b.findItemsByPos(a),e=0,f=d.length;f>e;e++){var g=d[e];b.selectItem(g),c+=g.getValue()+";"}b.selectData({value:c})}function G(b){var c=this,d=b.key,e=c.selectItemMap;e[d]&&(e[d]=null,a.Array.remove(c.selectItemList,b),b.unselect())}function H(){var b=this;a.Array.each(b.selectItemList,function(c,d){a.Array.remove(b.itemList,d),b.itemMap[d.key]=null,d.destroy(),d.warn&&b.fire("itemwarnremove",d.key)}),b.selectItemList=[],b.selectItemMap={},b.checkHeight()}function I(b){var c=this,d=null;if(b.el&&b.el.dom?d=a.Component.getItem(b.el.dom):b.address?d=c.findItem(b.address):b.item&&(d=b.item),d){var c=this;a.Array.remove(c.itemList,d),c.itemMap[d.key]=null,a.Array.remove(c.selectItemList,d),c.selectItemMap[d.key]=null,d.destroy(),d.warn&&c.fire("itemwarnremove",d.key),c.checkHeight(),c.fire("containerupdate")}}function J(){var b=this;b.tipsItemList&&b.tipsItemList.length&&(a.Array.each(b.tipsItemList,function(a,b){b.destroy()}),b.tipsItemList=[])}function K(){var a=this,b=this.getEl().dom.scrollHeight;a.height!=b&&(a.height=b,this.fire("containerresize"))}function L(){var b=this;if(""==db.trim(b.getInputValue())){var c=a.Event.get();b.selectStartX=c.pageX,b.selectStartY=c.pageY,b.buildIndex(),b.mousemove=a.Function.bind(b.mouseSelect,b),a.Event.listen(document,"mousemove",b.mousemove),a.Event.listen(document,"mouseup",function(){b.mousemove&&(a.Event.unlisten(document,"mousemove",b.mousemove),b.mousemove=null)})}}function M(){var b=this,c=b.getEl();if(c&&c.dom){var d=a.Event.get(),e=d.pageX,f=d.pageY,g=e-b.selectStartX,h=f-b.selectStartY;if(Math.abs(h)>10||Math.abs(g)>10){b.isSelect=!0;var i=c.dom,j=i.childNodes,k=b.getPosition(),l=k[0],m=k[1],n=k[2],o=k[3],p=j[0];e<o+p.offsetLeft&&(e=o+p.offsetLeft+1),e>m&&(e=m-1),f<=l+p.offsetTop&&(f=l+p.offsetTop+1),f>n-4&&(f=n-4);for(var q=null,r=null,s=0,t=j.length;t>s;s++){var u=j[s],v=l+u.offsetTop,w=e<=o+u.offsetLeft+2;f<=v+u.offsetHeight;var x=v>=f,y=f>v&&f<=v+u.offsetHeight,z=e>o+u.offsetLeft&&e<o+u.offsetLeft+u.offsetWidth+2;if(y&&z){if(b.findItemByDom(u,"emailblock")){q=u;break}return b.resetSelectItem(),void 0}if(!w&&x){if(u.previousSibling){q=u.previousSibling;break}}else y&&(r=u)}if(q||r&&b.findItemByDom(r,"emailblock")&&(q=r),!q)return b.resetSelectItem(),void 0;try{var A=b.emailinput.index,B=b.findItemByDom(q,"emailblock").index}catch(C){return}var D=[],E="";b.resetSelectItem(),A>B?a.Array.each(b.itemList,function(a,b){b.index>=B&&b.index<A&&D.push(b)}):a.Array.each(b.itemList,function(a,b){b.index<=B&&b.index>A&&D.push(b)});for(var s=0,t=D.length;t>s;s++){var F=D[s];b.selectItem(F),E+=F.getValue()+";"}b.selectData({value:E})}}}function N(){var b=this,c=b.getEl();if(c&&c.dom){var d=c.dom,e=d.childNodes,f=b.getPosition(),g=f[3],h=f[0],i=0;try{i=document.getElementById(a.Context.module.createId("main")).scrollTop||0}catch(j){}for(var k=a.Event.get(),l=k.pageX,m=k.pageY+i,n=!1,o=0,p=e.length;p>o;o++){var q=e[o],r=h+q.offsetTop,s=l<=g+q.offsetLeft+2,t=m<=r+q.offsetHeight,u=r>=m;if(s&&t||!s&&u){n=!0,b.emailinput.move("itemPre",a(q),!0);break}}n||b.emailinput.move("last",null,!0)}}function O(){for(var a=this.getEl().dom,b=[0,a?a.offsetWidth:0,a?a.offsetHeight:0,0],c=a;c;c=c.offsetParent)b[3]+=c.offsetLeft,b[0]+=c.offsetTop-(document.all?c.offsetParent?c.scrollTop:0:0);return b[1]+=b[3],b[2]+=b[0],b}function P(){var b=this,c=a.Event.get();if(3!=c.which){var d=a.Event.getTarget(),e=b.findItemByDom(d);if(e&&"emailblock"==e.xtype){var f,c=a.Event.get(),g=b.dragItem,h=b.selectItemList.length;f=h>1?'<div class="nui-addr nui-editableAddr"><em class="nui-addr-email">您选择了'+h+"个地址</em></div>":e.getEl().dom.innerHTML,g.getEl().html(f);var i=g.getEl().dom;i.style.left=c.pageX+2+"px",i.style.top=c.pageY+2+"px",b.drag._start=!0}}}function Q(){this.dragItem.show()}function R(){var b=this,c=a.Event.getTarget(),d=b.findItemByDom(c);!d||"emailcontainer"!=d.xtype&&"emailcontainer"!=d.owenCt.xtype?(b.locate(),b.destItem=b):("emailcontainer"!=d.xtype&&(d=d.owenCt),d!=b?(d.locate(),d.fire("containerfocus"),b.destItem=d):(b.locate(),b.destItem=b))}function S(){var b=this;if(0!=b.drag._start&&(b.drag._start=!1,b.dragItem.hide(),b.destItem)){var c=[];a.Array.each(b.selectItemList,function(a,b){b.valid?c.push(b.getValue()):c.push(b.getValue().toString())}),b.delSelectItem(),b.destItem.addItem(c)}}function T(){var b,c=this,d="nui-menu-item-disabled";if(c.menu)b=c.menu.find("menuitem");else{var e={xtype:"menu",width:110,hidden:!0,groups:[{items:[{text:"剪切    Ctrl+X",click:function(){c.menuCut()}},{text:"复制    Ctrl+C",click:function(){c.menuCopy()}},{text:"粘贴    Ctrl+V",click:function(){c.menuPaste()}},{text:"删除    Delete",click:function(){c.delSelectItem()}},{type:"split"},{text:"全选    Ctrl+A",click:function(){c.selectAllItem()}}]}]};c.menu=new a.Menu(e),c.menu.render(document.body),b=c.menu.find("menuitem"),Y.isIE()||(b[0].getEl().addClass(d),b[1].getEl().addClass(d))}var f=a.Event.getTarget(),g=c.findItemByDom(f);if(g)switch(g.xtype){case"emailinput":return;case"emailblock":Y.isIE()&&(b[0].getEl().removeClass(d),b[1].getEl().removeClass(d)),b[3].getEl().removeClass(d),a.Event.cancel();break;case"emailcontainer":Y.isIE()&&(b[0].getEl().addClass(d),b[1].getEl().addClass(d)),b[3].getEl().addClass(d),a.Event.cancel()}var h=a.Event.get(),i=h.pageX+"px",j=h.pageY+"px",k=c.menu.getEl();k.css({top:j,left:i}),c.menu.show()}function U(){this.menuCopy()&&this.delSelectItem()}function V(){var c="";a.Array.each(this.selectItemList,function(a,b){c+=b.getValue()+";"});try{if(b.clipboardData)return b.clipboardData.clearData(),b.clipboardData.setData("Text",c),!0}catch(d){}}function W(){var a=this;if(Y.isIE())try{var c=b.clipboardData.getData("Text");return c&&(a.emailinput.set(c),a.emailinput.paste()),void 0}catch(d){}var c=b.prompt("因为您的浏览器安全设置原因，不能直接访问剪贴板内容，需要重新粘贴一次。\n\n请使用键盘快捷键(Ctrl+V)把内容粘贴到下面的方框里，再按 确定。");a.emailinput.set(c),a.emailinput.paste()}var X=a.Component,Y=a.Browser,Z=a.Email,$=a.EMAIL_ADDRESS,_=a.Uri;try{var ab=$L("component.emailinput.EmailBlock");$L("component.emailinput.EmailTips"),$L("component.emailinput.EmailInput"),$L("component.emailinput.EmailHide")}catch(bb){return bb}var cb=a.Object,db=a.String,eb=a.createClass($N("component.emailinput.EmailContainer"));cb.mix(eb,X,{_template:'<div class="nui-multiLineIpt C-multiLineIpt nui-ipt#{cls_type}" #{title} unselectable="on">#{input}</div>',_events:["containerfocus","containerblur","containerresize","containerupdate","itemwarnremove"],_listeners:[{name:"init",handler:function(){},custom:!0},{name:"mousedown",handler:function(){var b=a.Event.getTarget(),c=X.getItem(this),d=c.findItemByDom(b);if(d)switch(d.xtype){case"emailblock":break;case"emailinput":c.resetSelectItem(),c.clearTips(),c.initSelect();break;case"emailcontainer":c.locate(),c.resetSelectItem(),c.clearTips(),c.initSelect();break;case"emailhide":c.clearTips(),c.locate(),c.fire("containerfocus");break;case"emailtips":c.clearTips(),c.locate(),c.fire("containerfocus");break;default:c.clearTips(),c.locate(),c.fire("containerfocus")}else c.clearTips(),c.locate(),c.fire("containerfocus")}},{name:"click",handler:function(){}},{name:"mouseover",handler:function(){var a=X.getItem(this).getEl();a.addClass("nui-ipt-hover")}},{name:"contextmenu",handler:function(){var a=X.getItem(this);a.contextMenu()}},{name:"keydown",handler:function(){}},{name:"mouseout",handler:function(){var a=X.getItem(this).getEl();a.removeClass("nui-ipt-hover")}},{name:"render",handler:function(){var c=this;c.emailinput=c.find("emailinput")[0];var d={xtype:"emailhide"},e=c.add(d,!0);if(e.render(c.getEl().dom,"before"),c.emailhide=c.find("emailhide")[0],!a.Browser.firefox()){c.dragItem=new X({renderTo:b.document.body,hidden:!0,html:'<div class="nui-addr nui-editableAddr nui-editableAddr-hover nui-editableAddr-draging" style="left:0px;top:0px;"></div>'});var f=a.getClass("netease.mail.util.DragDrop");this.drag=new f({drag:c.dragItem.getEl().dom,trigger:c.getEl().dom,triggerOffset:5,noListenerSelect:!0,listeners:[{name:"mousedown",handler:a.Function.bind(c._dragInit,c)},{name:"start",handler:a.Function.bind(c._dragStart,c)},{name:"drag",handler:a.Function.bind(c._dragMove,c)},{name:"drop",handler:a.Function.bind(c._dragDrop,c)}]}),c.drag._start=!1}},custom:!0},{name:"afterRender",handler:function(){var a=this,b=a.find("emailtips");b&&(a.tipsItemList=a.tipsItemList.concat(b))},custom:!0}],xtype:"emailcontainer",getEmails:c,matchEmails:d,getEmail:e},{itemList:null,itemMap:null,selectItemList:null,selectItemMap:null,tipsItemList:null,height:0,shiftIndex:0,selectStartX:0,selectStartY:0,key:null,_getData:g,initialize:f,get:h,addItem:j,clearItem:k,setItem:l,delItem:m,setItemValid:n,choose:o,leave:p,select:s,focus:t,blur:u,build:v,exit:w,initComplete:q,getInputValue:r,buildIndex:x,findItem:y,findItemByDom:A,findItemsByPos:z,selectData:C,selectAllItem:B,resetSelectItem:D,selectItem:E,selectPos:F,unselectItem:G,delSelectItem:H,removeItem:I,addTips:i,clearTips:J,_dragInit:P,_dragStart:Q,_dragMove:R,_dragDrop:S,contextMenu:T,menuCut:U,menuCopy:V,menuPaste:W,checkHeight:K,initSelect:L,mouseSelect:M,locate:N,getPosition:O})}($,window),function(a,b){function c(b){return r.isArray(b)?b=b.join(",")||"":r.isString(b)||(b=""),a.String.encodeHTML(b)}function d(){var b=x.cards;if(!(b.length<=0))for(var c=b.length-1;c>=0;c--){var d=b[c];try{var e,f=d.rawConfig;if(!f.doNotHide&&!f.tmpDoNotHide){var g,h=d.getEl();try{g=a.Event.getTarget()}catch(i){}h&&g&&(e=h&&a.Element.inside(g,h)),e||d.close()}f.tmpDoNotHide=null}catch(i){}}}function e(b){var c=this;try{o=$L("support.AddressSupport"),p=$L("component.contact.ContactEdit")}catch(d){return d}x.hideCard(),b.scrollEl||(b.scrollEl=document.body);var e,f=o.data.extDataMap.contact,g=b.info||{};g.cid||b.cid?(e=f[g.cid||b.cid],c.contact=e,c.isNew=!1):g.email?(e=o.getAddrObj(g.email),e?(c.contact=e,c.isNew=!1):(c.isNew=!0,c.newInfo={email:g.email,name:a.Uri.getDefaultName(g.email)})):(c.isNew=!0,c.newInfo={email:"",name:""}),x.cards.push(c),x.superClass.initialize.call(c,b)}function f(){var a=this,b=a.rawConfig;!a.isNew&&b.del?b.del.call(a,a.contact):o.deleteContact({contacts:[a.contact.CID],call:function(){a.fire("del")},error:function(){a.fire("delError")}}),a.close()}function g(){var a=this,b=a.rawConfig;!a.isNew&&b.edit?b.edit.call(a,a.contact):p.show({cid:a.contact.CID}),a.fire("edit"),a.close()}function h(){var b=this,c=b.newInfo||{};b.hide(),o.contactDialog({type:"add",addr:{name:a.String.encodeHTML(c.name||""),email:c.email},callback:b.rawConfig.addOneCb})}function i(){var a=this;a.fire("close"),a.closeTimer&&(clearTimeout(a.closeTimer),a.closeTimer=null),a.destroy()}function j(b){try{q.cache({contact_card_compose_click:1},function(a,b){a.value=(+a.value||0)+ +b})}catch(c){}var d;try{d=$L("interface.ComposeInterface")}catch(c){return c}if(!b)return a.Tips.show({text:"请先选择联系人"}),void 0;var e=[];r.isObject(b)?e.push(b):b.length>0&&e.push(b),d.compose.apply(d,[{info:{to:e}}])}function k(b,c){try{q.cache({contact_card_related_click:1},function(a,b){a.value=(+a.value||0)+ +b})}catch(d){}var e;if(!b)return a.Tips.show({text:"该联系人无邮箱",succ:!0}),void 0;try{e=$L("interface.MboxInterface")}catch(d){return d}e.contacts({email:b},{cid:c})}function l(){var b=this,c=b.formContact.mail;if(c.length>0&&c[0].value&&(a.Ext.avatar_show||c[0].value===y))try{var d=$I("init.Avatar");d.get(c[0].value,180,c[0].value!==y,function(a,c){if(!c){var d=b.getEl().find(".uW0 IMG").dom;d.src=a}})}catch(e){}}function m(a){var b=this,c={hasSubTemplate:!0,closeIcon:a.noClose?"":b._getChildHtml({xtype:"link",text:'<b class="nZ0 nui-ico nui-ico-close">x</b>',cls:"nui-layer-close",click:s.bind(b.close,b)}),delBtn:a.noDel||b.isNew?"":b._getChildHtml({xtype:"button",text:"删 除",icon:"trash",click:s.bind(b.del,b)}),editBtn:a.noAction?"":b.isNew?b._getChildHtml({xtype:"button",subclass:"mainBtn",text:"添加",click:s.bind(b.addOne,b)}):b._getChildHtml({xtype:"button",subclass:"mainBtn",text:"编 辑",click:s.bind(b.edit,b)}),closeBtn:b._getChildHtml({xtype:"button",text:"关 闭",click:s.bind(b.close,b)})};return c.content=b._getContentHtml(a),c}function n(){function b(){return x.encodeHTML(o.parseName(B)||"未命名")}function c(){var c=b(),d="";return(B["X-PHONETIC-LAST-NAME"]||B["X-PHONETIC-FIRST-NAME"])&&(d="&nbsp;<span>("+t.encodeHTML(B["X-PHONETIC-LAST-NAME"]||"")+" "+t.encodeHTML(B["X-PHONETIC-FIRST-NAME"]||"")+")</span>"),c='<strong class="fN0" title="'+c+'">'+c+"</strong>"+d,a.Link.html({icon:B.MARKED?"star-selected":"star",click:function(){var a=z.rawConfig;a.mark&&a.mark.call(z,z.contact)}})+"&nbsp&nbsp"+c}function d(b){return a.Ext.contact_TDCode?'<img class="gE0" src="../contacts/call.do?from=webmail&cmd=newapi.formContactsInfo&vcardver=3.0&type=qrcode&uid='+y+"&sid="+$S("sid")+"&cid="+b+'" alt="二维码" title="二维码"></img>':""
}function e(){return B.NICKNAME?q(x.encodeHTML(B.NICKNAME),"昵称"):""}function f(){return B.GENDER||""}function g(){if(B.BDAY||B["BDAY;value=date"]){var a=B.BDAY||B["BDAY;value=date"];return a=a.replace(/^0/,""),a=a.replace(/(\d{3,4})(\d{2})(\d{2})/,"$1年$2月$3日").replace("1604年",""),q(x.encodeHTML(a),"生日")}return""}function h(a,b,c){var d="";switch(a){case"URL;type=pref":var e=F.url;d=b[a]||b.URL||e[0]?e[0].value:"";break;default:d=b[a]}return d?(d=v(a,d,b),q(d,c||w.keyMap[a]||"")):""}function i(){if(B.JINIAN||B.ANNIVERSARY){var a=B.JINIAN||B.ANNIVERSARY;return j(a,"date")}return""}function j(b,c){var d,e,f,g,h="";if(!b)return h;d=b.split(";");for(var i,j=0,k=d.length;k>j;j++)if(i=d[j]){e=i.split(":"),f=2===e.length?e[0]:"other",g=e[e.length-1];var l={im:a.ADDR_IM_TITLE,date:a.ADDR_MEMORIAL_DAY}[c];r.each(l,function(a){a===f&&("date"===c&&(g=g.replace(/(\d{1,4})-(\d{1,2})-(\d{1,2})/g,"$1年$2月$3日")),g=v(c,g,B),h+=q(g,l[f]))})}return h}function k(){var a=B.GROUPING||B.Grouping||"",b=a.split(";"),c=[];b[0]&&""!==b[0]&&A[b[0]]&&c.push(A[b[0]].N);for(var d=1,e=b.length;e>d;d++)A[b[d]]&&c.push(A[b[d]].N);return q(x.encodeHTML(c.join(" ; ")),"所属分组")}function l(a,b){var c="";return a.length>0&&u.each(a,function(a,d){var e=v(b,d.value,B);c+=q(e,d.text||w.keyMap[d.fKey||""]||"",d.value)}),c}function m(a){var b="";return a.length>0&&u.each(a,function(a,c){if(c.label){var d=v(c.key,c.value,B);b+=q(d,c.label,c.value)}}),b}function n(b){return a.Email.checkMobile(b)?a.Icon.html({type:"phone"}):""}function p(b){return/@(vip\.163|vip\.126|188|vip\.188)\.com$/i.test(a.String.trim(b))?a.Icon.html({xtype:"icon",type:"user",subtype:"vip"}):""}function q(a,b,c,d){return a=t.trim(a),a||d?['<dl class="',"电子邮箱"===b?"ou0 jS1":"ou0",'">','<dt class="iX0">',b+"：","</dt>",'<dd class="is0">','<span title="',x.encodeHTML((c||a).replace(/&nbsp;/g,"")),'">',a||"&nbsp;","</span>","</dd>","</dl>"].join(""):""}function v(b,c,d){var e="";switch(b){case"MAIL":case"MAILHOME":case"MAILWORK":return e=o.parseName(d)||"未命名",[p(c),x.encodeHTML(c),"&nbsp;",n(c),"&nbsp;&nbsp;&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"envelop",attrs:'title="写信"',click:function(){z.gotoCompose(new a.Email(c,e)),z.close()}}),"&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"dealings",attrs:'title="邮件往来"',click:function(){z.gotoMbox(c,d.CID),z.close()}})].join("");case"TEL;CELL":case"TEL;HOME;VOICE":case"TEL;WORK;FAX":case"TEL;WORK;VOICE":return x.encodeHTML(c);case"adr":return x.encodeHTML(w.parseADR(c));default:return x.encodeHTML(t.trim(c)).replace(/\n/gi,"<br>")}}var z=this,A=o.data.extDataMap.group,B=z.contact,C=z.newInfo||{};if(z.isNew&&!C.email)return'<div class="sD0 ot0">#{closeIcon}这个联系人还没有信息。 '+z._getChildHtml({xtype:"link",text:"现在添加",click:s.bind(z.addOne,z)})+"</div>";if(z.isNew&&C.email){var D=C.email;return sEmailHtml=[p(D),x.encodeHTML(D),"&nbsp;",n(D),"&nbsp;&nbsp;&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"envelop",attrs:'title="写信"',click:function(){z.gotoCompose(new a.Email(D,C.name)),z.close()}}),"&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"dealings",attrs:'title="邮件往来"',click:function(){z.gotoMbox(D),z.close()}})].join(""),['<div class="sD0">',"#{closeIcon}<h1>查看联系人</h1>",'<div class="jZ0">','<strong class="fN0" title="',C.name,'">',C.name,"</strong>","</div>",'<div class="pf0 nui-scroll contact_info_layer">',q(sEmailHtml,"邮箱地址",C.email||" "),q("","手机号码",!1,!0),"</div>","</div>"].join("")}var E=B.CID,F=z.formContact=w.formatContact(B),G=F.mail||[],H=a.Ext.avatar_show&&G[0]&&G[0].value===y&&a.Email.checkFree(y);return['<div class="sD0">',"#{closeIcon}<h1>查看联系人</h1>",H?'<a href="javascript:void(0);" class="uW0 nui-faceEdit nui-faceEdit-100">':'<span class="uW0 nui-faceEdit nui-faceEdit-100">','<img src="http://mimg.127.net/p/js6/lib/img/noface.gif" class="nui-faceEdit-face" alt="',b(),'的头像">',H?'<span class="nui-faceEdit-tips">点击编辑头像</span>':"",H?"</a>":"</span>",'<div class="jZ0">',c(),"</div>","<!-- 详情列表 Start -->",'<div class="pf0 nui-scroll contact_info_layer">',d(E),'<div class="fu1"></div>',e(),f(),l(F.mail,"MAIL")||q("","邮箱地址",!1,!0),l(F.tel,"TEL;CELL")||q("","手机号码",!1,!0),l(F.fax,"TEL;CELL"),l(F.icq,"im"),l(F.adr,"adr"),g(),h("ZS",B),i(),h("URL;type=pref",B),h("ORGNAME",B),h("ORG",B),h("TITLE",B),h("ROLE",B),h("MEMBER",B),h("LOGO",B),h("RELATED",B),h("LANG",B),h("TZ",B),h("GEO",B),k()||q("","所属分组",!1,!0),m(F.other),"</div>","</div>"].join("")}var o,p,q=a.Log||b.Log,r=a.Object,s=a.Function,t=a.String,u=a.Array,v=a.getClass("netease.mail.component.Component"),w=$I($N("util.Contact")),x=a.createClass($N("component.contact.ContactCard")),y=$S("orgUid");a.fly(document).listen("click",function(){x.hideCard()}),r.mix(x,v,{xtype:"contactcard",_template:['<div class="nui-layer nui-layer-arrLeft oC0">','<b class="nui-layer-arr"></b>','<div class="nui-layer-normal">',"#{content}",'<div class="ny0">','<div class="fR0">',"#{delBtn}","</div>",'<div class="fj0">',"#{editBtn}#{closeBtn}","</div>","</div>","</div>","</div>"].join(""),_listeners:[{name:"render",handler:function(){var b=this,c=b.rawConfig,d=b.getEl(),e=d.dom.firstChild,f=b.rawConfig.floatTo;if(b.checkAvatar(),f){d.show();var g=d.find("div.contact_info_layer"),h=g.dom.offsetHeight;h-380>0&&(g.dom.style.height="380px");var i,j,k=a.fly(f).offset(),l=k.x+f.offsetWidth;c.positionX&&(l=Math.min(l,c.positionX));var m=k.y,n=c.scrollEl.scrollTop,o=m-n,p=o-60,q=document.body.clientHeight;h=d.dom.offsetHeight;var s=q-p-h,t=a.Browser.isIE()?4:2;i=0>s?q>=h?p+s:p:p,j=o-i+7;var u=137-o,v=q-o;u>0&&38>u&&(j+=u/2),38>v&&(v>12?j-=38-v-t:j=-1),j>-1?(e.style.top=j+"px",e.style.display=""):e.style.display="none",d.css({left:l+"px",top:i+"px",visibility:"",display:"block"});try{var w,z,A=a.Event.getEvent();A&&(z=a.Event.getTarget(),w=z&&z.nodeType),b.rawConfig.tmpDoNotHide=w}catch(B){b.rawConfig.tmpDoNotHide=!0}a.Component.setEvents();var C=b.formContact.mail||[0];if(a.Ext.avatar_show&&C[0]&&C[0].value===y&&a.Email.checkFree(y)){var D=b.getEl().find("span.nui-faceEdit-tips");a.Event.listen(D,"click",function(){var a=r.clone(b.rawConfig);b.close(),$E("support.OptionSupport",function(b){b.avatarUploader({uploader:function(){try{new x(a)}catch(b){}},cancel:function(){}})})})}}},custom:!0},{name:"destroy",handler:function(){var b=this;a.Array.each(x.cards,function(c,d){return d===b?(x.cards.splice(c,1),a.BREAK):void 0})},custom:!0},{name:"mouseout",handler:function(b){var c=this;if(!a.Event.isMouseout(c,b))return!1;var d=v.getItem(c);d.closeTimer=setTimeout(function(){d.close()},2e3)}},{name:"mouseover",handler:function(b){var c=this;if(!a.Event.isMouseover(c,b))return!1;var d=v.getItem(c);d.closeTimer&&(clearTimeout(d.closeTimer),d.closeTimer=null)}}],cards:[],encodeHTML:c,hideCard:d},{initialize:e,del:f,edit:g,addOne:h,close:i,gotoCompose:j,gotoMbox:k,checkAvatar:l,_getData:m,_getContentHtml:n})}($,window),function(a,b,c){function d(b){var c=new P(b);if(a.Msgbox.show({header:b.cid?"编辑联系人":"新建联系人",contentType:"wide",top:"157px",width:"428px",content:c.html(),ok:K.bind(c.submit,c),cancel:K.bind(c.cancel,c),listeners:{destroy:K.bind(c.destroy,c),render:function(){O.setEvents(),setTimeout(function(){try{c.components.name[0].input.focus()}catch(a){}},10)}},close:b.close}),c.initData(b),O.setEvents(),b.hideMark)try{var d=c.components.MARKED[0].checkbox;d.setChecked(!1),d.getEl().findParent("dl.ou0",!1,!0).hide()}catch(e){}}function e(b){var c=this;try{G=$L("support.AddressSupport"),H=$L("support.AddressSupportAction")}catch(d){return d}c.components={name:[],MAIL:[],TEL:[],ZS:[],MARKED:[],GROUP:[],FAX:[],ADR:[],ICQ:[],date:[],"URL;type=pref":[],ORGNAME:[],ORG:[],TITLE:[],ROLE:[],MEMBER:[]},c.formatContact={mail:[],tel:[],fax:[],adr:[],url:[],icq:[],date:[],other:[]},c.boolGroup={},P.superClass.initialize.call(c,b);var e=b.cid;G.data.rawDataArray.group;var f=G.data.extDataMap.contact;c.contact=e?f[e]:b.data,c.action=new H(G),c.inContactModule="contact.ContactModule"===(a.Context.getModule()||{}).mtype,c.curModule=a.Context.getModule()}function f(){var a=this,b={};return b.normalContent=a.getBaseHtml(),b.moreInfo=a.getMoreInfoHtml(),b}function g(){var b,d=this,e="",f=d.components,g="input_N",h=new a.Input({inputId:g});b=a.Link.html({text:"详细",title:"编辑详细姓名",extcls:"nui-txt-link nui-txt-s12",click:K.bind(d.clickShowDetail,d,"name")}),e+=d._getDlHtml("姓名",h.html()+b,c,g),f.name.push({input:h,nickname:"",n:""}),e+=d._getDivHtml(["MAIL"]);var i=new a.Checkbox({text:"设为星标联系人"});e+=d._getDlHtml("",i.html()+'<b class="nui-ico nui-ico-help" title="设为星标联系人后，该联系人将添加至收件箱的左侧栏，您可以很方便的查看他们的往来邮件哦！"></b>'),f.MARKED.push({checkbox:i}),e+=d._getDivHtml(["TEL"]),g="input_DETAIL";var j=new a.Input({subclass:"multiLineIpt",rows:2,inputId:g});return e+=d._getDlHtml("备注",j.html(),c,g),f.ZS.push({input:j}),b=["<div>",a.Button.html({text:"请选择",extcls:"ef0",click:a.Function.bind(d.clickShowGroupEdit,d)}),'</div><div style="display:none;"></div>'].join(""),e+=d._getDlHtml("分组",b,"contact_edit_group")}function h(){var a=this,b="";return a.bBDAY=!0,b+=a._getDivHtml(["FAX","ADR","ICQ","date"]),M.each(P.otherArray,function(c,d){b+=a._getMulDlHtml(d)}),b}function i(b){var c=this;c.delItems={},c.components;var d,e=G.data.rawDataArray.group,f=G.data.extDataMap.contact,g=c.boolGroup={},h=b.cid,i=[];c.filled=!1,c.newContact=!1;try{var j=h?f[h]:b.data;if(h?(j=f[h],j&&b.data&&I.isObject(b.data)&&(j=I.clone(j),delete b.data["EMAIL;PREF"],I.extend(j,b.data))):j=b.data,c.contact=j,j){c.formatContact=N.formatContact(j),c.maxItem=c.formatContact.maxItem,delete c.formatContact.maxItem,d=c.formatContact,I.each(d,function(a,b){"url"!==a&&"other"!==a&&b.length<=0&&b.push({key:"",value:"",bEmpty:!0})});var k=j.GROUPING||j.Grouping||"";if(k){var l=k.split(";");M.each(e,function(b,c){var d=c.CID;M.each(l,function(b,c){return c===d?(l.splice(b,1),g[d]=!0,i.push(d),a.BREAK):void 0})}),c.fillGroup(i)}c.fillDate(),c.fillSingle(j),c.fillMulti(),c.filled=!0}else{d=c.formatContact,I.each(d,function(a,b){"url"!=a&&"other"!=a&&b.length<=0&&b.push({key:"",value:"",bEmpty:!0})}),c.newContact=!0;var m=c.inContactModule&&c.curModule?c.curModule.currentGroup:null;m&&(M.each(e,function(a,b){m==b.CID&&(g[m]=!0,i.push(m))}),c.fillGroup(i))}}catch(n){}}function j(b,c){switch(b){case"date":if(-1===c.search(/^(\d){2,4}-(1[0-2]|0?[1-9])-(0?[1-9]|[12][0-9]|3[01])$/gi))return!0;break;case"zs":if(L.len(c)>1e3)return!0;break;case"N":case"ADR":if(c.indexOf(";")>-1)return!0;break;case"MAIL":case"EMAIL":case"EMAIL;type=INTERNET":case"EMAIL;type=INTERNET;type=HOME":case"EMAIL;type=INTERNET;type=WORK":if(""==c||/[,;]/gi.test(c))return!0;var d=a.Uri.getEmails(c);if(d.wrong.length>0)return!0;break;default:return!1}return!1}function k(){var b,c=this,d=c.editField,e=c.components;switch(a.Msgbox.msgbox.footer.html(""),d){case"group":c.boolGroup={};var f=[];M.each(e.GROUP,function(a,b){b.getChecked()&&f.push(b.value),b.destroy()}),c.fillGroup(f);break;case"name":var g=L.trim($C("contactDialogNickName").getValue()),h=L.trim($C("contactDialogFront").getValue()),i=L.trim($C("contactDialogFirstName").getValue()),j=L.trim($C("contactDialogMidName").getValue()),k=L.trim($C("contactDialogFamilyName").getValue()),l=L.trim($C("contactDialogEnd").getValue()),m=[k,i,j,h,l];b=e.name[0],b.nickname=g,b.n=m.join(";"),b.input.setValue(G.parseN(m)),a("#contact_edit_details").empty();break;case"ADR":var n=L.trim($C("contactDialogCountry").getValue()),o=L.trim($C("contactDialogProvince").getValue()),p=L.trim($C("contactDialogCity").getValue()),q=L.trim($C("contactDialogStreet").getValue()),r=L.trim($C("contactDialogCode").getValue()),s=[n,o,p,q,"","",r];b=e.ADR[c.detailIndex],b.value=s.join(";"),b.input.setValue(G.parseADR(s)),a("#contact_edit_details").empty();break;default:if(c.submitLock)return!0;var t=c.getContact(function(a){c.submitLock=!0,c[a.CID?"updateSubmit":"addSubmit"](a)});return!t}return c.cancel()}function l(b){var c=this,d=c.rawConfig,e=c.curModule,f={contacts:I.isArray(b)?b:[b]};e&&e.isSort&&(f.order=[{field:e.sortType,desc:e.sortDesc}]);try{c.action.addContact({data:f,returnType:"all",call:function(b){c.submitLock=!1,a.Msgbox.msgbox.hide(),a.Tips.show({text:"您已成功添加联系人",succ:!0}),d.success&&d.success(b)},error:function(a){c.submitLock=!1,c.onError("添加失败",a),d.fail&&d.fail(a)},extData:{contact:b}})}catch(g){}}function m(b){var c=this,d=c.rawConfig,e=c.curModule,f={contacts:I.isArray(b)?b:[b]};e&&e.isSort&&(f.order=[{field:e.sortType,desc:e.sortDesc}]);try{c.action.updateContact({data:f,returnType:"all",call:function(b){c.submitLock=!1,a.Msgbox.msgbox.hide(),a.Tips.show({text:"您已成功编辑联系人",succ:!0}),d.success&&d.success(b)},error:function(a){c.submitLock=!1,c.onError("修改失败",a),d.error&&d.error(a)},extData:{contact:b}})}catch(g){}}function n(){var b=this,c=b.editField,d=a.Msgbox.msgbox;if(c){b.unfoldMore&&b.getEl().addClass("oL0");var e=b.getEl();e.find("#contact_edit_main").css({left:"0"}),e.find("#contact_edit_details").css({left:"100%"}).empty();var f=d.buttons;return f.ok.update({text:"确 定"}),f.cancel.update({text:"取 消"}),delete b.editField,!0}b.unfoldMore=!1,b.rawConfig.cancel&&b.rawConfig.cancel()}function o(){var a=this;I.each(a.components,function(a,b){b.length=0}),I.each(a.formatContact,function(a,b){b.length=0}),a.boolGroup=null}function p(b){function d(a){var b=0,c="";for(var d in a)c+=b++ +"-------"+d+"  :   "+a[d]+"\n"}function e(){var a=h.formatContact.date;M.each(m.date,function(b,c){var d=c.select,e=d.getValue(),i=L.trim(c.input[0].getValue()),j=L.trim(c.input[1].getValue()),k=L.trim(c.input[2].getValue()),m=a[b]||{},o=m.fullKey,p="";if(i||(i=1604),(j||k)&&(p=i+"-"+j+"-"+k),p){if(h.checkValue("date",p))return f("日期格式错误，请检查。",c.input[0]),g(!1),v=!0,!1;if(o&&!u[o]){if(M.has(o.split("."),"BDAY;value=date"))n[o]=h.formatValue("BDAY",p);else{if(e!=m.fKey){var q=o.split(".")[0];n[q+".X-ABLabel"]&&(n[q+".X-ABLabel"]="_$!<"+e.substring(0,1).toUpperCase()+e.substring(1,e.length)+">!$_")}n[o]=h.formatValue("date",p)}u[o]=!0}else if("BDAY;value=date"==e){var r=h.formatValue("BDAY",p);r&&(n[e]=r)}else{var s=h.formatValue("date",p),t="item"+l++,w=t+".X-ABDATE";n[w]=s,n[t+".X-ABLabel"]=m.label?e===m.fKey||"other"===e&&"other"!==m.fKey?m.label:"_$!<"+e.substring(0,1).toUpperCase()+e.substring(1,e.length)+">!$_":"_$!<"+e.substring(0,1).toUpperCase()+e.substring(1,e.length)+">!$_"}}else o&&delete n[o]})}function f(b,c){a.Msgbox.msgbox.footer.html(b?a.Label.html({text:b,type:"err"}):"");try{c.select()}catch(d){}}function g(a){if(j){var b=j._toolbar.find("button");b[1].setDisabled(a)}}var h=this,i=h.rawConfig,j=h.inContactModule&&h.curModule?h.curModule:null,k=h.formatContact,l=h.formatContact.maxItem;l=I.isNumber(l)?l+1:1;var m=h.components,n={};if(i.cid){n=I.clone(G.data.extDataMap.contact[i.cid]);var o=h.delItems;for(var p in o)try{delete n[p]}catch(q){}}var r,s,t,u={},v=!1,w=L.trim(m.name[0].nickname||"");w=h.formatValue("NICKNAME",w),w?n.NICKNAME=w:n.NICKNAME&&delete n.NICKNAME;var x=m.MARKED[0].checkbox.getChecked();x?n.MARKED&&I.isNumber(+n.MARKED)||(n.MARKED=G.getMarkSort()):delete n.MARKED;var y=h.boolGroup;if(y){var z="";I.each(y,function(a,b){b&&(z+=";"+a)}),n.GROUPING=z.substring(1)}if(e(),v)return!1;var A=m.ZS[0].input;if(r=L.trim(A.getValue()),h.checkValue("zs",r))return f("备注超过500个中文或1000个英文字母的长度限制。",A),g(!1),!1;r?n.ZS=h.formatValue("ZS",r):n.ZS&&delete n.ZS;var B,C="",D=[];if(M.each(P.contactArray,function(b,c){var d=c.toLowerCase(),e=!1,i=k[d.toLowerCase()];if("icq"===d)M.each(m.ICQ,function(a,b){var d=i[a]||{},e=d.fullKey,f=b.select.getValue(),g=L.trim(b.input.getValue());if(d.key)if(e&&!u[e])n[e]=g,u[e]=!0;else{var j;j=f===d.fKey?d.key:"IMPP;X-SERVICE-TYPE="+f;var k="item"+l++;j=k+"."+j,d.label&&(n[k+".X-ABLabel"]=d.label),d.label||!n[j]?n[j]=g:I.isString(n[j])?n[j]=[n[j],g]:n[j].push(g)}else g=h.formatValue(c,g),f="item"+l++ +".IMPP;X-SERVICE-TYPE="+f,n[f]?I.isString(n[f])?n[f]=[n[f],g]:n[f].push(g):n[f]=g,n[e]&&delete n[e]});else{var j=G.data.cache.addrCache;M.each(m[c],function(b,k){var m,o=i[b]||{},p=o.fullKey,q=k.select.getValue();if("fax"===d&&3===k.input.length){var r=L.trim(k.input[0].getValue());m=L.trim(k.input[1].getValue());var s=L.trim(k.input[2].getValue());r=r?r+"-":r,s=s?"-"+s:s,r&&s&&(m=m||" "),m=r+m+s}else m=L.trim(k.input.getValue());var t,w;if(m){var x;if(h.checkValue(c,m))return x=q.indexOf("EMAIL")>=0?"请正确填写邮件地址。":q.indexOf("ADR")>=0?"请不要填写;等特殊字符":"输入不合法",f(x,k.input),g(!1),v=!0,a.BREAK;if("mail"===d){if(C.indexOf(m)>=0)return x="Email地址重复",f(x,k.input),g(!1),v=!0,a.BREAK;C+="@@"+m}if("tel"===d&&m.length>20)return f("手机/电话长度不能超过20个字符",k.input),g(!1),v=!0,a.BREAK}if("adr"==d){t=k.value||";;;;;;";var y=t.split(";");if(w=G.parseADR(y),w===m)m=[y[5],y[4],y[3],y[2],y[1],y[6],y[0]].join(";");else if(";;;;;;"!=m){var z=j[m];z?(y[2]=z.city,y[3]=z.street,y[1]=z.province,y[4]="",y[0]=z.country,y[5]="",y[6]=z.zip,m=G.parseADR(y)):m&&D.push(m)}}if(m=h.formatValue(c,m),e||"EMAIL;type=INTERNET"!==q&&"TEL;type=CELL;type=VOICE"!==q||(q+=";type=pref",e=!0),B||"mail"!==d||(B=m),p&&!u[p])e===!0?(delete n[p],n[q]=m,e="used"):n[p]=m,u[p]=!0;else{q===N.iaddrMap[o.fKey]&&(q=o.key);var A="item"+l++;q.indexOf("pref")<0&&(q=A+"."+q),o.label&&(n[A+".X-ABLabel"]=o.label,q.indexOf(A)<0&&(q=A+"."+q)),o.label||!n[q]?n[q]=m:I.isString(n[q])?n[q]=[n[q],m]:n[q].push(m)}})}return v?a.BREAK:void 0}),v)return!1;if(""===C)return f("请正确填写邮件地址。",m.MAIL[0].input),g(!1),!1;var E=D.length;if(E>0){var F=0;return M.each(D,function(a,c){h.action.splitAddr({addr:c,call:K.bind(function(a){F++,F===a&&h.getContact(b)},null,E)})}),!1}M.each(P.otherArray,function(a,b){b.toLowerCase();var c=m[b][0].input;if(c){var d=L.trim(c.getValue());d=h.formatValue(b,d),d?"URL;type=pref"!=b&&(n[b]=d):"URL;type=pref"!=b&&n[b]&&delete n[b]}});var H=m["URL;type=pref"][0],J=H.input,O=L.trim(J.getValue());k.url||[];var Q="URL;type=pref",R=H.key;if(n[R||Q]=O,v)return!1;var S=m.name[0],T=S.input;if(r=L.trim(T.getValue()),h.checkValue("N",r))return f("请不要填写；特殊字符。",T),g(!1),!1;s=S.n||";;;;",t=s.split(";");var U=G.parseN(s);if(r){var V=G.data.cache.nameCache;if(r!=U){var W=V[r];if(!W)return h.action.splitName({name:r,call:K.bind(h.getContact,h,b)}),!1;t[0]=W.last,t[1]=W.first,t[2]=W.middle,t[3]=W.prefix,t[4]=W.suffix,s=t.join(";")}}else r=B?B.substring(0,B.indexOf("@")):"未命名";n.N=s,n.FN=r,d(n),d(G.data.extDataMap.contact[i.cid]);for(var p in n){var X=n[p];(X===c||null===X||""===X||";;;;;;"===X&&a.Array.has(p.toLowerCase().split("."),function(a){return"adr"===a||0===a.indexOf("adr;")}))&&delete n[p]}return b&&b(n),!1}function q(b,c){try{switch(b){case"BDAY":case"date":case"anniversary":var d=c.split("-"),e=new Date(d[0],d[1]-1,d[2]);if(e.setHours(12),e.getFullYear(),"anniversary"==b||"date"==b)return a.Date.format(e,"yyyy-MM-dd");var f=a.Date.format(e,"yyyyMMdd");return 8==f.length?f:"0"+f;case"ADR":if(c.indexOf(";")<0){var g=[c,"","","","","",""];return g.join(";")}default:return c}}catch(h){}return c}function r(c,d){var e,f=this,g=a(J.getTarget(d)),h=f.components;if("name"!==c&&"ADR"!==c)return!1;var i,j,f=this;if("name"===c){e=h.name[0];var k=G.data.cache.nameCache,l=e.n||"",m=e.nickname||"",n=l.split(";"),o=G.parseN(n),p=L.trim(e.input.getValue());if(o!==p){var q=k[p];if(!q)return f.action.splitName({name:p,call:function(){f.clickShowDetail(c,d)}}),void 0;n[0]=q.last,n[1]=q.first,n[2]=q.middle,n[3]=q.prefix,n[4]=q.suffix}j="contactDialogFirstName",i=['<div class="ph0 nui-scroll">','<div class="jK0">','<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogFront">前缀</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogFront",inputId:"input_contactDialogFront",width:"222px",value:n[3]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogFirstName">名字</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogFirstName",inputId:"input_contactDialogFirstName",width:"222px",value:n[1]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogMidName">中间名</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogMidName",inputId:"input_contactDialogMidName",width:"222px",value:n[2]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogFamilyName">姓氏</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogFamilyName",inputId:"input_contactDialogFamilyName",width:"222px",value:n[0]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogEnd">后缀</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogEnd",inputId:"input_contactDialogEnd",width:"222px",value:n[4]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogNickName">昵称</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogNickName",inputId:"input_contactDialogNickName",width:"222px",value:m||""}),"</dd>","</dl>","</div>","</div>"].join("")}else if("ADR"===c){var r=g.findParent("DL",!1,!0);f.detailIndex=f._getIndex(r),e=h.ADR[f.detailIndex];var s=G.data.cache.addrCache,t=e.value||";;;;;;",u=t.split(";"),v=L.trim(e.input.getValue()),w=L.trim(G.parseADR(u));if(w!==v){var q=s[v];if(!q)return f.action.splitAddr({addr:v,call:function(){f.clickShowDetail(c,d)}}),void 0;u[2]=q.city,u[3]=q.street,u[1]=q.province,u[4]="",u[0]=q.country,u[5]="",u[6]=q.zip}j="contactDialogStreet",i=['<div class="ph0">','<div class="jK0">','<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogStreet">街道地址</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogStreet",inputId:"input_contactDialogStreet",width:"222px",value:u[3]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogCode">邮编</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogCode",inputId:"input_contactDialogCode",width:"222px",value:u[6]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogCity">城市</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogCity",inputId:"input_contactDialogCity",width:"222px",value:u[2]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogProvince">省份或地区</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogProvince",inputId:"input_contactDialogProvince",width:"222px",value:u[1]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogCountry">国家或地区</label></dt>','<dd class="is0">',a.Input.html({id:"contactDialogCountry",inputId:"input_contactDialogCountry",width:"222px",value:u[0]||""}),"</dd>","</dl>","</div>","</div>"].join("")}var x=f.getEl();x.removeClass("oL0"),x.find("#contact_edit_main").css({left:"-100%"}),x.find("#contact_edit_details").html(i).css({left:"0"}),f.editField=c;var y=a.Msgbox.msgbox.buttons;return y.ok.update({text:"保 存"}),y.cancel.update({text:"取消并返回"}),a.Component.setEvents(),j&&b.setTimeout(function(){$C(j).select()},100),!1}function s(b,c){var d=this,e=a(J.getTarget(c)),f=e.findParent("DL",!1,!0),g=f.find("a.dl-remove-link"),h=d._getIndex(f);g.show(),d._addRow(f,b,h)}function t(b,c){var d=this,e=a(J.getTarget(c)),f=e.findParent("DL",!1,!0),g=f.findParent("DIV",!1,!0),h=d._getIndex(f),i=d.components[b],j=d.formatContact[b.toLowerCase()];if(1!==i.length)try{var k=j[h];k.fullKey&&(d.delItems[k.fullKey]=!0),j.splice(h,1),f.empty(),f.remove(),i.splice(h,1),1===i.length&&g.find("dl a.dl-remove-link").hide()}catch(l){}}function u(){function b(){this.hide(),w.show();try{var a=$C(n);a.setValue(""),a.focus()}catch(b){}}function c(){var b=$C(n),c=a.String.trim(b.getValue());c?(e(!0),G.addGroup({name:c,call:f,error:g})):(g("请输入分组名"),b.setValue(""),b.focus())}function d(){g(),w.hide(),$C(q).show()}function e(a){$C(o).setDisabled(a),$C(p).setDisabled(a)}function f(b){try{var c=b.returns[0];x.append(h(G.data.extDataMap.group[c],!0)),x.dom.parentNode.parentNode.scrollTop+=30,a.Component.setEvents(),j.inContactModule&&(a.Context.navAdded=!0,a.Nav.update(),a.Nav.getModule(j.curModule))}catch(e){}d()}function g(b){var c=!!b,b=c?b.content||b:b;y.html(c?a.Label.html({text:b,type:"err"}):""),y.dom.parentNode.parentNode.scrollTop+=20,e(!1)}function h(b,c){var d=b.CID,e=a.String.encodeHTML(b.N),f=new a.Checkbox({title:e,name:"group_item",value:d,text:'<span class="nui-fIBlock rM0" title="'+e+'">'+e+"</span>",checked:c});return m.push(f),sLiHtml='<li class="eZ0">'+f.html()+"</li>"}var i,j=this,k=G.data.rawDataArray.group,l=j.boolGroup,m=j.components.GROUP,n="contact_edit_group_ipt",o="contact_edit_group_add_bt_submit",p="contact_edit_group_add_bt_cancel",q="contact_edit_group_add_bt",r=[];m.length=0;for(var s=0,t=k.length;t>s;s++)i=k[s],r.push(h(i,!!l[i.CID]));var u=['<div class="iN0 nui-scroll">','<ul id="contact_edit_group_data_ul">',r.join(""),"</ul>",'<ul id="contact_edit_group_add_ul" style="display:none;">','<li class="eZ0">','<div class="cW0">',a.Input.html({id:n}),a.Button.html({id:o,text:"保 存",click:c}),a.Button.html({id:p,text:"取 消",click:d}),"</div>","</li>","</ul>",'<div id="contact_edit_group_err"></div>',a.Button.html({id:q,text:"新建分组",extcls:"dX0",click:b}),"</div>"].join("");a.Msgbox.msgbox.footer.html("");var v=j.getEl();v.removeClass("oL0"),v.find("#contact_edit_main").css({left:"-100%"}),v.find("#contact_edit_details").html(u).css({left:"0"});var w=a("#contact_edit_group_add_ul"),x=a("#contact_edit_group_data_ul"),y=a("#contact_edit_group_err");j.editField="group";var z=a.Msgbox.msgbox.buttons;z.ok.update({text:"保 存"}),z.cancel.update({text:"取消并返回"}),a.Component.setEvents()}function v(b){function c(b,c){var e="contact_edit_group_item_"+b;return['<div class="nui-fIBlock rM0" id="',e,'">',a.String.encodeHTML(c),"&nbsp",a.Link.html({title:"去掉此分组",cls:"nui-close",text:'<b class="js-component-icon nui-ico nui-ico-close">x</b>',click:function(){var c=a("#"+e);c.remove(),d.boolGroup[b]=!1}}),"</div>"].join("")}var d=this,e=G.data.extDataMap.group,f=[],g=d.boolGroup;b=b||[];var h=a.fly("#contact_edit_group").dom.childNodes,i=h[0],j=h[1];M.each(b,function(a,b){var d=e[b];f.push(c(b,d.N)),g[b]=!0}),f.length>0?(i.style.display="none",j.innerHTML=f.join("")+a.Link.html({text:"修改",extcls:"nui-txt-link contact-editor-group-link",click:K.bind(d.clickShowGroupEdit,d)}),j.style.display="",O.setEvents()):(j.style.display="none",a(j).empty(),i.style.display="")}function w(){function b(b,f,g){var h;if(b){var i=c._getLast(e).input[0].getEl(),j=a(i.findParent("DL",!1,!0).dom);c._addRow(j,"date",e.length-1,g,f)}else if(h=e[0],h.input[0].getValue()){var i=c._getLast(e).input[0].getEl(),j=a(i.findParent("DL",!1,!0).dom);c._addRow(j,"date",e.length-1,g,f)}else{var k,l=0;"BDAY;value=date"!=f&&(I.each(d,function(b){return b===f?a.BREAK:(l++,void 0)}),l++),g.indexOf("-")>=0?k=g.split("-"):(7===g.length&&(g="0"+g),k=[g.substring(0,4)-0,g.substring(4,6),g.substring(6,8)]),1604!==k[0]-0&&h.input[0].setValue(k[0]),h.input[1].setValue(k[1]),h.input[2].setValue(k[2]),h.select.setSelected(l),l>0&&(c.bBDAY=!1)}}var c=this,d=a.ADDR_MEMORIAL_DAY,e=c.components.date,f=c.formatContact.date;if(1!=f.length||f[0].value){var g,h,i=f.length;M.each(f,function(a,c){c&&(g=N.iaddrMap[c.fKey]||"other",h=c.value,b(a,g,h,i))})}}function x(a){var b,c=this,d=c.components,e=P.singleArray;M.each(e,function(e,f){if("FN"===f){var g=a.N||"",h=g.split(";"),i=G.parseN(h);d.name[0].input.setValue(i||a.FN||"")}else if("N"===f||"NICKNAME"===f)d.name[0][f.toLowerCase()]=a[f];else if("MARKED"===f)a.MARKED&&d.MARKED[0].checkbox.setChecked(!0);else if(b=d[f][0],"URL;type=pref"===f){var j=c.formatContact.url,k=j[0],l=b.input;l.setValue(a[f]||k?k.value:""),k&&k.fullKey&&(b.key=k.fullKey)}else b.input.setValue(a[f]||"")})}function y(){var b=this,c=b.components,d=b.formatContact,e=P.contactArray;try{M.each(e,function(e,f){var g=f.toLowerCase(),h=d[g];c[f];var i;M.each(h,function(d,e){if(!e.bEmpty){var h=e.value,j=e.fKey,k=N.iaddrMap[j]||j;if(d){var l=("fax"===g?b._getLast(c[f]).input[0]:b._getLast(c[f]).input).getEl(),m=a(l.findParent("DL",!1,!0).doms[0]),n=m.find("a.dl-remove-link");n.show(),b._addRow(m,f,c[f].length-1,h,k,e.fullKey)}else{var o,p=0;i=c[f][0],o="icq"!==g?P[g+"Map"]:a.ADDR_IM_TITLE,I.each(o,function(b){return b===k?a.BREAK:(p++,void 0)});try{i.select.setSelected(p)}catch(q){i.select.setSelected(--p)}"adr"===g?(i.value=h,i.input.setValue(G.parseADR(h))):"fax"===g?3===i.input.length&&(aFax=N.formatFAX(h),i.input[0].setValue(aFax[0]),i.input[1].setValue(aFax[1]),i.input[2].setValue(aFax[2])):i.input.setValue(h),e.fullKey&&(i.key=e.fullKey)}}})})}catch(f){}}function z(b,c,d,e,f){var g=this;try{var h=g._getMulDlHtml(c,!0,!0,d,e,f);b.after(h),a.Component.setEvents()}catch(i){}}function A(a){var b,c=this,d=[];return M.each(a,function(a,e){b="iaddress_"+e+"_wrap";var f=c._getMulDlHtml(e,!0,!1,0);d.push('<div class="eH0" id="'+b+'">'+f+"</div>")}),d.join("")}function B(b,d,e,f,g,h){function i(b,c){var d,e={options:[],subclass:"simpleSelect",selectedchange:function(){j.call(o,this,b)}},f={};return"icq"===b?f=a.ADDR_IM_TITLE:"date"===b?(f=a.ADDR_MEMORIAL_DAY,e.options.push({text:"生日",value:"BDAY;value=date",disabled:o.bBDAY})):f=P[b+"Map"],I.each(f,function(a,b){d="uc"===a?"新浪UC":"other"===a?"其他":a,e.options.push({text:b.replace(/googletalk/i,"GTalk"),value:d,checked:c==a})}),"date"===b&&(o.filled||o.newContact)&&(e.options[1].checked=o.bBDAY,o.bBDAY=!0),l=new a.Select(e)}function j(a,b){var c=this,d=a.getEl(),e=d.findParent("DL",!1,!0),f=c._getIndex(e),g=c.formatContact[b];g&&g[f]&&g[f].fullKey&&(c.delItems[g[f].fullKey]=!0,delete g[f].fullKey)}var k,l,m,n,o=this,p=b.toLowerCase(),q=g?!0:!1,r="",s="",t=o.components[b],u=N.keyMap[b],v=o.formatContact,w=[];if(d){if("date"===p){b="date";var x=[];g&&(x=g.split("-")),k=new a.Input({width:"50px",maxLength:4,value:x[0]||""}),s+=k.html(),s+="年&nbsp;",w.push(k),k=new a.Input({width:"37px",maxLength:2,value:x[1]||""}),s+=k.html(),s+="月&nbsp;",w.push(k),k=new a.Input({width:"37px",maxLength:2,value:x[2]||""}),s+=k.html(),s+="日&nbsp;",w.push(k),l=i(p,h,f),r+=l.html(),u="纪念日"}else if(l=i(p,h,f),r=l.html(),"ADR"===b)w=new a.Input({width:"183px",value:I.isString(g)?G.parseADR(g):""}),s+=w.html(),s+=a.Link.html({text:"详细",title:"编辑详细地址",extcls:"nui-txt-link nui-txt-s12",click:K.bind(o.clickShowDetail,o,"ADR")}),m=I.isString(g)?g:";;;;;;";else if("FAX"===b){var y=N.formatFAX(g);M.each(y,function(b,c){k=new a.Input({width:1===b?"75px":"40px",value:c}),s+=k.html(),w.push(k),2>b&&(s+="-&nbsp;")})}else"ICQ"===b&&(u="聊天工具"),w=new a.Input({value:g||""}),s+=w.html();s+=a.Link.html({click:K.bind(o.clickAddIcon,o,b),title:"添加一个"+(u||""),items:[{xtype:"icon",type:"add"}],extcls:"dl-add-link",hidden:!1}),s+="&nbsp;",s+=a.Link.html({click:K.bind(o.clickRemoveIcon,o,b),title:"移除这个"+(u||""),items:[{xtype:"icon",type:"remove"}],extcls:"dl-remove-link",hidden:!e})
}else n="input_"+a.String.encodeHTML(b),r+=u,w=new a.Input({inputId:n}),s+=w.html();return f=0===t.length?0:f+1,!q&&d&&v&&v[p].splice(f,0,{key:"",value:""}),t.splice(f,0,{input:w,select:l,value:"ADR"===b&&m?m:null}),o._getDlHtml(r,s,c,n)}function C(a,b,c,d){return d&&(a='<label for="'+d+'">'+a+"</label>"),['<dl class="ou0">','<dt class="iX0">',a,"</dt>",'<dd class="is0" ',c?'id="'+c+'"':"",">",b,"</dd>","</dl>"].join("")}function D(b){b instanceof a.Element&&(b=b.dom);for(var c=-1;b;)c++,b=b.previousSibling;return c}function E(a){return 0===a.length?null:a[a.length-1]}function F(b,c){var d;d={title:"抱歉，"+(b||c.title||"操作失败"),content:"原因："+c.content},$S("isVip")&&"联系人分组个数超过上限"===c.content&&(d.content+=a.Link.html({text:"升级分组上限",cls:"nui-txt-link",bracket:!0,click:function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close(),$E(["interface.OutlinkInterface"],function(b){b.goOutlink({url:a.Uri.getUrl("option_viptype"),key:"option_viptype"})})}})),a.Msgbox.show(d),a.Component.setEvents()}var G,H,I=a.Object,J=a.Event,K=a.Function,L=a.String,M=a.Array,N=$I($N("util.Contact")),O=a.getClass("netease.mail.component.Component"),P=a.createClass($N("component.contact.ContactEdit"));I.mix(P,O,{xtype:"contactedit",_cssClass:{baseclass:{tpl:['<div class="tg0">','<div id="contact_edit_main" class="pc0 nui-scroll" style="left:0">','<div class="ph0">','<div id="contact_edit_main_normal" class="jK0">',"#{normalContent}","</div>",'<div class="qA0">','<b class="nui-ico nui-ico-rArr"></b>','<b class="nui-ico nui-ico-dArr" style="display: none;"></b>',' <span class="nui-txt-cLink">更多选项</span>',"</div>",'<div id="contact_edit_pinfo" class="jK0" style="display:none">',"#{moreInfo}","</div>","</div>","</div>",'<div id="contact_edit_details" class="pc0 nui-scroll" style="left:100%">',"#{detailContent}","</div>","</div>"].join("")}},_listeners:[{name:"render",handler:function(){var b=this.getEl(),c=b.find("#contact_edit_pinfo");J.live(b,"click","div.qA0",function(d,e){var f=this,g=a(e.currentTarget),h="oL0",i=g.find("b.nui-ico"),j=i.doms[0],k=i.doms[1];return"none"===j.style.display?(j.style.display="",k.style.display="none",g.css({borderBottomWidth:"0px"}),b.removeClass(h),c.hide(),f.unfoldMore=!1):(j.style.display="none",k.style.display="",g.css({borderBottomWidth:"1px"}),b.addClass(h),c.show(),f.unfoldMore=!0),!1})},type:"custom"}],show:d,otherArray:["URL;type=pref","ORGNAME","ORG","TITLE","ROLE","MEMBER"],singleArray:["URL;type=pref","ORGNAME","ORG","TITLE","ROLE","MEMBER","N","FN","NICKNAME","ZS","MARKED"],contactArray:["MAIL","TEL","FAX","ICQ","ADR"],mailMap:{"EMAIL;type=INTERNET":"电子邮箱","EMAIL;type=INTERNET;type=HOME":"家庭邮箱","EMAIL;type=INTERNET;type=WORK":"工作邮箱"},telMap:{"TEL;type=CELL;type=VOICE":"手机号码","TEL;type=VOICE":"电话号码","TEL;type=HOME;type=VOICE":"家庭电话","TEL;type=WORK;type=VOICE":"办公电话"},faxMap:{"TEL;type=FAX":"传真号码","TEL;type=HOME;type=FAX":"家庭传真","TEL;type=WORK;type=FAX":"办公传真"},adrMap:{ADR:"居住地址","ADR;type=HOME":"家庭地址","ADR;type=WORK;type=pref":"工作地址"}},{initialize:e,_getData:f,getBaseHtml:g,getMoreInfoHtml:h,initData:i,checkValue:j,submit:k,addSubmit:l,updateSubmit:m,cancel:n,destroy:o,getContact:p,formatValue:q,clickShowDetail:r,clickAddIcon:s,clickRemoveIcon:t,clickShowGroupEdit:u,fillGroup:v,fillDate:w,fillSingle:x,fillMulti:y,_addRow:z,_getDivHtml:A,_getMulDlHtml:B,_getDlHtml:C,_getIndex:D,_getLast:E,onError:F,test:"hello world"})}($,window),function(a,b,c){function d(c){var d=a.Msgbox,e=new H(c),f=!1,g=d.show({header:"添加星标联系人/联系组",contentType:"wide",width:"480px",content:e.html(),isParentBox:!0,listeners:{render:function(){b.setTimeout(function(){var b=a("#markLeftTree");b.html(""),new a.Tree({extcls:"nui-simpleTree",isRoot:!0,items:e.getTree(),renderTo:a("#markLeftTree")}),b.destroy()},20),G.setEvents()},destroy:function(){e.destroy()}},ok:function(){if(f)return!0;f=!0;var b=e.selected,d=e.recommend,h=[];return B.each(b,function(a,b){h.push({cid:b.CID,ctype:"GROUP"===b["X-TYPE"]?"group":null})}),B.each(d,function(a,b){h.push(b)}),0===h.length?(a.Tips.show({text:"未添加任何联系人和联系组至左侧栏",type:"err"}),void 0):(v.markData({data:h,mark:!0,call:function(){f=!1,g.hide(),c.call&&c.call(e.format(b))},error:function(){f=!1,c.error&&c.error()}}),!0)}});c.noGotoContact||g.footer.html(new a.Link({text:"去通讯录管理添加>>",extcls:"nui-txt-link",click:function(){g.hide(),$E("interface.AddressInterface",function(a){a.entry({action:"marked"})})}}).html())}function e(a){try{v=$L("support.AddressSupport"),w=$L("support.AddressSupportAction")}catch(b){return b}var c=this;c.c2liMap={},c.r2liMap={},H.superClass.initialize.call(c,a),c.selected=[],c.recommend=[]}function f(b){function c(){var a=this,b=y.getEvent(),c=b.keyCode;27===c&&a.setValue("");var e=A.trim(a.getValue());if(e){var f=a.find("icon")[0];f.update({type:"close",title:"取消"}),d.searchContact({key:e})}else d.searchCancel()}var d=this,e={},f=[],g=d.searchInput=new E({voiceInput:!0,iconBtn:"search",width:"129px",placeholder:"搜索联系人",iconbtnclick:function(){this.setValue(""),this.showPlaceholder(),this.iconBtn.update({type:"search"}),d.searchCancel()},keyup:c}),h=d.addBtn=new a.Button({subclass:"inputBtn",title:"新建联系人",text:'<b class="nui-ico nui-ico-plus"></b>',click:z.bind(d.addNewContact,d)});f.push(g.html()),f.push(h.html()),f.push('<div class="kr0 nui-scroll">'),f.push('<div class="contactmark-search"></div>'),f.push('<div class="contactmark-list" id="markLeftTree">加载中...'),f.push("</div></div>"),e.left=f.join(""),e.title=b.title||"";var i=d.removeAllLink=new a.Link({text:"移除全部",extcls:"nui-contacts-to-removeAll nui-txt-link",hidden:!0,click:function(){d.removeAll()}});return e.removeAll=i.html(),e}function g(){function b(){var b=a("#markLeftTree");b.empty(),b.html(F.html({extcls:"nui-simpleTree",isRoot:!0,items:c.getTree()})),a.Component.setEvents()}var c=this;t.show({hideMark:!0,success:function(a){var d=v.data.extDataMap.contact,e=d[a.returns[0]];c.choose(e),b()},cancel:function(){b()},close:function(){b()}})}function h(){var b=this,d=v.data.extDataMap.groupArray,e=v.data.extDataMap.contact,f=[];B.each(d,function(c,d){if("ALL"!==d.CID){var e=d.CONTACTS||[],g=[];if(B.each(e,function(c,d){if(d){var e=v.getGivenName(d)||"",f=v.getContactEmails(d)[0]||"";if(!f)return;!e&&f&&(e=f.split("@")[0]),g.push({text:a.String.left(e,24,!0),title:e,click:function(){b.choose(d),B.each((b.c2liMap[d.CID]||{}).div,function(a,b){b.addClass("nui-tree-item-label-disable")})},title:f||null,titleScale:"label",listeners:{render:function(){var c=b.c2liMap,e=this.getEl(),f=a(e.dom.firstChild);(d.MARKED||b.checkSelected(d))&&f.addClass("nui-tree-item-label-disable");var g=c[d.CID];g=g||{},g.div=g.div||[],g.div.push(f),c[d.CID]=g}}})}}),0!==g.length||"OTHERS"===d.CID){var h=g.length>0,i=d.N||"未命名分组",j={text:a.String.left(i,10,!0)+"("+g.length+")",title:i,items:g,isFold:!0,extItems:"OTHERS"===d.CID||"SYSTEM"===d["X-TYPE1"]?null:[{xtype:"link",text:"添加组",extcls:"nui-txt-link",title:h?"添加后，可以方便查看与该组成员的往来邮件。":"该组无联系人，无法添加",click:function(){if(h){b.choose(d,!0);var c=this,e=a(c).findParent("DIV",!1,!0);e&&e.addClass("nui-tree-item-label-disable"),c.className="nui-txt-link nui-txt-disabled"}}}],listeners:{render:function(){var c=b.c2liMap,e=a(this.getEl().dom.firstChild),f=a(this.getEl()).find("a.nui-txt-link");(d.MARKED||b.checkSelected(d)||!h)&&(e.addClass("nui-tree-item-label-disable"),f&&f.addClass("nui-txt-disabled")),c[d.CID]={div:[e],a:f}}}};f.push(j)}}});try{var g=v.getMarkData().recommend;if(g.length>0){var h=[];B.each(g,function(d,f){if(f){f.__CID=b._tmpId++;var g=f.name,i=f.email;i&&(!g&&i&&(g=i.split("@")[0]),h.push({text:a.String.left(g,24,!0),title:g,click:function(){if(f.cid==c){b.chooseRecommend(f);var d=a(this.getEl().dom.firstChild);d.addClass("nui-tree-item-label-disable");var g=b.r2liMap;return g[f.__CID]=d,void 0}var h=e[f.cid];h&&(b.choose(h),B.each((b.c2liMap[h.CID]||{}).div,function(a,b){b.addClass("nui-tree-item-label-disable")}))},title:i||null,titleScale:"label",listeners:{render:function(){if(f.cid!=c){var d=e[f.cid];if(d){var g=b.c2liMap,h=this.getEl(),i=a(h.dom.firstChild);(d.MARKED||b.checkSelected(d))&&i.addClass("nui-tree-item-label-disable");var j=g[d.CID];j=j||{},j.div=j.div||[],j.div.push(i),g[d.CID]=j}}}}}))}}),f.unshift({text:"常用联系人",title:"常用联系人",items:h,isFold:!0})}}catch(i){}return f}function i(){var b=this,c=b.getEl(),d=b.c2liMap;B.each(b.selected,function(a,b){var c=d[b.CID]||{};B.each(c.div,function(a,b){b.removeClass("nui-tree-item-label-disable")}),c.a&&c.a.removeClass("nui-txt-disabled")}),B.each(b.recommend.slice(0),function(a,c){b.removeRecommendSelected(c)}),b.selected.length=0,b.recommend.length=0,c.findFly("div.nB0 ul").empty(),b.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(b.selected.length+b.recommend.length)}function j(){var a=this;a.removeAllLink[a.selected.length+a.recommend.length>0?"show":"hide"]()}function k(b){function c(b){var c=b.contacts,e=d.c2liMap,f=d.getEl(),g=f.find("div.kr0 div.contactmark-search");if(g.empty(),c&&c.length)B.each(b.contacts,function(a,b){var c=C.create("A");c.addClass("nui-contacts-search-item"),c.attr({href:"javascript:void(0)",title:b.perAddress||b.contact["EMAIL;type=INTERNET;type=pref"]||""}),c.listen("click",function(){c.addClass("nui-tree-item-label-disable"),B.each((e[b.contact.CID]||{}).div,function(a,b){b.addClass("nui-tree-item-label-disable")}),d.choose(b.contact)});var f=C.create("STRONG");f.html("&quot;"+(b.name||b.contact.FN||"未命名")+"&quot;"),c.append(f.dom),c.append("&lt;"+(b.address||b.contact["EMAIL;type=INTERNET;type=pref"]||"")+"&gt;"),g.append(c.dom);var h=b.contact;(h.MARKED||d.checkSelected(h))&&c.addClass("nui-tree-item-label-disable");var i=e[h.CID];i=i||{},i.div=i.div||[],i.div.push(c),e[h.CID]=i});else{var h=C.create("DIV");h.addClass("nui-assistBlock nui-block nui-contacts-search-tit"),h.html('没有符合条件的联系人 [<a href="javascript:void(0)" class="back txt-link">返回</a>]'),h.find("A").listen("click",function(b){d.searchCancel(),a.Event.cancel(b)}),g.append(h.dom)}}b=b||{};var d=this,e=v.simpleSearch(b);if(e.length?c({contacts:e}):c({contacts:null}),!d.isSearch){var f=d.getEl(),g=f.find("div.contactmark-list");g.hide();var h=f.find("div.contactmark-search");h.show(),d.isSearch=!0}}function l(){var a=this;if(a.isSearch){var b=a.searchInput,c=b.find("icon")[0];c.update({type:"search",title:"查找"}),A.trim(b.getValue())&&(b.setValue(""),b.showPlaceholder()),a.clearSearch()}}function m(){var a=this,b=a.getEl();if(a.isSearch){var c=b.find("div.contactmark-search");c.hide(),c.empty();var d=b.find("div.contactmark-list");d.show(),a.isSearch=!1}}function n(b,c){var d=this;if((c||v.getContactEmails(b)[0]||b.address)&&!b.MARKED&&!d.checkSelected(b)){var e=d.getEl(),f=document.createElement("LI");f.className="hq0",f.title=c?b.N||"未命名分组":b.address||v.getContactEmails(b)||null;var g=document.createElement("A");g.className="ds0 nui-txt-link",g.href="javascript:void(0);",g.innerHTML="移除",a.Event.listen(g,"click",function(){var a=g.parentNode;a.parentNode.removeChild(a),d.removeSelected(b)});var h=c?b.N||"未命名分组":b.defaultName||b.address||v.getGivenName(b)||v.getContactEmails(b),i=c?"nui-ico-stars nui-ico-stars-selected":"nui-ico-star nui-ico-star-selected";a.fly(f).append('<div class="eL1"><b class="nui-ico '+i+'"></b></div>'),a.fly(f).append('<p class="em0">'+a.String.escapeHTML(h)+"</p>"),a.fly(f).append(g),e.find("div.nB0 ul").append(f),d.selected.push(b),d.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(d.selected.length+d.recommend.length)}}function o(b){var c=this,d=!1;if(B.each(c.recommend,function(c,e){return e.name===b.name&&e.email===b.email&&e.emails===b.emails?(d=!0,a.BREAK):void 0}),!d){c.recommend.push(b);var e=c.getEl(),f=document.createElement("LI");f.className="hq0",f.title=b.name;var g=document.createElement("A");g.className="ds0 nui-txt-link",g.href="javascript:void(0);",g.innerHTML="移除",a.Event.listen(g,"click",function(){var a=g.parentNode;a.parentNode.removeChild(a),c.removeRecommendSelected(b)}),a.fly(f).append('<div class="eL1"><b class="nui-ico nui-ico-star nui-ico-star-selected"></b></div>'),a.fly(f).append('<p class="em0">'+a.String.escapeHTML(b.name)+"</p>"),a.fly(f).append(g),e.find("div.nB0 ul").append(f),c.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(c.selected.length+c.recommend.length)}}function p(b){var c=this;c.checkSelected(b,!0),c.checkRemoveAllLink();var d=c.c2liMap[b.CID];d&&(B.each(d.div,function(a,b){b.removeClass("nui-tree-item-label-disable")}),d.a&&d.a.removeClass("nui-txt-disabled")),a.fly("#spnSelectContactSelectedNum").html(c.selected.length+c.recommend.length)}function q(b){var c=this,d=c.r2liMap[b.__CID];d&&d.removeClass("nui-tree-item-label-disable"),B.each(c.recommend,function(d,e){return e.name===b.name&&e.email===b.email&&e.emails===b.emails?(c.recommend.splice(d,1),a.BREAK):void 0}),a.fly("#spnSelectContactSelectedNum").html(c.selected.length+c.recommend.length),c.checkRemoveAllLink()}function r(b,c){var d=this,e=!1;return B.each(d.selected,function(f,g){return g.CID===b.CID?(c&&d.selected.splice(f,1),e=!0,a.BREAK):void 0}),e}function s(b){return B.each(b,function(c,d){return d.address?a.CONTINUE:(b[c]=new D(v.getContactEmails(d)[0],v.getGivenName(d)),void 0)}),b}try{var t=$L("component.contact.ContactEdit")}catch(u){return u}var v,w,x=a.Object,y=a.Event,z=a.Function,A=a.String,B=a.Array,C=a.Element,D=a.Email,E=$I("component.Input"),F=$I("component.Tree");$I($N("util.Contact"));var G=a.getClass("netease.mail.component.Component"),H=a.createClass($N("component.contact.ContactMark"));x.mix(H,G,{xtype:"contactmark",_template:['<div class="sA1">','<div class="nT0">','<div class="iM0"></div>','<p class="iv0">添加星标联系人或联系组至左侧栏，可以很方便的查看他们的往来邮件哦</p>',"</div>",'<div class="pi0">','<b class="nui-ico nui-ico-next nW0"></b>','<div class="pS0">','<div class="nz0">所有联系人</div>',"#{left}","</div>",'<div class="ri0">','<div class="nz0">#{removeAll}你已选择 <span id="spnSelectContactSelectedNum">0</span> 个联系人</div>','<div class="nB0 nui-scroll">',"<ul></ul>","</div>","</div>","</div>",'<div class="ub0 nui-txt-tips">小提示：添加联系组后，您可以在同个列表中查看该组成员的往来邮件</div>',"</div>"].join(""),_listeners:[{name:"render",handler:function(){var a=this,b=v.data,c=b.recentGroupId,d=(c?b.extDataMap.group[c]||{}:{}).CONTACTS;B.each(d,function(b,c){a.choose(c)})},type:"custom"},{name:"destroy",handler:function(){var a=this;delete a.c2liMap,delete a.r2liMap,a.selected.length=0,a.recommend.length=0},type:"custom"}],show:d},{initialize:e,_getData:f,addNewContact:g,_tmpId:1,getTree:h,removeAll:i,checkRemoveAllLink:j,searchContact:k,searchCancel:l,clearSearch:m,choose:n,chooseRecommend:o,removeSelected:p,removeRecommendSelected:q,checkSelected:r,format:s})}($,window),function(a,b){function c(a){var b=this;A.superClass.initialize.call(b,a),b.selected=[]}function d(b){function c(){var b=this,c=a.Event.getEvent(),e=c.keyCode;27===e&&b.setValue("");var f=t.trim(b.getValue());if(f){var g=b.find("icon")[0];g.update({type:"close",title:"取消"}),d.searchContact({key:f})}else d.searchCancel()}var d=this,e={},f=[];f.push('<div class="nui-contacts-input">');var g=d.searchInput=new z({voiceInput:!0,iconBtn:"search",placeholder:"搜索联系人",iconbtnclick:function(){this.setValue(""),this.showPlaceholder(),this.iconBtn.update({type:"search"}),d.searchCancel()},keyup:c});f.push(g.html()),f.push("</div>"),f.push('<div class="nui-contacts-list nui-scroll" id="selectLeftTree">加载中...'),f.push("</div>"),f.push('<div class="nui-contacts-search nui-scroll" style="display:none"></div>'),e.left=f.join(""),e.title=b.title||"收件人";var h=d.removeAllLink=new a.Link({text:"移除全部",extcls:"nui-contacts-to-removeAll nui-txt-link",hidden:!0,click:function(){d.removeAll()}});return e.removeAll=h.html(),e}function e(){var a=this;if(a.isSearch){var b=a.searchInput,c=b.find("icon")[0];c.update({type:"search",title:"查找"}),t.trim(b.getValue())&&(b.setValue(""),b.showPlaceholder()),a.clearSearch()}}function f(){var a=this,b=a.getEl();if(a.isSearch){var c=b.find(".nui-contacts-search");c.hide(),c.empty();var d=b.find(".nui-contacts-list");d.show(),a.isSearch=!1}}function g(b){function c(b){var c=b.contacts,e=d.getEl(),f=e.find(".nui-contacts-search");if(f.empty(),c&&c.length)u.each(b.contacts,function(a,b){var c=w.create("A");c.addClass("nui-contacts-search-item"),c.attr({href:"javascript:void(0)",title:b.perAddress||b.contact["EMAIL;type=INTERNET;type=pref"]||""}),c.listen("click",function(){d.choose(b.contact)});var e=w.create("STRONG");e.html("&quot;"+(b.name||b.contact.FN||"未命名")+"&quot;"),c.append(e.dom),c.append("&lt;"+(b.address||b.contact["EMAIL;type=INTERNET;type=pref"]||"")+"&gt;"),f.append(c.dom)});else{var g=w.create("DIV");g.addClass("nui-assistBlock nui-block nui-contacts-search-tit"),g.html('没有符合条件的联系人 [<a href="javascript:void(0)" class="back txt-link">返回</a>]'),g.find("A").listen("click",function(b){d.searchCancel(),a.Event.cancel(b)}),f.append(g.dom)}}b=b||{};var d=this,e=d.search(b);if(e.length?c({contacts:e}):c({contacts:null}),!d.isSearch){var f=d.getEl(),g=f.find(".nui-contacts-list");g.hide();var h=f.find(".nui-contacts-search");h.show(),d.isSearch=!0}}function h(a){var b=this,c=a.key||"",d=[],e=new RegExp("("+c+")","i"),f='<b class="nui-txt-mark">$1</b>';return u.each(b.rawConfig.data.rawDataArray.contact,function(a,c){var g=!1,h={id:c.CID,name:"",address:"",perAddress:"",contact:c},i=b.getContactEmails(c),j=i[0]||"";h.perAddress=j;var k=c.N,l=k.split(";"),m=c.FN||t.trim([l[3],l[0],l[1],l[4],l[2]].join(" "))||"未命名";if(e.test(m)?(h.name=m.replace(e,f),g=!0):h.name=t.encodeHTML(m),e.test(j)?(h.address=j.replace(e,f),g=!0):h.address=j,!g){var n;for(var o in c)if("CID"!==o&&"GROUPING"!==o)if(n=c[o],"string"==typeof n){if(g=e.test(n))break}else if("array"==typeof n){for(var p=0,q=n.length;q>p&&!(g=e.test(n[p]));p++);if(g)break}}g&&d.push(h)}),d}function i(c){var d=$I("component.Msgbox"),e=new A(c);d.show({header:"快速添加"+c.title,contentType:"normal",content:e.html(),listeners:{render:function(){b.setTimeout(function(){var b=a("#selectLeftTree");b.html(""),new a.Tree({extcls:"nui-simpleTree",isRoot:!0,items:e.getTree(),renderTo:b}),b.destroy()},20),y.setEvents()},destroy:function(){e.destroy()}},ok:function(){c&&c.callback&&c.callback(e.format(e.selected))},cancel:function(){c&&c.cancel&&c.cancel()}})}function j(b){var c=this,d=[];return u.each(b,function(b,e){if(e.address)return d.push(e),a.CONTINUE;for(var f=c.getContactEmails(e),g=c.getGivenName(e),h=0,i=f.length;i>h;h++)d.push(new x(f[h],g))}),d}function k(b){var c=this;if((c.getContactEmails(b)[0]||b.address)&&!c.checkSelected(b)){var d=c.getEl(),e=A.chooseDiv;e||(e=document.createElement("DIV"),e.className="nui-item",A.chooseDiv=e),e=e.cloneNode(!1),e.title=b.address||c.getContactEmails(b)||null;var f=A.chooseSpan;f||(f=document.createElement("SPAN"),f.className="nui-txt-link",f.style.cursor="pointer",A.chooseSpan=f),f=f.cloneNode(!1),f.innerHTML="移除",a.Event.listen(f,"click",function(){var a=f.parentNode;a.parentNode.removeChild(a),c.removeSelected(b)});var g=b.defaultName||b.address||c.getGivenName(b)||c.getContactEmails(b);f.title="移除"+g,a.fly(e).append(f),a.fly(e).append('<span class="nui-contacts-selectedList-name">'+a.String.escapeHTML(g)+"</span>"),d.findFly(".nui-contacts-selectedList").append(e),c.selected.push(b),c.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(c.selected.length)}}function l(b){var c=this;c.checkSelected(b,!0),c.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(c.selected.length)}function m(){var a=this;a.selected.length>0?a.removeAllLink.show():a.removeAllLink.hide()}function n(){var b=this,c=b.getEl();b.selected=[],c.findFly(".nui-contacts-selectedList").empty(),b.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(b.selected.length)}function o(b,c){var d=this,e=!1;return u.each(d.selected,function(f,g){return g===b||b.CID&&g.CID==b.CID?(c&&d.selected.splice(f,1),e=!0,a.BREAK):void 0}),e}function p(){for(var b,c,d,e,f=this,g=f.rawConfig.data.extDataMap.groupArray,h=[],i=0,j=g.length,k=h;j>i;i+=1)if(b=g[i],"ALL"!==b.CID){c=b.CONTACTS||[],d={text:a.String.left(b.N||"未命名分组",16,!0),items:[],isFold:!0},e=d.items;for(var l,m,n,o,p=0,q=c.length;q>p;p+=1)if(l=c[p]){if(m=f.getGivenName(l)||"",o=f.getContactEmails(l),n=o[0]||"",!n)continue;m||n&&(m=n.split("@")[0]),e.push({text:a.String.left(m,22,!0),click:a.Function.bind(function(a){this.choose(a)},f,l),title:o.length>0?o.join(","):null,titleScale:"label"})}(0!==e.length||"OTHERS"===b.CID)&&(d.extItems=[{xtype:"link",text:"("+e.length+")",title:"添加该组"+e.length+"个联系人",click:a.Function.bind(function(b){a.Event.cancel();var c=b.CONTACTS,d=this;u.each(c,function(a,b){d.choose(b)})},f,b)}],k.push(d))}return h}function q(a){var b=a.FN||"";return b}function r(a){var b,c,d,e=[];for(var f in a)d=a[f],f.indexOf("EMAIL")>=0&&d&&("string"==typeof d?c||f!==v?e.push(d):c=d:"function"==typeof d.pop&&(d=s.clone(d),c||f!==v||(c=d.shift()),e=e.concat(d)));return c&&e.unshift(c),b=e.join("@@").toLowerCase(),b.split("@@")}var s=a.Object,t=a.String,u=a.Array,v=a.EMAIL_ADDRESS||b.EMAIL_ADDRESS,w=a.Element,x=a.Email||b.Email,y=a.getClass("netease.mail.component.Component"),z=$I("component.Input");$I("component.Tree");var A=a.createClass($N("component.contact.SelectContact"));s.mix(A,y,{_template:'<div class="nui-contacts nui-contacts-hasResult"><div class="nui-contacts-from"><div class="nui-contacts-listTitle">所有联系人</div>#{left}</div><b class="nui-contacts-arr nui-ico nui-ico-next"></b><div class="nui-contacts-to"><div class="nui-contacts-listTitle">#{removeAll}#{title}(<span id="spnSelectContactSelectedNum">0</span>)</div><div class="nui-contacts-selectedList nui-scroll">#{right}</div></div></div>',_listeners:[{name:"render",handler:function(){var a=this,b=a.rawConfig;b.exist&&u.each(b.exist,function(b,c){a.choose(c)})},type:"custom"},{name:"destroy",handler:function(){this.removeAllLink.destroy(),this.removeAllLink=null,delete this.removeAllLink},type:"custom"}],xtype:"selectcontact",show:i},{selected:[],initialize:c,getTree:p,choose:k,removeSelected:l,removeAll:n,checkRemoveAllLink:m,getGivenName:q,getContactEmails:r,checkSelected:o,search:h,searchContact:g,searchCancel:e,clearSearch:f,format:j,_getData:d})}($,window),function(a,b,c){function d(){if(!f.inited){f.inited=!0;var a,b,d,e,g,h,i,j,k,l={a:0},m=["isindex","fieldset"],n=["input","button","select","textarea","label"],o=["a"].concat(n),p=["iframe"].concat(o),q=["hr","ul","menu","div","blockquote","noscript","table","center","address","dir","pre","h5","dl","h4","noframes","h6","ol","h1","h3","h2"],r=["ins","del","script","style"],s=["b","acronym","bdo","var","#","abbr","code","br","i","cite","kbd","u","strike","s","tt","strong","q","samp","em","dfn","span"].concat(r),t=["sub","img","embed","object","sup","basefont","map","applet","font","big","small"].concat(s),u=["p"].concat(t),v=["iframe"].concat(t).concat(n),w=["img","embed","noscript","br","kbd","center","button","basefont","h5","h4","samp","h6","ol","h1","h3","h2","form","font","#","select","menu","ins","abbr","label","code","table","script","cite","input","iframe","strong","textarea","noframes","big","small","span","hr","sub","bdo","var","div","object","sup","strike","dir","map","dl","applet","del","isindex","fieldset","ul","b","acronym","a","blockquote","i","u","s","tt","address","q","pre","p","em","dfn"],x=[l].concat(v),y=["tr"],z=["#"],A=["param"].concat(w),B=["form"].concat(m).concat(p).concat(q).concat(u),C=["li","ol","ul"],D=["style","script"],E=["base","link","meta","title"],F=E.concat(D),G=["head","body"],H=["html"],I=["address","blockquote","center","dir","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","isindex","menu","noframes","ol","p","pre","table","ul"],J=["area","base","basefont","br","col","command","dialog","embed","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"],K=[["nonBodyContent",H.concat(G).concat(E)],["block",I],["inline",x],["inlineWithA",["a"].concat(x)],["body",["script","style"].concat(I)],["cdata",["script","style"]],["empty",J],["nonChild",["iframe","textarea"]],["listItem",["dd","dt","li"]],["list",["ul","ol","dl"]],["isNotEmpty",["table","ul","ol","dl","iframe","area","base","col","hr","img","embed","input","link","meta","param","h1","h2","h3","h4","h5","h6"]],["removeEmpty",["a","abbr","acronym","address","b","bdo","big","cite","code","del","dfn","em","font","i","ins","label","kbd","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"]],["removeEmptyBlock",["p","div"]],["tableContent",["caption","col","colgroup","tbody","td","tfoot","th","thead","tr","table"]],["notTransContent",["pre","script","style","textarea"]],["html",G],["head",F],["style",z],["script",z],["body",B],["base",[]],["link",[]],["meta",[]],["title",z],["col",[]],["tr",["td","th"]],["img",[]],["embed",[]],["colgroup",["thead","col","tbody","tr","tfoot"]],["noscript",B],["td",B],["br",[]],["th",B],["center",B],["kbd",x],["button",u.concat(q)],["basefont",[]],["h5",x],["h4",x],["samp",x],["h6",x],["ol",C],["h1",x],["h3",x],["option",z],["h2",x],["form",m.concat(p).concat(q).concat(u)],["select",["optgroup","option"]],["font",x],["ins",x],["menu",C],["abbr",x],["label",x],["table",["thead","col","tbody","tr","colgroup","caption","tfoot"]],["code",x],["tfoot",y],["cite",x],["li",B],["input",[]],["iframe",B],["strong",x],["textarea",z],["noframes",B],["big",x],["small",x],["span",["#","br","b","strong","u","i","em","sub","sup","strike","span"]],["hr",x],["dt",x],["sub",x],["optgroup",["option"]],["param",[]],["bdo",x],["var",x],["div",B],["stationery",B],["object",A],["sup",x],["dd",B],["strike",x],["area",[]],["dir",C],["map",["area"].concat(m).concat(r).concat(q)],["applet",A],["dl",["dt","dd"]],["del",x],["isindex",[]],["fieldset",["legend"].concat(w)],["thead",y],["ul",C],["acronym",x],["b",x],["a",["a"].concat(v)],["blockquote",["td","tr","tbody","li"].concat(B)],["caption",x],["i",x],["u",x],["tbody",y],["s",x],["address",p.concat(u)],["tt",x],["legend",x],["q",x],["pre",s.concat(o)],["p",["a"].concat(x)],["em",x],["dfn",x]];for(a=0,d=K.length;d>a;a++){for(aMap=K[a],g=aMap[0],h=aMap[1],k={},b=0,e=h.length;e>b;b++)i=h[b],j=1,i===l&&(i="a",j=0),k[i]===c&&(k[i]=j,k[i.toUpperCase()]=j);h.length=0,f[g]=k,f[g.toUpperCase()]=k}K.length=0}}var e=a.Object,f=a.createClass($N("component.editor.Dtd"));e.extend(f,{init:d,inited:!1})}($,window),function(a,b,c){function d(){var a=navigator.userAgent.toLowerCase();return a.indexOf(" applewebkit/")>-1}function e(){var a=this;return"Gecko"===navigator.product&&!a.webkit()&&!qb.opera()}function f(a){if(!a)return{};a=pb.isArray(a)?a:a.split(",");for(var b,c={},d=0,e=a.length;e>d;d++)b=a[d],c[b]=c[b.toUpperCase()]=1;return c}function g(a){var b=this;if(!b.domStyleCache){var d=document.createElement("div").style;b.domStyleCache={"float":d.cssFloat!=c?"cssFloat":d.styleFloat!=c?"styleFloat":"float"}}var e=b.domStyleCache;return e[a]||(e[a]=a.toLowerCase().replace(/-./g,function(a){return a.charAt(1).toUpperCase()}))}function h(a,b){if(/color/i.test(a)&&/rgba?/.test(b)){var c=b.split(",");if(c.length>3)return"";b="#";for(var d=0,e=c.length;e>d;d++)sColor=c[d],sColor=parseInt(sColor.replace(/[^\d]/gi,""),10).toString(16),b+=1==sColor.length?"0"+sColor:sColor;b=b.toLowerCase()}return b}function i(a){if(!/(pt|cm)/.test(a))return a;var b;switch(a.replace(/([\d.]+)(\w+)/,function(c,d,e){a=d,b=e}),b){case"cm":a=25*parseFloat(a);break;case"pt":a=Math.round(96*parseFloat(a)/72)}return a+(a?"px":"")}function j(a){return rb.trim(a,!0)}function k(a,b,c){var d=-1;c=pb.isNumber(c)?c:0;for(var e=0,f=a.length;f>e;e++)if(e>=c&&a[e]===b){d=e;break}return d}function l(a,b,c){var d=this;return d.setAttributes(a.createElement(b),c)}function m(a,b){for(var c=a,d=0;c=c.previousSibling;)b&&3==c.nodeType?c.nodeType!=c.nextSibling.nodeType&&d++:d++;return d}function n(a,b,c){var d=this;if(a&&!d.isBody(a))for(a=c?a:a.parentNode;a;){if(!b||b(a)||d.isBody(a))return b&&!b(a)&&d.isBody(a)?null:a;a=a.parentNode}return null}function o(a,b,c,d){for(var e=this,f=b&&(c&&c(a)||!c)?[a]:[];a=e.findParent(a,c);)f.push(a);return d?f:f.reverse()}function p(a,b,c,d){var e=this;return b=e.listToMap(pb.isArray(b)?b:[b]),e.findParent(a,function(a){return b[a.tagName]&&!(d&&d(a))},c)}function q(a,b,c){var d=this,e=[];if(!pb.isFunction(b)){var f=b;b=function(a){return a.tagName?-1!=d.indexOf(pb.isArray(f)?f:f.split(" "),a.tagName.toLowerCase()):!1}}for(var g=0,h=a.length;h>g;g++)b(a[g])&&e.push(a[g]);return 0==e.length?null:1!=e.length&&c?e:e[0]}function r(a,b){var c,d=a.parentNode;if(d){if(b&&a.hasChildNodes())for(;c=a.firstChild;)d.insertBefore(c,a);d.removeChild(a)}return a}function t(a,b){var c=this;b=pb.isArray(b)?b:c.trim(b).replace(/[ ]{2,}/g," ").split(" ");for(var d,e=0,f=b.length;f>e;e++){switch(d=b[e],d=c.attrFix[d]||d){case"className":a[d]="";break;case"style":if(a.style.cssText="",!qb.ie()){var g=a.getAttributeNode("style");if(g)try{a.removeAttribute(g)}catch(h){}}}a.removeAttribute(d)}}function u(a){for(var b=a.getElementsByTagName("*"),c=0,d=b.length;d>c;c++)b[c].removeAttribute("_moz_dirty");a.removeAttribute("_moz_dirty")}function v(a,b){if(a===b)return 0;for(var c=[a],d=[b],e=a;e=e.parentNode;){if(e===b)return 10;c.push(e)}for(e=b;e=e.parentNode;){if(e===a)return 20;d.push(e)}if(c.reverse(),d.reverse(),c[0]!==d[0])return 1;for(var f=-1;f++,c[f]===d[f];);for(a=c[f],b=d[f];a=a.nextSibling;)if(a===b)return 4;return 2}function w(a,b,c){function d(a,b,c){var d;if((d=c[a])&&!e.isBookmarkNode(d)&&1==d.nodeType&&e.isSameElement(c,d)){for(;d.firstChild;)"firstChild"===b?c.insertBefore(d.lastChild,c.firstChild):c.appendChild(d.firstChild);e.remove(d)}}var e=this;!b&&d("previousSibling","firstChild",a),!c&&d("nextSibling","lastChild",a)}function x(a,b,c){for(var d=this,e=d.getElementsByTagName(a,a.tagName.toLowerCase()),f=0,g=e.length;g>f;f++)if(oCi=e[f],oCi.parentNode&&!d.isBookmarkNode(oCi))if("span"!==oCi.tagName.toLowerCase())d.isSameElement(a,oCi)&&d.remove(oCi,!0);else{if(a===oCi.parentNode&&(d.trimWhiteTextNode(a),1==a.childNodes.length)){a.style.cssText=oCi.style.cssText+";"+a.style.cssText,d.remove(oCi,!0);continue}if(oCi.style.cssText=a.style.cssText+";"+oCi.style.cssText,c){var h=c.style;if(h){h=h.split(";");for(var i=0,j=h.length;j>i;i++)s=h[i],oCi.style[d.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}d.isSameStyle(oCi,a)&&d.remove(oCi,!0)}}function y(a){for(var b=this,c=a.parentNode;c&&nb.removeEmpty[c.tagName];){if(c.tagName==a.tagName||"A"==c.tagName){if(b.trimWhiteTextNode(c),"SPAN"==c.tagName&&!b.isSameStyle(c,a)||"A"==c.tagName&&"SPAN"==a.tagName){if(c.childNodes.length>1||c!==a.parentNode){a.style.cssText=c.style.cssText+";"+a.style.cssText,c=c.parentNode;continue}c.style.cssText+=";"+a.style.cssText,"A"==c.tagName&&(c.style.textDecoration="underline")}if("A"!=c.tagName){c===a.parentNode&&b.remove(a,!0);break}}c=c.parentNode}}function z(a,b,c){function d(a,b){for(var c;a&&!e.isBookmarkNode(a)&&(e.isEmptyInlineElement(a)||!new RegExp("[^	\n\r"+e.fillChar+"]").test(a.nodeValue));)c=a[b],e.remove(a),a=c}var e=this;!b&&d(a.nextSibling,"nextSibling"),!c&&d(a.previousSibling,"previousSibling")}function A(a,b){if(a===b)return a;for(var c=[a],d=[b],e=a,f=-1;e=e.parentNode;){if(e===b)return e;
c.push(e)}for(e=b;e=e.parentNode;){if(e===a)return e;d.push(e)}for(c.reverse(),d.reverse();f++,c[f]===d[f];);return 0==f?null:c[f-1]}function B(a,b,c){var d=this;if(c&&pb.isString(c)){var e=c;c=function(a){return d.hasClass(a,e)}}b=d.trim(b).replace(/[ ]{2,}/g," ").split(" ");for(var f=[],g=0,h=b.length;h>g;g++)for(var i=b[g],j=a.getElementsByTagName(i),k=0,l=j.length;l>k;k++)oCi=j[k],(!c||c(oCi))&&f.push(oCi);return f}function C(a,b){var c=this,d=a.ownerDocument;if(qb.ie()&&b==a.nodeValue.length){var e=d.createTextNode("");return c.insertAfter(a,e)}var f=a.splitText(b);if(qb.isIE(8)){var g=d.createTextNode("");c.insertAfter(f,g),c.remove(g)}return f}function D(a,b){return a.parentNode.insertBefore(b,a.nextSibling)}function E(a,b,c,d,e,f){var g,h=this,i=d&&a[b];for(i||(i=a[c]);!i&&(g=(g||a).parentNode);){if("body"===g.tagName.toLowerCase()||f&&!f(g))return null;i=g[c]}return i&&e&&!e(i)?h.getDomNode(i,b,c,!1,e):i}function F(a,b,c,d){var e=this;return e.getDomNode(a,"firstChild","nextSibling",b,c,d)}function G(a){var b=a.ownerDocument||a;return b.defaultView||b.parentWindow}function H(a){for(var b,c={},d=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g;b=d.exec(a);){var e=(b[1]||b[2]||b[4]||b[6]).toLowerCase(),f=(b[2]?b[3]:b[4]?b[5]:b[7])||"";c[e]=f}return c}function I(a,b){var c=this;return pb.each(b,function(b,d){switch(b){case"class":a.className=d;break;case"style":a.style.cssText=a.style.cssText+";"+d;break;case"innerHTML":a[b]=d;break;case"value":a.value=d;break;default:a.setAttribute(c.attrFix[b]||b,d)}}),a}function J(a,b,c){var d=this;a.style[d.cssStyleToDomStyle(b)]=c,d.trim(a.style.cssText)||d.removeAttributes(a,"style")}function K(a,b){var c=this;pb.each(b,function(b,d){c.setStyle(a,b,d)})}function L(a,b){var c=this;qb.ie()?("color"==b&&(b="(^|;)"+b),a.style.cssText=a.style.cssText.replace(new RegExp(b+"[^:]*:[^;]+;?","ig"),"")):a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(c.cssStyleToDomStyle(b)),a.style.cssText||c.removeAttributes(a,["style"])}function M(a,b){var c=this;if(pb.isRegExp(b))return b.test(a.className);b=c.trim(b).replace(/[ ]{2,}/g," ").split(" ");for(var d=a.className,e=0,f=b.length;f>e;e++){var g=b[e];if(!new RegExp("\\b"+g+"\\b","i").test(d))return!1}return e==b.length}function N(a){for(var b=0,c=0;a.offsetParent;)c+=a.offsetTop,b+=a.offsetLeft,a=a.offsetParent;return{x:b,y:c}}function O(a,b,c){function d(a){var b=a.document,c="CSS1Compat"==b.compatMode;return{width:(c?b.documentElement.clientWidth:b.body.clientWidth)||0,height:(c?b.documentElement.clientHeight:b.body.clientHeight)||0}}function e(a){if("pageXOffset"in a)return{x:a.pageXOffset||0,y:a.pageYOffset||0};var b=a.document;return{x:b.documentElement.scrollLeft||b.body.scrollLeft||0,y:b.documentElement.scrollTop||b.body.scrollTop||0}}var f=d(b).height,g=-1*f+(c||0);g+=a.offsetHeight||0;var h=tb.getXY(a);g+=h.y;var i=e(b).y;(g>i||i-f>g)&&b.scrollTo(0,g+(0>g?-20:20))}function P(a,b){var c,d,e,f=this,g=a,h=a;do{for(g=g.parentNode,c?(e=g.cloneNode(!1),e.appendChild(c),c=e,e=g.cloneNode(!1),e.appendChild(d),d=e):(c=g.cloneNode(!1),d=c.cloneNode(!1));e=h.previousSibling;)c.insertBefore(e,c.firstChild);for(;e=h.nextSibling;)d.appendChild(e);h=g}while(b!==g);return e=b.parentNode,e.insertBefore(c,b),e.insertBefore(d,b),e.insertBefore(a,d),f.remove(b),a}function Q(a){function b(b){for(var d;(d=a[b])&&3==d.nodeType&&c.isWhitespace(d);)a.removeChild(d)}var c=this;b("firstChild"),b("lastChild")}function R(a,b){var c=0,d=a.firstChild;for(b=b||function(){return 1};d;)b(d)&&c++,d=d.nextSibling;return c}function S(a,b,c){for(;a.firstChild;)c&&b.firstChild?b.insertBefore(a.lastChild,b.firstChild):b.appendChild(a.firstChild)}function T(a,b){var c=qb.ie()?a.createTextNode(tb.fillChar):a.createElement("BR");b.innerHTML="",b.appendChild(c)}function U(a,b){var c=this,d=a.style[c.cssStyleToDomStyle(b)];return c.fixColor(b,d)}function V(a,c){var d=this,e="width height top left";if(e.indexOf(c)>-1)return a["offset"+c.replace(/^\w/,function(a){return a.toUpperCase()})]+"px";if(3==a.nodeType&&(a=a.parentNode),qb.ie()&&qb.isIE("<9")&&"font-size"==c&&!a.style.fontSize&&!nb.empty[a.tagName]&&!nb.nonChild[a.tagName]){var f=a.ownerDocument.createElement("span");f.style.cssText="padding:0;border:0;font-family:simsun;",f.innerHTML=".",a.appendChild(f);var g=f.offsetHeight;return a.removeChild(f),f=null,g+"px"}try{var h=d.getStyle(a,c)||(b.getComputedStyle?d.getWindow(a).getComputedStyle(a,"").getPropertyValue(c):(a.currentStyle||a.style)[d.cssStyleToDomStyle(c)])}catch(i){return""}return d.transUnitToPx(d.fixColor(c,h))}function W(a,b){var c=this;return 10===c.getPosition(a,b)}function X(a){return a&&1==a.nodeType&&"body"===a.tagName.toLowerCase()}function Y(a,b){var c=this;return 3==a.nodeType&&0===a.nodeValue.replace(new RegExp((b?"^":"")+c.fillChar),"").length}function Z(a){var b=this;if(1!=a.nodeType||!nb.removeEmpty[a.tagName])return 0;for(a=a.firstChild;a;){if(b.isBookmarkNode(a))return 0;if(1==a.nodeType&&!b.isEmptyInlineElement(a)||3==a.nodeType&&!b.isWhitespace(a))return 0;a=a.nextSibling}return 1}function $(a){var b=this;return!a.firstChild||0==b.getChildCount(a,function(a){return!b.isBr(a)&&!b.isBookmarkNode(a)&&!b.isWhitespace(a)})}function _(a){var b=this;return!new RegExp("[^ 	\n\r"+b.fillChar+"]").test(a.nodeValue)}function ab(a){return 1==a.nodeType&&a.id&&/^_webmail_bookmark_/i.test(a.id)}function bb(a){return 1==a.nodeType&&"BR"==a.tagName}function cb(a){var b=this;return 1==a.nodeType&&(nb.block[a.tagName]||b.styleBlock[b.getComputedStyle(a,"display")])&&!nb.nonChild[a.tagName]}function db(a,b){return 1==a.nodeType&&new RegExp("^"+a.tagName+"$","i").test(b)}function eb(a,b){var c=this;if(a.tagName!=b.tagName)return!1;var d=a.attributes,e=b.attributes;if(!qb.ie()&&d.length!==e.length)return!1;for(var f,g,h=0,i=0,j=0;f=d[j++];){if("style"==f.nodeName){if(f.specified&&h++,c.isSameStyle(a,b))continue;return!1}if(qb.ie()){if(!f.specified)continue;h++,g=e.getNamedItem(f.nodeName)}else g=b.attributes[f.nodeName];if(!g.specified||f.nodeValue!=g.nodeValue)return!1}if(qb.ie()){for(j=0;g=e[j++];)g.specified&&i++;if(h!=i)return!1}return!0}function fb(a,b){var c=a.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),d=b.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(qb.opera()){if(c=a.style,d=b.style,c.length!=d.length)return!1;for(var e in c)if(!/^(\d+|csstext)$/i.test(e)&&c[e]!=d[e])return!1;return!0}if(!c||!d)return c==d;if(c=c.split(";"),d=d.split(";"),c.length!=d.length)return!1;for(var f,g=0;f=c[g++];)if(-1==sb.indexOf(d,f))return!1;return!0}function gb(a,b){for(var c,d=this;!d.isBody(a);)if(c=a,a=a.parentNode,c!==a[b])return!1;return!0}function hb(a,b){var c=a.startContainer;if(3==c.nodeType&&a.startOffset!=c.nodeValue.length)return 0;if(1==c.nodeType&&a.startOffset!=c.childNodes.length)return 0;for(;c!==b;){if(c.nextSibling)return 0;c=c.parentNode}return 1}function ib(a){return a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /gi,"&nbsp;").replace(/\"/g,"&quot;").replace(/\n/gi,"<br>")}function jb(a,b){return a=a.replace(/\n/gi,""),a=a.replace(/\\s+/gi,""),b||(a=a.replace(/<\/(address|blockquote|center|dir|div|dl|fieldset|form|hr|h[1-6]|isindex|iframe|menu|ol|p|pre|table|ul)>/gi,"\n"),a=a.replace(/<br>/gi,"\n")),a=a.replace(/<li>/gi," . ").replace(/<[^>]+>/g,"").replace(/&nbsp;/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"').replace(/&amp;/gi,"&")}function kb(a,b){var c="";return function(a){if(b&&3!=a.nodeType&&("BR"==a.tagName||nb.block[a.tagName])&&(c+="\n"),3==a.nodeType)c+=a.nodeValue;else if(a.childNodes)for(var d=a.childNodes,e=0;e<d.length;e++)arguments.callee.call(null,d[e])}(a),c=c.replace(tb.fillCharReg,""),b?c:c.replace(/\n/g,"")}function lb(a){if(!a)return"";var b=this,c=b.forbidden,d=c.tag||{},e=c.attr||{},f=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g,g=a.replace(f,function(a,c,f,g,h,i,j){if(c=c||"",f=f||"",g=g.toLowerCase(),h=h||"",i=i?" "+i:"",j=j||"",d[g])return"";if(""===i&&nb.empty[g]&&(i=" /"),""!==h){var k=b.getAttrList(a);pb.each(e,function(a){a in k&&delete k[a]}),h="",pb.each(k,function(a,b){h+=" "+a+'="'+b+'"'})}return c+"<"+f+g+h+i+">"+j});return g}function mb(a,b){return a?a.replace(b||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""}var nb;try{nb=$L("component.editor.Dtd")}catch(ob){return ob}var pb=a.Object,qb=a.Browser,rb=a.String,sb=a.Array,tb=a.createClass($N("component.editor.Util"));pb.extend(tb,{forbidden:{tag:{listing:1},attr:{xmlns:1}},NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,webkit:d,gecko:e,listToMap:f,cssStyleToDomStyle:g,fixColor:h,transUnitToPx:i,trim:j,indexOf:k,createElement:l,getNodeIndex:m,findParent:n,findParents:o,findParentByTagName:p,filterNodeList:q,remove:r,removeAttributes:t,removeDirtyAttr:u,getPosition:v,mergeSibling:w,mergeChild:x,mergeToParent:y,clearEmptySibling:z,getCommonAncestor:A,getElementsByTagName:B,split:C,insertAfter:D,getDomNode:E,getNextDomNode:F,getWindow:G,getAttrList:H,setAttributes:I,setStyle:J,setStyles:K,removeStyle:L,hasClass:M,getXY:N,scrollToView:O,breakParent:P,trimWhiteTextNode:Q,getChildCount:R,moveChild:S,fillNode:T,getStyle:U,getComputedStyle:V,inDoc:W,isBody:X,isFillChar:Y,isEmptyInlineElement:Z,isEmptyNode:$,isWhitespace:_,isBookmarkNode:ab,isBr:bb,isBlockElm:cb,isTagNode:db,isSameElement:eb,isSameStyle:fb,isBoundaryNode:gb,isInNodeEndBoundary:hb,textToHtml:ib,htmlToText:jb,getDomText:kb,filterHtml:lb,unhtml:mb,fillChar:qb.isIE(6)?"﻿":"​"}),tb.fillCharReg=new RegExp(tb.fillChar,"g"),tb.styleBlock=tb.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),tb.attrFix=qb.isIE("<9")?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"}}($,window),function(a,b){function c(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer===a.endContainer&&a.startOffset==a.endOffset}function d(a){return!a.collapsed&&1==a.startContainer.nodeType&&a.startContainer===a.endContainer&&1==a.endOffset-a.startOffset}function e(a,b,c,d){var e=this;return 1==b.nodeType&&(V.empty[b.tagName]||V.nonChild[b.tagName])&&(c=W.getNodeIndex(b)+(a?0:1),b=b.parentNode),a?(d.startContainer=b,d.startOffset=c,d.endContainer||d.collapse(!0)):(d.endContainer=b,d.endOffset=c,d.startContainer||d.collapse(!1)),e.updateCollapse(d),d}function f(a,b){var c,d,e=a.startContainer,f=a.endContainer,g=a.startOffset,h=a.endOffset,i=a.document,j=i.createDocumentFragment();if(1==e.nodeType&&(e=e.childNodes[g]||(c=e.appendChild(i.createTextNode("")))),1==f.nodeType&&(f=f.childNodes[h]||(d=f.appendChild(i.createTextNode("")))),e===f&&3==e.nodeType)return j.appendChild(i.createTextNode(e.substringData(g,h-g))),b&&(e.deleteData(g,h-g),a.collapse(!0)),j;for(var k,l,m,n,o=j,p=W.findParents(e,!0),q=W.findParents(f,!0),r=0;p[r]==q[r];)r++;for(var s=r;m=p[s];s++){for(k=m.nextSibling,m==e?c||(3==a.startContainer.nodeType?(o.appendChild(i.createTextNode(e.nodeValue.slice(g))),b&&e.deleteData(g,e.nodeValue.length-g)):o.appendChild(b?e:e.cloneNode(!0))):(l=m.cloneNode(!1),o.appendChild(l));k&&k!==f&&k!==q[s];)m=k.nextSibling,o.appendChild(b?k:k.cloneNode(!0)),k=m;o=l}o=j,p[r]||(o.appendChild(p[r-1].cloneNode(!1)),o=o.firstChild);for(var s=r;n=q[s];s++){if(k=n.previousSibling,n==f?d||3!=a.endContainer.nodeType||(o.appendChild(i.createTextNode(f.substringData(0,h))),b&&f.deleteData(0,h)):(l=n.cloneNode(!1),o.appendChild(l)),s!=r||!p[r])for(;k&&k!==e;)n=k.previousSibling,o.insertBefore(b?k:k.cloneNode(!0),o.firstChild),k=n;o=l}return b&&a.setStartBefore(q[r]?p[r]?q[r]:p[r-1]:q[r-1]).collapse(!0),c&&W.remove(c),d&&W.remove(d),j}function g(a,b){try{if(Y&&W.inDoc(Y,a))if(Y.nodeValue.replace(ab,"").length)Y.nodeValue=Y.nodeValue.replace(ab,"");else{var c=Y.parentNode;for(W.remove(Y);c&&W.isEmptyInlineElement(c)&&!_.inside(b,c);)Y=c.parentNode,W.remove(c),c=Y}}catch(d){}}function h(a,b){var c;for(a=a[b];a&&W.isFillChar(a);)c=a[b],W.remove(a),a=c}function i(a){var b=this;b.startContainer=b.startOffset=b.endContainer=b.endOffset=null,b.document=a,b.collapsed=!0,b.spanCache=a.createElement("SPAN")}function j(){var a=this;return a.collapsed?null:bb.execContentsAction(a,0)}function k(){var a,b=this;return b.collapsed||bb.execContentsAction(b,1),$.ie()||(a=b.startContainer,3!=a.nodeType||a.nodeValue.length||(b.setStartBefore(a).collapse(!0),W.remove(a))),b}function l(){var a=this;return a.collapsed?null:bb.execContentsAction(a,2)}function m(a,b){var c=this;return bb.setEndPoint(!0,a,b,c)}function n(a,b){var c=this;return bb.setEndPoint(!1,a,b,c)}function o(a){var b=this;return b.setStart(a.parentNode,W.getNodeIndex(a)+1)}function p(a){var b=this;return b.setStart(a.parentNode,W.getNodeIndex(a))}function q(a){var b=this;return b.setEnd(a.parentNode,W.getNodeIndex(a)+1)}function r(a){var b=this;return b.setEnd(a.parentNode,W.getNodeIndex(a))}function s(a){var b=this;return b.setStart(a,0)}function t(a){var b=this;return b.setStart(a,3==a.nodeType?a.nodeValue.length:a.childNodes.length)}function u(a){var b=this;return b.setEnd(a,0)}function v(a){var b=this;return b.setEnd(a,3==a.nodeType?a.nodeValue.length:a.childNodes.length)}function w(a){var b=this;return b.setStartBefore(a).setEndAfter(a)}function x(a){var b=this;return b.setStart(a,0).setEndAtLast(a)}function y(){var a=this;return new bb(a.document).setStart(a.startContainer,a.startOffset).setEnd(a.endContainer,a.endOffset)}function z(a){var b=this;return a?(b.endContainer=b.startContainer,b.endOffset=b.startOffset):(b.startContainer=b.endContainer,b.startOffset=b.endOffset),b.collapsed=!0,b}function A(a){function b(a){return 1==a.nodeType&&!W.isBookmarkNode(a)&&!V.empty[a.tagName]&&!V.nonChild[a.tagName]}for(var c,d=this,e=d.collapsed;1==d.startContainer.nodeType&&(c=d.startContainer.childNodes[d.startOffset])&&b(c);)d.setStart(c,0);if(e)return d.collapse(!0);if(!a)for(;1==d.endContainer.nodeType&&d.endOffset>0&&(c=d.endContainer.childNodes[d.endOffset-1])&&b(c);)d.setEnd(c,c.childNodes.length);return d}function B(a,b){var c=this,d=c.startContainer,e=c.endContainer;return d===e?a&&bb.selectOneNode(c)&&(d=d.childNodes[c.startOffset],1==d.nodeType)?d:b&&3==d.nodeType?d.parentNode:d:W.getCommonAncestor(d,e)}function C(a){var b=this;b.txtToElmBoundary();var c=b.startContainer,d=b.startOffset,e=b.collapsed,f=b.endContainer;if(3==c.nodeType){if(0==d)b.setStartBefore(c);else if(d>=c.nodeValue.length)b.setStartAfter(c);else{var g=W.split(c,d);c===f?b.setEnd(g,b.endOffset-d):c.parentNode===f&&(b.endOffset+=1),b.setStartBefore(g)}if(e)return b.collapse(!0)}return a||(d=b.endOffset,f=b.endContainer,3==f.nodeType&&(0==d?b.setEndBefore(f):(d<f.nodeValue.length&&W.split(f,d),b.setEndAfter(f)))),b}function D(a){function b(a,b){var c=a[b+"Container"],d=a[b+"Offset"];3==c.nodeType&&(d?d>=c.nodeValue.length&&a["set"+b.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](c):a["set"+b.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](c))}var c=this;return(a||!c.collapsed)&&(b(c,"start"),b(c,"end")),c}function E(a){var b=this,c=a,d=1;11==a.nodeType&&(c=a.firstChild,d=a.childNodes.length),b.trimBoundary(!0);var e=b.startContainer,f=b.startOffset,g=e.childNodes[f];return g?e.insertBefore(a,g):e.appendChild(a),c.parentNode===b.endContainer&&(b.endOffset=b.endOffset+d),b.setStartBefore(c)}function F(a,b){var c=this;return c.collapse(!a).select(b)}function G(a,b){var c,d=this,e=d.spanCache.cloneNode(!1);return bb.ieLess9||(e.style.display="none"),e.appendChild(d.document.createTextNode("‍")),e.id="_webmail_bookmark_start_"+(b?"":bb.guid++),d.collapsed||(c=e.cloneNode(!0),c.id="_webmail_bookmark_end_"+(b?"":bb.guid++)),d.insertNode(e),c&&d.collapse().insertNode(c).setEndBefore(c),d.setStartAfter(e),{start:a?e.id:e,end:c?a?c.id:c:null,id:a}}function H(a){if(!a)return b;var b=this,c=a.id?b.document.getElementById(a.start):a.start,d=a.end&&a.id?b.document.getElementById(a.end):a.end;return b.setStartBefore(c),W.remove(c),d?(b.setEndBefore(d),W.remove(d)):b.collapse(!0),b}function I(a,b){var c,d,e=this,f=e.document.createTextNode("");if(a){for(d=e.startContainer,1==d.nodeType?d.childNodes[e.startOffset]?c=d=d.childNodes[e.startOffset]:(d.appendChild(f),c=d=f):c=d;;){if(W.isBlockElm(d)){for(d=c;(c=d.previousSibling)&&!W.isBlockElm(c);)d=c;e.setStartBefore(d);break}c=d,d=d.parentNode}for(d=e.endContainer,1==d.nodeType?((c=d.childNodes[e.endOffset])?d.insertBefore(f,c):d.appendChild(f),c=d=f):c=d;;){if(W.isBlockElm(d)){for(d=c;(c=d.nextSibling)&&!W.isBlockElm(c);)d=c;e.setEndAfter(d);break}c=d,d=d.parentNode}f.parentNode===e.endContainer&&e.endOffset--,W.remove(f)}if(!e.collapsed){for(;!(0!=e.startOffset||b&&b(e.startContainer)||W.isBody(e.startContainer));)e.setStartBefore(e.startContainer);for(;!(e.endOffset!=(1==e.endContainer.nodeType?e.endContainer.childNodes.length:e.endContainer.nodeValue.length)||b&&b(e.endContainer)||W.isBody(e.endContainer));)e.setEndAfter(e.endContainer)}return e}function J(){var a=this;if(!a.collapsed){for(;!W.isBody(a.startContainer)&&a.startOffset==a.startContainer[3==a.startContainer.nodeType?"nodeValue":"childNodes"].length&&a.startContainer[3==a.startContainer.nodeType?"nodeValue":"childNodes"].length;)a.setStartAfter(a.startContainer);for(;!W.isBody(a.endContainer)&&!a.endOffset&&a.endContainer[3==a.endContainer.nodeType?"nodeValue":"childNodes"].length;)a.setEndBefore(a.endContainer)}return a}function K(a,b,c){var d=this;if(d.collapsed)return d;d.trimBoundary().enlarge(!1,function(a){return 1==a.nodeType&&W.isBlockElm(a)}).adjustmentBoundary();for(var e,f,g=d.createBookmark(),h=g.end,i=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase():!W.isWhitespace(a)},j=W.getNextDomNode(g.start,!1,i),k=d.cloneRange();j&&4&W.getPosition(j,h);)if(3==j.nodeType||V[a][j.tagName]){for(k.setStartBefore(j),f=j;f&&(3==f.nodeType||V[a][f.tagName])&&f!==h;)e=f,f=W.getNextDomNode(f,1==f.nodeType,null,function(b){return V[a][b.tagName]});var l,m=k.setEndAfter(e).extractContents();if(c&&c.length>0){var n,o;o=n=c[0].cloneNode(!1);for(var p,q=1;p=c[q++];)n.appendChild(p.cloneNode(!1)),n=n.firstChild;l=n}else l=k.document.createElement(a);b&&W.setAttributes(l,b),l.appendChild(m),k.insertNode(c?o:l);var r;if("span"==a&&b.style&&/text\-decoration/.test(b.style)&&(r=W.findParentByTagName(l,"a",!0))?(W.setAttributes(r,b),W.remove(l,!0),l=r):(W.mergeSibling(l),W.clearEmptySibling(l)),W.mergeChild(l,b),j=W.getNextDomNode(l,!1,i),W.mergeToParent(l),f===h)break}else j=W.getNextDomNode(j,!0,i);return d.moveToBookmark(g)}function L(a){var b=this;if(b.collapsed)return b;a=Z.isArray(a)?a:[a],b.shrinkBoundary().adjustmentBoundary();for(var c=b.startContainer,d=b.endContainer;;){if(1==c.nodeType){if(W.indexOf(a,c.tagName.toLowerCase())>-1)break;if("body"===c.tagName.toLowerCase()){c=null;break}}c=c.parentNode}for(;;){if(1==d.nodeType){if(W.indexOf(a,d.tagName.toLowerCase())>-1)break;if("body"==d.tagName.toLowerCase()){d=null;break}}d=d.parentNode}var e,f,g=b.createBookmark();c&&(f=b.cloneRange().setEndBefore(g.start).setStartBefore(c),e=f.extractContents(),f.insertNode(e),W.clearEmptySibling(c,!0),c.parentNode.insertBefore(g.start,c)),d&&(f=b.cloneRange().setStartAfter(g.end).setEndAfter(d),e=f.extractContents(),f.insertNode(e),W.clearEmptySibling(d,!1,!0),d.parentNode.insertBefore(g.end,d.nextSibling));for(var h,i=W.getNextDomNode(g.start,!1,function(a){return 1==a.nodeType});i&&i!==g.end;)h=W.getNextDomNode(i,!0,function(a){return 1==a.nodeType}),W.indexOf(a,i.tagName.toLowerCase())>-1&&W.remove(i,!0),i=h;return b.moveToBookmark(g)}function M(){var a,b=this;if(!b.collapsed){var c=b.cloneRange().adjustmentBoundary().shrinkBoundary();if(bb.selectOneNode(c)){var d=c.startContainer.childNodes[c.startOffset];d&&1==d.nodeType&&(V.empty[d.tagName]||V.nonChild[d.tagName])&&(a=d)}}return a}function N(b,c){function d(a,b){var c,d=this;d.collapsed||d.shrinkBoundary();var e=d.getClosedNode();if(e&&!b){try{c=d.document.body.createControlRange(),c.addElement(e),c.select()}catch(f){}return d}var g,h=d.createBookmark(),i=h.start;if(c=d.document.body.createTextRange(),c.moveToElementText(i),c.moveStart("character",1),d.collapsed){if(!a&&3!=d.startContainer.nodeType){var j=d.document.createTextNode(W.fillChar),k=d.spanCache.cloneNode(!1);k.appendChild(d.document.createTextNode(W.fillChar)),i.parentNode.insertBefore(k,i),i.parentNode.insertBefore(j,i),bb.removeFillData(d.document,j),Y=j,bb.mergeSibling(k,"previousSibling"),bb.mergeSibling(i,"nextSibling"),c.moveStart("character",-1),c.collapse(!0)}}else{var l=d.document.body.createTextRange();g=h.end,l.moveToElementText(g),c.setEndPoint("EndToEnd",l)}d.moveToBookmark(h),k&&W.remove(k);try{c.select()}catch(f){}return d}function e(a){var b,c=this,d=W.getWindow(c.document),e=d.getSelection();if(W.gecko()?c.document.body.focus():d.focus(),e){if(e.removeAllRanges(),c.collapsed&&!a){var g=c.startContainer,h=g;1==g.nodeType&&(h=g.childNodes[c.startOffset]),3==g.nodeType&&c.startOffset||(h?h.previousSibling&&3==h.previousSibling.nodeType:g.lastChild&&3==g.lastChild.nodeType)||(b=c.document.createTextNode(W.fillChar),c.insertNode(b),bb.removeFillData(c.document,b),bb.mergeSibling(b,"previousSibling"),bb.mergeSibling(b,"nextSibling"),Y=b,c.setStart(b,W.webkit()?1:0).collapse(!0))}var i=c.document.createRange();if(c.collapsed&&$.opera()&&1==c.startContainer.nodeType){var h=c.startContainer.childNodes[c.startOffset];if(h){for(;h&&W.isBlockElm(h)&&1==h.nodeType&&h.childNodes[0];)h=h.childNodes[0];h&&c.setStartBefore(h).collapse(!0)}else h=c.startContainer.lastChild,h&&W.isBr(h)&&c.setStartBefore(h).collapse(!0)}f(c),i.setStart(c.startContainer,c.startOffset);try{i.setEnd(c.endContainer,c.endOffset)}catch(j){}e.addRange(i)}return c}function f(a){function b(b,c,d){3==b.nodeType&&b.nodeValue.length<c&&(a[d+"Offset"]=b.nodeValue.length)}b(a.startContainer,a.startOffset,"start"),b(a.endContainer,a.endOffset,"end")}var g=this,h=a.Browser.isIE("<9")?d:e;return h.call(g,b,c)}function O(a,c){var d=this,e=d.spanCache.cloneNode(!1);return a=a?b:W.getWindow(d.document),e.innerHTML="&nbsp;",d.cloneRange().insertNode(e),W.scrollToView(e,a,c),W.remove(e),d}function P(){var a=this,b=a.startContainer;return this.collapsed&&3==b.nodeType&&b.nodeValue.replace(new RegExp("^"+W.fillChar),"").length+1==b.nodeValue.length}function Q(a,b){function c(a){for(var c=a?e.startContainer:e.endContainer,d=W.findParents(c,!0,function(a){return!W.isBody(a)}),f=[],g=0,h=d.length;h>g;g++)f.push(W.getNodeIndex(d[g],b));var i=0;if(b)if(3==c.nodeType){for(var j=c.previousSibling;j&&3==j.nodeType;)i+=j.nodeValue.replace(ab,"").length,j=j.previousSibling;i+=a?e.startOffset:e.endOffset}else if(c=c.childNodes[a?e.startOffset:e.endOffset])i=W.getNodeIndex(c,b);else{c=a?e.startContainer:e.endContainer;for(var k=c.firstChild;k;)if(W.isFillChar(k))k=k.nextSibling;else if(i++,3==k.nodeType)for(;k&&3==k.nodeType;)k=k.nextSibling;else k=k.nextSibling}else i=a?W.isFillChar(c)?0:e.startOffset:e.endOffset;return 0>i&&(i=0),f.push(i),f}var d={},e=this;return d.startAddress=c(!0),a||(d.endAddress=e.collapsed?[].concat(d.startAddress):c()),d}function R(a,b){function c(a,b){for(var c,e,f,g=d.document.body,h=0,i=a.length;i>h;h++)if(f=a[h],c=g,g=g.childNodes[f],!g){e=f;break}b?g?d.setStartBefore(g):d.setStart(c,e):g?d.setEndBefore(g):d.setEnd(c,e)}if(!a)return d;var d=this;return c(a.startAddress,!0),!b&&a.endAddress&&c(a.endAddress),d}function S(a){var b=this;return Z.each(b,function(b,c){return c!==a[b]?!1:void 0}),!0}function T(a,b){var c=this;if(c.collapsed)return c;for(var d=c.createBookmark(),e=d.end,f=W.getNextDomNode(d.start,!1,b);f&&f!==e&&4&W.getPosition(f,e);){var g=W.getNextDomNode(f,!1,b);a(f),f=g}return c.moveToBookmark(d)}function U(){var a=this,b=a.cloneContents(),c="";return b&&(c=W.getDomText(b)),c}var V,W;try{V=$L("component.editor.Dtd"),W=$L("component.editor.Util")}catch(X){return X}var Y,Z=a.Object,$=a.Browser,_=a.Element,ab=W.fillCharReg,bb=a.createClass($N("component.editor.Range"));Z.extend(bb,{guid:1,ieLess9:$.isIE("<9"),updateCollapse:c,selectOneNode:d,setEndPoint:e,execContentsAction:f,removeFillData:g,mergeSibling:h,test:"hello world"}),Z.extend(bb.prototype,{initialize:i,cloneContents:j,deleteContents:k,extractContents:l,setStart:m,setEnd:n,setStartAfter:o,setStartBefore:p,setEndAfter:q,setEndBefore:r,setStartAtFirst:s,setStartAtLast:t,setEndAtFirst:u,setEndAtLast:v,selectNode:w,selectNodeContents:x,cloneRange:y,collapse:z,shrinkBoundary:A,getCommonAncestor:B,trimBoundary:C,txtToElmBoundary:D,insertNode:E,setCursor:F,createBookmark:G,moveToBookmark:H,enlarge:I,adjustmentBoundary:J,applyInlineStyle:K,removeInlineStyle:L,getClosedNode:M,select:N,scrollToView:O,inFillChar:P,createAddress:Q,moveToAddress:R,equals:S,traversal:T,toString:U})}($,window),function(a){function b(a,b){a=a.duplicate(),a.collapse(b);var c=a.parentElement();if(!c.hasChildNodes())return{container:c,offset:0};for(var d,e,f=c.children,g=a.duplicate(),h=0,i=f.length-1,j=-1;i>=h;){j=Math.floor((h+i)/2),d=f[j],g.moveToElementText(d);var k=g.compareEndPoints("StartToStart",a);if(k>0)i=j-1;else{if(!(0>k))return{container:c,offset:r.getNodeIndex(d)};h=j+1}}if(-1==j){if(g.moveToElementText(c),g.setEndPoint("StartToStart",a),e=g.text.replace(/(\r\n|\r)/g,"\n").length,f=c.childNodes,!e)return d=f[f.length-1],{container:d,offset:d.nodeValue.length};for(var l=f.length;e>0;)e-=f[--l].nodeValue.length;return{container:f[l],offset:-e}}if(g.collapse(k>0),g.setEndPoint(k>0?"StartToStart":"EndToStart",a),e=g.text.replace(/(\r\n|\r)/g,"\n").length,!e)return q.empty[d.tagName]||q.nonChild[d.tagName]?{container:c,offset:r.getNodeIndex(d)+(k>0?0:1)}:{container:d,offset:k>0?0:d.childNodes.length};for(;e>0;)try{var m=d;d=d[k>0?"previousSibling":"nextSibling"],e-=d.nodeValue.length}catch(n){return{container:c,offset:r.getNodeIndex(m)}}return{container:d,offset:k>0?-e:d.nodeValue.length+e}}function c(a,b){var c=this;if(a.item)b.selectNode(a.item(0));else{var d=c.getBoundaryInformation(a,!0);b.setStart(d.container,d.offset),0!=a.compareEndPoints("StartToEnd",a)&&(d=c.getBoundaryInformation(a,!1),b.setEnd(d.container,d.offset))}return b}function d(a){var b;try{b=a.getNative().createRange()}catch(c){return null}var d=b.item?b.item(0):b.parentElement();return(d.ownerDocument||d)===a.document?b:null}function e(a){var b=this;b.document=a;var c;if(v.ie()){if(c=r.getWindow(a).frameElement,!c)return;w.listen(c,"beforedeactivate",function(){b._bakIERange=b.getIERange()}),w.listen(c,"activate",function(){try{!x._getIERange(b)&&b._bakIERange&&b._bakIERange.select()}catch(a){}b._bakIERange=null})}c=a=null}function f(){var a=this,b=a.document;try{return b?a.ieLess9?b.selection:r.getWindow(b).getSelection():null}catch(c){return null}}function g(){var a=this,b=x._getIERange(a);return!b&&a._bakIERange?a._bakIERange:b}function h(){var a=this;a.clear(),a._cachedRange=a.getRange(),a._cachedStartElement=a.getStart(),a._cachedStartElementPath=a.getStartElementPath()}function i(){var a=this;if(a._cachedStartElementPath)return a._cachedStartElementPath;var b=a.getStart();return b?r.findParents(b,!0,null,!0):[]}function j(){var a=this;a._cachedStartElementPath=a._cachedRange=a._cachedStartElement=null}function k(){var a=this;try{if(a.ieLess9){var b=x._getIERange(a);return!(!b||!a.rangeInBody(b))}return!!a.getNative().rangeCount}catch(c){return!1}}function l(){function a(a){for(var c=b.document.body.firstChild,d=a.collapsed;c&&c.firstChild;)a.setStart(c,0),c=c.firstChild;a.startContainer||a.setStart(b.document.body,0),d&&a.collapse(!0)}var b=this;if(null!=b._cachedRange)return b._cachedRange;var c=new s(b.document);if(b.ieLess9){var d=b.getIERange();if(d)try{x.transformIERangeToRange(d,c)}catch(e){a(c)}else a(c)}else{var f=b.getNative();if(f&&f.rangeCount){var g=f.getRangeAt(0),h=f.getRangeAt(f.rangeCount-1);c.setStart(g.startContainer,g.startOffset).setEnd(h.endContainer,h.endOffset),c.collapsed&&r.isBody(c.startContainer)&&!c.startOffset&&a(c)}else{if(b._bakRange&&r.inDoc(b._bakRange.startContainer,b.document))return b._bakRange;a(c)}}return b._bakRange=c}function m(){var a=this;if(a._cachedStartElement)return a._cachedStartElement;var b,c,d,e,f=a.ieLess9?a.getIERange():a.getRange();if(a.ieLess9){if(!f)return a.document.body.firstChild;if(f.item)return f.item(0);for(b=f.duplicate(),b.text.length>0&&b.moveStart("character",1),b.collapse(1),c=b.parentElement(),e=d=f.parentElement();d=d.parentNode;)if(d==c){c=e;break}}else if(f.shrinkBoundary(),c=f.startContainer,1==c.nodeType&&c.hasChildNodes()&&(c=c.childNodes[Math.min(c.childNodes.length-1,f.startOffset)]),3==c.nodeType)return c.parentNode;return c}function n(){var a,b,c=this;return c.isFocus()&&(a=c.getNative())?(b=c.ieLess9?a.createRange():a.getRangeAt(0),c.ieLess9?b.text:b.toString()):""}function o(){var a=this;try{var b=a.getNative();b.empty&&b.empty(),b.removeAllRanges&&b.removeAllRanges()}catch(c){}}function p(a,b){var c=this,d=c.ieLess9||b?a.item?a.item():a.parentElement():a.startContainer;return d===c.document.body||r.inDoc(d,c.document)}var q,r,s;try{q=$L("component.editor.Dtd"),r=$L("component.editor.Util"),s=$L("component.editor.Range")}catch(t){return t}var u=a.Object,v=a.Browser,w=a.Event,x=a.createClass($N("component.editor.Selection"));u.extend(x,{getBoundaryInformation:b,transformIERangeToRange:c,_getIERange:d}),u.extend(x.prototype,{ieLess9:v.isIE("<9"),initialize:e,getNative:f,getIERange:g,cache:h,getStartElementPath:i,clear:j,isFocus:k,getRange:l,getStart:m,getText:n,clearRange:o,rangeInBody:p})}($,window),function(a,b,c){function d(a){var b=this;b.document=a,b.selection=new y(a)}function e(a,b){var c=this;try{c.document.execCommand(a,!1,b)}catch(d){}}function f(a){try{var b=this,c=b.selection.getRange();if(a&&b.document.body.lastChild)c.setStartAtLast(b.document.body.lastChild).setCursor(!1,!0);else if(a===!1)try{c.setStartAtFirst(b.document.body).setCursor(!1,!0)}catch(d){c.select(!0)}else c.select(!0)}catch(d){}}function g(){var a=this,b=a.document.body,c=a.selection.getRange();b.innerHTML="<div>"+(C.ie()?"":"<br />")+"</div>",c.setStart(b.firstChild,0).setCursor(!1,!0)}function h(a,b,c,d){function e(a){return 1==a.nodeType}function f(a){if(3==a.nodeType||"span"!=a.tagName.toLowerCase())return 0;if(C.ie()){var b=a.attributes;if(b.length){for(var c=0,d=b.length;d>c;c++)if(b[c].specified)return 0;return 1}}return!a.attributes.length}function g(a){var c=a.createBookmark();if(a.collapsed&&a.enlarge(!0),!d){var g=w.findParentByTagName(a.startContainer,"a",!0);g&&a.setStartBefore(g),g=w.findParentByTagName(a.endContainer,"a",!0),g&&a.setEndAfter(g)}for(h=a.createBookmark(),p=h.start;(i=p.parentNode)&&!w.isBlockElm(i);)w.breakParent(p,i),w.clearEmptySibling(p);if(h.end){for(p=h.end;(i=p.parentNode)&&!w.isBlockElm(i);)w.breakParent(p,i),w.clearEmptySibling(p);for(var j,m=w.getNextDomNode(h.start,!1,e);m&&m!=h.end;)j=w.getNextDomNode(m,!0,e),v.empty[m.tagName.toLowerCase()]||w.isBookmarkNode(m)||(k.test(m.tagName)?b?(w.removeStyle(m,b),f(m)&&"text-decoration"!=b&&w.remove(m,!0)):w.remove(m,!0):v.tableContent[m.tagName]||v.list[m.tagName]||(w.removeAttributes(m,l),f(m)&&w.remove(m,!0))),m=j}var n=h.start.parentNode;!w.isBlockElm(n)||v.tableContent[n.tagName]||v.list[n.tagName]||w.removeAttributes(n,l),n=h.end.parentNode,h.end&&w.isBlockElm(n)&&!v.tableContent[n.tagName]&&!v.list[n.tagName]&&w.removeAttributes(n,l),a.moveToBookmark(h).moveToBookmark(c);
for(var o,p=a.startContainer,q=a.collapsed;1==p.nodeType&&w.isEmptyNode(p)&&v.removeEmpty[p.tagName];)o=p.parentNode,a.setStartBefore(p),a.startContainer===a.endContainer&&a.endOffset--,w.remove(p),p=o;if(!q)for(p=a.endContainer;1==p.nodeType&&w.isEmptyNode(p)&&v.removeEmpty[p.tagName];)o=p.parentNode,a.setEndBefore(p),w.remove(p),p=o}var h,i,j=this,k=new RegExp("^(?:"+(a||D.options.removeFormatTags).replace(/,/g,"|")+")$","i"),l=b?[]:(c||D.options.removeFormatAttributes).split(","),m=new x(j.document);m=j.selection.getRange(),g(m),m.select()}function i(b){var c=this;if(a.Browser.ie()){var d=c.document.createDocumentFragment(),e=c.document.createElement("DIV");e.innerHTML=b;for(var f;f=e.firstChild;)oLastNode=d.appendChild(f);var g=c.selection.getRange();g.deleteContents(),g.insertNode(d),g.collapse(!1),g.select()}else c.nativeCmd("inserthtml",b)}function j(b){function d(a,b,e,g){e=e||" ";var h="",i=g?'"':"";return A.each(a,function(a,g){g!==c&&null!==g&&""!==g&&(h+=A.isObject(g)?a+b+i+d(g,":",";")+i+e:a+b+i+f(g+"")+i+e)}),h}var e=this,f=a.String.encodeHTML,g=d(b,"="," ",!0),h="<img "+g+" />";return e.insertHtml(h)}function k(a){var b=this,c={left:"justifyLeft",center:"justifyCenter",right:"justifyRight"}[a]||"justifyLeft";b.focus(),b.nativeCmd(c,null);try{var d=w.findParent(this.selection.getRange().startContainer,function(a){return w.isBlockElm(a)},!0),e=(w.getElementsByTagName(d,"br")||[]).pop();e&&w.remove(e)}catch(f){}b.selection.getRange().select(!0)}function l(){var a=this;if(-1!==a.horizontalState()){a.insertHtml("<hr />");var b=a.selection.getRange();return b.select(),!0}}function m(){var a=this;return w.filterNodeList(a.selection.getStartElementPath(),"table")?-1:0}function n(a,b,c){function d(a,b,c,d){var e,f=["TD","LI","PRE"],g=a.createBookmark(),h=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase()&&!w.isBookmarkNode(a):!w.isWhitespace(a)};a.enlarge(!0);for(var i,j=a.createBookmark(),k=w.getNextDomNode(j.start,!1,h),l=a.cloneRange();k&&!(w.getPosition(k,j.end)&w.POSITION_FOLLOWING);)if(3!=k.nodeType&&w.isBlockElm(k))k=w.getNextDomNode(k,!0,h);else{for(l.setStartBefore(k);k&&k!==j.end&&!w.isBlockElm(k);)i=k,k=w.getNextDomNode(k,!1,null,function(a){return!w.isBlockElm(a)});l.setEndAfter(i),e=a.document.createElement(b),c&&(w.setAttributes(e,c),d&&"customstyle"==d&&c.style&&(e.style.cssText=c.style)),e.appendChild(l.extractContents()),w.isEmptyNode(e)&&w.fillChar(a.document,e),l.insertNode(e);var m=e.parentNode;w.isBlockElm(m)&&!w.isBody(e.parentNode)&&-1==w.indexOf(f,m.tagName)&&(d&&"customstyle"==d||(m.getAttribute("dir")&&e.setAttribute("dir",m.getAttribute("dir")),m.style.cssText&&(e.style.cssText=m.style.cssText+";"+e.style.cssText),m.style.textAlign&&!e.style.textAlign&&(e.style.textAlign=m.style.textAlign),m.style.textIndent&&!e.style.textIndent&&(e.style.textIndent=m.style.textIndent),m.style.padding&&!e.style.padding&&(e.style.padding=m.style.padding)),c&&/h\d/i.test(m.tagName)&&!/h\d/i.test(e.tagName)?(w.setAttributes(m,c),d&&"customstyle"==d&&c.style&&(m.style.cssText=c.style),w.remove(e,!0),e=m):w.remove(e.parentNode,!0)),k=-1!=w.indexOf(f,m.tagName)?m:e,k=w.getNextDomNode(k,!1,h)}return a.moveToBookmark(j).moveToBookmark(g)}var e=this.selection.getRange();if(e.collapsed){var f=this.document.createTextNode("p");if(e.insertNode(f),C.ie()){var g=f.previousSibling;g&&w.isWhitespace(g)&&w.remove(g),g=f.nextSibling,g&&w.isWhitespace(g)&&w.remove(g)}}if(e=d(e,a,b,c),f&&(e.setStartBefore(f).collapse(!0),oPN=f.parentNode,w.remove(f),w.isBlockElm(oPN)&&w.isEmptyNode(oPN)&&w.fillNode(this.document,oPN)),w.gecko()&&e.collapsed&&1==e.startContainer.nodeType){var h=e.startContainer.childNodes[e.startOffset];h&&1==h.nodeType&&h.tagName.toLowerCase()==a&&e.setStart(h,0).collapse(!0)}return e.select(),!0}function o(){var a=w.filterNodeList(this.selection.getStartElementPath(),"div p h1 h2 h3 h4 h5 h6");return a?a.tagName.toLowerCase():""}function p(a){var b=this;b.focus();var c=b.selection.getRange();if(c.collapsed){var d=w.findParent(c.startContainer,function(a){return a&&1==a.nodeType&&!w.isBody(a)},!0);d&&w.setStyle(d,"line-height",a)}else c.applyInlineStyle("SPAN",{style:"line-height:"+a});return c.select(),!0}function q(){var a=this,b=w.filterNodeList(a.selection.getStartElementPath(),function(a){return w.isBlockElm(a)});if(b){var c=w.getComputedStyle(b,"line-height");return"normal"==c?1:c.replace(/[^\d.]*/gi,"")}}function r(a){function b(a,b){var c=a.cloneRange(),e=d.linkValue();d._optimize(a=a.adjustmentBoundary());var f=a.startContainer;if(1==f.nodeType&&e&&(f=f.childNodes[a.startOffset],f&&1==f.nodeType&&"A"==f.tagName&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(f[C.ie()?"innerText":"textContent"])&&(f[C.ie()?"innerText":"textContent"]=w.textToHtml(b.textValue||b.href))),(!c.collapsed||e)&&(a.removeInlineStyle("a"),c=a.cloneRange()),c.collapsed){var g=a.document.createElement("a"),h="";b.textValue?(h=w.textToHtml(b.textValue),delete b.textValue):h=w.textToHtml(b.href),w.setAttributes(g,b),f=w.findParentByTagName(c.startContainer,"oA",!0),f&&w.isInNodeEndBoundary(c,f)&&a.setStartAfter(f).collapse(!0),g[C.ie()?"innerText":"textContent"]=h,a.insertNode(g).selectNode(g)}else a.applyInlineStyle("a",b)}var c,d=this;a.href&&(a.href=w.unhtml(a.href,new RegExp('[<">]',"g"))),a.textValue&&(a.textValue=w.unhtml(a.textValue,new RegExp('[<">]',"g"))),b(c=d.selection.getRange(),a),c.collapse().select(!0)}function s(){var a,b=this.selection.getRange();if(!b.collapsed){b.shrinkBoundary();var c=3!=b.startContainer.nodeType&&b.startContainer.childNodes[b.startOffset]?b.startContainer.childNodes[b.startOffset]:b.startContainer,d=3==b.endContainer.nodeType||0==b.endOffset?b.endContainer:b.endContainer.childNodes[b.endOffset-1],e=b.getCommonAncestor();if(a=w.findParentByTagName(e,"a",!0),!a&&1==e.nodeType)for(var f,g,h,i=e.getElementsByTagName("a"),j=0,k=i.length;k>j;j++)if(h=i[j],f=w.getPosition(h,c),g=w.getPosition(h,d),(f&w.POSITION_FOLLOWING||f&w.POSITION_CONTAINS)&&(g&w.POSITION_PRECEDING||g&w.POSITION_CONTAINS)){a=h;break}return a}return a=b.startContainer,a=1==a.nodeType?a:a.parentNode,a&&(a=w.findParentByTagName(a,"a",!0))&&!w.isInNodeEndBoundary(b,a)?a:void 0}function t(){var a,b=this,c=b.selection.getRange();(!c.collapsed||w.findParentByTagName(c.startContainer,"a",!0))&&(a=c.createBookmark(),b._optimize(c),c.removeInlineStyle("a").moveToBookmark(a).select())}function u(a){var b=a.startContainer,c=a.endContainer;(b=w.findParentByTagName(b,"a",!0))&&a.setStartBefore(b),(c=w.findParentByTagName(c,"a",!0))&&a.setEndAfter(c)}var v,w,x,y;try{v=$L("component.editor.Dtd"),w=$L("component.editor.Util"),x=$L("component.editor.Range"),y=$L("component.editor.Selection")}catch(z){return z}var A=a.Object,B=a.Array,C=a.Browser;a.Element,a.Event;var D=a.createClass($N("component.editor.Cmd"));A.extend(D,{basestyle:{bold:["b","strong"],italic:["i","em"],subscript:["sub"],superscript:["sup"],underline:["u"]},fonts:{forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",strikethrough:"text-decoration",fontborder:"border"},needCmd:{underline:1,strikethrough:1,fontborder:1,forecolor:1,backcolor:1,fontsize:1,fontfamily:1},options:{removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}}),A.extend(D.prototype,{initialize:d,nativeCmd:e,focus:f,cleardoc:g,removeFormat:h,insertHtml:i,insertImage:j,justify:k,horizontal:l,horizontalState:m,paragraph:n,paragraphState:o,lineheight:p,lineheightState:q,link:r,linkValue:s,unlink:t,_optimize:u,test:"hello world"}),A.each(D.basestyle,function(a,b){D.prototype[a]=function(){var c=this,d=c.selection.getRange(),e=w.filterNodeList(c.selection.getStartElementPath(),b);if(d.collapsed){if(e){var f=c.document.createTextNode("");d.insertNode(f).removeInlineStyle(b),d.setStartBefore(f),w.remove(f)}else{var g=d.document.createElement(b[0]);("superscript"==a||"subscript"==a)&&(f=c.document.createTextNode(""),d.insertNode(f).removeInlineStyle(["sub","sup"]).setStartBefore(f).collapse(!0)),d.insertNode(g).setStart(g,0)}d.collapse(!0)}else("superscript"==a||"subscript"==a)&&(e&&e.tagName.toLowerCase()==a||d.removeInlineStyle(["sub","sup"])),e?d.removeInlineStyle(b):d.applyInlineStyle(b[0]);d.select()},D.prototype[a+"State"]=function(){var a=this;return w.filterNodeList(a.selection.getStartElementPath(),b)?1:0}}),A.each(D.fonts,function(a,b){D.prototype[a]=function(c){function d(a,b,c){var d,g=a.collapsed,h=a.createBookmark();if(g)for(d=h.start.parentNode;v.inline[d.tagName];)d=d.parentNode;else d=w.getCommonAncestor(h.start,h.end);B.each(w.getElementsByTagName(d,"span"),function(a,d){if(d.parentNode&&!w.isBookmarkNode(d)){if(/\s*border\s*:\s*none;?\s*/i.test(d.style.cssText))return/^\s*border\s*:\s*none;?\s*$/.test(d.style.cssText)?w.remove(d,!0):w.removeStyle(d,"border"),void 0;if(/border/i.test(d.style.cssText)&&"SPAN"==d.parentNode.tagName&&/border/i.test(d.parentNode.style.cssText)&&(d.style.cssText=d.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")),"fontborder"!=b||"none"!=c)for(var f=d.nextSibling;f&&1==f.nodeType&&"SPAN"==f.tagName;)if(w.isBookmarkNode(f)&&"fontborder"==b)d.appendChild(f),f=d.nextSibling;else{if(f.style.cssText==d.style.cssText&&(w.moveChild(f,d),w.remove(f)),d.nextSibling===f)break;f=d.nextSibling}if(e(d),C.isIE(">8")){var g=w.findParent(d,function(a){return"SPAN"==a.tagName&&/background-color/.test(a.style.cssText)});g&&!/background-color/.test(d.style.cssText)&&(d.style.backgroundColor=g.style.backgroundColor)}}}),a.moveToBookmark(h),f(a,b,c)}function e(a){for(var b;(b=a.parentNode)&&"SPAN"==b.tagName&&1==w.getChildCount(b,function(a){return!w.isBookmarkNode(a)&&!w.isBr(a)});)b.style.cssText+=a.style.cssText,w.remove(a,!0),a=b}function f(a,b,c){var d={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};if(d[b]&&(a.adjustmentBoundary(),!a.collapsed&&1==a.startContainer.nodeType)){var e=a.startContainer.childNodes[a.startOffset];if(e&&w.isTagNode(e,"span")){var f=a.createBookmark();B.each(w.getElementsByTagName(e,"span"),function(a,e){e.parentNode&&!w.isBookmarkNode(e)&&("backcolor"!=b||w.getComputedStyle(e,"background-color").toLowerCase()!==c)&&(w.removeStyle(e,d[b]),0==e.style.cssText.replace(/^\s+$/,"").length&&w.remove(e,!0))}),a.moveToBookmark(f)}}}var g=this;c=c||(this[a+"State"]()?"none":"underline"==a?"underline":"fontborder"==a?"1px solid #000":"line-through");var h,i=this.selection.getRange();if("default"==c)i.collapsed&&(h=g.document.createTextNode("font"),i.insertNode(h).select()),g.removeFormat("span,a",b),h&&(i.setStartBefore(h).collapse(!0),w.remove(h)),d(i,a,c),i.select();else if(i.collapsed){var j=w.findParentByTagName(i.startContainer,"span",!0);if(h=g.document.createTextNode("font"),!j||j.children.length||j[C.ie()?"innerText":"textContent"].replace(w.fillCharReg,"").length){if(i.insertNode(h),i.selectNode(h).select(),j=i.document.createElement("span"),D.needCmd[a]){if(w.findParentByTagName(h,"a",!0))return i.setStartBefore(h).setCursor(),w.remove(h),void 0;g.removeFormat("span,a",b)}if(j.style.cssText=b+":"+c,h.parentNode.insertBefore(j,h),!C.ie()||C.isIE("9"))for(var k=j.parentNode;!w.isBlockElm(k);)"SPAN"==k.tagName&&(j.style.cssText=k.style.cssText+";"+j.style.cssText),k=k.parentNode;C.opera()?setTimeout(function(){i.setStart(j,0).collapse(!0),d(i,a,c),i.select()}):(i.setStart(j,0).collapse(!0),d(i,a,c),i.select())}else i.insertNode(h),D.needCmd[a]&&(i.selectNode(h).select(),g.removeFormat("span,a",b,null),j=w.findParentByTagName(h,"span",!0),i.setStartBefore(h)),j&&(j.style.cssText+=";"+b+":"+c),i.collapse(!0).select();w.remove(h)}else D.needCmd[a]&&g.removeFormat("span,a",b),i=g.selection.getRange(),i.applyInlineStyle("span",{style:b+":"+c}),d(i,a,c),i.select();return!0},D.prototype[a+"Value"]=function(){var c=this.selection.getStart();if("underline"==a||"strikethrough"==a){for(var d,e=c;e&&!w.isBlockElm(e)&&!w.isBody(e);){if(1==e.nodeType&&(d=w.getComputedStyle(e,b),"none"!=d))return d;e=e.parentNode}return"none"}if("fontborder"==a){for(var f,g=c;g&&v.inline[g.tagName];){if((f=w.getComputedStyle(g,"border"))&&/1px/.test(f)&&/solid/.test(f))return f;g=g.parentNode}return""}if("FontSize"==a){var h=w.getComputedStyle(c,b),g=/^([\d\.]+)(\w+)$/.exec(h);return g?Math.floor(g[1])+g[2]:h}return w.getComputedStyle(c,b)},D.prototype[a+"State"]=function(){var b=this;if(!D.needCmd[a])return 0;var c=b[a+"Value"]();return"fontborder"==a?/1px/.test(c)&&/solid/.test(c):c==("underline"==a?"underline":"line-through")}}),B.each("formatblock,selectall,insertorderedlist,insertunorderedlist,indent,outdent".split(","),function(a,b){D.prototype[b]=function(a){var c=this;c.focus(),c.nativeCmd(b,a)}}),B.each(["cut","copy","paste"],function(a,b){D.prototype[b]=function(){var a=this;return a.focus(),a.document.queryCommandSupported(b)?(a.nativeCmd(b,null),a):"not supported"}})}($,window),function(a){function b(a,b){var c=this,d=c.editMode,h=c[d+"FontnameMenu"];if(!h){var i=g.initMenuConf(c);h=new f(i),h.attachTo({clickFrom:b,delegateTo:"self"}),h.fire("attachToShow"),c[d+"FontnameMenu"]=h}setTimeout(function(){var a=(c.exec("fontfamilyValue")||"").replace(/'/g,"").replace(/"/g,""),b=!1;e.each(h.items,function(c,d){d.checked&&d.setChecked(!1),d.value===a&&"setDefault"!==a&&(d.setChecked(!0),b=!0)}),!b&&h.items&&h.items[0].setChecked(!0)},0)}function c(a){var b={groups:[{items:[],checkType:"radio"}],items:[],onItemClick:function(b){"setDefault"!==b.value&&a.exec("fontfamily",b.value)},width:"180px"},c=b.groups[0].items;return e.each(g.config,function(a,b){return"split"===b.type?(c.push({type:"split"}),void 0):(c.push({text:b.name,value:b.val,code:b.code,extAttr:' style="font-family:'+b.val+';" ',checked:b.checked}),void 0)}),a.setDefault&&(c.push({type:"split"}),c.push({text:"设置默认",value:"setDefault",click:function(){a.log("setDefaultFontname"),a.plugin.SetDefault.selected.call(a)}})),b}var d=a.Object,e=a.Array,f=a.getClass($N("component.Menu")),g=a.createClass($N("component.editor.plugin.Fontname"));d.extend(g,{selected:b,initMenuConf:c,config:[{name:"宋体",val:"simsun",code:1,checked:!0},{name:"黑体",val:"simhei",code:2},{name:"楷体,楷体_GB2312",val:"楷体,楷体_GB2312",code:3},{name:"隶书",val:"隶书",code:4},{name:"幼圆",val:"幼圆",code:5},{name:"微软雅黑",val:"Microsoft Yahei",code:"e"},{name:"Arial",val:"Arial",code:6},{name:"Arial Black",val:"Arial Black",code:7},{name:"Comic Sans MS",val:"Comic Sans MS",code:8},{name:"Courier",val:"Courier",code:9},{name:"System",val:"System",code:"a"},{name:"Times New Roman",val:"Times New Roman",code:"b"},{name:"Verdana",val:"Verdana",code:"c"},{name:"Georgia",val:"Georgia",code:"d"},{name:"Calibri",val:"Calibri",code:"f"}]})}($,window),function(a){function b(a,b){var c=this,d=c.editMode,h=c[d+"FontsizeMenu"];if(!h){var i=g.initMenuConf(c);h=new f(i),h.attachTo({clickFrom:b,delegateTo:"self"}),h.fire("attachToShow"),c[d+"FontsizeMenu"]=h}setTimeout(function(){var a=(c.exec("fontsizeValue")||"").replace(/'/g,""),b=!1;e.each(h.items,function(c,d){d.checked&&d.setChecked(!1),d.value===a&&"setDefault"!==a&&(d.setChecked(!0),b=!0)}),!b&&h.items&&h.items[0].setChecked(!0)},0)}function c(a){var b={groups:[{items:[],checkType:"radio"}],items:[],onItemClick:function(b){"setDefault"!==b.value&&a.exec("fontsize",b.value)},width:"190px"},c=b.groups[0].items;return e.each(g.config,function(a,b){return"split"===b.type?(c.push({type:"split"}),void 0):(c.push({text:b.name,value:b.val,code:b.code,extText:b.val,extcls:"APP-editor-fontSize-"+b.size,checked:b.checked}),void 0)}),a.setDefault&&(c.push({type:"split"}),c.push({text:"设置默认",value:"setDefault",click:function(){a.log("setDefaultFontsize"),a.plugin.SetDefault.selected.call(a)}})),b}var d=a.Object,e=a.Array,f=a.getClass($N("component.Menu")),g=a.createClass($N("component.editor.plugin.Fontsize"));d.extend(g,{selected:b,initMenuConf:c,config:[{name:"默认大小",val:"14px",code:1,size:0,checked:!0},{type:"split"},{name:"极小",val:"10px",code:2,size:1},{name:"特小",val:"13px",code:3,size:2},{name:"小",val:"16px",code:4,size:3},{name:"中",val:"18px",code:5,size:4},{name:"大",val:"24px",code:6,size:5},{name:"特大",val:"32px",code:7,size:6},{name:"极大",val:"48px",code:8,size:7}]})}($,window),function(a){function b(a,b){var c=this,d=c.editMode,h=c[d+"ForecolorMenu"];if(!h){var i=g.initMenuConf(c);h=new f(i),h.attachTo({clickFrom:b,delegateTo:"self"}),h.fire("attachToShow"),c[d+"ForecolorMenu"]=h}setTimeout(function(){var a=(c.exec("forecolorValue")||"").replace(/'/g,""),b=!1;e.each(h.items,function(c,d){d.checked&&d.setChecked(!1),d.value===a&&(d.setChecked(!0),b=!0)}),!b&&h.items&&"setDefault"!==a&&h.items[0].setChecked(!0)},0)}function c(a){var b={groups:[{items:[],checkType:"radio"}],items:[],extcls:"APP-editor-color",onItemClick:function(b){"setDefault"!==b.value&&a.exec("forecolor",b.value)},width:"180px"},c=b.groups[0].items;return e.each(g.config,function(a,b){return"split"===b.type?(c.push({type:"split"}),void 0):(c.push({text:'<b class="nui-ico APP-editor-ico-color" style="background:'+b.val+";"+("#ffffff"===b.val?"border:1px solid #ccc;height:7px;width:7px;":"")+'"></b>'+b.name,value:b.val,code:b.code,checked:b.checked}),void 0)}),a.setDefault&&(c.push({type:"split"}),c.push({text:"设置默认",value:"setDefault",click:function(){a.log("setDefaultForecolor"),a.plugin.SetDefault.selected.call(a)}})),b}var d=a.Object,e=a.Array,f=a.getClass($N("component.Menu")),g=a.createClass($N("component.editor.plugin.Forecolor"));d.extend(g,{selected:b,initMenuConf:c,config:[{val:"#000000",name:'黑色<span class="txt-info">(默认)</span>',code:1,checked:!0},{type:"split"},{val:"#880000",name:"暗红色",code:2},{val:"#800080",name:"紫色",code:3},{val:"#ff0000",name:"红色",code:4},{val:"#ff00ff",name:"鲜粉色",code:5},{val:"#000080",name:"深蓝色",code:6},{val:"#0000ff",name:"蓝色",code:7},{val:"#00ffff",name:"湖蓝色",code:8},{val:"#008080",name:"蓝绿色",code:9},{val:"#008000",name:"绿色",code:"a"},{val:"#808000",name:"橄榄色",code:"b"},{val:"#00ff00",name:"浅绿色",code:"c"},{val:"#ffcc00",name:"橙黄色",code:"d"},{val:"#808080",name:"灰色",code:"e"},{val:"#c0c0c0",name:"银色",code:"f"},{val:"#ffffff",name:"白色",code:"g"}]})}($,window),function(a){function b(){var a=this,b=a.constructor.mode;a.changeMode(b.BASIC)}var c=a.Object,d=a.createClass($N("component.editor.plugin.Basic"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this,b=a.constructor.mode;a.changeMode(b.FULL)}var c=a.Object,d=a.createClass($N("component.editor.plugin.Full"));c.extend(d,{selected:b})}($,window),function(a,b){function c(a){var b=this;p.extend(this,{editor:a,lastKey:null,_poll:[["",null]],_pos:0}),a.openHistory&&(a.listen("iframeKeydown",function(a){b.shortcut(a),b.copyOrDelete(a)}),a.listen("iframeKeydown",function(a){if(b.autoSave){var c={16:1,17:1,18:1,37:1,38:1,39:1,40:1,46:1,8:1};b.ieLess9&&(c["229"]=1),c[a.keyCode]||a.ctrlKey||a.altKey||a.metaKey||a.shiftKey||a.altKey||(b._curKeyCount++,b._curKeyCount>=b.interval&&(b._curKeyCount=0,b.save(!0)))}}))}function d(a){(a.ctrlKey||a.metaKey)&&(a.keyCode===u.Z?(q.stop(a),this.canUndo()&&this.undo()):a.keyCode===u.Y&&(q.stop(a),this.canRedo()&&this.redo()))}function e(a){var b=this;if(b._curKeyCount=0,b.editor.openHistory){var c=b._poll,d=b.editor,e=d.cmd.selection.getRange(),f=b._pos,g=c[f][0],h=d.body.innerHTML.replace(s.fillCharReg,""),i=b.getBookmark(a);return g!==h?(c=b._poll=c.slice(0,f+1),c.push([h,i]),c.length>b.maxUndoCount&&c.shift(),b._pos=c.length-1,e):e}}function f(){var a=this,b=a.editor;if(a.save(),a._pos>0){a._pos--;var c=a._poll[a._pos];b.body.innerHTML=c[0];try{a.setBookmark(c[1])}catch(d){}return!0}return!1}function g(){var a=this,b=this.editor;if(this._pos!==this._poll.length-1){this._pos++;var c=this._poll[this._pos];b.body.innerHTML=c[0];try{a.setBookmark(c[1])}catch(d){}return!0}return!1}function h(){if(this.autoSave){var a=this.editor.body.innerHTML;return Math.abs(a.length-this._removeBookMark(this._poll[this._pos][0]).length)+1>=this.interval?this.save():void 0}}function i(a){var b=a.keyCode;!this.autoSave||b!==u.BACKSPACE&&b!==u.DELETE&&b!==u.V&&u!==u.V||(((b===u.BACKSPACE||b===u.DELETE)&&this.lastKey!==b||a.ctrlKey&&b===u.V)&&this.save(!0),this.lastKey=b)}function j(){return this._pos>0}function k(a){var b=this,c=b.editor,d={};try{if(b.ieLess9&&document.selection&&a){try{c.focus()}catch(e){}var f=c.doc.selection,g=/text/i.test(f.type)?f.createRange().getBookmark():null;d.bookmark=g,d.toIE=!0}else{var h=c.cmd.selection.getRange();d.bookmark=h.createAddress(!1,!0)}}catch(e){}return d}function l(a){a=a||{};var b=this,c=b.editor,d=a.bookmark;if(d)try{if(a.toIE){var e=c.doc.body.createTextRange();"[object]"!==d&&e.moveToBookmark(d)&&e.select()}else{var e=new t(c.doc).moveToAddress(d),f=e.startContainer.nodeName.toLowerCase();e.select({body:1,ol:1,table:1,tbody:1,tr:1,ul:1}[f])}}catch(g){}}function m(){return this._pos!==this._poll.length-1}function n(a,b){return a=a.replace(/<span [^>]*id="?_webmail_bookmark_start_\d+"?[^>]*>.*?<\/span>|<span [^>]*id="?_webmail_bookmark_end_\d+"?[^>]*>.*?<\/span>/gi,"").replace(s.fillCharReg,""),b&&(a=a.replace(/\s/g,"")),decodeURI(encodeURI(a).replace(/%E2%80%8B/gi,""))}function o(a){return a=a.replace(s.fillCharReg,""),decodeURI(encodeURI(a).replace(/%E2%80%8B/gi,""))}var p=b.Object,q=b.Event,r=b.createClass($N("component.editor.plugin.History")),s=$L("component.editor.Util"),t=$L("component.editor.Range"),u={DELETE:46,BACKSPACE:8,C:67,V:86,Y:89,Z:90};p.extend(r.prototype,{ieLess9:b.Browser.isIE("<9"),_curKeyCount:0,autoSave:!0,interval:20,maxUndoCount:150,initialize:c,shortcut:d,copyOrDelete:i,save:e,undo:f,redo:g,smartSave:h,canUndo:j,canRedo:m,getBookmark:k,setBookmark:l,_removeBookMark:n,_removeSpecialChar:o})}(window,$),function(a,b,c){function d(b){var d=this;if(d.plugin=a.getClass($N("component.editor.plugin")),H.inited||H.init(),a.JS&&!a.JS.css["geditor.css"]&&a.Ajax.request({requestType:a.Ajax.CSS,url:[$G.environment.cacheCssPath,"geditor.css",$G.environment.isDebug?"?"+(new Date).getTime():""].join(""),call:function(){a.JS.css["geditor.css"]=!0}}),d.plugins=N.clone(W),d.pluginsInfo=N.clone(X),d.pluginBtn={},d.eventPoll={},d.toolbarInit={},d.toolbarInit[V.HIDE]=d.toolbarInit[V.TEXT]=!0,!b.noUseUdFont){var e=d.getUdInfo();N.each(e,function(a,c){c&&(b[a]=d[a]=c)})}O.each(["editMode","tabIndex","width","height","setDefault","isMask","imageAutoSize","opacity","plugins","openHistory"],function(a,e){b[e]!==c&&(d[e]=b[e])}),b.pluginsInfo&&(d.pluginsInfo=N.extend(d.pluginsInfo,b.pluginsInfo)),Y.superClass.initialize.call(d,b),a.JS&&!a.JS.css["geditor.css"]&&setTimeout(function(){a.JS.css["geditor.css"]=a.JS.css["geditor.css"]||d.toolbarDv&&"none"!==d.toolbarDv.css("display")},3e3)}function e(){var a=this,b=a.getToolbarHtml(a.editMode),c={opacityStyle:a.opacity?'allowtransparency="true"':"",tabIndex:a.tabIndex,modeCls:"APP-editor-"+a.editMode.toLowerCase()};return c[a.editMode+"Toolbar"]=b,a.toolbarInit[a.editMode]=!0,c}function f(){function b(b){var c=a.Ud.get({field:"ntes_buzz",flag:"def_"+b});"0"!=c&&O.each(e[b],function(e,f){return N.isObject(f)?f.code==c?(d[b]=f.val,a.BREAK):void 0:void 0})}var c=this,d={},e={fontsize:c.plugin.Fontsize.config,fontname:c.plugin.Fontname.config,forecolor:c.plugin.Forecolor.config};return b("fontname"),b("fontsize"),b("forecolor"),d}function g(){var a,b,c,d=this,e=this.editDv,f=arguments.length,g=arguments[f-1],h=[].concat([].slice.call(arguments,0));3===f&&N.isString(arguments[0])&&h.unshift(e),a=h[0],b=h[1],d.eventPoll[b]=d.eventPoll[b]||[],4===h.length?(c=h[2],R.live(a,b,c,g),d.eventPoll[b].push({context:a,selector:c,handler:g})):3===arguments.length&&(R.listen(a,b,g),d.eventPoll[b].push({context:a,handler:g,bind:!0}))}function h(){function b(a){return a?d[a]?d[a]:(a=c._upperChar(a),d[a]):void 0}var c=this,d=c.plugin;c.addListener("click","div.APP-editor-tbar a.APP-editor-commond-btn",function(d){R.stop(d),a.Menu.hideAllMenu(),a.Layer.hideAllLayer(),c.fire("focusToolbar",d),c.fire("clickToolbar",d);var e=new S(this),f=e.attr("editorCmd");if(c.editMode!==V.SOURCE||"source"===f){var g=b(f);if(g&&g.selected){var h=c.editMode;g.selected.call(c,d,e,f),c.log(f,h)}}c.fire("selectionChanged")}),c.addListener(c.tipsDv.find("a.nui-ico-x"),"click",function(){c.showTips()}),R.listen(c.doc,"click",function(b){a.Menu.hideAllMenu(),a.Layer.hideAllLayer(),c.fire("iframeClick",b),c.fire("selectionChanged")}),c.addListener(c.doc,"keydown",function(a){c.fire("iframeKeydown",a)}),c.addListener(c.doc,"keyup",function(a){c.fire("iframeKeyup",a),c.fire("selectionChanged")}),P.ie()?(R.listen(c.iframe,"beforedeactivate",function(a){c.fire("iframeBlur",a),c.fire("selectionChanged")}),R.listen(c.iframe,"activate",function(a){c.fire("iframeFocus",a),c.fire("selectionChanged")})):(R.listen(c.doc,"focusout",function(a){c.fire("iframeBlur",a),c.fire("selectionChanged")}),R.listen(c.win,"focus",function(a){c.fire("iframeFocus",a),c.fire("selectionChanged")}),R.listen(c.win,"blur",function(a){c.fire("iframeBlur",a),c.fire("selectionChanged")}))}function i(a){var b=this,c=b.rawConfig;return["<head>","<title>编辑邮件正文</title>","<style>","html{word-wrap:break-word;}","body{color:",a.forecolor||b.forecolor,";font-size:",b.fontsize||b.fontsize,";font-family:",a.fontname||b.fontname,";line-height:1.7;padding:8px 10px;margin:0;background-color:#fff;}","pre{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;font-family:arial;}","span.typoRed{border-bottom:2px dotted #ff0000;cursor:pointer;}",".nui-scroll{overflow:auto}",".nui-scroll::-webkit-scrollbar{width: 8px;height:8px}",".nui-scroll::-webkit-scrollbar-track{border-radius:10px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0);}",".nui-scroll::-webkit-scrollbar-track:hover{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.4);background-color:rgba(0,0,0,0.01)}",".nui-scroll::-webkit-scrollbar-track:active{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.4);background-color:rgba(0,0,0,0.05)}",".nui-scroll::-webkit-scrollbar-thumb{background-color: rgba(0, 0, 0, 0.05);border-radius:10px;-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}",".nui-scroll:hover::-webkit-scrollbar-thumb{background-color: rgba(0, 0, 0, 0.2);border-radius:10px;-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}",".nui-scroll::-webkit-scrollbar-thumb:hover{background-color:rgba(0, 0, 0, 0.4);-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}",".nui-scroll::-webkit-scrollbar-thumb:active{background:rgba(0,0,0,0.6);}","</style>","</head>",'<body class="nui-scroll"',c.opacity?'style="background-color: transparent;"':"",">",a.content||"","</body>"].join("")}function j(b){function c(a){if("|"===a||"||"===a)return e(a);if(N.isString(a))return d(a);for(var b=a[0],c=['<div class="',"ext"===b?"APP-editor-extOpt":"APP-editor-btnGrp "+b,'">'],f=0,g=a.length;g>f;f++)0!==f&&c.push(d(a[f]));return c.push("</div>"),c.join("")}function d(b,c){if(h[b])return"";var d,e,f,i=g.pluginsInfo[b],j="APP-editor-btn APP-editor-commond-btn APP-editor-commond-"+b,k="basic"===c;if(N.isObject(i)?(d=i.title||b,j=(i.cls||j)+" "+(i.extcls||" "),e=i.tpl):d=i,k||"fontname"!==b&&"fontsize"!==b){var l=d;f='<b class="ico ico-editor ico-editor-'+b+'">'+l+"</b>"}else f={fontname:"字体",fontsize:"字号"}[b],j+=" APP-editor-btn-select";return e||(e="typo"===b||"dict"===b?'<a editorcmd="#{name}" class="APP-editor-commond-btn APP-editor-extOpt-item nui-txt-link" href="javascript:void(0)">#{title}</a>':'<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);"><span class="APP-editor-btn-rc">#{content}</span></a>'),a.Template.fastExec(e,{name:b,aCls:j,title:d,content:f})}function e(a){return'<a href="javascript:void(0);" class="APP-editor-btn APP-editor-btn-spln '+("||"===a?"APP-editor-btn-spln-l":"")+'"></a>'}if(!this.plugins)return"";var f,g=this,h=g.rawConfig.btnNoShow||{},i=[],j=[];if(b=b||V.BASIC,b===V.BASIC){for(var k,l=0,m=g.plugins.basic.length;m>l;l++)k=g.plugins.basic[l],"|"!==k&&"||"!==k?"fullScreen"===k?i.push('<div class="APP-editor-btnGrp APP-editor-switchFullScreen">'+d(k,"basic")+"</div>"):i.push(d(k,"basic")):i.push(e(k));return i.join("")}for(var n,l=0,m=g.plugins.full.length;m>l;l++)n=g.plugins.full[l],N.isObject(n)?N.each(n,function(a,b){P[a]()&&j.push(c(b))}):j.push(c(n));return f=j.join(""),b===V.FULL?f:b===V.SOURCE?f.replace("切换到源码功能","###").replace(/title=\"[^\"#]+\"/gi,'title="源码模式下不能使用该功能"').replace(/APP-editor-btn\s+APP-editor-btn-switchSource/,"APP-editor-btn APP-editor-btn-switchSource APP-editor-btn-selected").replace("###","返回可视化视图").replace("fullsource","sourcefull"):""}function k(a){var c=this,d=c.editMode;a=a||{},a.height=a.height||c.height,a.width=a.width||c.width;var e,f=b.parseInt(a.height)-2;d!==V.TEXT&&(e=d===V.HIDE?0:d===V.BASIC?32:59,f-=e),c.textarea.css({height:f+"px"}),c.innerDv.css({height:f+"px",width:a.width}),c.height=a.height,c.width=a.width}function l(a){var b=this,c=b.editMode;if(a=a,c===a)return!1;if(!b.toolbarInit[a]){var d=b.getToolbarHtml(a);b[a+"TBDv"].html(d),b.toolbarInit[a]=!0,b.pluginBtn={}}var e,f,g=b.innerDv,h="";g.replaceClass("APP-editor-"+c,"APP-editor-"+a),b.editMode=a;var i=[V.HIDE,V.FULL,V.BASIC];O.has(i,c)&&O.has(i,a)?b.focus():(e=c===V.TEXT||c===V.SOURCE?c:V.FULL,f=a===V.TEXT?"text":"html",h=b.getContent(e,f),b.setContent(h),b.focus(!1)),b.setSize(),b.fire("modeChanged")}function m(b){var c=this;return a(c.body).find(b)}function n(a,b){var c=this;if(!c.rendered)return"";var d="";try{a=a||V.FULL,b=b||"html";var d="",e=c.body;a===V.TEXT||a===V.SOURCE?(d=c.textarea.dom.value,"html"===b&&a!==V.SOURCE?d=I.textToHtml(d):"text"===b&&a===V.SOURCE&&(d=Q.trim(I.htmlToText(d)))):d="text"===b?I.getDomText(e,!0):e.innerHTML,d=d.replace(I.fillCharReg,""),"html"===b&&(d=I.filterHtml(d))}catch(f){}return d}function o(a,b){var c=this;if(!c.rendered)return c.listen("afterRender",function(){c.setContent(a,b)}),void 0;b=b||c.editMode,c.changeMode(b);try{b===V.TEXT||b===V.SOURCE?c.textarea.dom.value=a:(a=I.filterHtml(a),c.body.innerHTML=a)}catch(d){}}function p(a,b){var c,d=this;return a!==V.TEXT?(c=d.getContent(a,b),c=['<div style="line-height:1.7;color:',d.forecolor,";font-size:",d.fontsize,";font-family:",d.fontname,'">',c,"</div>"].join("")):c=d.getContent(a,b),c}function q(a,b){var c=this;return c.getIframeHtml({content:this.getFinalContent(a,b)})}function r(){return this.cmd.selection.getText()}function s(){var a=I.htmlToText(this.cmd.selection.getText());return Q.trim(a,!0)}function t(a){for(var b="",c=P.opera()||P.safari()?"<div><br></div>":"<br>";a>0;)b+=c,a--;return P.ie()?"<div>"+b+"</div>":b}function u(a){var b=this;return a===!1?(this.maskDv.hide(),this.isMask=!1):(this.maskDv.dom.style.display="block",this.isMask=!0,N.isNumber(a)&&setTimeout(function(){b.maskDv.hide(),b.isMask=!1},a)),b}function v(a){var c=this;try{if(a&&N.isObject(a)){var d=a.name||"win";"win"==d?c.win.focus():"doc"==d?c.doc.focus():"body"==d&&c.doc.body.focus();var e=a.element;if(a.id&&(e=c.doc.getElementById(a.id)),e){e=e.dom||e;var f=+a.pos;isNaN(f)&&(f=0);var g;if(b.getSelection){var h=c.win.getSelection();if(!h)return!1;h.rangeCount>0&&h.removeAllRanges(),g=c.doc.createRange(),g.selectNode(e.firstChild||e),g.collapse(!0),h.addRange(g)}else g=(e.createTextRange?e:c.doc.body).createTextRange(),g.moveToElementText(e),g.moveStart("character",f),g.collapse(!0),g.select()}}else c.editMode===V.SOURCE||c.editMode===V.TEXT?c.textarea.focus():c.cmd.focus(a)}catch(i){}return c}function w(){var a=this;return a.history?a.history.save():void 0}function x(a){var d=this;if(a===c||null===a)return d.tipsDv.hide(),d.tipsSpan.html(""),d._tipsTimer=null,void 0;var e=d.editMode,f=e===V.HIDE?0:e===V.BASIC?31:58;N.isString(a)&&(a={content:a});var g=a.content||"";d._tipsTimer&&b.clearTimeout(d._tipsTimer),d.tipsSpan.html(g),d.tipsDv.css({top:f+"px"}).show()}function y(a){var b=this;if(b.cmd[a]){var c=!/focus|Value|State/.test(a);c&&b.history.save();var d=b.cmd[a].apply(b.cmd,[].slice.call(arguments,1));c&&b.cmd.selection.getRange().select();
var e={fontfamily:"fontname",fontsize:"fontsize",justify:"justify",insertunorderedlist:"list",insertorderedlist:"list",indent:"indent",outdent:"indent",lineheight:"lineheight",forecolor:"forecolor",backcolor:"backcolor"};return e[a]&&b.log(e[a]+"Menu"),d}}function z(a){var b=this;return b.exec("insertHtml",a),b}function A(){var a=this;return a.insertPortrait("http://mimg.127.net/p/js5/lib/img/currenttime.png","写信时会自动替换为当天日期")}function B(c,d,e,f,g){function h(){e=b.parseInt(k.width),f=b.parseInt(k.height);var c=i.doc.getElementById(j.id);if(c){try{c.removeAttribute("id")}catch(d){c.id=""}c.setAttribute("orgwidth",e),c.setAttribute("orgheight",f),c.setAttribute("data-image",1);var g=.8*i.getEl().width();if(i.imageAutoSize&&g){var h=b.parseInt(g>=e?e:g),l=b.parseInt(f*h/e);if(c.style.width=h+"px",c.style.height=l+"px",h!==e){var m=a.Link.html({text:"显示原始尺寸大小",extcls:"nui-txt-link",click:function(){try{c.style.width=e+"px",c.style.height=f+"px"}catch(a){}i.showTips()}});i.showTips("图片尺寸过大，已为您智能缩小显示，图片质量不变 "+m),a.Component.setEvents()}}else c.style.width=e+"px",c.style.height=f+"px"}}var i=this,j={src:c,title:d,style:{width:e?e+"px":"",height:f?f+"px":""},align:g,id:"editorInsertImg_"+i._eIndex++};i.exec("insertImage",j);var k=i.doc.createElement("IMG");k.onload=h,k.onerror=function(){var a=i.doc.getElementById(j.id);if(a)try{a.removeAttribute("id")}catch(b){a.id=""}},k.src=c}function C(a,b){var c=this;return c.exec("insertImage",{src:a,title:b}),c}function D(a){var b=this,c=a.element,d=a.tag,e=a.reg;if(c)c.parentNode.removeChild(c);else if(d&&e)for(var f=b.doc.getElementsByTagName(d),g=0;g<f.length;g++){var h=f[g],i=h.src;e.test(i)&&(h.parentNode.removeChild(h),g--)}}function E(a,b){try{a="basic"===a?"b":"full"===a?"f":a;var c=b===Y.mode.BASIC?"e_b"+a:b===Y.mode.FULL?"e_f"+a:"e_"+a;if(c){var d={};d[c]=1,T.cache(d,function(a){a&&a.value++})}}catch(e){}}function F(a){if(a&&""!==a){var b=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g;return a=a.replace(b,function(a,b,c,d,e,f,g){return b=b||"",c=c||"",e=e||"",f=f?" "+f:"",g=g||"",e&&(e=e.replace(/display\:\s*none;?/gi,"")),b+"<"+c+d+e+f+">"+g})}}function G(a){return a?a.replace(/./,function(a){return a.toUpperCase()}):a}var H,I,J,K,L;try{H=$L("component.editor.Dtd"),I=$L("component.editor.Util"),L=$L("component.editor.Range"),K=$L("component.editor.Selection"),J=$L("component.editor.Cmd"),$L("component.editor.plugin.Fontname"),$L("component.editor.plugin.Fontsize"),$L("component.editor.plugin.Forecolor"),$L("component.editor.plugin.Basic"),$L("component.editor.plugin.Full"),$L("component.editor.plugin.History")}catch(M){return M}var N=a.Object,O=a.Array,P=a.Browser,Q=a.String,R=a.Event,S=a.Element,T=b.Log||a.Log,U=a.getClass("netease.mail.component.Component"),V={BASIC:"basic",FULL:"full",SOURCE:"source",TEXT:"text",HIDE:"hide"},W={basic:"bold,italic,underline,fontsize,forecolor,backcolor,formatMatch,|,justify,list,indent,|,image,capture,portrait,stationery,insertTime,microphone,translate,sign,av,notary,full,fullScreen".split(","),full:["APP-editor-btnGrp1,undo,redo".split(","),"||",{ie:"APP-editor-btnGrp2,cut,copy,paste".split(",")},{ie:"||"},"APP-editor-btnGrp3,fontname,fontsize,justify,list,indent,lineheight,bold,italic,underline,forecolor,backcolor,formatMatch,insertHorizontalRule,insertTable,removeFormat".split(","),"||","APP-editor-btnGrp4,image,capture,portrait,stationery,link,insertTime,sign".split(","),"||","APP-editor-btnGrp5,microphone,source".split(","),"APP-editor-btnGrp6,av,notary".split(","),"APP-editor-switchFullScreen,fullScreen".split(","),"ext,typo,dict".split(","),"basic"]},X={fontname:"选择字体",fontsize:"选择字体大小",forecolor:"选择字体颜色",backcolor:"选择字体背景",formatMatch:"格式刷",lineheight:"设置行高",indent:"设置缩进",justify:"选择对齐方式",list:"设置列表",bold:"加粗",italic:"斜体",underline:"下划线",link:"插入/删除链接",portrait:"添加表情",image:"添加图片",insertHorizontalRule:"插入横线",insertTable:"添加表格",insertTime:"添加日期",currentTime:"当前日期(自动更新)",copy:"复制",cut:"剪切",capture:"截图",editImage:"编辑图片",paste:"粘贴",removeFormat:"清除格式",setDefault:"设置默认",sign:"签名",av:"录制音视频",stationery:"添加信纸",microphone:"语音输入",backspace:"退格",typo:{title:"拼写检查",cls:"APP-editor-extOpt-item nui-txt-link"},dict:{title:"查词典",cls:"APP-editor-extOpt-item nui-txt-link"},basic:{title:"切换到简单功能",extcls:"APP-editor-btn-switchFunction "},full:{title:"切换到全部功能",extcls:"APP-editor-btn-switchFunction "},source:{title:"切换到源码功能",extcls:"APP-editor-btn-switchSource "},undo:{title:"撤销",extcls:"APP-editor-btn-dis"},redo:{title:"重做",extcls:"APP-editor-btn-dis"},translate:"网易专业翻译，轻松读写英文邮件",notary:"邮件存证",fullScreen:{tpl:'<a editorcmd="fullScreen" class="APP-editor-commond-btn APP-editor-switchFullScreen-toFull" title="写信全屏" href="javascript:void(0);"><b class="ico ico-editor ico-editor-toFullScr"></b></a>'}},Y=a.createClass($N("component.editor.Editor"));N.mix(Y,U,{xtype:"editor",mode:V,_cssClass:{baseclass:{cls:"APP-editor",tpl:['<div style="position:relative;" class="">','<div class="APP-editor #{modeCls}">','<div class="APP-editor-tbar" style="z-index:2;">','<div class="APP-editor-tbar-basic">#{basicToolbar}</div>','<div class="APP-editor-tbar-full">#{fullToolbar}</div>','<div class="APP-editor-tbar-source">#{sourceToolbar}</div>',"</div>",'<div class="APP-editor-edtr" style="position:relative;">','<div class="APP-editor-edtr-mask" style="display:none"></div>','<iframe frameBorder="0" tabIndex="#{tabIndex}" class="APP-editor-iframe" style="position:absolute" #{opacityStyle}></iframe>','<textarea tabIndex="#{tabIndex}" class="APP-editor-textarea"></textarea>',"</div>","</div>",'<div class="APP-editor-autoReduceWp" style="display:none;">','<div class="APP-editor-autoReduce nui-assistBlock">',"<span></span>",'<a href="javascript:void(0);" class="nui-ico nui-ico-x" title="关闭"></a>',"</div>","</div>","</div>"].join("")}},_listeners:[{name:"render",handler:function(){var a=this,b=a.getEl();a.editDv=b,a.innerDv=b.find("div.APP-editor"),a.toolbarDv=b.find("div.APP-editor-tbar"),a.basicTBDv=b.find("div.APP-editor-tbar-basic"),a.fullTBDv=b.find("div.APP-editor-tbar-full"),a.sourceTBDv=b.find("div.APP-editor-tbar-source"),a.editAreaDv=b.find("div.APP-editor-edtr"),a.maskDv=b.find("div.APP-editor-edtr-mask"),a.tipsDv=b.find("div.APP-editor-autoReduceWp"),a.tipsSpan=a.tipsDv.find("span"),a.iframe=b.find("iframe.APP-editor-iframe"),a.textarea=b.find("textarea.APP-editor-textarea");var c=a.iframe.dom;a.doc=S.getIframeDoc(c),a.win=S.getWin(a.doc),a.doc.open("text/html","replace"),a.doc.write(a.getIframeHtml(a.rawConfig)||""),a.doc.close(),P.ie()?(a.doc.body.disabled=!0,a.doc.body.contentEditable=!0,a.doc.body.disabled=!1):a.doc.body.contentEditable=!0,a.body=a.doc.body,a.isMask&&a.maskDv.show(),a.setSize(),a.initEvents(),a.cmd=new J(a.doc),a.history=new a.plugin.History(a),a.history.smartSave(),a.focus()},custom:!0},{name:"afterRender",handler:function(){var a=this;try{for(var b=["AutoLink","ImageResize","EnterLine","Tab","CurrentTime","FormatMatch","Bold","Italic","Underline","Backcolor","Copy","Cut","Dict","Indent","InsertHorizontalRule","InsertTable","InsertTime","Justify","Lineheight","Link","List","Paste","Redo","RemoveFormat","SetDefault","Source","Typo","Undo"],c=0,d=b.length;d>c;c++)$L("component.editor.plugin."+b[c],a)}catch(e){return e}try{a.plugin.AutoLink.selected.call(a),a.plugin.ImageResize.selected.call(a),a.plugin.EnterLine.selected.call(a),a.plugin.Tab.selected.call(a)}catch(e){}},custom:!0},{name:"destroy",handler:function(){var a=this;a.history&&(a.history._poll.length=0,delete a.history),N.each(a.eventPoll,function(a,b){O.each(b,function(b,c){c.bind?R.unlisten(c.context,a,c.handler):R.die(c.context,a,c.selector,c.handler)}),b.length=0}),delete a.eventPoll,delete a.pluginBtn,O.each(["editDv","innerDv","toolbarDv","basicTBDv","fullTBDv","sourceTBDv","editAreaDv","maskDv","iframe","textarea","doc","win","body"],function(){a[sName]=null})},custom:!0},{name:"iframeBlur",handler:function(){var a=this;a.innerDv.removeClass("APP-editor-active")},custom:!0},{name:"iframeFocus",handler:function(){var a=this;a.innerDv.addClass("APP-editor-active")},custom:!0},{name:"selectionChanged",handler:function(){var a,b,c,d,e,f=this,g=f.editMode,h=["bold","italic","underline"],i=["undo","redo"];for(c=0,d=h.length;d>c;c++)e=h[c],f.pluginBtn[e]||(f.pluginBtn[e]=f.toolbarDv.find("a.APP-editor-commond-"+e)),a=!f.cmd[e+"State"]()||g!==V.BASIC&&g!==V.FULL?"removeClass":"addClass",f.pluginBtn[e]&&f.pluginBtn[e][a]("APP-editor-btn-on");for(c=0,d=i.length;d>c;c++)e=i[c],f.pluginBtn[e]||(f.pluginBtn[e]=f.toolbarDv.find("a.APP-editor-commond-"+e)),b="undo"===e?"canUndo":"canRedo",a=f.history[b]()?"removeClass":"addClass",f.pluginBtn[e]&&f.pluginBtn[e][a]("APP-editor-btn-dis");h.length=0,i.length=0},custom:!0}]},{editMode:V.BASIC,tabIndex:1,_eIndex:1,width:"100%",height:"500px",fontsize:"14px",forecolor:"#000000",fontname:"Arial",imageAutoSize:!0,content:"",setDefault:!0,opacity:!1,isMask:!1,openHistory:!0,inputType:!1,initialize:d,_getData:e,getUdInfo:f,addListener:g,initEvents:h,getIframeHtml:i,getToolbarHtml:j,setSize:k,changeMode:l,getIframeEl:m,getContent:n,setContent:o,getFinalContent:p,getPreviewContent:q,getSelectHtml:r,getSelectText:s,getBreakLine:t,showMask:u,focus:v,historySave:w,showTips:x,exec:y,insertHtml:z,insertCurrentTime:A,insertImage:B,insertPortrait:C,del:D,log:E,filterDisplayNone:F,_upperChar:G})}($,window),function(a){function b(){if(!d.ie()){var b=this;b.listen("iframeKeydown",function(c){var d=c.keyCode||c.which;if(32==d||13==d){for(var f,g,h,i=b.cmd.selection.getNative(),j=i.getRangeAt(0).cloneRange(),k=j.startContainer;1==k.nodeType&&j.startOffset>0&&(k=j.startContainer.childNodes[j.startOffset-1]);)j.setStart(k,1==k.nodeType?k.childNodes.length:k.nodeValue.length),j.collapse(!0),k=j.startContainer;do{if(0==j.startOffset){for(k=j.startContainer.previousSibling;k&&1==k.nodeType;)k=k.lastChild;if(!k||e.isFillChar(k))break;f=k.nodeValue.length}else k=j.startContainer,f=j.startOffset;j.setStart(k,f-1),g=j.toString().charCodeAt(0)}while(160!=g&&32!=g);if(j.toString().replace(new RegExp(e.fillChar,"g"),"").match(/(?:https?:\/\/|(mailto:)?[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){for(;j.toString().length&&!/^(?:https?:\/\/|(mailto:)?[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(j.toString());)try{j.setStart(j.startContainer,j.startOffset+1)}catch(l){for(var k=j.startContainer;!(h=k.nextSibling);){if(e.isBody(k))return;k=k.parentNode}j.setStart(h,0)}if(e.findParentByTagName(j.startContainer,"a",!0))return;var m,n=b.doc.createElement("a"),o=b.doc.createTextNode(" ");n.appendChild(j.extractContents());var p=n.innerHTML.replace(/<[^>]+>/g,"");p=a.String.decodeHTML(p),n.href=n.innerHTML=p,m=n.getAttribute("href").replace(new RegExp(e.fillChar,"g"),""),m=/^(?:https?:\/\/)/gi.test(m)?m:/^(?:mailto?:)/gi.test(m)?m:/^(?:[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$)/gi.test(m)?"mailto:"+m:"http://"+m,n.setAttribute("_src",m),n.href=m,j.insertNode(n),n.parentNode.insertBefore(o,n.nextSibling),j.setStart(o,0),j.collapse(!0),i.removeAllRanges(),i.addRange(j)}}})}}var c=a.Object,d=a.Browser,e=$L("component.editor.Util"),f=a.createClass($N("component.editor.plugin.AutoLink"));c.extend(f,{selected:b})}($,window),function(a){function b(a,b){var c=this,d=c.editMode,h=c[d+"BackcolorMenu"];if(!h){var i=g.initMenuConf(c);h=new f(i),h.attachTo({clickFrom:b,delegateTo:"self"}),h.fire("attachToShow"),c[d+"BackcolorMenu"]=h}setTimeout(function(){var a=(c.exec("backcolorValue")||"").replace(/'/g,""),b=!1;e.each(h.items,function(c,d){d.checked&&d.setChecked(!1),d.value===a&&(d.setChecked(!0),b=!0)}),!b&&h.items&&h.items[0].setChecked(!0)},0)}function c(a){var b={groups:[{items:[],checkType:"radio"}],items:[],extcls:"APP-editor-color",onItemClick:function(b){a.exec("backcolor",b.value)},width:"180px"},c=b.groups[0].items;return e.each(g.config,function(a,b){return"split"===b.type?(c.push({type:"split"}),void 0):(c.push({text:'<b class="nui-ico APP-editor-ico-color" style="background:'+b.val+";"+("#ffffff"===b.val?"border:1px solid #ccc;height:7px;width:7px;":"")+'"></b>'+b.name,value:b.val,checked:b.checked}),void 0)}),b}var d=a.Object,e=a.Array,f=a.getClass($N("component.Menu")),g=a.createClass($N("component.editor.plugin.Backcolor"));d.extend(g,{selected:b,initMenuConf:c,config:[{name:'白色<span class="txt-info">(默认)</span>',val:"#ffffff",checked:!0},{type:"split"},{name:"暗红色",val:"#880000"},{name:"紫色",val:"#800080"},{name:"红色",val:"#ff0000"},{name:"鲜粉色",val:"#ff00ff"},{name:"深蓝色",val:"#000080"},{name:"蓝色",val:"#0000ff"},{name:"湖蓝色",val:"#00ffff"},{name:"蓝绿色",val:"#008080"},{name:"绿色",val:"#008000"},{name:"橄榄色",val:"#808000"},{name:"浅绿色",val:"#00ff00"},{name:"橙黄色",val:"#ffcc00"},{name:"灰色",val:"#808080"},{name:"银色",val:"#c0c0c0"},{name:"黑色",val:"#000000"}]})}($,window),function(a){function b(){var a=this;a.exec("bold")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Bold"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.cmd.copy()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Copy"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("insertHtml",'<img title="写信时会自动替换为当天日期" src="http://mimg.127.net/p/js5/lib/img/currenttime.png"/>')}var c=a.Object,d=a.createClass($N("component.editor.plugin.CurrentTime"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("cut")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Cut"));c.extend(d,{selected:b})}($,window),function(a){function b(){a.Log.cache({cl_dict:1},a.EMPTYFUNC);var b;try{b=$L("product.Translate")}catch(c){return c}b.change()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Dict"));c.extend(d,{selected:b})}($,window),function(a){function b(){var b,c=this,f=c.doc;c.listen("iframeKeyup",function(a){if(13==a.keyCode){var g=c.cmd.selection.getRange(),h=g.startContainer;if("h1"===b||"h2"===b||"h3"===b||"h4"===b||"h5"===b||"h6"===b)if(e.gecko()){var i=e.findParentByTagName(h,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);i||f.execCommand("formatBlock",!1,"<div>")}else if(1==h.nodeType){var j,k=f.createTextNode("");if(g.insertNode(k),j=e.findParentByTagName(k,"div",!0)){for(var l=f.createElement("div");j.firstChild;)l.appendChild(j.firstChild);j.parentNode.insertBefore(l,j),e.remove(j),g.setStartBefore(k).setCursor()}e.remove(k)}d.opera()&&g.select()}}),c.listen("iframeKeydown",function(g){if(13==g.keyCode){b="";var h=c.cmd.selection.getRange();if(!h.collapsed){var i=h.startContainer,j=h.endContainer,k=e.findParentByTagName(i,"td",!0),l=e.findParentByTagName(j,"td",!0);if(k&&l&&k!==l||!k&&l||k&&!l)return a.Event.stop(g),void 0}i=e.findParentByTagName(h.startContainer,["ol","ul","div","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),i||d.opera()?(b=i.tagName,"div"==i.tagName.toLowerCase()&&e.gecko()&&e.removeDirtyAttr(i)):(f.execCommand("formatBlock",!1,"<div>"),e.gecko()&&(h=c.cmd.selection.getRange(),i=e.findParentByTagName(h.startContainer,"div",!0),i&&e.removeDirtyAttr(i)))}})}var c=a.Object,d=a.Browser,e=$L("component.editor.Util"),f=a.createClass($N("component.editor.plugin.EnterLine"));c.extend(f,{selected:b})}($,window),function(a){function b(a){var b=this;b.editor=a,b.formatmatchState=0,b.formatmatchList=[]}function c(a,b){function c(a){if(f.webkit()){var h=e.getTarget(a);"IMG"!=h.tagName&&(h=null)}var k=d.cmd.selection.getRange(),m=h||k.getClosedNode();if(l&&m&&"IMG"==m.tagName)m.style.cssText+=";float:"+(l.style.cssFloat||l.style.styleFloat||"none")+";display:"+(l.style.display||"inline"),l=null;else if(!l){var n=k.collapsed;if(n){var o=d.doc.createTextNode("match");k.insertNode(o).select()}var p=g.options.removeFormatAttributes;g.options.removeFormatAttributes="",d.cmd.removeFormat(),g.options.removeFormatAttributes=p,k=d.cmd.selection.getRange();try{j.length&&(o&&k.selectNode(o),k.applyInlineStyle(j[j.length-1].tagName,{"class":""},j))}catch(q){}o&&k.setStartBefore(o).collapse(!0),k.select(),o&&f.remove(o)}e.unlisten(d.doc,"mouseup",c),i.formatmatchState=0,b.removeClass("APP-editor-btn-on")}var d=this;d.constructor.mode;var i=d.formatMatch;i||(i=new h(d),d.formatMatch=i);var j=i.formatmatchList;if(i.formatmatchState)return i.formatmatchState=0,j.length=0,e.unlisten(d.doc,"mouseup",c),b.removeClass("APP-editor-btn-on"),void 0;d.historySave(),b.addClass("APP-editor-btn-on");var k=d.cmd.selection.getRange(),l=k.getClosedNode();if(!l||"IMG"!=l.tagName){k.collapse(!0).shrinkBoundary();var m=k.startContainer;j=f.findParents(m,!0,function(a){return!f.isBlockElm(a)&&1==a.nodeType});for(var n=j.length-1;n>=0;n--){var o=j[n];if("A"==o.tagName){j.splice(n,1);break}}i.formatmatchList=j}e.listen(d.doc,"mouseup",c),i.formatmatchState=1}var d=a.Object,e=a.Event,f=$L("component.editor.Util"),g=$L("component.editor.Cmd"),h=a.createClass($N("component.editor.plugin.FormatMatch"));d.extend(h,{selected:c}),d.extend(h.prototype,{initialize:b})}($,window),function(a){function b(){function b(){c.imageResizeToolbar&&(c.imageResizeToolbar.style.display="none"),c.mediaCtrToolbar&&(c.mediaCtrToolbar.style.display="none");var a=c.editImage;a&&a.getAttribute("data-image")&&(a.style.border="none")}var c=this;c.addListener(c.doc,"mouseup","IMG",function(b){var d=a(this);if(this.getAttribute("data-image")||this.getAttribute("data-media"))if(c.editImage=this,this.getAttribute("data-image")){l.initResizeToolbar(c,b);var e=c.cmd.selection.getRange();e.selectNode(this),d.css({border:"1px solid #999"})}else this.getAttribute("data-media")&&l.initMediaToolbar(c,b)}),c.listen("iframeKeydown",b),c.listen("iframeClick",function(c){var d=a.Event.getTarget(c);d.tagName&&"img"==d.tagName.toLowerCase()&&(d.getAttribute("data-image")||d.getAttribute("data-media"))||b()}),c.listen("clickToolbar",b),c.addListener(document,"click",b)}function c(b,c){var d=a.Event.getTarget(c),e=b.imageResizeToolbar;e||(e=document.createElement("DIV"),e.className="APP-editor-picReset",e.style.display="none",e.innerHTML=['<div class="nui-btnGroup">','<div class="nui-btn" func="big"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-zoomIn"></b></span></div>','<div class="nui-btn" func="original"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-zoomNo"></b></span></div>','<div class="nui-btn" func="small"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-zoomOut"></b></span></div>','<div class="nui-btn" func="delete"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-delete"></b></span></div>',"</div>"].join(""),b.editDv.append(e),b.addListener(e,"click","div.nui-btn",function(a){l.dealImage(a,b,this,e)}),b.imageResizeToolbar=e);var f=l.getImageCtrPos(b,d);e.style.left=f.left+"px",e.style.top=f.top+"px",setTimeout(function(){e.style.display="block"},25)}function d(b,c){var d=a.Event.getTarget(c),e=b.mediaCtrToolbar;e||(e=document.createElement("DIV"),e.className="APP-editor-imgEditBar bdr-light",e.style.width="135px",e.style.display="none",e.innerHTML=['<a href="javascript:void(0)" class="media-ctr-btn" func="play">播放</a>&nbsp;-&nbsp;','<a href="javascript:void(0)" class="media-ctr-btn" func="delete">删除</a>&nbsp;&nbsp;[','<a href="javascript:void(0)" class="media-ctr-btn" func="close">关闭</a>]'].join(""),b.editDv.append(e),b.addListener(e,"click",".media-ctr-btn",function(a){l.dealMedia(a,b,this,e)}),b.mediaCtrToolbar=e);var f=l.getMediaCtrPos(b,d);e.style.left=f.left+"px",e.style.top=f.top+"px",setTimeout(function(){e.style.display="block"},25)}function e(b,c,d,e){var f=this;a.Event.stop(b);var g=c.editImage,h=d.getAttribute("func"),i=+g.getAttribute("orgwidth"),j=+g.getAttribute("orgheight"),m=+g.width,n=+g.height;if(i&&j&&m&&n&&h){if("delete"===h){var o=g.parentNode;try{var p=o.childNodes[1];"a"!==o.tagName.toLowerCase()||p&&(3!=p.nodeType||p.nodeValue!=k.fillChar)?o.removeChild(g):o.parentNode.removeChild(o)}catch(q){}return e.style.display="none",f.saveHistory(c),void 0}if("original"===h)g.style.width=i+"px",g.style.height=j+"px";else{var r,s,t,u,v={big:.1,small:-.1}[h];if(!v)return;i>j?(s=2*i,r=.1*i,t=m*(1+v),t=r>t?r:t>s?s:t,u=Math.round(t*n/m)):(s=2*j,r=.1*j,u=n*(1+v),u=r>u?r:u>s?s:u,t=Math.round(u*m/n)),g.style.width=t+"px",g.style.height=u+"px"}var w=l.getImageCtrPos(c,g);e.style.left=w.left+"px",e.style.top=w.top+"px",f.saveHistory(c)}}function f(b,c,d,e){a.Event.stop(b);var f=c.editImage,g=d.getAttribute("func"),h=f.getAttribute("data-media");if("delete"===g)c.fire("related",{action:"deleteAttach",id:h});else if("close"===g)e.style.display="none";else if("play"===g){try{var i=$L("product.AvMail")}catch(j){return j}(new i).preview(h)}}function g(b,c){var d=a(c).offset(),e=28,f=d.y,g="hide"===b.editMode?4:b.toolbarDv.height()-2,h=b.editDv.height(),i=f-b.doc.body.scrollTop+g;return i=g>i?g:i+e>h?h-e:i,{left:d.x+1,top:i}}function h(b,c){var d=a(c).offset(),e=c.offsetHeight,f=d.y,g="hide"===b.editMode?4:b.toolbarDv.height()+1,h=b.editDv.height(),i=f-b.doc.body.scrollTop+g+e;return i=g>i?g:i>h?h-e:i,{left:d.x,top:i}}function i(a){a.editImage&&(a.editImage.style.border="none"),a.historySave(),a.editImage&&(a.editImage.style.border="1px solid #999")}var j=a.Object,k=$L("component.editor.Util"),l=a.createClass($N("component.editor.plugin.ImageResize"));j.extend(l,{selected:b,initResizeToolbar:c,initMediaToolbar:d,dealImage:e,dealMedia:f,getImageCtrPos:g,getMediaCtrPos:h,saveHistory:i})}($,window),function(a){function b(a,b){var c=this,e=c.editMode,f=c[e+"IndentMenu"];f||(f=new d({items:[{text:"增加缩进",icon:{extcls:"ico-editor ico-editor-addIndent"},click:function(){c.exec("indent","indent")}},{text:"减少缩进",icon:{extcls:"ico-editor ico-editor-cutIndent"},click:function(){c.exec("outdent","outdent")}}],width:"150px"}),f.attachTo({clickFrom:b,delegateTo:"self"}),f.fire("attachToShow"),c[e+"IndentMenu"]=f)}var c=a.Object,d=a.getClass($N("component.Menu")),e=a.createClass($N("component.editor.plugin.Indent"));c.extend(e,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("horizontal")}var c=a.Object,d=a.createClass($N("component.editor.plugin.InsertHorizontalRule"));c.extend(d,{selected:b})}($,window),function(a){function b(b,c,d){function e(a){k.inputChange.call(f,a,this,d)}var f=this,g=k.tpl;new a.Msgbox({header:"插入表格",contentType:"wide",content:g,type:"confirm",ok:function(){var a=k.done.call(f);return a?a:(k.clear.call(f),f.focus(),void 0)},cancel:function(){k.clear.call(f),f.focus()}});var h=a("#editorInsertTableDv");f.tableInputs=h.find("input"),f.tableSelect=h.find("select.APP-editor-addTable-sel"),f.tableInfo={width:80,unit:"%",row:2,column:2,border:1,cellspacing:1,padding:1},f.tableHtml=k.create(f.tableInfo),f.preViewDv=a("#editorTablePreviewDv"),f.errorDv=a("#insertTableErrDv"),i.ie()?"propertychange":"input",f.tableInputs.each(function(a,b){j.listen(b,"keyup",e)}),j.listen(f.tableSelect,"change",e)}function c(){var a=this;return""===a.tableHtml?!0:(a.exec("insertHtml",a.tableHtml),void 0)}function d(a){var b,c,d,e=a.cellspacing,f=a.width+a.unit,g=a.row,h=a.column,j=a.border+"px",k=a.padding+"px",l=i.ie()?"<div>&nbsp;</div>":"<br>";for(b=["<table cellspacing="+e+'px style="'],b.push("width:"+f),b.push(";border:"+j+" #808080 outset"),b.push(";border-collapse:"+(e>0?"separate":"collapse")),e&&b.push(";border-spacing:"+e+"px"),b.push(';">'),c=0;g>c;c++){for(b.push("<tr>"),d=0;h>d;d++)b.push("<td"),a.padding&&(b.push(' style="border:'+j+" #808080 inset"),b.push(";padding:"+k),b.push(';">'),b.push(l),b.push("</td>"));b.push("</tr>")}return b.push("</table>"),b.join("")}function e(a,b){var c=this,d=b.name,e=b.value;d={borderSpacing:"cellspacing",cellPadding:"padding",widthUnit:"unit"}[d]||d,"unit"===d&&(e="px"===e||"%"===e?e:"%"),c.tableInfo[d]=e,k.inputValid.call(c)&&(c.tableHtml=k.create(c.tableInfo),c.preViewDv.html(c.tableHtml))}function f(){var b=this,c="",d=!0,e=b.tableInfo,f={row:{name:"行数",min:1,max:100},column:{name:"列数",min:1,max:100},width:{name:"表格宽度",min:1,max:1e3},border:{name:"边框粗细",min:1,max:1e3},cellspacing:{name:"单元格边",min:0,max:1e3},padding:{name:"单元格间距",min:0,max:1e3}};return a.Array.each(["row","column","width","border","cellspacing","padding"],function(b,g){var h=e[g],i=f[g];return c=""===h?i.name+"不能为空":/^\d+\.+\d*$/.test(h)?"请输入整数":/^\d*$/.test(h)?+h<i.min?i.name+"不能小于"+i.min:+h>i.max?i.name+"不能超过"+i.max:"":"请输入数字",d=d&&""===c,d?void 0:a.BREAK}),b.errorDv.html(c),d||(b.preViewDv.html(""),b.tableHtml=""),d}function g(){var b=this;b.tableInputs.each(function(a,b){j.unlisten(b)}),j.unlisten(b.tableSelect),a.Array.each(["tableHtml","tableInputs","tableSelect","tableInfo","preViewDv","errorDv"],function(a,c){delete b[c]})}var h=a.Object,i=a.Browser,j=a.Event,k=a.createClass($N("component.editor.plugin.InsertTable"));h.extend(k,{selected:b,done:c,create:d,inputChange:e,inputValid:f,clear:g,tpl:['<div class="APP-editor-addTable nui-fClear">','<div id="editorInsertTableDv" class="APP-editor-addTable-form">','<div class="item item-rows">','<span class="item-rows-name nui-fIBlock">行数</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="row" maxlength="6" value="2" type="text" class="nui-ipt-input"></div>',"</div>",'<div class="item item-cols">','<span class="item-cols-name nui-fIBlock">列数</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="column" maxlength="6" value="2" type="text" class="nui-ipt-input"></div>',"</div>",'<div class="item">','<span class="item-name nui-fIBlock">表格宽度</span>','<div class="nui-ipt APP-editor-addTable-ipt"><input name="width" value="80" type="text" class="nui-ipt-input"></div>','<select name="widthUnit" class="APP-editor-addTable-sel"><option value="%">%</option><option value="px">px</option></select>',"</div>",'<div class="item">','<span class="item-name nui-fIBlock">边框粗细</span>','<div class="nui-ipt APP-editor-addTable-ipt"><input name="border" value="1" type="text" class="nui-ipt-input"></div>像素',"</div>",'<div class="item">','<span class="item-name nui-fIBlock">单元格间距</span>','<div class="nui-ipt APP-editor-addTable-ipt"><input name="borderSpacing" value="1" type="text" class="nui-ipt-input"></div>像素',"</div>",'<div class="item">','<span class="item-name nui-fIBlock">单元格边距</span>','<div class="nui-ipt APP-editor-addTable-ipt"><input name="cellPadding" value="1" type="text" class="nui-ipt-input"></div>像素',"</div>","</div>",'<div class="APP-editor-addTable-pre">','<span class="APP-editor-addTable-preTit">预览</span>','<div id="editorTablePreviewDv" style="height:100%;overflow:hidden">','<table border="1px" cellspacing="1px" style="width:90%;border-color:#808080;border-style:outset;border-collapse:separate;border-width:1px;border-spacing:1px">',"<tbody>","<tr>",'<td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td>','<td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td>',"</tr>","<tr>",'<td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td>','<td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td>',"</tr>","</tbody>","</table>","</div>","</div>",'<div id="insertTableErrDv" style="float:right;width:223px;color:red"></div>',"</div>"].join("")})}($,window),function(a,b){function c(){var c=this;c.exec("insertHtml",a.Date.format(new b.Date,"yyyy-MM-dd"))}var d=a.Object,e=a.createClass($N("component.editor.plugin.InsertTime"));d.extend(e,{selected:c})}($,window),function(a){function b(){var a=this;a.exec("italic")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Italic"));c.extend(d,{selected:b})}($,window),function(a){function b(a,b){var c=this,e=c.editMode,f=c[e+"JustifyMenu"];f||(f=new d({items:[{text:"左对齐",icon:{extcls:"ico-editor ico-editor-justifyLeft"},click:function(){c.exec("justify","left")}},{text:"居中对齐",icon:{extcls:"ico-editor ico-editor-justifyCenter"},click:function(){c.exec("justify","center")}},{text:"右对齐",icon:{extcls:"ico-editor ico-editor-justifyRight"},click:function(){c.exec("justify","right")}}],width:"150px"}),f.attachTo({clickFrom:b,delegateTo:"self"}),f.fire("attachToShow"),c[e+"JustifyMenu"]=f)}var c=a.Object,d=a.getClass($N("component.Menu")),e=a.createClass($N("component.editor.plugin.Justify"));c.extend(e,{selected:b})}($,window),function(a){function b(a,b){var c=this,e=c.editMode,f=c[e+"LineheightMenu"];f||(f=new d({items:[{text:"170%(默认)",click:function(){c.exec("lineheight","170%")}},{text:"50%",click:function(){c.exec("lineheight","50%")}},{text:"80%",click:function(){c.exec("lineheight","80%")}},{text:"100%",click:function(){c.exec("lineheight","100%")}},{text:"120%",click:function(){c.exec("lineheight","120%")}},{text:"150%",click:function(){c.exec("lineheight","150%")}},{text:"180%",click:function(){c.exec("lineheight","180%")}},{text:"200%",click:function(){c.exec("lineheight","200%")}}],width:"150px"}),f.attachTo({clickFrom:b,delegateTo:"self"}),f.fire("attachToShow"),c[e+"LineheightMenu"]=f)}var c=a.Object,d=a.getClass($N("component.Menu")),e=a.createClass($N("component.editor.plugin.Lineheight"));c.extend(e,{selected:b})}($,window),function(a){function b(){var b=this,c=b.cmd.selection.getRange(),e=b.exec("linkValue");if(e)try{c.selectNode(e);var f=c.createBookmark();b.cmd.unlink(),c.moveToBookmark(f),c.select()}catch(g){}else{var h=!0,i=c.cloneContents();if(i){var j=b.doc.createElement("DIV");j.appendChild(i),h=!!d.getElementsByTagName(j,"IMG").length,j=null}else h=!1;var k=b.getSelectText(),l=new a.Input({value:k,width:"400px"}),m=new a.Input({value:"http://",width:"400px"});sHtml=[h?"":'<div class="nui-txt-s14 nui-txt-normal" style="padding:10px 0 5px"><strong>请输入链接标题</strong></div><div>'+l.html()+"</div>",'<div class="nui-txt-s14 nui-txt-normal" style="padding:10px 0 5px"><strong>请输入链接</strong>（如：http://www.163.com）</div>',"<div>",m.html(),"</div>"].join(""),new a.Msgbox({type:"confirm",contentType:"normal",content:sHtml,ok:function(){var d=m.getValue();if(!h&&""===a.String.trim(l.getValue()))return l.showTips("链接标题不能为空","err"),!0;if(!d||"http://"==d)return m.showTips("链接地址无效","err"),!0;var e={href:m.getValue()};if(""===k)e.textValue=l.getValue();else if(k!==l.getValue()){var f=c.createBookmark();c.select(),b.cmd.insertHtml(l.getValue()),c.moveToBookmark(f),c.select()}b.exec("link",e),c.collapse()}}),a.Component.setEvents()}}var c=a.Object,d=$L("component.editor.Util"),e=a.createClass($N("component.editor.plugin.Link"));c.extend(e,{selected:b})}($,window),function(a){function b(a,b){var c=this,e=c.editMode,f=c[e+"ListMenu"];f||(f=new d({items:[{text:"符号列表",icon:{extcls:"ico-editor ico-editor-cList"},click:function(){c.exec("insertunorderedlist")}},{text:"数字列表",icon:{extcls:"ico-editor ico-editor-nList"},click:function(){c.exec("insertorderedlist")}}],width:"150px"}),f.attachTo({clickFrom:b,delegateTo:"self"}),f.fire("attachToShow"),c[e+"ListMenu"]=f)}var c=a.Object,d=a.getClass($N("component.Menu")),e=a.createClass($N("component.editor.plugin.List"));c.extend(e,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("paste")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Paste"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.history.canRedo()&&a.history.redo()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Redo"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("removeFormat")}var c=a.Object,d=a.createClass($N("component.editor.plugin.RemoveFormat"));c.extend(d,{selected:b})}($,window),function(a){function b(){function b(){f(this,"fontname","fontFamily")}function c(){f(this,"fontsize","fontSize")}function d(){var a=f(this,"forecolor","color");a.find("icon")[0].update({type:"color-"+this.rawConfig.icon.subtype})}function f(b,c,d){var e=b.rawConfig,f=i["_"+c]=e.val;a.fly("#setDefPre").dom.style[d]=f;var g=p.find("#"+c);return g.setText(e.text),g}function h(a,b,c){var d,f,g=j[a],h=[],i="",l=0,m=0;e.each(g,function(b,d){return"split"===d.type?(m=1,h.push({type:"split"}),void 0):(b-=m,f={text:"fontname"===a?'<span style="font-family:'+d.val+'">'+d.name+"</span>":d.name,icon:"forecolor"===a?{xtype:"icon",type:"color",subtype:b}:null,linkExtcls:"fontsize"===a?"g-menu-fontSize-"+b:null,extText:"fontsize"===a?d.val:null,val:d.val,click:k[a]},d.val===c&&(i=d.name,l=b),h.push(f),void 0)
}),d={id:a,text:i,subclass:"dropdownBtn",xtype:"button",renderTo:b,menu:{xtype:"menu",checkType:"radio",groups:[{type:"scroll",items:h}],extcls:{fontname:"",fontsize:"g-menu-fontSize",forecolor:"APP-editor-color"}[a]},icon:"forecolor"===a?"color-"+l:null},p.add(d)}var i=this,j=g.config={fontname:i.plugin.Fontname.config,fontsize:i.plugin.Fontsize.config,forecolor:i.plugin.Forecolor.config},k={fontname:b,fontsize:c,forecolor:d},l=i.fontsize,m=i.fontname,n=i.forecolor;i._fontname=i._fontsize=i._forecolor=null;var o=['<div class="APP-editor-setDft nui-fClear">','<ul class="APP-editor-setDft-form">','<li id="setDefFn" class="item">','<span class="item-name">字体</span>',"</li>",'<li id="setDefFs" class="item">','<span class="item-name">字号</span>',"</li>",'<li id="setDefFc" class="item item-color">','<span class="item-name">颜色</span>',"</li>","</ul>",'<div class="APP-editor-setDft-pre">','<div class="APP-editor-setDft-pre-tit">预览</div>','<div id="setDefPre" class="APP-editor-setDft-pre-cont" style="font-family:',m,";font-size:",l,";color:",n,'">','<table style="height:100%;width:100%">',"<tbody>","<tr>",'<td style="height:100%;width:100%" align="center" valign="middle">网易免费邮<br>NetEase</td>',"</tr>","</tbody>","</table>","</div>","</div>","</div>"].join(""),p=new a.Msgbox({header:"设置编辑器默认值",type:"confirm",contentType:"wide",content:o,ok:a.Function.bind(g.setDef,i)});h("fontname","setDefFn",m),h("fontsize","setDefFs",l),h("forecolor","setDefFc",n)}function c(){function b(b,c){if(c){var d=c.code;if(d===a.S_OK){var e=h.doc.body;return i&&(h.fontname=i,e.style.fontFamily=i),j&&(h.fontsize=j,e.style.fontSize=j),k&&(h.forecolor=k,e.style.color=k),a.Tips.show({succ:!0,text:"默认字体设置成功"}),void 0}a.Tips.show({text:"设置失败，请稍候再试"})}}function c(c,i,j){if(i){var k=g.config[c];e.each(k,function(b,c){return d.isObject(c)?c.val===i?(i=c.code,a.BREAK):void 0:void 0}),a.Ud.set({field:"ntes_buzz",flag:"def_"+c,value:i,notPost:!j,forcePost:j,call:f.bind(b,h,c)})}}var h=this,i=h._fontname,j=h._fontsize,k=h._forecolor;c("fontname",i,!(j||k)),c("fontsize",j,!k),c("forecolor",k,!0)}var d=a.Object,e=a.Array,f=a.Function,g=a.createClass($N("component.editor.plugin.SetDefault"));d.extend(g,{selected:b,setDef:c})}($,window),function(a){function b(){var a=this,b=a.constructor.mode;a.changeMode(b[a.editMode===b.SOURCE?"FULL":"SOURCE"])}var c=a.Object,d=a.createClass($N("component.editor.plugin.Source"));c.extend(d,{selected:b})}($,window),function(a,b){function c(){}var d=b.Object;b.Event;var e=b.createClass($N("component.editor.plugin.Tab"));d.extend(e,{selected:c})}(window,$),function(a,b,c){function d(){function b(){var b=a("#typoMenuDv");b&&b.hide()}var c=this;Typo.doc=c.doc;var d=c.editMode,e=c.constructor.mode;d==e.TEXT||d==e.SOURCE?new a.Msgbox({type:"confirm",content:"拼写检查需要切换到富文本编辑模式，是否切换？",okText:"是",cancelText:"否",ok:function(){c.changeMode(e.BASIC),Typo.check.apply(c)}}):Typo.check.apply(c),c._bindTypoEvent||(c.addListener(c.doc,"click",".typoRed",function(){Typo.showMenu.call(this,c)}),c.listen("iframeClick",b),a.Event.listen(document,"click",b),c._bindTypoEvent=!0)}function e(){function b(a){var b=e.doc.getElementById(a);b&&(r.remove(b),g=!0)}function c(){e.showMask(5e3),e._isTypoChecking=!0;var b=$I("core.DataAction");(new b).request({type:b.FLASH,data:{url:q.getUrl("compose_typo"),method:a.Ajax.POST,body:"text="+encodeURIComponent(h),call:a.Function.bind(Typo.showError,e)}})}function d(){var a=i.getEl().find("#editorTypoChk");a.dom.checked&&p.set({field:"ntes_buzz",flag:"typo_prompt",value:"1"})}var e=this;if(e._isTypoChecking)return a.Tips.show({text:"正在进行拼写检查，请稍后再试"}),void 0;Typo.ignoreAll(e);var f=e.getContent(),g=!1;f.indexOf("\n")>=0&&(f=f.replace(/\n/g,""),g=!0),b("isReplyContent"),b("isForwardContent");var h=r.getDomText(e.body,!0);g&&e.setContent(f);var i,j=1!=p.get({field:"ntes_buzz",flag:"typo_prompt"});/[a-zA-z]+/.test(h)?j&&/[\u4E00-\u9FA5]+/.test(h)?i=new a.Msgbox({type:"confirm",title:'拼写检查暂不支持中文。不过，我们仍可以检查您邮件中的所有英文拼写。<br><br><input id="editorTypoChk" type="checkbox"/>&nbsp;不再提示',okText:"检查",cancelText:"不检查",ok:function(){d(),c()},cancel:d}):c():a.Msgbox.show({title:"对不起，拼写检查暂时只支持英文。"})}function f(b){var d=this;d.showMask(!1);var e=a.Eval.get(b);e=e.res;var f=d.cmd.selection.getRange();f.setEnd(d.body,0).collapse();var g=d.doc.createElement("span");g.className="typoRed";var h=0;d.typoData={},o.each(e,function(a,b){var i=Typo._findRangeText(f,b,h);if(i){h=b.pos+b.src.length;var j=g.cloneNode(),k=i.cloneRange(),l=k.extractContents();j.appendChild(l),k.insertNode(j).selectNode(j),i.setEndAfter(j),f=i;var m=(new Date).getTime()+Math.random()+"";j.setAttribute("evId",m),j.id=m,d.typoData[m]=e[a]}else h=c}),d._isTypoChecking=!1,a.Tips.show({text:"检查成功",succ:!0})}function g(b){function c(a){var b='<div class="nui-menu-item"><div class="nui-menu-item-link"><span class="nui-menu-item-text">'+a+"</span>"+"</div>"+"</div>";return b}var d=b.constructor.mode,e=this,f=a("#typoMenuDv"),g=e.getAttribute("evId");b.curTypoSpan=e;var h=!1;if(f?f=f.dom:(h=!0,f=document.createElement("DIV"),f.id="typoMenuDv",f.className="nui-menu",f.style.display="none",b.editDv.append(f),b.addListener(f,"click",function(a){Typo.clickMenu.call(this,a,b)})),h||f.getAttribute("typoId")!=g){a(f).empty(),f.setAttribute("typoId",g);var i=b.typoData[g];if(!i)return;var j=i.list;(!j||0==j.length&&i["case"])&&(j=[i["case"]]);for(var k="",l=0,m=j.length;m+2>l;l++)0==m&&0==l&&(k+=c("暂无提示")),l==m&&(k+='<div class="nui-menu-split nui-split"></div>'),k+=c(m>l?j[l]:l==m?"忽略":"忽略全部");f.innerHTML=k}var n=a(e).offset();f.style.left=n[0]+"px";var o=n[1],p=b.doc.body.scrollTop;f.style.top=o-p+e.offsetHeight+31+(b.editMode==d.FULL?27:0)+"px",o-p>b.innerDv.dom.offsetHeight/2&&(o=o-p+31+(b.editMode==d.FULL?27:0)-f.offsetHeight,f.style.top=o+"px");var q=a(f).find(".nui-menu-item");q.each(function(b,c){var d=a(c);d.listen("mouseover",function(){d.addClass("nui-menu-item-hover")}),d.listen("mouseout",function(){d.removeClass("nui-menu-item-hover")})}),setTimeout(function(){if(f.style.display="block",a.Browser.isIE("<9")){var b=a(f),c=0,d=b.find(".nui-menu-item-text");if(d&&d.doms)for(var e,g,h=d.doms,i=0,j=h.length;j>i;i++){var e=h[i];g=Math.max(e.offsetWidth,e.clientWidth)||120,c=Math.max(g,c)}b.dom.style.width=c+100+"px"}},0)}function h(b,c){var d=this,e=a.Event.getTarget(b);d.getAttribute("typoId");var f=c.curTypoSpan,g=e.innerHTML;return g.indexOf("全部")>=0?(Typo.ignoreAll(c),!1):(g.indexOf("忽略")>=0?Typo.clear(f,c.doc):g&&g.indexOf("暂无提示")<0&&g.indexOf("nui-menu-split nui-split")<0&&a(f).replace(g,c.doc),!1)}function i(a,b){var c,d=a.typoData;return!d||n.isEmpty(d)?!1:(b?(c=a.ignoreTypoDv,c||(c=a.ignoreTypoDv=document.createElement("DIV"),c.style.display="none",a.editAreaDv.append(c)),c.innerHTML=a.getContent()):c=a.body,function(c){if(c.childNodes)for(var d=c.childNodes,e=0;e<d.length;e++)arguments.callee.call(null,d[e]);"SPAN"==c.tagName&&"typoRed"==c.className&&Typo.clear(c,b?document:a.doc)}(c),b?c.innerHTML:void 0)}function j(a){var b=Typo.reg,c=Typo.doc.createElement("DIV");c.appendChild(a.cloneNode(!0)),b.test(c.innerHTML)?(a.removeAttribute("class"),a.removeAttribute("id"),a.removeAttribute("evId")):r.remove(a,!0)}function k(a,b,d){try{for(var e=b.src,f=b.pos-(d==c?Typo._getRangePos(a):d),g=e.length,h=0,i=0,j=!0;5>h;){if(f+i>=0){var k=a.cloneRange();Typo._rangeMove(k,f+i),k.collapse(!0),Typo._rangeMove(k,g,!0)}if(k.toString()==e)return k;j?(h++,i=h,j=!1):(i=0-h,j=!0)}return!1}catch(l){return!1}}function l(a){var b=a.document;a=a.cloneRange(),a.setStartAtFirst(b.body);var c=a.cloneContents();return c?r.getDomText(c).length:0}function m(a,b,c){function d(){for(;e;){var a=e.nextSibling;if(a){e=a,f=0;break}e=e.parentNode}}var e,f,g,h=c?a.cloneRange():a,e=h.endContainer,f=h.endOffset;for(1==e.nodeType&&f==e.childNodes.length&&(d(),h.setEnd(e,f));b>=0;)if(3==e.nodeType){if(!(b>0))break;var i=e.nodeValue;i.indexOf("\n")>=0&&(i=i.replace(/\n/g,""),e.nodeValue=i);var g=e.nodeValue.length;if(g>b||c&&g==b){f+=b;break}b-=g,d()}else{if(g=r.getDomText(e).length,0!=f)for(var j=0;f>j;j++)g-=r.getDomText(e.childNodes[j]).length;if(g>b||c&&g==b){var k=e.childNodes;e=k.length<=f?e.lastChild:k[f],f=0}else d(),b-=g}a[c?"setEnd":"setStart"](e,f)}var n=a.Object,o=a.Array;a.Function,a.Log;var p=a.Ud,q=a.Uri;Typo=a.createClass($N("component.editor.plugin.Typo"));var r=$L("component.editor.Util");n.extend(Typo,{selected:d,check:e,showError:f,showMenu:g,clickMenu:h,ignoreAll:i,clear:j,_findRangeText:k,_getRangePos:l,_rangeMove:m,reg:/^<[^>]*style=[^>]*>/i})}($,window),function(a){function b(){var a=this;a.exec("underline")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Underline"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.history.canUndo()&&a.history.undo()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Undo"));c.extend(d,{selected:b})}($,window),function(a){$G.set("appCenterConfig",{gotoApp:function(b){function c(a){var b=a.appId||a.id;return a.id=b,a.text=a.name,a.name=b,a.fullScreen=!0,a.isAppcenterApp=!0,a.url&&0!==a.url.indexOf("http")&&(a.name=a.url),a}a.AppManager.startApp(c(b));try{a.Msgbox.msgbox&&"appcenterMsg"===a.Msgbox.msgbox.rawConfig.indentityType&&a.Msgbox.msgbox.hide()}catch(d){}},showMsg:function(b){(b||{}).indentityType="appcenterMsg",a.Msgbox.show(b)},showTips:function(b){a.Tips.show(b)},addApp:function(b){var c=a.AppManager,d=b.id;c.resetDataSource(),c.getAppsList({call:function(){c.addDockApp(d,function(){var c=$I("init.Dock");b.onlyShowDock?c.showAddedAnimation(d):a.Msgbox.show({icon:"suc",title:"应用添加成功！",content:"应用已成功添加至邮箱触点。",okText:"立即使用",cancelText:"继续添加",ok:function(){$G.get("appCenterConfig").gotoApp(b),c.showAddedAnimation(d)},close:function(){c.showAddedAnimation(d)},cancel:function(){c.showAddedAnimation(d)}}),c.show()})}})},changeApp:function(){var b=a.AppManager;b.resetDataSource(),b.getAppsList({call:function(){a.Listener.fire("appmanager:modify"),a.Listener.fire("tab:reset")}})},frameClick:function(){a.Event.fire(document,"click"),a.Event.fire(document.body,"click")},extLink:""})}($,window),function(a){function b(a){if(!a)return"";for(var b=0;f>b;b++)if(-1!==e[b][1].indexOf(a))return e[b][0];return/[\u0020-\u007e]/.test(a)?a:null}function c(a,b){for(var c,d=a.length,e="",f=this.pydic,g=0;d>g;g++)c=a.charAt(g),f[c]||(f[c]=this.han2py(c)),b?f[c]&&(e+=f[c].charAt(0)):e+=f[c]||"";return e}var d=a.createClass($N("support.PyDict"));a.Object.extend(d,{pydic:{},han2py:b,getPy:c});var e=[["a","啊阿吖嗄锕"],["ai","埃挨哎唉哀皑癌蔼矮艾碍爱隘捱嗳嫒瑷暧砹锿霭"],["an","鞍氨安俺按暗岸胺案谙埯揞庵桉铵鹌黯"],["ang","肮昂盎"],["ao","凹敖熬翱袄傲奥懊澳坳拗嗷岙廒遨媪骜獒聱螯鏊鳌鏖"],["ba","芭捌扒叭吧笆八疤巴拔跋靶把坝霸罢爸茇菝岜灞钯粑鲅魃"],["bai","白柏百摆佰败拜稗捭掰"],["ban","斑班搬扳般颁板版扮拌伴瓣半办绊阪坂钣瘢癍舨"],["bang","邦帮梆榜膀绑棒磅蚌镑傍谤蒡浜"],["bao","苞胞包褒薄雹保堡饱宝抱报暴豹鲍爆曝勹葆孢煲鸨褓趵龅"],["bei","杯碑悲卑北辈背贝钡倍狈备惫焙被孛陂邶蓓呗悖碚鹎褙鐾鞴"],["ben","奔苯本笨畚坌锛"],["beng","崩绷甭泵蹦迸嘣甏"],["bi","逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必壁臂避陛匕俾荜荸萆薜吡哔狴庳愎滗濞弼妣婢嬖璧贲睥畀铋秕裨筚箅篦舭襞跸髀"],["bian","鞭边编贬扁便变卞辨辩辫遍匾弁苄忭汴缏煸砭碥窆褊蝙笾鳊"],["biao","标彪膘表婊骠飑飙飚镖镳瘭裱鳔"],["bie","鳖憋别瘪蹩"],["bin","彬斌濒滨宾摈傧豳缤玢殡膑镔髌鬓"],["bing","兵冰柄丙秉饼炳病并禀邴摒槟"],["bo","剥玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳卜亳啵饽檗擘礴钹鹁簸跛踣"],["bu","捕哺补埠不布步簿部怖卟逋瓿晡钚钸醭"],["ca","擦礤"],["cai","猜裁材才财睬踩采彩菜蔡"],["can","餐参蚕残惭惨灿孱骖璨粲黪"],["cang","苍舱仓沧藏伧"],["cao","操糙槽曹草嘈漕螬艚"],["ce","厕策侧册测恻"],["cen","岑涔"],["ceng","层蹭曾噌"],["cha","插叉茬茶查碴搽察岔差诧嚓猹馇汊姹杈槎檫锸镲衩"],["chai","拆柴豺侪钗瘥虿"],["chan","搀掺蝉馋谗缠铲产阐颤冁谄蒇廛忏潺澶羼婵骣觇禅蟾躔"],["chang","昌猖场尝常长偿肠厂敞畅唱倡伥鬯苌菖徜怅阊娼嫦昶氅鲳"],["chao","超抄钞朝嘲潮巢吵炒怊晁焯耖"],["che","车扯撤掣彻澈坼砗"],["chen","郴臣辰尘晨忱沉陈趁衬谌谶抻嗔宸琛榇碜龀"],["cheng","撑称城橙成呈乘程惩澄诚承逞骋秤丞埕枨柽塍瞠铖裎蛏酲"],["chi","吃痴持池迟弛驰耻齿侈尺赤翅斥炽傺墀茌叱哧啻嗤彳饬媸敕眵鸱瘛褫蚩螭笞篪豉踟魑"],["chong","充冲虫崇宠茺忡憧铳舂艟"],["chou","抽酬畴踌稠愁筹仇绸瞅丑臭俦帱惆瘳雠"],["chu","初出橱厨躇锄雏滁除楚础储矗搐触处畜亍刍怵憷绌杵楮樗褚蜍蹰黜"],["chuai","揣搋啜膪踹"],["chuan","川穿椽传船喘串舛遄氚钏舡"],["chuang","疮窗床闯创怆"],["chui","吹炊捶锤垂陲棰槌"],["chun","春椿醇唇淳纯蠢莼鹑蝽"],["chuo","戳绰辍踔龊"],["ci","疵茨磁雌辞慈瓷词此刺赐次茈祠鹚糍"],["cong","聪葱囱匆从丛苁淙骢琮璁枞"],["cou","凑楱辏腠"],["cu","粗醋簇促蔟徂猝殂蹙蹴"],["cuan","蹿篡窜汆撺爨镩"],["cui","摧崔催脆瘁粹淬翠萃啐悴璀榱毳"],["cun","村存寸忖皴"],["cuo","磋撮搓措挫错厝嵯脞锉矬痤鹾蹉"],["da","搭达答瘩打大耷哒嗒怛妲沓褡笪靼鞑"],["dai","呆歹傣戴带殆代贷袋待逮怠埭甙呔岱迨绐玳黛"],["dan","耽担丹单郸掸胆旦氮但惮淡诞弹蛋儋凼萏菪啖澹宕殚赕眈疸瘅聃箪"],["dang","当挡党荡档谠砀铛裆"],["dao","刀捣蹈倒岛祷导到稻悼道盗叨氘焘纛"],["de","德得的锝"],["deng","蹬灯登等瞪凳邓噔嶝戥磴镫簦"],["di","堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔氐籴诋谛邸坻荻嘀娣柢棣觌祗砥碲睇镝羝骶"],["dia","嗲"],["dian","颠掂滇碘点典靛垫电佃甸店惦奠淀殿丶阽坫巅玷钿癜癫簟踮"],["diao","碉叼雕凋刁掉吊钓调铞貂鲷"],["die","跌爹碟蝶迭谍叠垤堞揲喋牒瓞耋鲽"],["ding","丁盯叮钉顶鼎锭定订仃啶玎腚碇町疔耵酊"],["diu","丢铥"],["dong","东冬董懂动栋侗恫冻洞垌咚岽峒氡胨胴硐鸫"],["dou","兜抖斗陡豆逗痘都蔸钭窦蚪篼"],["du","督毒犊独读堵睹赌杜镀肚度渡妒芏嘟渎椟牍蠹笃髑黩"],["duan","端短锻段断缎椴煅簖"],["dui","堆兑队对怼憝碓镦"],["dun","墩吨蹲敦顿钝盾遁沌炖砘礅盹趸"],["duo","掇哆多夺垛躲朵跺舵剁惰堕咄哚沲缍铎裰踱"],["e","蛾峨鹅俄额讹娥恶厄扼遏鄂饿噩谔垩苊莪萼呃愕屙婀轭腭锇锷鹗颚鳄"],["ei","诶"],["en","恩蒽摁嗯"],["er","而儿耳尔饵洱二贰迩珥铒鸸鲕"],["fa","发罚筏伐乏阀法珐垡砝"],["fan","藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛蕃蘩幡梵燔畈蹯"],["fang","坊芳方肪房防妨仿访纺放邡枋钫舫鲂"],["fei","菲非啡飞肥匪诽吠肺废沸费芾狒悱淝妃绯榧腓斐扉砩镄痱蜚篚翡霏鲱"],["fen","芬酚吩氛分纷坟焚汾粉奋份忿愤粪偾瀵棼鲼鼢"],["feng","丰封枫蜂峰锋风疯烽逢冯缝讽奉凤俸酆葑唪沣砜"],["fo","佛"],["fou","否缶"],["fu","夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐匐凫郛芙苻茯莩菔拊呋呒幞怫滏艴孚驸绂绋桴赙祓黻黼罘稃馥蚨蜉蝠蝮麸趺跗鲋鳆"],["ga","噶嘎垓尬尕尜旮钆"],["gai","该改概钙盖溉丐陔戤赅"],["gan","干甘杆柑竿肝赶感秆敢赣坩苷尴擀泔淦澉绀橄旰矸疳酐"],["gang","冈刚钢缸肛纲岗港杠戆罡筻"],["gao","篙皋高膏羔糕搞镐稿告睾诰郜藁缟槔槁杲锆"],["ge","哥歌搁戈鸽胳疙割革葛格蛤阁隔铬个各咯鬲仡哿圪塥嗝纥搿膈硌镉袼虼舸骼"],["gei","给"],["gen","根跟亘茛哏艮"],["geng","耕更庚羹埂耿梗哽赓绠鲠"],["gong","工攻功恭龚供躬公宫弓巩汞拱贡共珙肱蚣觥"],["gou","钩勾沟苟狗垢构购够佝诟岣遘媾缑枸觏彀笱篝鞲"],["gu","辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇嘏诂菰崮汩梏轱牯牿臌毂瞽罟钴锢鸪痼蛄酤觚鲴"],["gua","刮瓜剐寡挂褂卦诖呱栝胍鸹"],["guai","乖拐怪"],["guan","棺关官冠观管馆罐惯灌贯倌莞掼涫盥鹳鳏"],["guang","光广逛咣犷桄胱"],["gui","瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽匦刿庋宄妫炅晷皈簋鲑鳜"],["gun","辊滚棍衮绲磙鲧"],["guo","锅郭国果裹过馘埚掴呙帼崞猓椁虢聒蜾蝈"],["ha","哈铪"],["hai","骸孩海氦亥害骇嗨胲醢"],["han","酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉邗菡撖犴阚瀚晗焓顸颔蚶鼾"],["hang","夯杭航沆绗颃"],["hao","壕嚎豪毫郝好耗号浩蒿薅嗥嚆濠灏昊皓颢蚝"],["he","呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺诃劾壑嗬阖曷盍颌蚵翮"],["hei","嘿黑"],["hen","痕很狠恨"],["heng","哼亨横衡恒蘅珩桁"],["hong","轰哄烘虹鸿洪宏弘红黉訇讧荭蕻薨闳泓"],["hou","喉侯猴吼厚候后堠後逅瘊篌糇鲎骺"],["hu","呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户冱唿囫岵猢怙惚浒滹琥槲轷觳烀煳戽扈祜瓠鹄鹕鹱笏醐斛鹘"],["hua","花哗华猾滑画划化话骅桦砉铧"],["huai","槐徊怀淮坏踝"],["huan","欢环桓还缓换患唤痪豢焕涣宦幻奂擐獾洹浣漶寰逭缳锾鲩鬟"],["huang","荒慌黄磺蝗簧皇凰惶煌晃幌恍谎隍徨湟潢遑璜肓癀蟥篁鳇"],["hui","灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘诙茴荟蕙咴喙隳洄彗缋桧晖恚虺蟪麾"],["hun","荤昏婚魂浑混诨馄阍溷珲"],["huo","豁活伙火获或惑霍货祸劐藿攉嚯夥钬锪镬耠蠖"],["ji","击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际妓继纪藉亟乩剞佶偈墼芨芰荠蒺蕺掎叽咭哜唧岌嵴洎屐骥畿玑楫殛戟戢赍觊犄齑矶羁嵇稷瘠虮笈笄暨跻跽霁鲚鲫髻麂"],["jia","嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁伽郏葭岬浃迦珈戛胛恝铗镓痂瘕蛱笳袈跏"],["jian","歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僭谏谫菅蒹搛湔蹇謇缣枧楗戋戬牮犍毽腱睑锏鹣裥笕翦踺鲣鞯"],["jiang","僵姜将浆江疆蒋桨奖讲匠酱降茳洚绛缰犟礓耩糨豇"],["jiao","蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫窖佼僬艽茭挢噍徼姣敫皎鹪蛟醮跤鲛"],["jie","揭接皆秸街阶截劫节桔杰捷睫竭洁结解姐戒芥界借介疥诫届讦诘拮喈嗟婕孑桀碣疖颉蚧羯鲒骱"],["jin","巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽劲卺荩堇噤馑廑妗缙瑾槿赆觐衿矜"],["jing","荆兢茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净刭儆阱菁獍憬泾迳弪婧肼胫腈旌箐"],["jiong","炯窘迥扃"],["jiu","揪究纠玖韭久灸九酒厩救旧臼舅咎就疚僦啾阄柩桕鸠鹫赳鬏"],["ju","鞠拘狙疽居驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧倨讵苣苴莒掬遽屦琚椐榘榉橘犋飓钜锔窭裾醵踽龃雎鞫"],["juan","捐鹃娟倦眷卷绢鄄狷涓桊蠲锩镌隽"],["jue","撅攫抉掘倔爵觉决诀绝厥劂谲矍蕨噘崛獗孓珏桷橛爝镢蹶觖"],["jun","均菌钧军君峻俊竣浚郡骏捃皲"],["ka","喀咖卡佧咔胩"],["kai","开揩楷凯慨剀垲蒈忾恺铠锎锴"],["kan","刊堪勘坎砍看侃莰戡龛瞰"],["kang","康慷糠扛抗亢炕伉闶钪"],["kao","考拷烤靠尻栲犒铐"],["ke","坷苛柯棵磕颗科壳咳可渴克刻客课嗑岢恪溘骒缂珂轲氪瞌钶锞稞疴窠颏蝌髁"],["ken","肯啃垦恳裉"],["keng","坑吭铿"],["kong","空恐孔控倥崆箜"],["kou","抠口扣寇芤蔻叩囗眍筘"],["ku","枯哭窟苦酷库裤刳堀喾绔骷"],["kua","夸垮挎跨胯侉"],["kuai","块筷侩快蒯郐哙狯浍脍"],["kuan","宽款髋"],["kuang","匡筐狂框矿眶旷况诓诳邝圹夼哐纩贶"],["kui","亏盔岿窥葵奎魁傀馈愧溃馗匮夔隗蒉揆喹喟悝愦逵暌睽聩蝰篑跬"],["kun","坤昆捆困悃阃琨锟醌鲲髡"],["kuo","括扩廓阔蛞"],["la","垃拉喇蜡腊辣啦剌邋旯砬瘌"],["lai","莱来赖崃徕涞濑赉睐铼癞籁"],["lan","蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥岚漤榄斓罱镧褴"],["lang","琅榔狼廊郎朗浪蒗啷阆稂螂"],["lao","捞劳牢老佬姥酪烙涝唠崂忉栳铑铹痨耢醪"],["le","勒乐了仂叻泐鳓"],["lei","雷镭蕾磊累儡垒擂肋类泪羸诔嘞嫘缧檑耒酹"],["leng","棱楞冷塄愣"],["li","厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俪俚郦坜苈莅蓠藜呖唳喱猁溧澧逦娌嫠骊缡枥栎轹膦戾砺詈罹锂鹂疠疬蛎蜊蠡笠篥粝醴跞雳鲡鳢黧"],["lian","联莲连镰廉怜涟帘敛脸链恋炼练蔹奁潋濂琏楝殓臁裢裣蠊鲢"],["liang","俩粮凉梁粱良两辆量晾亮谅墚莨椋锒踉靓魉"],["liao","撩聊僚疗燎寥辽潦撂镣廖料蓼尥嘹獠寮缭钌鹩"],["lie","列裂烈劣猎冽埒捩咧洌趔躐鬣"],["lin","琳林磷霖临邻鳞淋凛赁吝拎蔺啉嶙廪懔遴檩辚瞵粼躏麟"],["ling","玲菱零龄铃伶羚凌灵陵岭领另令酃苓呤囹泠绫柃棂瓴聆蛉翎鲮"],["liu","溜琉榴硫馏留刘瘤流柳六浏遛骝绺旒熘锍镏鹨鎏"],["long","龙聋咙笼窿隆垄拢陇垅茏泷珑栊胧砻癃"],["lou","楼娄搂篓漏陋偻蒌喽嵝镂瘘耧蝼髅"],["lu","芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮垆撸噜泸渌漉逯璐栌橹轳辂辘氇胪镥鸬鹭簏舻鲈"],["luan","峦挛孪滦卵乱脔娈栾鸾銮"],["lue","掠略锊"],["lun","抡轮伦仑沦纶论囵"],["luo","萝螺罗逻锣箩骡裸落洛骆络倮蠃荦摞猡泺漯珞椤脶镙瘰雒"],["lv","驴吕铝侣旅履屡缕虑氯律滤绿捋闾榈膂稆褛"],["ma","妈麻玛码蚂马骂嘛吗唛犸杩蟆"],["mai","埋买麦卖迈脉劢荬霾"],["man","瞒馒蛮满蔓曼慢漫谩墁幔缦熳镘颟螨鳗鞔"],["mang","芒茫盲氓忙莽邙漭硭蟒"],["mao","猫茅锚毛矛铆卯茂冒帽貌贸袤茆峁泖瑁昴牦耄旄懋瞀蝥蟊髦"],["me","么麽"],["mei","玫枚梅酶霉煤没眉媒镁每美昧寐妹媚莓嵋猸浼湄楣镅鹛袂魅"],["men","门闷们扪焖懑钔"],["meng","萌蒙檬盟锰猛梦孟勐甍瞢懵朦礞虻蜢蠓艋艨"],["mi","眯醚靡糜迷谜弥米秘觅泌蜜密幂芈谧咪嘧猕汨宓弭脒祢敉縻麋"],["mian","棉眠绵冕免勉娩缅面沔渑湎腼眄"],["miao","苗描瞄藐秒渺庙妙喵邈缈杪淼眇鹋"],["mie","蔑灭乜咩蠛篾"],["min","民抿皿敏悯闽苠岷闵泯缗玟珉愍黾鳘"],["ming","明螟鸣铭名命冥茗溟暝瞑酩"],["miu","谬缪"],["mo","摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谟茉蓦馍嫫嬷殁镆秣瘼耱貊貘"],["mou","谋牟某侔哞眸蛑鍪"],["mu","拇牡亩姆母墓暮幕募慕木目睦牧穆仫坶苜沐毪钼"],["na","拿哪呐钠那娜纳讷捺肭镎衲"],["nai","氖乃奶耐奈鼐佴艿萘柰"],["nan","南男难喃囝囡楠腩蝻赧"],["nang","囊攮囔馕曩"],["nao","挠脑恼闹淖孬垴呶猱瑙硇铙蛲"],["ne","呢"],["nei","馁内"],["nen","嫩恁"],["neng","能"],["ni","妮霓倪泥尼拟你匿腻逆溺伲坭蘼猊怩昵旎睨铌鲵"],["nian","蔫拈年碾撵捻念廿埝辇黏鲇鲶"],["niang","娘酿"],["niao","鸟尿茑嬲脲袅"],["nie","捏聂孽啮镊镍涅陧蘖嗫颞臬蹑"],["nin","您"],["ning","柠狞凝宁拧泞佞咛甯聍"],["niu","牛扭钮纽狃忸妞"],["nong","脓浓农弄侬哝"],["nou","耨"],["nu","奴努怒弩胬孥驽"],["nuan","暖"],["nue","虐疟挪"],["nuo","懦糯诺傩搦喏锘"],["nv","女恧钕衄"],["o","哦噢"],["ou","欧鸥殴藕呕偶沤讴怄瓯耦"],["pa","耙啪趴爬帕怕琶葩杷筢"],["pai","拍排牌徘湃派俳蒎哌"],["pan","攀潘盘磐盼畔判叛拚爿泮袢襻蟠蹒"],["pang","乓庞旁耪胖彷滂逄螃"],["pao","抛咆刨炮袍跑泡匏狍庖脬疱"],["pei","呸胚培裴赔陪配佩沛辔帔旆锫醅霈"],["pen","喷盆湓"],["peng","砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰堋嘭怦蟛"],["pi","辟坯砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬丕仳陴邳郫圮埤鼙芘擗噼庀淠媲纰枇甓罴铍癖疋蚍蜱貔"],["pian","篇偏片骗谝骈犏胼翩蹁"],["piao","飘漂瓢票剽嘌嫖缥殍瞟螵"],["pie","撇瞥丿苤氕"],["pin","拼频贫品聘姘嫔榀牝颦"],["ping","乒坪苹萍平凭瓶评屏俜娉枰鲆"],["po","坡泼颇婆破魄迫粕叵鄱珀钋钷皤笸"],["pou","剖裒掊"],["pu","扑铺仆莆葡菩蒲埔朴圃普浦谱瀑匍噗溥濮璞氆镤镨蹼"],["qi","期欺戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫亓圻芑芪萁萋葺蕲嘁屺岐汔淇骐绮琪琦杞桤槭耆祺憩碛颀蛴蜞綦鳍麒"],["qia","掐恰洽葜袷髂"],["qian","牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉倩佥阡芊芡掮岍悭慊骞搴褰缱椠肷愆钤虔箝"],["qiang","枪呛腔羌墙蔷强抢戕嫱樯戗炝锖锵镪襁蜣羟跄"],["qiao","橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍劁诮谯荞峤愀憔缲樵硗跷鞒"],["qie","切茄且怯窃郄惬妾挈锲箧趄"],["qin","钦侵亲秦琴勤芹擒禽寝沁芩揿吣嗪噙溱檎锓螓衾"],["qing","青轻氢倾卿清擎晴氰情顷请庆苘圊檠磬蜻罄綮謦鲭黥"],["qiong","琼穷邛茕穹蛩筇跫銎"],["qiu","秋丘邱球求囚酋泅俅巯犰湫逑遒楸赇虬蚯蝤裘糗鳅鼽"],["qu","趋区蛆曲躯屈驱渠取娶龋趣去诎劬蕖蘧岖衢阒璩觑氍朐祛磲鸲癯蛐蠼麴瞿黢"],["quan","圈颧权醛泉全痊拳犬券劝诠荃犭悛绻辁畎铨蜷筌鬈"],["que","缺炔瘸却鹊榷确雀阕阙悫"],["qun","裙群逡麇"],["ran","然燃冉染苒蚺髯"],["rang","瓤壤攘嚷让禳穰"],["rao","饶扰绕荛娆桡"],["re","惹热"],["ren","壬仁人忍韧任认刃妊纫仞荏饪轫稔衽"],["reng","扔仍"],["ri","日"],["rong","戎茸蓉荣融熔溶容绒冗嵘狨榕肜蝾"],["rou","揉柔肉糅蹂鞣"],["ru","茹蠕儒孺如辱乳汝入褥蓐薷嚅洳溽濡缛铷襦颥"],["ruan","软阮朊"],["rui","蕊瑞锐芮蕤枘睿蚋"],["run","闰润"],["ruo","若弱偌箬"],["sa","撒洒萨卅挲脎飒"],["sai","腮鳃塞赛噻"],["san","三叁伞散仨彡馓毵"],["sang","桑嗓丧搡磉颡"],["sao","搔骚扫嫂埽缫臊瘙鳋"],["se","瑟色涩啬铯穑"],["sen","森"],["seng","僧"],["sha","莎砂杀刹沙纱傻啥煞唼歃铩痧裟霎鲨"],["shai","筛晒酾"],["shan","珊苫杉山删煽衫闪陕擅赡膳善汕扇缮栅讪鄯芟潸姗嬗骟膻钐疝蟮舢跚鳝"],["shang","墒伤商赏晌上尚裳垧绱殇熵觞"],["shao","梢捎稍烧芍勺韶少哨邵绍劭潲杓蛸筲艄"],["she","奢赊蛇舌舍赦摄射慑涉社设厍佘猞滠畲麝"],["shen","砷申呻伸身深娠绅神沈审婶甚肾慎渗什诜谂莘葚哂渖胂矧蜃糁"],["sheng","声生甥牲升绳省盛剩胜圣嵊晟眚笙"],["shi","匙师失狮施湿诗尸虱十石拾时食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试谥埘莳蓍弑轼贳炻礻铈舐筮豕鲥鲺"],["shou","收手首守寿授售受瘦兽狩绶艏"],["shu","蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕丨倏塾菽摅沭澍姝纾毹腧殳秫"],["shua","刷耍唰"],["shuai","率摔衰甩帅蟀"],["shuan","栓拴闩涮"],["shuang","霜双爽孀"],["shui","谁水睡税"],["shun","吮瞬顺舜"],["shuo","说硕朔烁蒴搠妁槊铄"],["si","斯撕嘶思私司丝死肆寺嗣四伺似饲巳厮俟兕厶咝汜泗澌姒驷缌祀锶鸶耜蛳笥"],["song","松耸怂颂送宋讼诵凇菘崧嵩忪悚淞竦"],["sou","搜艘擞嗽叟薮嗖嗾馊溲飕瞍锼螋"],["su","苏酥俗素速粟僳塑溯宿诉肃夙谡蔌嗉愫涑簌觫稣"],["suan","酸蒜算狻"],["sui","虽隋随绥髓碎岁穗遂隧祟谇荽濉邃燧眭睢"],["sun","孙损笋荪狲飧榫隼"],["suo","蓑梭唆缩琐索锁所唢嗦嗍娑桫睃羧"],["ta","塌他它她塔獭挞蹋踏闼溻遢榻铊趿鳎"],["tai","胎苔抬台泰酞太态汰邰薹骀肽炱钛跆鲐"],["tan","坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭郯昙忐钽锬覃"],["tang","汤塘搪堂棠膛唐糖倘躺淌趟烫傥帑惝溏瑭樘铴镗耥螗螳羰醣"],["tao","掏涛滔绦萄桃逃淘陶讨套鼗啕洮韬饕"],["te","特忒忑慝铽"],["teng","藤腾疼誊滕"],["ti","梯剔踢锑提题蹄啼体替嚏惕涕剃屉倜悌逖绨缇鹈醍"],["tian","天添填田甜恬舔腆掭忝阗殄畋"],["tiao","挑条迢眺跳佻苕祧窕蜩笤粜龆鲦髫"],["tie","贴铁帖萜餮"],["ting","厅听烃汀廷停亭庭挺艇莛葶婷梃铤蜓霆"],["tong","通桐酮瞳同铜彤童桶捅筒统痛佟仝茼嗵恸潼砼"],["tou","偷投头透骰"],["tu","凸秃突图徒途涂屠土吐兔堍荼菟钍酴"],["tuan","湍团抟彖疃"],["tui","推颓腿蜕褪退煺"],["tun","囤吞屯臀氽饨暾豚"],["tuo","拖托脱鸵陀驮驼椭妥拓唾佗坨庹沱柝柁橐砣箨酡跎鼍"],["wa","挖哇蛙洼娃瓦袜佤娲腽"],["wai","歪外崴"],["wan","豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕剜芄菀纨绾琬脘畹蜿"],["wang","汪王亡枉网往旺望忘妄罔惘辋魍"],["wei","威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫偎诿隈圩葳薇帏帷嵬猥猬闱沩洧涠逶娓玮韪軎炜煨痿艉鲔"],["wen","瘟温蚊文闻纹吻稳紊问刎夂阌汶璺攵雯"],["weng","嗡翁瓮蓊蕹"],["wo","挝蜗涡窝我斡卧握沃倭莴喔幄渥肟硪龌"],["wu","巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误兀仵阢邬圬芴唔庑怃忤寤迕妩婺骛杌牾焐鹉鹜痦蜈鋈鼯"],["xi","栖昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细僖兮隰郗茜菥葸蓰奚唏徙饩阋浠淅屣嬉玺樨曦觋欷歙熹禊禧皙穸裼蜥螅蟋舄舾羲粞翕醯蹊鼷"],["xia","瞎虾匣霞辖暇峡侠狭下厦夏吓呷狎遐瑕柙硖罅黠"],["xian","掀锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线冼苋莶藓岘猃暹娴氙燹祆鹇痫蚬筅籼酰跣跹霰"],["xiang","相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象芗葙饷庠骧缃蟓鲞飨"],["xiao","萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效哓崤潇逍骁绡枭枵筱箫魈"],["xie","楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑偕亵勰燮薤撷獬廨渫瀣邂绁缬榭榍蹀躞"],["xin","薪芯锌欣辛新忻心信衅囟馨昕歆镡鑫"],["xing","星腥猩惺兴刑型形邢行醒幸杏性姓陉荇荥擤饧悻硎"],["xiong","兄凶胸匈汹雄熊芎"],["xiu","休修羞朽嗅锈秀袖绣咻岫馐庥溴鸺貅髹"],["xu","墟戌需虚嘘须徐许蓄酗叙旭序恤絮婿绪续吁诩勖蓿洫溆顼栩煦盱胥糈醑"],["xuan","轩喧宣悬旋玄选癣眩绚儇谖萱揎泫渲漩璇楦暄炫煊碹铉镟痃"],["xue","靴薛学穴雪血谑噱泶踅鳕"],["xun","勋熏循旬询寻驯巡殉汛训讯逊迅巽郇埙荀荨蕈薰峋徇獯恂洵浔曛醺鲟"],["ya","压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶伢垭揠岈迓娅琊桠氩砑睚痖"],["yan","焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验厣赝剡俨偃兖谳郾鄢埏菸崦恹闫阏湮滟妍嫣琰檐晏胭腌焱罨筵酽趼魇餍鼹"],["yang","殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾徉怏泱炀烊恙蛘鞅"],["yao","邀腰妖瑶摇尧遥窑谣姚咬舀药要耀钥夭爻吆崾徭幺珧杳轺曜肴铫鹞窈繇鳐"],["ye","椰噎耶爷野冶也页掖业叶曳腋夜液靥谒邺揶晔烨铘"],["yi","一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎刈劓佚佾诒圯埸懿苡荑薏弈奕挹弋呓咦咿嗌噫峄嶷猗饴怿怡悒漪迤驿缢殪轶贻欹旖熠眙钇镒镱痍瘗癔翊蜴舣羿翳酏黟"],["yin","茵荫因殷音阴姻吟银淫寅饮尹引隐印胤鄞垠堙茚吲喑狺夤洇氤铟瘾窨蚓霪龈"],["ying","英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映嬴郢茔莺萦蓥撄嘤膺滢潆瀛瑛璎楹媵鹦瘿颍罂"],["yo","哟唷"],["yong","拥佣臃痈庸雍踊蛹咏泳涌永恿勇用俑壅墉喁慵邕镛甬鳙饔"],["you","幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼卣攸侑莠莜莸尢呦囿宥柚猷牖铕疣蚰蚴蝣鱿黝鼬"],["yu","迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁遇喻峪御愈欲狱育誉浴寓裕预豫驭禺毓伛俣谀谕萸蓣揄圄圉嵛狳饫馀庾阈鬻妪妤纡瑜昱觎腴欤於煜燠聿钰鹆鹬瘐瘀窬窳蜮蝓竽臾舁雩龉"],["yuan","鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院垸塬芫掾圜沅媛瑗橼爰眢鸢螈箢鼋"],["yue","曰约越跃岳粤月悦阅龠哕瀹樾刖钺"],["yun","耘云郧匀陨允运蕴酝晕韵孕郓芸狁恽愠纭韫殒昀氲熨筠"],["za","匝砸杂咋拶咂"],["zai","栽哉灾宰载再在崽甾"],["zan","咱攒暂赞瓒昝簪糌趱錾"],["zang","赃脏葬奘驵臧"],["zao","遭糟凿藻枣早澡蚤躁噪造皂灶燥唣"],["ze","责择则泽仄赜啧帻迮昃笮箦舴"],["zei","贼"],["zen","怎谮"],["zeng","增憎赠缯甑罾锃"],["zha","扎喳渣札轧铡闸眨榨乍炸诈柞揸吒咤哳楂砟痄蚱齄"],["zhai","摘斋宅窄债寨砦瘵"],["zhan","瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽谵搌旃"],["zhang","樟章彰漳张掌涨杖丈帐账仗胀瘴障仉鄣幛嶂獐嫜璋蟑"],["zhao","招昭找沼赵照罩兆肇召诏棹钊笊"],["zhe","遮折哲蛰辙者锗蔗这浙着乇谪摺柘辄磔鹧褶蜇螫赭"],["zhen","珍斟真甄砧臻贞针侦枕疹诊震振镇阵帧圳蓁浈缜桢椹榛轸赈胗朕祯畛稹鸩箴"],["zheng","蒸挣睁征狰争怔整拯正政症郑证诤峥徵钲铮筝"],["zhi","芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒卮陟郅埴芷摭帙忮彘咫骘栉枳栀桎轵轾贽胝膣祉黹雉鸷痣蛭絷酯跖踬踯豸觯"],["zhong","中盅忠钟衷终种肿重仲众冢锺螽舯踵"],["zhou","舟周州洲诌粥轴肘帚咒皱宙昼骤荮啁妯纣绉胄碡籀酎"],["zhu","珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻伫侏邾苎茱洙渚潴杼槠橥炷铢疰瘃竺箸舳翥躅麈"],["zhua","抓爪"],["zhuai","拽"],["zhuan","专砖转撰赚篆啭馔颛"],["zhuang","幢桩庄装妆撞壮状僮"],["zhui","椎锥追赘坠缀萑惴骓缒隹"],["zhun","谆准肫窀"],["zhuo","捉拙卓桌琢茁酌啄灼浊倬诼擢浞涿濯禚斫镯"],["zi","兹咨资姿滋淄孜紫仔籽滓子自渍字谘呲嵫姊孳缁梓辎赀恣眦锱秭耔笫粢趑訾龇鲻髭"],["zong","鬃棕踪宗综总纵偬腙粽"],["zou","邹走奏揍诹陬鄹驺鲰"],["zu","租足卒族祖诅阻组俎菹镞"],["zuan","钻纂攥缵躜"],["zui","嘴醉最罪蕞觜"],["zun","尊遵撙樽鳟"],["zuo","昨左佐做作坐座阼唑嘬怍胙祚酢"]],f=e.length}($,window),function(a,b,c){function d(a){var b=this;w.superClass.initialize.call(b),b._support=a}function e(a,b,c){var d,e=this,f=a.data;return f&&(d=f.order,d&&(e._support.orderParam=d)),"splitName"===a.command||"splitAddr"===a.command?(a.call&&a.call({requestParam:a,responseData:b,returns:c}),void 0):(e._support.resetData(a,b,c,function(){a.call&&a.call({requestParam:a,responseData:b,returns:c})}),void 0)}function f(a){this._request({command:"getVer",call:a.call})}function g(a){var b=this;a=a||{};var c=a.data||{};a.extData=a.extData||{},a.extData._realCommand="getCon";var d={vcardver:"3.0",ctype:"all",attachinfos:"yellowpage,frequentContacts",freContLim:20};c.order=c.order||b._support.orderParam||[{field:"N",desc:"false"}],$S("isVip")&&(d.limitinfo="get"),b._request({command:"getCon",call:a.call,data:c,ext:d,error:a.error,extData:a.extData})}function h(a){var b=this,c={vcardver:"3.0"};a.extData=a.extData||{},a.extData._realCommand="addCon",a.returnType&&(c.cType=a.returnType),b._request({command:"addCon",requireNewData:!0,data:a.data,call:a.call,error:a.error,ext:c,extData:a.extData})}function i(a){var b=this,c={vcardver:"3.0"};a.extData=a.extData||{},a.extData._realCommand="removeCon",a.returnType&&(c.cType=a.returnType),b._request({command:"removeCon",requireNewData:!0,data:a.data,call:a.call,ext:c,error:a.error,extData:a.extData})}function j(a){var b=this,c={vcardver:"3.0"};a.extData=a.extData||{},a.extData._realCommand="updateCon",a.returnType&&(c.cType=a.returnType),b._request({command:"updateCon",requireNewData:!0,data:a.data,ext:c,call:a.call,error:a.error,extData:a.extData})}function k(a){var b=this,c={vcardver:"3.0"};a.extData=a.extData||{},a.extData._realCommand="updateGrp",a.returnType&&(c.cType=a.returnType),b._request({command:"updateGrp",requireNewData:!0,data:a.data,ext:c,call:a.call,error:a.error,extData:a.extData})}function l(b){var c=this,d={vcardver:"3.0"};b.extData=b.extData||{},b.extData._realCommand="updateGrp",b.returnType&&(d.cType=b.returnType);var e={contacts:[]};a.Array.each(b.data.groups.groups,function(a,b){b.CONTACTS&&(b=u.clone(b),delete b.CONTACTS),e.contacts.push(b)}),c._request({command:"updateCon",requireNewData:!0,data:e,ext:d,call:b.call,error:b.error,extData:b.extData})}function m(b){var c=this,d={vcardver:"3.0"};b.extData=b.extData||{},b.extData._realCommand="updateGrp",b.returnType&&(d.cType=b.returnType);var e={contacts:[]};a.Array.each(b.data.groups.groups,function(a,b){b.CONTACTS&&(b=u.clone(b),delete b.CONTACTS),b["X-TYPE"]="GROUP",e.contacts.push(b)}),c._request({command:"addCon",requireNewData:!0,data:e,call:b.call,error:b.error,ext:d,extData:b.extData})}function n(a){var b=a.extData||{},c={vcardver:"3.0",recurse:a.deleteContact||!1};a.extData=a.extData||{},a.extData._realCommand="removeGrp",a.returnType&&(c.cType=a.returnType),this._request({command:"removeGrp",requireNewData:!0,data:a.data,call:a.call,ext:c,error:a.error,extData:b})}function o(a){var b=this;b._request({url:b._recentContactURL,command:"getRecent",call:a.call,ext:{limit:a.limit||20},error:a.error})}function p(d){function e(a){var b=a.responseData||a.data;b&&(g[h]=b,d.call&&d.call())}var f=this,g=f._support.data.cache.nameCache,h=d.name;return!h||g[h]!==c&&null!==g[h]?void 0:(g[h]=null,$S("isVip")?(f._request({requestType:a.Ajax.SCRIPT,method:a.Ajax.GET,url:f._smartSplitURL,command:"splitName",paddingFunc:e,paddingParam:"call",ext:{name:b.encodeURIComponent(h)},error:d.error}),void 0):(f._request({url:f._smartSplitURL,command:"splitName",call:e,data:{name:h},error:d.error}),void 0))}function q(d){function e(a){var b=a.responseData||a.data;b&&(g[h]=b,d.call&&d.call())}var f=this,g=f._support.data.cache.addrCache,h=d.addr;return!h||g[h]!==c&&null!==g[h]?void 0:(g[h]=null,$S("isVip")?(f._request({requestType:a.Ajax.SCRIPT,method:a.Ajax.GET,url:f._smartSplitURL,command:"splitAddr",paddingFunc:e,paddingParam:"call",ext:{address:b.encodeURIComponent(h)},error:d.error}),void 0):(f._request({url:f._smartSplitURL,command:"splitAddr",call:e,data:{address:h},error:d.error}),void 0))}function r(d){var e=this,f="&cookiestr="+b.encodeURIComponent("Coremail="+a.Cookie.get("Coremail",!0)),g="&inmode="+d.inmode,h="&group="+d.group,i="&exportuser="+b.encodeURIComponent(d.username);if("gmail.com"===d.username.split("@").pop()){var j=function(){var b=v.getUrl("address_clone_gmail",!0)+f+g+h+i,j=new a.Msgbox({contentType:"wide",header:"复制Gmail通讯录",noFooter:!0,content:'<iframe src="'+b+'" frameborder="0" style="width:100%;height:100%;border:0;"></iframe>',close:function(){a.Tips.loading()}});$S("gmailCloneCall",function(b){try{j.destroy()}catch(f){}b?e.getData({call:function(){d.callback&&d.callback({suc:!0})}}):a.Tips.loading(),$S("gmailCloneCall",c)})};d.confirmed?j():a.Msgbox.show({title:"Gmail邮箱需要申请授权才可进行复制",content:"如需复制其他Gmail帐号的通讯录，请先退出当前登录的Gmail帐号",icon:"alert",cancelText:"取消",okText:"申请授权复制Gmail通讯录",ok:j,cancel:function(){a.Tips.loading()},close:function(){a.Tips.loading()}})}else{var k=this._support,l=v.getUrl("address_clone_ssl");l+=f,l+=g,l+=i,d.password&&(l+="&password="+b.encodeURIComponent(d.password)),d.verifyCode&&(l+="&validcode="+d.verifyCode),l+=h,l+="&rnd="+(new Date).getTime(),a.Ajax.request({requestType:a.Ajax.SCRIPT,url:l,paddingFunc:a.Function.bind(k.cloneResponse,k,d),paddingParam:"callback"})}}function s(a){var b={vcardver:"3.0"};a.extData=a.extData||{},a.extData._realCommand="batchDeal",a.returnType&&(b.cType=a.returnType),this._request({command:"batchDeal",requireNewData:!0,data:a.data,call:a.call,error:a.error,ext:b,extData:a.extData})}var t,u=a.Object,v=a.Uri;t=$I("core.ContactDataAction");var w=a.createClass($N("support.AddressSupportAction"));u.mix(w,t,null,{_support:null,_response:e,initialize:d,getVersion:f,getData:g,addContact:h,removeContact:i,updateContact:j,updateGroup:k,updateGroupAll:l,addGroupAll:m,removeGroup:n,getRecentContact:o,splitName:p,splitAddr:q,contactClone:r,batchDeal:s})}($,window),function(a,b,c){function d(){var a=this,b=!0;mb.localStorage||a.forceUseLocalStorage?a.readLocalData()&&(a._formatData(),b=!1):a.clearLocalData(),b&&($S("isVip")?a._action.getData({call:function(b){a.data.rawDataArray.limitinfo=b.responseData.limitinfo||{}},error:function(){}}):a._action.getData({error:function(){}}))}function e(a){var b=this,c=b._initCalls;b._formatGroupData(),b._formatContactData(function(){if(b._formatFrequentContacts(),!b.dataInited){b.dataInited=!0;try{qb.fire("addr:dataInit")}catch(d){}}for(var e=0,f=c.length;f>e;e++)try{c.shift().call()}catch(d){}a&&a()})}function f(){var a=this,b=a.data,c=b.rawDataArray.group,d=b.rawDataArray.contact,e=[],f=[],g=b.extDataMap.groupMark,h=b.extDataMap.group={},i=b.extDataMap.groupArray;g.length=0,i.length=0;var j,k,l,m,n,o,p,q;for(n=0,o=c.length;o>n;n++)q=c[n],p=q.N||"",p?"SYSTEM"===q["X-TYPE1"]?"RECENT"===q.UID?j=q:e.push(q):"我的邮件列表"===p?k=q:(q.PRODID&&q.PRODID.indexOf("Apple Inc.")>-1&&(q.N=q.N.replace(/\\;/gi,";")),f.push(q)):(q.error=!0,c.splice(n,1),n--,o--);for(j&&e.unshift(j),k&&e.push(k),f.sort(function(a,b){return a.N.localeCompare(b.N)}),c=b.rawDataArray.group=e.concat(f),l={CID:"ALL",UID:"ALL",N:"所有",CONTACTS:d},h[l.CID]=l,i.push(l),n=0,o=c.length;o>n;n++)q=jb.clone(c[n]),q.CONTACTS||(q.CONTACTS=[]),h[q.CID]=q,i.push(q),q.MARKED&&g.push(q);m={CID:"OTHERS",UID:"OTHERS",N:"未分组",CONTACTS:[]},h[m.CID]=m,i.push(m),e.length=0,f.length=0}function g(c){function d(a){var c,d,g,p,q,r,s,t,u,v,w,x=a.CID,y=a.N,z=a.FN,A=[];for(y=jb.isString(y)?y:";;;;",jb.isArray(z)&&(a.FN=z=z.join("")),g=y.split(";"),""===g.join("")&&(g[1]=(z||"").replace(";",""));g.length<5;)g.push("");for(a.N=g.join(";"),q=e.getGivenName(a),l[x]=a,c=e.getContactEmails(a),s=0,t=c.length;t>s;s++){var B={};v=kb.trim(c[s]),nb.matchEmail(v)&&(w=k[v],w||(k[v]=w=[]),w.push(a),B={email:v,name:q,cid:x},n.push(B),A.push(v))}if(A.length>0&&(r={email:A,name:q,yellowPage:o[x]||null},m[x]=r),a.MARKED&&(j.push(a),f.maxMarkSort=Math.max(b.parseInt(a.MARKED)||0,f.maxMarkSort)),p=a.GROUPING||a.Grouping||"",a.GROUPING=p,delete a.Grouping,d=p.split(";"),p.length>0)for(s=0,t=d.length,u;t>s;s++)u=h[d[s]],u&&u.CONTACTS.push(a);else i.CONTACTS.push(a)}var e=this,f=e.data,g=f.rawDataArray.contact,h=f.extDataMap.group,i=h.OTHERS,j=f.extDataMap.contactMark,k=f.extDataMap.email={},l=f.extDataMap.contact={},m=f.extDataMap.contactLite={},n=f.extDataMap.contactLiteArray,o=f.extDataMap.yellowPage;j.length=0,n.length=0;var p=g.length,q=Math.floor(p/8),r=p%8,s=0;if(r)do d(g[s++]);while(--r);var t=++e._formatTimerId,u=e.dataInited,v=u?25:50,w=25;if(q){if(a.Browser.ie()||!u)setTimeout(function(){if(!(t<e._formatTimerId)){var a=0;do d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]);while(--q&&++a<w);0===q?c&&c():setTimeout(arguments.callee,v)}},u?50:0);else if(q){do d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]),d(g[s++]);while(--q);c&&c()}}else c&&c()}function h(c,d,e){function f(a){for(var b,c,d,e={GROUPING:"",__FORNEW:!0},f=0,g=a.length;g>f;f++)b=a[f],c=A[b],c.MARKED&&(y.change=!0),e.CID=b,d=c.GROUPING,c.GROUPING+=""===d?"OTHERS;ALL":";ALL",u.contact[b]=c,l(e,c),m(e,c),n(e,c),c.GROUPING=d}function g(a){for(var b,c,d,e={GROUPING:"",__FORDEL:!0},f=0,g=a.length;g>f;f++)b=a[f],c=u.contact[b],c&&(c.MARKED&&(y.change=!0),d=c.GROUPING,c.GROUPING+=""===c.GROUPING?"OTHERS;ALL":";ALL",e.CID=b,delete u.contact[b],l(c,e),m(c,e),n(c,e),c.GROUPING=d)}function h(a){for(var b,c,d,e,f=u.contactLite,g=u.contactLiteArray,h=g.length,i=0,j=a.length;j>i;i++)if(b=a[i],c=u.contact[b],d=A[b],d&&c){(d.MARKED||c.MARKED)&&(y.change=!0,y.contactNameChange=d.N!==c.N);var k={};if(jb.each(c,function(a,b){k[a]=b,delete c[a]}),jb.extend(c,d),c=k,l(c,d),m(c,d),n(c,d),c.N!=d.N){e=t.getGivenName(d),f[c.CID]&&(f[c.CID].name=e);for(var o=0;h>o;o++)g[o].cid==c.CID&&(g[o].name=e)}}}function i(a){for(var b,c,d,e,f=0,g=a.length;g>f;f++){if(b=a[f],c=u.group[b],d=z[b],u.group[b]=d,(d&&d.MARKED||c&&c.MARKED)&&(y.change=!0,y.contactNameChange=(d||{}).N!==(c||{}).N),c)d.CONTACTS=c.CONTACTS,o(c,d);else{e=!1,d.CONTACTS=[];for(var h=0,i=u.groupArray.length;i>h;h++)if(c=u.groupArray[h],"ALL"!==c.CID&&"OTHERS"!==c.CID&&"SYSTEM"!==c["X-TYPE1"]&&"我的邮件列表"!==c.N&&-1==d.N.localeCompare(c.N)){u.groupArray.splice(h,0,d),e=!0;break}e||u.groupArray.push(d),c={}}p(c,d)}}function j(b){for(var d,e,f=(c.ext||{}).recurse,i=a.Array.map(c.extData.contacts,function(a,b){return b.CID
}),j=0,k=b.length;k>j;j++)if(d=b[j],e=u.group[d]){e.MARKED&&(y.change=!0),delete u.group[d];for(var l=0,m=u.groupArray.length;m>l;l++)if(u.groupArray[l].CID==d){u.groupArray.splice(l,1);break}p(e,{})}f?g(i):h(i)}function k(a){var c=a.N,d=a.FN;c="string"==typeof c?c:";;;;",d instanceof b.Array&&(a.FN=d=d.join(""));var e=c.split(";");for(""===e.join("")&&(e[1]=(d||"").replace(";",""));e.length<5;)e.push("");a.N=e.join(";");var f=a.GROUPING||a.Grouping||"";a.GROUPING=f,delete a.Grouping}function l(a,b){var c=a.GROUPING,d=b.GROUPING;if(c!==d){""!==c||a.__FORNEW||(c="OTHERS"),""!==d||b.__FORDEL||(d="OTHERS");var e,f,g=c.split(";"),h=d.split(";"),i=q(g,h),j=i.add,k=i.del;if(0!==j.length+k.length){for(r=0,s=j.length;s>r;r++)e=j[r],f=u.group[e],f&&(f.MARKED&&(y.groupChange=!0),f.CONTACTS.push(b));for(r=0,s=k.length;s>r;r++)if(e=k[r],f=u.group[e]){f.MARKED&&(y.groupChange=!0);for(var l=0,m=f.CONTACTS.length;m>l;l++)if(f.CONTACTS[l].CID==b.CID){f.CONTACTS.splice(l,1);break}}}}}function m(a,b){var c,d,e,f,g=u.email,h=u.contactLiteArray,i=u.contactLite,j=u.yellowPage,k=b.CID,l=t.getContactEmails(a),m=t.getContactEmails(b),n=q(l,m),o=n.add,p=n.del,r=t.getGivenName(b),s=[];if(0!==o.length+p.length){for(b.MARKED&&(y.contactEmailChange=!0),c=0,d=m.length;d>c;c++)e=kb.trim(m[c]),nb.matchEmail(e)&&s.push(e);for(i[k]={email:s,name:r,yellowPage:j[k]||null},c=0,d=o.length;d>c;c++)e=kb.trim(o[c]),nb.matchEmail(e)&&(f=g[e],f||(g[e]=f=[]),f.push(b),h.push({email:e,name:r,cid:k}));for(c=0,d=p.length;d>c;c++)if(e=kb.trim(p[c]),nb.matchEmail(e)){var v,w;for(f=g[e]||[],v=0,w=f.length;w>v;v++)if(f[v].CID==k){f.splice(v,1);break}for(v=0,w=h.length;w>v;v++){var x=h[v];if(x.email===e&&x.cid===k){h.splice(v,1);break}}}}}function n(a,b){var c=u.contactMark;if(a.MARKED!=b.MARKED){if(!("MARKED"in a)&&"MARKED"in b)return y.statusChange=!0,c.push(b),void 0;if("MARKED"in a&&!("MARKED"in b)){y.statusChange=!0;for(var d=0,e=c.length;e>d;d++)if(c[d].CID==a.CID){c.splice(d,1);break}}}}function o(a,b){for(var c=u.groupArray,d=0,e=c.length;e>d;d++)if(c[d].CID==a.CID){c.splice(d,1,b);break}}function p(a,b){var c=u.groupMark;if(a.MARKED!=b.MARKED){if(!("MARKED"in a)&&"MARKED"in b)return y.statusChange=!0,c.push(b),void 0;if("MARKED"in a&&!("MARKED"in b)){y.statusChange=!0;for(var d=0,e=c.length;e>d;d++)if(c[d].CID==a.CID){c.splice(d,1);break}}else for(var d=0,e=c.length;e>d;d++)if(c[d].CID==a.CID){c.splice(d,1,b);break}}}function q(a,b){if(a=a||[],b=b||[],0===a.length)return{add:b.slice(0),del:[]};if(0===b.length)return{add:[],del:a.slice(0)};var c,d,e,f={},g=[];for(c=0,d=a.length;d>c;c++)e=kb.trim(a[c]+""),""!==e&&(f[a[c]]=!0);for(c=0,d=b.length;d>c;c++)e=kb.trim(b[c]+""),""!==e&&(f[e]?delete f[e]:g.push(e));var h=jb.keys(f);return{add:g,del:h}}var r,s,t=this,u=t.data.extDataMap,v=t.data.rawDataArray.contact,w=t.data.rawDataArray.group,x=(c.extData||{})._realCommand,y={statusChange:!1,contactEmailChange:!1,contactNameChange:!1,groupChange:!1,change:!1},z={},A={};if(x){for(r=0,s=v.length;s>r;r++)k(v[r]),A[v[r].CID]=v[r];for(r=0,s=w.length;s>r;r++)z[w[r].CID]=w[r];try{switch(x){case"getCon":break;case"addCon":f(e);break;case"removeCon":g(c.data.contactIds||[]);break;case"updateCon":var B=[],C=[];for(r=0,s=e.length;s>r;r++)z[e[r]]?C.push(e[r]):B.push(e[r]);h(B),i(C);break;case"updateGrp":i(e);break;case"removeGrp":j(c.data.contactIds||[]);break;case"batchDeal":var D=c.data.deals.dels,E=a.Array.map(c.data.deals.updates,function(a,b){return b.CID}),e=q(D.concat(E),e||[]),F=e.add;h(E),g(D),f(F)}}catch(G){}u.dataMark=null;try{t._formatFrequentContacts()}catch(G){}y.change=y.change||y.contactEmailChange||y.contactNameChange||y.groupChange,y.change&&qb.fire("addr:dataMark",y)}}function i(){for(var a,b=this,c=b.data,d=c.rawDataArray.attach||[],e={},f=0,g=d.length;g>f;f++)a=d[f],"yellowpage"===a.type&&(e[a.CID]=a.companyId||-1);c.extDataMap.yellowPage=e}function j(){function a(a){for(var b,d,e=c.data.extDataMap.email,f=[],g=0,h=a.length;h>g;g++)if(b=kb.trim(a[g]),d=e[b],d&&d[0])f.push(d[0]);else{var i={};i[rb]=b,f.push(i)}return f}for(var b,c=this,d=c.data,e=d.rawDataArray.attach||[],f=[],g=0,h=e.length;h>g;g++)if(b=e[g],"frequentContacts"===b.type){f=b.uids;break}return mb.contact_record?(d.recentContacts=a(f),void 0):null}function k(a,b){return a=a.replace("\\","\\\\"),a=a.replace(new RegExp("[$ ( [ { ^ | ) ? * + .]","gi"),function(a){return"\\"+a}),new RegExp(b?"^"+a+"$":a,"gi")}function l(a){this._initCalls.push(a)}function m(){var a=this,b=a.data.maxMarkSort||0;return b+=1,a.data.maxMarkSort=b,b}function n(){var a=this;return a.readLocalData(!0)}function o(){var b=this,c=null;try{return c=a.Storage.get(b._localKey),c?JSON.parse(c,function(a,b){var c;return jb.isString(b)&&(c=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(b))?new Date(Date.UTC(+c[1],+c[2]-1,+c[3],+c[4],+c[5],+c[6])):b}):null}catch(d){return null}}function p(b){var c=this;try{a.Storage.set(c._localKey,b?JSON.stringify(b):"")}catch(d){}}function q(a){var b,c,d,e,f=this,g=!1,h=f.data.rawDataArray,i=f.getLocalData();if(i)if(i.ver===f._localVer||a)try{if(d=i.data,d&&(e=d[$S("uid")]),e){if(a)return!0;e.ver===f.data.ver&&(b=e.group,c=e.allInfo)}jb.isArray(b)&&jb.isArray(c)&&(a||(h.group=b,h.contact=c),g=!0)}catch(j){}else f.clearLocalData(!0);return g}function r(a,b){var c,d=this,e=d.data.rawDataArray,f=$S("uid");if(!a&&d.dataInited)return d.getDataVersion({call:function(){var a=d.updateLocalData(!0);b&&b(a)}}),!1;try{var g=d.getLocalData(),h={ver:d.data.ver,group:e.group,allInfo:e.contact};if(g&&g.ver===d._localVer&&(c=g.data))return c[f]=h,d.setLocalData(g),!0;g={ver:d._localVer,data:{}},g.data[f]=h,d.setLocalData(g)}catch(i){return!1}return!0}function s(b){var c,d,e,f=this;try{b?(c=f._localKey,a.Storage.get(c)&&a.Storage.set(c,"")):(d=$S("uid"),e=f.getLocalData(),e&&e.data&&e.data[d]&&(e.data[d]=null,delete e.data[d],f.setLocalData(e)))}catch(g){return!1}return!0}function t(a){var b=this;b._action.getVersion({call:function(){a.call&&a.call()}})}function u(a){var b=this;try{"download"===a.type?b.updateLocalData(!1,a.call):a.call&&a.call(b.clearLocalData())}catch(c){return!1}}function v(){function b(){a.Addr._items&&a.Thread.delay(function(){jb.each(a.Addr._items,function(a,b){try{if(b._destroyed===!0)return;b.update({})}catch(c){}})}),a.UserLabel._items&&a.Thread.delay(function(){jb.each(a.UserLabel._items,function(a,b){try{if(b._destroyed===!0)return;b.layer&&(b.layer.destroy(),delete b.layer),b.update({})}catch(c){}})})}var c=this;c._inited||(c._inited=!0,c._action=new ib(c),mb.localStorage&&c.checkLocalState()||c.forceUseLocalStorage?c.getDataVersion({call:a.Function.bind(c._initData,c)}):c._initData(),qb.listen("addr:dataReset",b),qb.listen("options:contactModify",b),qb.listen("options:skinChange",b),qb.listen("addr:dataInit",b))}function w(a,b,c,d){function e(){function b(){if((mb.localStorage&&f.checkLocalState()||f.forceUseLocalStorage)&&f.updateLocalData(!0),h)try{qb.fire("addr:dataReset",i)}catch(a){}d&&d()}if(!a.extData.notAutoRemoveMark){for(var c,j=g.extDataMap.groupMark||[],k=[],l=0,m=j.length;m>l;l++)c=j[l],0===c.CONTACTS.length&&c.MARKED&&k.push({cid:c.CID,ctype:"group"});if(k.length>0)return f.markData({data:k,mark:!1,call:e,error:b}),void 0}b()}var f=this,g=f.data,h=f.dataInited,i={};a.extData||(a.extData={});var j=null===b.rev?0:b.rev,k=b.contacts,l=b.groups,m=b.attachinfos;if(g.extDataMap.dataMark=null,g.extDataMap.dataPhone=null,jb.isNumber(j)&&(g.ver=j),k&&(i.contact=!0,g.rawDataArray.contact=k,f.data.delayedContact={}),l&&(i.group=!0,g.rawDataArray.group=l),m){g.rawDataArray.attach=m;try{f._formatYellowPageData()}catch(n){}}if(k||l){var o=a.extData._realCommand;"getCon"!==o&&h&&!(a.extData||{}).forceUpdate?(f._updateData(a,b,c),e()):f._formatData(e)}else d&&d()}function x(a){var b,c=this,d=kb.trim(a.name||""),e="添加联系人分组出错";if(0===d.length)return c.showError({title:e,content:"请填写联系组名称。",error:a.error});if(kb.len(d)>40)return c.showError({title:e,content:"分组名长度超过20个中文或40个字符，请重新输入。",error:a.error});b=c.data.rawDataArray.group;for(var f,g=0,h=b.length;h>g;g++)if(f=b[g],d===f.N)return c.showError({title:e,content:"已存在名称为“"+kb.encodeHTML(d)+"”的分组，请输入其他名称。",error:a.error});c._action.updateGroup({data:{groups:{groups:[{N:d}]}},call:a.call,error:function(b){c.showError({title:e,content:b.content,error:a.error,reason:"action_error"})}})}function y(b){function c(){for(var a=0,c=j.length;c>a;a++){var e=j[a],f=d.getAddrObj(e[rb]||e.email);e.id=f.CID}d.updateContact({contacts:j,call:b.call,error:b.error})}var d=this,e=d.data.delayedContact,f=!a.Object.isEmpty(e),g="@@",h=b.contacts,i=[],j=[];if(f)for(var k in e){var l=e[k][rb];l&&(g+=l+"@@")}for(var m,n=0,o=h.length;o>n;n++){m=h[n];var p,q=m.name?kb.trim(m.name.replace("&nbsp;"," ").replace(";","")):"",r=(m.email||"").toLowerCase(),s=m.phone,t=m.group||[],u=m.marked&&jb.isNumber(m.marked)?m.marked:null,v={};if(f&&r&&g.indexOf(r)>0)j=j.concat(h.splice(n,1)),o--,n--;else{if(p=nb.matchEmail(r),!p||p.address!==r)return b.error({content:"请输入正确的Email地址",type:"email"}),void 0;d.setGivenName(v,q),v[rb]=r,t.length>0&&(v.GROUPING=t.join(";")),jb.isString(s)&&(v["TEL;type=CELL;type=VOICE;type=pref"]=s),u&&(v.MARKED=u),i.push(v)}}if(i.length>0){var w="添加联系人";d._action.addContact({data:{contacts:i},call:function(e){j.length>0?c():d.dataCall(!0,w,a.Function.bind(b.call,b,e.returns))},error:function(a){d.dataCall(!1,w,b.error,a)}})}else j.length>0&&d.registerContact({call:c,request:!0});return!0}function z(d){for(var e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=d.contacts,s=q.data.extDataMap.email,t=q.data.extDataMap.contact,u=[],v=[],w=0,x=r.length;x>w;w++)p=r[w],e=p.id,f=kb.trim(p.name||"").replace("&nbsp;"," ").replace(";",""),g=(p.email||"").toLowerCase(),h=p.phone,i=s[g]||[],j=p.group||null,o=p.mark,k=t[e],l=jb.clone(k),k?(k=jb.clone(k),f&&q.setGivenName(k,f),(h!==c||null!==h)&&(m="TEL;type=CELL;type=VOICE;type=pref",n=k[m],d.incremental?n?jb.isString(n)&&h!==n?k[m]=[n,h]:lb.has(n,h)||n.push(h):k[m]=h:!n||jb.isString(n)?k[m]=h:n[0]=h),o===!1?delete k.MARKED:k.MARKED||(o===!0&&(o=q.getMarkSort()),o=b.parseInt(o),b.isNaN(o)||(k.MARKED=o)),j&&(k.GROUPING=j.join(";")),a.Object.isEqual(k,l)||u.push(k)):v.push(p);var y="修改联系人";return v.length>0&&q.addContact({contacts:v,call:function(){q.dataCall(!0,y,d.call)},error:function(a){q.dataCall(!1,y,d.error,a)}}),u.length>0&&q._action.updateContact({data:{contacts:u},call:function(a){q.dataCall(!0,y,function(){d.call(a.returns)})},error:function(a){q.dataCall(!1,y,d.error,a)}}),0===v.length+u.length&&q.dataCall(!1,y,null,{content:"联系人没有修改"}),!0}function A(a){function b(){n++,o+n===m&&(o?d.dataCall(!1,e,a.error):d.dataCall(!0,e,a.call))}function c(b){o++,o+n===m&&d.dataCall(!1,e,a.error,b)}var d=this,e=a.text||"修改星标联系人",f=d.data.extDataMap.contact,g=d.data.extDataMap.group,h=a.data;if(!h)return d.dataCall(!1,e,null,{content:"联系人没有修改"});h=jb.isArray(h)?h:[h];var i,j=a.mark!==!1,k=[],l=[];if(lb.each(h,function(a,b){if(!b.cid&&0!==b.cid){var c=b.email;if(i={name:nb.getDefaultName(c),email:nb.getAddress(c,!0),marked:d.getMarkSort()},!i.email){var e=nb.getEmails(c,"Email",!0);e.match.length>0&&(i.email=e.match[0].address,i.name=e.match[0].defaultName)}return i.name||(i.name=i.email.split("@")[0]),l.push(i),void 0}if(i="group"===b.ctype?g[b.cid]:f[b.cid]){if(i=jb.clone(i),"GROUP"===i["X-TYPE"]||g[i.CID]){if("ALL"===i.CID||"OTHERS"===i.CID||"SYSTEM"===i["X-TYPE1"]||0===i.CONTACTS.length&&j)return;i=jb.clone(i),delete i.CONTACTS,delete i.contacts}if(j){var h=d.getMarkSort();i.MARKED=h}else delete i.MARKED;k.push(i)}}),0===k.length+l.length)return d.dataCall(!1,e,null,{content:"联系人没有修改"});var m=(k.length>0?1:0)+(l.length>0?1:0),n=0,o=0;k.length>0&&d._action.updateContact({data:{contacts:k},call:b,error:c}),l.length>0&&d.addContact({contacts:l,call:b,error:c})}function B(a){var b=this,c="删除联系人";b._action.removeContact({data:{contactIds:a.contacts},call:function(){b.dataCall(!0,c,a.call)},error:function(d){b.dataCall(!1,c,a.error,d)}})}function C(b){var c,d=this,e=d.data.extDataMap.contact[b.id],f=b.value,g=!1;if(e){switch(b.type){case"email":for(var h in e)if(c=e[h],h.indexOf("EMAIL")>=0&&c&&(c===f?(delete e[h],g=!0):c instanceof lb&&lb.each(c,function(b,d){return d===f?(c.splice(b,1),g=!0,a.BREAK):void 0}),g))break}var i="修改联系人";g&&d._action.updateContact({data:{contacts:[e]},call:function(a){d.dataCall(!0,i,function(){b.call(a.returns)})},error:function(a){d.dataCall(!1,i,b.error,a)}})}}function D(a){var b=this,c=b.data.rawDataArray.contact;b.data.extDataMap.contact;for(var d,e,f,g,h,i,j=b.data.extDataMap.email,k=b.data.extDataMap.contactLite,l=b.data.extDataMap.contactLiteArray,m=0,n=a.length;n>m;m++)h=a[m],"added"===h.action&&(h=h.item,f=h["EMAIL;PREF"]||"",i={UID:h.id,FN:h.FN,N:h.N||";;;;",GROUPING:""},i[rb]=f,c.unshift(i),e=b.getGivenName(i),l.unshift({name:e,email:f}),k["delay"+i.UID]={name:e,email:[f]},g=j[f],g?g.unshift(i):j[f]=[i],b.data.delayedContact[i.UID]=i,d=!0);if(d)try{qb.fire("addr:dataReset",{contact:!0})}catch(o){}}function E(a){function b(b){var f,g=c.data.rawDataArray.contact;$S("isVip")&&(c.data.rawDataArray.limitinfo=b.responseData.limitinfo||{});for(var h=g.length-1;h>-1;h--)if(f=g[h],e||f.UID===d)return a.call(f),void 0}var c=this,d=a.UID,e=a.request;e||c.data.delayedContact[d]?c._action.getData({call:b,error:function(){}}):b()}function F(b){var c={title:b.title||"通讯录出错",content:b.content||"未知错误",reason:b.reason||""};if(b.error)b.error(c);else{if(b.noAlert)return;new a.Msgbox(c)}}function G(a){var b=this,c=b.getContactEmails(a)[0]||"",d="",e="",f=a.FN,g=a.N,h=g?g.split(";"):[];return d=b.parseN(h),0===d.length&&(d=f&&f!==c?f:c?new nb(c,nb.type.EMAIL).defaultName||e:e),d}function H(a){var b,c=a,d="",e="";return jb.isString(c)&&(c=c.split(";")),5===c.length&&(d=c.join(";"),b=/[a-zA-Z]+/.test(d),e=b?kb.trim([c[3],c[1],c[2],c[0],c[4]].join(" ")):kb.trim([c[3],c[0],c[2],c[1],c[4]].join(""))),kb.trim(e)}function I(a){var b,c=a,d="",e="";return jb.isString(c)&&(c=c.split(";")),7!==c.length?c.join(" "):(d=c.join(";"),b=/.*[\u4e00-\u9fa5]+.*$/.test(d),e=b?kb.trim([c[0],c[1],c[2],c[3],c[6]].join(" ")):kb.trim([c[3],c[2],c[1],c[0],c[6]].join(" ")),kb.trim(e))}function J(a){var b,c,d=this,e=d.data.extDataMap.email,f=a.name,g=a.address,h=a.force;return f||(f=nb.getDefaultName(g)),g&&(g===$S("uid")?f="我":("2"===ob.get({field:"ntes_option",flag:"sendershow"})||h)&&(b=e[g.toLowerCase()],b&&b.length>0&&(c=d.getGivenName(b[0]),f=c?c:f))),f.replace(/^[+|-]/,"")}function K(a){var b=a.FN||"",c=a.N,d=c?c.split(";"):null;return d?this.parseN(d)||b:kb.trim(b)}function L(a,b){var c=this,d=c.getGivenName(a);b!==d&&(a.N=";"+b+";;;"),a.FN=b}function M(a){var b,c,d,e=[];for(var f in a)d=a[f],d&&f.indexOf("EMAIL")>=0&&("string"==typeof d?c||f!==rb?e.push(d):c=d:jb.isArray(d)&&(d=jb.clone(d),c||f!==rb||(c=d.shift()),e=e.concat(d)));return c&&e.unshift(c),b=e.join("@@").toLowerCase(),b.split("@@")}function N(a,b){var c,d=this.data.extDataMap.email[a.toLowerCase()];if(d)if(b&&d.length>1){for(var e=0,f=d.length;f>e;e++)if(d[e].MARKED){c=d[e];break}c||(c=d[0])}else c=d[0];return c}function O(a,b){var c=this,d=c.data.extDataMap.groupArray,e="";if(a=kb.trim(a)){for(var f,g=0,h=d.length;h>g;g++)if(f=d[g],f.N===a){e=f.CID;break}}else e="zall";e.length>0?b(e):c.addGroup({name:a,call:function(a){if(a){var d=c.data.extDataMap.group[a.returns[0]];d&&("null"===d.UID&&delete d.UID,b(d.CID,!0))}}})}function P(a,b){for(var c,d,e,f,g=this,h=g.data.extDataMap.email,i=0,j=$S("uid"),k=0,l=a.length;l>k;k++)c=a[k],d=(c.address||"undefined").toLowerCase(),e=h[d],e&&(e=e[0]||e,i++,c.exist=!0,b&&(f=d===j?"我":g.getGivenName(e),f&&(c.name=f)));return{data:a,exist:i,inexist:a.length-i}}function Q(a,b,c){var d=this,e=d.getGivenName(a);b=b||d.getContactEmails(b)[0]||"";var f="&lt;",g="&gt;";return c&&(f="<",g=">"),e||(e=b.split("@")[0]||""),b===$S("uid")&&(e="我"),e+(b?f+b+g:"")}function R(a){var b=this,c=a.key||"",d=[],e=new RegExp("("+c+")","i"),f='<b class="nui-txt-mark">$1</b>';return lb.each(b.data.rawDataArray.contact,function(a,c){var g=!1,h={id:c.CID,name:"",address:"",perAddress:"",contact:c},i=b.getContactEmails(c),j=i[0]||"";h.perAddress=j;var k=c.N;k.split(";");var l=b.getGivenName(c);e.test(l)?(h.name=l.replace(e,f),g=!0):h.name=kb.encodeHTML(l),e.test(j)?(h.address=j.replace(e,f),g=!0):h.address=j;var m;if(g)d.push(h);else for(var n in c)if("CID"!==n&&"GROUPING"!==n)if(m=c[n],jb.isString(m)){if(g=e.test(m)){d.push(h);break}}else if(jb.isArray(m)){for(var o=0,p=m.length;p>o;o++)if(g=e.test(m[o])){d.push(h);break}if(g)break}}),d}function S(a){var b=this,c=b._getReg(a.key),d=b._getReg(a.key,!0),e=a.contact,f=a.fields||[],g=a.extDataMap,h=!1;b.getGivenName(e);var i,j,k,l,m;try{if(f.length>0)for(l=0,m=f.length;m>l;l++){if(i=e[f[l]],jb.isString(i)&&(h=c.test(i))){h=d.test(i)?1:h;break}if(g){k=g[e.CID];try{if(i=k[f[l]],jb.isString(i)&&(h=c.test(i))){h=d.test(i)?1:h;break}}catch(n){}}}else for(var o in e)if(i=e[o],"CID"!==o&&"Grouping"!==o&&"GROUPING"!==o&&"UID"!==o&&"REV"!==o&&"MARKED"!==o){if("string"==typeof i)h=c.test(i);else if(jb.isArray(i))for(l=0,m=i.length;m>l&&(j=i[l],"string"!=typeof j||!(h=c.test(j)));l++);if(h){h=d.test(i)?1:h;break}if(g){k=g[e.CID];try{for(var p in k)if(i=k[p],jb.isString(i)&&(h=c.test(i)))break}catch(n){}}if(h){h=i&&d.test(i)?1:h;break}}}catch(n){}return h}function T(a){var b=this,c=a.contacts||b.data.rawDataArray.contact,d=[];try{for(var e,f=0,g=c.length;g>f;f++){var h=c[f];e=b.search({key:a.key,contact:h,fields:a.fields,extDataMap:a.extDataMap}),e&&d[e===!0?"push":"unshift"](h)}}catch(i){}return d}function U(a){var b,c,d=this.data.extDataMap,e=a.id,f=a.name;if(e){b=d.group;var g=b[e];if(g)return g.CONTACTS.length}else if(f){c=d.groupArray;for(var h,i=0,j=c.length;j>i;i++)if(h=c[i],h.N===f)return h.CONTACTS.length}}function V(a){function b(a){for(var b,d,e=c.data.extDataMap.email,f=[],g=0,h=a.length;h>g;g++)if(b=kb.trim(a[g]),d=e[b])f.push(d[0]);else{var i={};i[rb]=b,f.push(i)}return f}var c=this,d=c.data.recentContacts;if(!mb.contact_record)return null;if(d)a.call(d);else try{c._action||c.init(),c._action.getRecentContact({limit:20,call:function(e){d=e.responseData||[],c.data.recentContacts=b(d),a.call(c.data.recentContacts)},error:function(){}})}catch(e){}}function W(a){var b="|";return(b+this._cloneList.join(b)+b).indexOf(b+a+b)>-1}function X(a){var b=this;a.group===c?b.getGroupId(a.folder,function(c,d){a.group=c,d&&(a.newGroup=!0),b._action.contactClone(a)}):b._action.contactClone(a)}function Y(b,c){var d,e,f=this,g=f.getCloneInfo(c);if(!g)return d={id:"addrCloneMBox",type:"prompt",inSubject:"请输入上图中看到的字符",header:"输入验证码",content:'<img alt="校验码图片" id="imgVerify" src="'+nb.getUrl("address_cloneimg")+"&rnd="+(new Date).valueOf()+'" ></img>',ok:function(a){var c=kb.trim(a);return c?(b.verifyCode=c,f.contactClone(b),void 0):"(验证码不能为空)"},cancel:function(){a.Tips.loading()},close:function(){a.Tips.loading()}},new a.Msgbox(d),void 0;if(!g.suc){try{g.code,kb.trim(b.username.split("@")[1])}catch(h){}b.newGroup&&f._action.removeGroup({data:{contactIds:[b.group]}}),b.callback(g)}e=f.data.extDataMap[b.group],e&&(g.count+=e.CONTACTS.length),g.suc&&c&&f._action.getData({call:function(){b.callback&&b.callback(g)},error:function(){}})}function Z(a){var b="",c=!1;if(a.code){var d="抱歉，",e=d+"复制通讯录失败";switch(a.code){case 1:b="帐号不存在";break;case 2:b=e;break;case 3:return!1;case 4:b=e;break;case 5:b="请求不合法";break;case 6:b=d+"此邮箱暂时不支持通讯录复制";break;case 7:b=d+"登陆次数过于频繁，请稍候再试";break;case 8:b=a.desc||e;break;case 501:b=d+"权限不足，请求失败";break;case 502:b=d+"通讯录已满，暂无法复制更多数据";break;case 503:b=d+"通讯录已满，暂无法复制更多数据";break;case 505:b=e;break;case 509:b=d+"没有可以复制的联系人数据";break;default:b="链接超时，可能是网络问题引起，请重试"}}else c=!0,b+=a.addedcnt?"恭喜，成功复制"+a.addedcnt+"条，保存在通讯录分组中！":"本次没有新增记录，您可进入通讯录分组中新建联系人。",a.existcnt>0&&(b+="有"+a.existcnt+"条联系人已存在于现有通讯录中，",b+=a.replacedcnt>0?"已覆盖。":"没有再次导入。");return{code:a.code,suc:c,msg:b,count:a.addedcnt||0}}function $(b){function d(d){var e=$C("contactDialogEmail"),f=$C("contactDialogCell"),h=$C("contactDialogMarked"),j=kb.trim($C("contactDialogName").getValue()),k=kb.trim(e.getValue()),l=kb.trim(f.getValue()),m=h.getChecked(),n=[],o=$C("contactDialogGrps").getValue();e.hideTips();for(var r in o)n.push(o[r]);if(d)return{id:s,name:j,email:k,phone:l,grouping:n.join(";")};if(!k){e.showTips("请输入联系人的Email地址");try{e.focus()}catch(t){}return!0}if(l.length>20){f.showTips("手机/电话长度不能超过20个字符");try{f.focus()}catch(t){}return!0}return j||(j=k.split("@")[0]),i[q?"updateContact":"addContact"]({contacts:[{id:s,name:j,email:p?c:k,phone:l,group:n,mark:m,marked:m?i.getMarkSort():c}],call:function(a){b.callback&&b.callback({id:a[0],name:j,address:k}),g.close()},error:function(c){return"email"===c.type?(e.showTips(c.content),void 0):(a.Msgbox.show({content:"抱歉，"+c.content,ok:function(){c.dataErr||i.contactDialog(b)}}),void 0)}}),!0}function e(){if(!r){r=!0;var b=$C("contactDialogAddGrpIpt"),c=$C("contactDialogAddGrpSubmit"),d=$C("contactDialogAddGrpCancel"),e="#contactDialogAddGrpInfo";c.hide(),d.hide(),a.fly(e).show(),i.addGroup({name:kb.trim(b.getValue()),call:function(b){a.fly(e).hide(),c.show(),d.show();var f=b.returns[0],g=i.data.extDataMap.group[f];$C("contactDialogGrps").add({text:kb.encodeHTML(g.N),value:g.CID,checked:!0}),a.fly("#contactDialogAddGrpDiv").hide(),a.fly("#contactDialogAddGrpP").show(),r=!1},error:function(f){a.fly(e).hide(),c.show(),d.show(),b.showTips(f.content),b.select();var g=b.getEl().dom,h=g.parentNode.offsetTop-8;h>0&&(g.parentNode.parentNode.scrollTop=h),r=!1}})}}var f,g,h,i=this,j=b.addr,k=i.data.extDataMap.groupArray,l=i.data.extDataMap.contact,m=i.data.delayedContact,n=[],o=[],p=b.disabled,q="modify"===b.type,r=!1,s="",t="",u="",v="",w=!1;if(!i.dataInited)return i._addInitCall(a.Function.bind(i.contactDialog,i,b)),void 0;if(j){if(s=j.CID||j.id,s&&(m[s]||!l[s]))return i.registerContact({UID:s,call:function(a){j.id=a.CID,i.contactDialog(b)}}),void 0;var x=pb.getModule();if(x&&"contact.ContactModule"===x.mtype)return $E(["interface.AddressInterface"],function(a){a.contactModify({id:s})}),void 0;t=j.name||t,u=j.email||u,v=j.phone||v,w=j.marked||!1}if(q){if(f=l[s],!f)return b.type="add",i.contactDialog(b),void 0;p=!0,h="快速修改联系人",s=f.CID,n=f.GROUPING.split(";"),t=i.getGivenName(f)||t,u=u||i.getContactEmails(f)[0],v=v||f["TEL;type=CELL;type=VOICE;type=pref"],w=f.MARKED}else p=!1,h="快速添加联系人";for(var y,z=0,A=k.length;A>z;z+=1)y=k[z],y.N&&"OTHERS"!==y.CID&&"ALL"!==y.CID&&o.push({text:kb.encodeHTML(y.N),value:y.CID,checked:lb.has(n,y.CID)});var B=['<div class="nui-simpleForm nui-form">',"<table>","<tbody>","<tr>",'<th class="nui-form-title">姓名</th>','<td class="nui-form-cont">',a.Input.html({id:"contactDialogName",value:t,width:"250px"}),"</td>","</tr>","<tr>",'<th class="nui-form-title">邮箱地址</th>','<td class="nui-form-cont">',a.Input.html({id:"contactDialogEmail",value:u,disabled:p,width:"250px"}),"</td>","</tr>","<tr>",'<th class="nui-form-title">手机/电话</th>','<td class="nui-form-cont">',a.Input.html({id:"contactDialogCell",value:v,width:"250px"}),"</td>","</tr>","<tr>",'<th class="nui-form-title"></th>','<td class="nui-form-cont">',a.Checkbox.html({id:"contactDialogMarked",checked:w,text:"设为星标联系人"}),"</td>","</tr>","<tr>",'<th class="nui-form-title">分组</th>','<td class="nui-form-cont">','<div class="cE0 nui-scroll">',a.CheckGroup.html({id:"contactDialogGrps",checkType:"checkbox",items:o}),'<p id="contactDialogAddGrpP">',a.Link.html({text:"添加分组",cls:"nui-txt-link",click:function(){var b=$C("contactDialogAddGrpIpt");b.hideTips(),b.setValue(""),a.fly("#contactDialogAddGrpP").hide(),a.fly("#contactDialogAddGrpDiv").show();var c=b.getEl().dom,d=c.parentNode.offsetTop-8;d>0&&(c.parentNode.parentNode.scrollTop=d),b.focus()}}),"</p>",'<div id="contactDialogAddGrpDiv" style="margin-bottom:2px;display:none;">',a.Input.html({id:"contactDialogAddGrpIpt",width:"150px"}),a.Link.html({id:"contactDialogAddGrpSubmit",text:"确定",cls:"nui-txt-link",click:e}),'<span id="contactDialogAddGrpInfo" class="nui-txt-tips" style="display:none;">通讯中...</span>',"&nbsp;&nbsp;",a.Link.html({id:"contactDialogAddGrpCancel",text:"取消",cls:"nui-txt-link",click:function(){a.fly("#contactDialogAddGrpDiv").hide(),a.fly("#contactDialogAddGrpP").show()}}),"</div>","</div>","</td>","</tr>","</tbody>","</table>","</div>"].join("");g=new a.Msgbox({type:"confirm",contentType:"normal",header:h,content:B,footer:{xtype:"link",text:"去通讯录编辑更多&gt;&gt;",cls:"nui-txt-link",hidden:sb.newwin,click:function(){$E(["interface.AddressInterface"],function(a){a.contactModify(d(!0)),g.close()})}},ok:d}),a.Component.setEvents(10)}function _(b){function c(){var a,b,c=$C("contactSelGroup"),e=c.getValue(),f=[],i=[];for(var j in k){if(j=kb.decodeHTML(j),b=nb.getAddress(j),a={name:nb.getDefaultName(j),email:nb.getAddress(j,!0)},!a.email){var l=nb.getEmails(j,"Email",!0);l.match.length>0&&(a.email=l.match[0].address,a.name=l.match[0].defaultName)}a.name||(a.name=a.email.split("@")[0]),"-1"!==e&&(a.group=[e]),document.getElementById("chk_"+b).checked&&(k[j]||f.push(a),i.push(b))}var m;if(0===f.length+i.length)m="请选择需要保存的联系人。";else if("-2"==e){m="请选择联系人分组。";try{$C("contactNewGroupInput").focus()}catch(o){}}return m?(n.footer.html('<span class="nui-txt-err">'+m+"</span>"),!0):(f.length>0&&h.addContact({contacts:f,call:g,error:function(a){n.footer.html('<span class="nui-txt-err">'+a.content+"</span>")}}),i.length>0&&d(i,e),void 0)}function d(a,b){if("-1"===b)return j({code:tb}),void 0;var c=h.data.extDataMap.email,d=[];lb.each(a,function(a,e){try{var f,g=c[e];if(g){f=g[0];var i=f.GROUPING.split(";");lb.has(i,b)||(i.push(b),d.push({id:f.CID,group:i,name:h.getGivenName(f)}))}}catch(j){}}),d.length>0?h.updateContact({contacts:d,call:g,error:function(a){n.footer.html('<span class="nui-txt-err">'+a.content+"</span>")}}):g()}function e(a){var b=[],c=h.data.extDataMap.groupArray;return a+="",lb.each(c,function(c,d){"ALL"!==d.CID&&"OTHERS"!==d.CID&&b.push({text:kb.escapeHTML(kb.left(d.N,30))+(kb.len(d.N)>30?"...":""),value:d.CID,checked:d.CID===a})}),b.unshift({text:"默认分组",value:"-1"}),b.push({text:"添加分组",value:"-2"}),{id:"contactSelGroup",title:"选择分组",options:b,selectedchange:f}}function f(a){var b=this,c=$C("contactNewGroupInput"),d=$C("contactNewGroupButton");"-2"===a?(c.setValue(""),c.show(),d.show(),c.focus()):(a||b.setSelected(0),c.hide(),d.hide())}function g(){j({code:tb})}var h=this,i=b.data,j=b.callback,k={},l={},m=$S("uid");h.data.extDataMap.email;var n,o,p,q=[],r=[],s=[];if(!h.dataInited)return h._addInitCall(a.Function.bind(h.contactListDialog,h,b)),void 0;if(!jb.isArray(i)||0===i.length)return g({code:!1,msg:"没有其他联系人可以添加！"}),void 0;a.Array.each(i,function(b,c){return c=(c+"").toLowerCase(),p=nb.getAddress(c).toLowerCase(),p||(p=nb.getEmails(c,"Email",!0).match[0]),!p||l[p]?a.CONTINUE:(l[p]=!0,k[c]||c===m||(k[c]=!!h.getAddrObj(p)),void 0)});for(o in k)(k[o]?r:q).push('<li class="cV0 nui-txt-'+(k[o]?"aside":"normal")+'"><label class="nui-chk nui-chk-hasText"><input class="nui-chk-symbol" type="checkbox" value="'+nb.getAddress(o)+'"'+(k[o]?"":' checked="true"')+' id="chk_'+nb.getAddress(o)+'"></input><span class="nui-chk-text">'+kb.escapeHTML(o)+(k[o]?"(已存在)":"")+"</span></label></li>");s=q.concat(r);var t=['<ul class="cY0 nui-scroll">',s.join(""),"</ul>",'<div class="nui-txt-normal cA0">',"将以上联系人加入到分组：",'<div class="nui-item nui-item-spc2x ">',"<span>",a.Select.html(e()),"</span>",a.Input.html({id:"contactNewGroupInput",hidden:!0}),a.Button.html({id:"contactNewGroupButton",text:"添加",subclass:"inputBtn",click:function(){var a=this,b=$C("contactNewGroupInput"),c=kb.trim(b.getValue());h.addGroup({name:c,call:function(c){a.hide(),b.hide(),$C("contactSelGroup").update(e(c.returns[0])),n.footer.empty()},error:function(a){n.footer.html('<span class="nui-txt-err">'+a.content+"</span>"),b.focus()}})},hidden:!0}),"</div>","</div>"].join("");n=new a.Msgbox({type:"confirm",contentType:"wide",header:"保存联系人",content:t,ok:c}),a.Component.setEvents(10)}function ab(b){function c(){var a=this;""===kb.trim(kb.trim(a.getValue()))&&g(a)}function d(b){var c=this;b=a.Event.getEvent(b);var d=b.keyCode.toString();return"27"===d||27===d?(c.setValue(""),!1):void 0}function e(){var b=this,c=kb.trim(b.getValue()),d=a("#"+t);return""===c||c===w?!1:(v||($C(s).hide(),d.show()),d.html('<div class="nui-assistBlock nui-block nui-contacts-search-tit">正在搜索...</div>'),h(c),b.iconBtn.update({type:"close"}),v=!0,d.destroy(),void 0)}function f(){var a=this;v&&g(a)}function g(b){var c=a("#"+t);b.setValue(""),b.iconBtn.update({type:"search"}),c.hide(),$C(s).show(),c.empty(),x.length=0,w="",v=!1,c.destroy()}function h(b){var c,d=o.data.rawDataArray.contact,e=[],f=[];u={},c=w.length>0&&b.length>0&&0===b.indexOf(w)?x:d;for(var g,h,j,k=0,l=c.length;l>k;k++)g=c[k],j=o.getContactEmails(g)[0]||"",h=o.getGivenName(g)||j.split("@")[0]||"",(h||j)&&(h.indexOf(b)>-1||j.indexOf(b)>-1)&&(e.push(g),u[g.CID]={name:h,email:j},f.push(i(b,{id:g.CID,name:h,email:j})));x=e,w=b,0===f.length&&f.push('<div class="nui-assistBlock nui-block nui-contacts-search-tit">没有搜索到有关“<strong>'+b+"</strong>”的联系人</div>"),a.fly("#"+t).html(f.join(""))}function i(a,b){var c=kb.encodeHTML(b.name),d=kb.encodeHTML(b.email),e=o._getReg(a);return['<a id="'+t+"__"+b.id+'" class="nui-contacts-search-item" href="javascript:void(0)" title="&quot;'+c+"&quot;"+"&lt;"+d+"&gt;"+'">','<strong class="nui-tree-item-text">',a?c.replace(e,j):c,"</strong>",'<p class="nui-tree-item-text">&lt;',a?d.replace(e,j):d,"&gt</p>","</a>"].join("")}function j(a){return'<b class="nui-txt-mark">'+a+"</b>"}function k(b,c){var d=b,e="",f=a.Element.create("span");for(f.setClass("txt-info"),f.css({visibility:"hidden"}),a.JS.container.appendChild(f.dom);f&&kb.len(d)>0;){var g=d+e;f.html(kb.escapeHTML(g));var h=parseInt(f.dom.offsetWidth,10);if(c>=h)return f.empty(),f.remove(),g;var i=Math.floor((h-c)/(h/g.length))||1;d=d.substr(0,d.length-i),0!==e.indexOf("..")&&(e="..")}}var l,m,n,o=this,p=o.data.extDataMap.groupArray,q=b.renderTo,r="contactSelector_"+((new Date).getTime()+""),s=r+"_tree",t=r+"_search",u={},v=!1,w="",x=[];if(!o.dataInited)return o._addInitCall(a.Function.bind(o.contactSelector,o,b)),null;if(!(q instanceof a.Element||(q=jb.isString(q)?a("#"+q):a(q),q&&q.append)))return null;l=a.Element.create("div"),m={id:s,items:[],isRoot:!0,extcls:"nui-simpleTree"};for(var y,z,A,B,C=0,D=p.length,E=m.items;D>C;C++)if(y=p[C],"ALL"!==y.CID){z=y.CONTACTS||[],A={text:k(y.N||"未命名分组",120),items:[],isFold:!0},B=A.items;for(var F,G,H,I=0,J=z.length;J>I;I++)if(F=z[I]){if(G=o.getGivenName(F)||"",H=o.getContactEmails(F)[0]||"",!G){if(!H)continue;G=H.split("@")[0]}B.push({text:G,click:a.Function.bind(b.call,b,{id:F.CID,name:G,email:H})})}(0!==B.length||"OTHERS"===y.CID)&&(A.extItems=[{xtype:"link",text:"("+B.length+")"}],E.push(A))}1===E.length&&"未分组"===E[0].text&&(E[0].text="所有"),n={placeholder:"查找联系人",iconBtn:"search",extcls:"nui-contacts-input",blur:c,keydown:d,keyup:e,iconbtnclick:f},l.setClass("nui-contacts"),l.html([a.Input.html(n),'<div class="nui-contacts-list nui-scroll">',a.Tree.html(m),'<div id="'+t+'" class="nui-contacts-search" style="display:none;"><div class="nui-assistBlock nui-block nui-contacts-search-tit">正在搜索...</div></div>',"</div>"].join("")),q.append(l.dom),a.Component.setEvents(10),a.fly("#"+t).listen("click",function(){var c,d,e,f=a.Event.getTarget();f&&("a"===f.nodeName.toLowerCase()?d=f.id:(c=a(f).findParent("a"),f=c?c.doms[0]:f,c&&(f=c.doms[0],c.destroy()),f&&(d=f.id))),d&&(d=d.split("__")[1],d&&(e=u[d],e.id=d,b.call(e)))}),q.destroy()}function bb(b,c,d,e){var f="。";e=e||{},b?a.Tips.show({text:c+"成功!",type:"suc"}):(e.dataErr=!0,e.content&&(f="："+e.content),a.Tips.show({text:c+"失败"+f,type:"err"})),d&&d(e)}function cb(a){var b,c=this,d=c.data.extDataMap.contactLiteArray||[],e=[];if($S("isCorp"))var e=c.entData.rawDataArray.contact||[];var f="corp"===a?e:"all"===a?d.concat(e):d;if(!ub)return f;for(var g=0,h=f.length;h>g;g++)b=f[g],ub&&!b.py&&b.name&&(b.py=hb.getPy(b.name).toLowerCase(),b.fpy=hb.getPy(b.name,!0).toLowerCase());
return f}function db(a){var b=this;return b.dataInited?(a(),void 0):(b._addInitCall(a),void 0)}function eb(b){function c(a){var b,c=e.getContactEmails(a)||[],d=c[0]||null,g=a.CID||null;return b=g?e.getGivenName(a)||"未命名":d?d.substring(0,d.indexOf("@")):"未命名",{cid:g,marked:+a.MARKED||null,email:d,emails:1!==c.length||d?c:[],name:b,yellowPage:g?f.extDataMap.yellowPage[g]||null:null}}function d(a){var b=[];return lb.each(f.extDataMap.group[a.CID].CONTACTS,function(a,d){b.push(c(d))}),{cid:a.CID,marked:+a.MARKED,name:a.N||"未命名",ctype:"group",contacts:b}}var e=this,f=e.data;if(!b&&f.extDataMap.dataMark)return f.extDataMap.dataMark;f.extDataMap.contact;var g,h=[],i=[];if(e.dataInited){lb.each(f.extDataMap.contactMark,function(d,e){if(g=c(e),b)i.push(g);else{if(0===g.emails.length)return;var f;lb.each(g.emails,function(b,c){return a.Uri.getEmails(c).wrong.length>0?(f=!0,a.BREAK):void 0}),f||i.push(c(e))}}),lb.each(f.extDataMap.groupMark,function(a,b){i.push(d(b))}),lb.each(f.recentContacts,function(a,b){b.MARKED||h.push(c(b))}),i.sort(function(a,b){return a.marked-b.marked});var j={contact:i,recommend:h,contactCount:f.extDataMap.contactLiteArray.length};return b||(f.extDataMap.dataMark=j),j}}function fb(a){var b=this;b.data.extDataMap.group;var c=a.GROUPING||a.Grouping||"";return c}function gb(b){try{var c=this,d=c.getMarkData(),e=d.contact,f={},g={},h=!1;if(e&&e.length>0)for(var i=0,j=e.length;j>i;i++){var k=e[i],l=k.emails;if(l)for(var m=0,n=l.length;n>m;m++)f[l[m].toLowerCase()]=!0,h=!0}var o={},l=[],p={};try{for(var m=0,n=b.length;n>m;m++)try{var q=b[m],r=q.rawConfig;try{var s=a.String.trim(r.address.toLowerCase());if(s){p[s]||(l.push(s),o[s]=[],p[s]=!0);var t=o[s];t.push(q),f[s]!=r.contact&&(g[s]=!0)}}catch(u){}}catch(u){}}catch(u){}if(l.length>0)for(var i=0,j=l.length;j>i;i++)try{var s=l[i].toLowerCase(),v=g[s];if(v)for(var t=o[s],m=0,n=t.length;n>m;m++){var q=t[m],r=q.rawConfig;r.contact=!r.contact,q.update({})}}catch(u){}}catch(w){}}var hb,ib,jb=a.Object,kb=a.String,lb=a.Array,mb=a.Ext,nb=a.Uri,ob=a.Ud,pb=a.Context,qb=a.Listener,rb=a.EMAIL_ADDRESS,sb=$G.common,tb=a.S_OK,ub=!a.Browser.isIE("<9");try{ib=$L("support.AddressSupportAction"),hb=$L("support.PyDict")}catch(vb){return vb}var wb=a.createClass($N("support.AddressSupport"));a.AddressSupport=wb,jb.extend(wb,{forceUseLocalStorage:!1,_action:null,_localVer:"5.0.1",_localKey:a.ADDR_LOCAL_KEY,_cloneList:a.ADDR_CLONE_LIST,_initCalls:[],dataInited:!1,_formatTimerId:1,_initData:d,_formatData:e,_formatGroupData:f,_formatContactData:g,_updateData:h,_formatYellowPageData:i,_formatFrequentContacts:j,_getReg:k,_addInitCall:l,getMarkSort:m,data:{ver:null,rawDataArray:{contact:[],group:[],attach:[],limitinfo:{}},extDataMap:{contact:{},contactLite:{},contactLiteArray:[],email:{},group:{},groupArray:[],yellowPage:{},contactMark:[],groupMark:[],dataPhone:{},dataMark:null},cache:{nameCache:{},addrCache:{}},maxMarkSort:0,recentContacts:null,delayedContact:{}},checkLocalState:n,getLocalData:o,setLocalData:p,readLocalData:q,updateLocalData:r,clearLocalData:s,getDataVersion:t,resetLocalStorage:u,init:v,resetData:w,addGroup:x,addContact:y,updateContact:z,markData:A,deleteContact:B,deleteContactAttr:C,addExtContact:D,registerContact:E,showError:F,parseName:G,parseN:H,parseADR:I,getName:J,getGivenName:K,setGivenName:L,getContactEmails:M,getAddrObj:N,getGroupId:O,mappingEmails:P,toAddrString:Q,simpleSearch:R,search:S,searchContacts:T,getGroupLength:U,getRecentContact:V,clonePermitCheck:W,contactClone:X,cloneResponse:Y,getCloneInfo:Z,contactDialog:$,contactListDialog:_,contactSelector:ab,dataCall:bb,getContactLiteArray:cb,dataInitCall:db,getMarkData:eb,fixedGroupingCid:fb,mark:gb})}($,window),function(){function a(a){var b,c=this;b=l.signFilter?{filterHtml:!0}:{},this.wmsvr({func:"user:getSignatures",body:b,call:function(b){var d=b["var"];"2"===$.Ud.get({field:"ntes_compose",flag:"card"})&&$.Array.each(d,function(a,b){return b.isDefault?(b.isDefault=!1,c.wmsvr({func:"user:updateSignatures",body:{items:[b]},call:function(){}}),$.BREAK):void 0}),a(d)},error:function(){a(!1)}})}function b(a,b){var c=this,d=function(d){if(d["var"].length>=a.limit)return b({overflow:!0}),void 0;var e={items:[{name:a.name,disabled:!1,"continue":!0,condictions:[{field:"from",disabled:!1,operator:"contains",operand:a.operand,ignoreCase:!1},{field:"accounts",disabled:!1,operator:"contains",operand:a.accounts}],actions:[{type:"move",disabled:!1,target:a.fid}]}]};c.wmsvr({func:"user:addMailRules",body:e,call:b})};c.wmsvr({func:"user:getMailRules",body:{},call:d})}function c(a){var b=this;b.wmsvr({func:"user:getMailRules",body:{},call:function(b){a&&a(b["var"])}})}function d(a){this.wmsvr({func:"global:sequential",body:{items:[{func:"user:getAttrs","var":{attrIds:["autorepmode","autoreptext"]}},{func:"user:getMailRules","var":{category:"autoreply"}}]},call:a})}function e(a){$.Ajax.jsonp(m.getUrl("getMobileServiceNo")+"&product=fw",function(b){a(b)})}function f(a,b){var c=m.getUrl("smsPushVerifyCode");c=$.String.uriAddParam(c,"mobile="+a+"&product=fw"),$.Ajax.jsonp(c,function(a){b(a)})}function g(a,b,c){var d=m.getUrl("smsVerifyCode");d=$.String.uriAddParam(d,"mobile="+a+"&product=fw&vcode="+b),$.Ajax.jsonp(d,function(a){c(a)})}function h(a,b,c){var d=m.getUrl("mobile_bind_send");d="lotteryPopup"==c?$.String.uriAddParam(d,"mobile="+a+"&from=webmail_web_cphongbao"):$.String.uriAddParam(d,"mobile="+a+"&from=webmail_wel_sectips"),$.Ajax.jsonp(d,function(a){b(a)},"cb")}function i(a,b,c,d){var e=m.getUrl("mobile_bind_verify");e="lotteryPopup"==d?$.String.uriAddParam(e,"mobile="+a+"&vcode="+b+"&from=webmail_web_cphongbao"):$.String.uriAddParam(e,"mobile="+a+"&vcode="+b+"&from=webmail_wel_sectips"),$.Ajax.jsonp(e,function(a){c(a)},"cb")}var j=$I("core.DataAction"),k=$.createClass($N("support.OptionSupportAction")),l=$.Ext,m=$.Uri;$.Object.inherit(k,j),$.Object.extend(k.prototype,{getPhoneStatue:e,sendPhoneVerifyCode:f,verifyCode:g,getSignList:a,addMailFilter:b,getMailFilter:c,getAutoReply:d,sendMobileCode:h,verifyMobileCode:i})}(),function(a,b,c){function d(b){function d(){g[b.field]=f,b.callback&&b.callback(b),b.call&&b.call(b);var a=b.module;if(a&&!b.noFire?C.fire("options:"+a+"Modify",[b]):C.fire("options:modify",[b]),b.relModule&&b.relModule.length>0)for(var c=0,d=b.relModule.length;d>c;c++)C.fire("options:"+b.relModule[c]+"Modify",[b])}function e(){g[b.field]=j,b.err&&b.err(b),b.errcallback&&b.errcallback(b)}var f,g=$S("attrs").user,h=a.Object.clone(b),i=!1,j=g[h.field];if(h&&h.flag)if("translate"==h.flag){var f=j.substr(0,2)+h.value+j.substr(3);g.ntes_labs=f,($S("is126")||$S("is163"))&&g.ntes_labs!==c&&(z.readTran=g.ntes_labs.charAt(2)-0>0,a.Ajax.request({url:"http://lab.mail."+$S("domain")+"/labweb/lab.do?m=submit&id=2&act="+(z.readTran?"enable":"disable")+"&uid="+$S("uid")+"&sid="+$S("sid")+"&host="+$S("host"),requestType:a.Ajax.SCRIPT,paddingParam:"jsonp",paddingFunc:function(){}}))}else f=B.set({field:h.field,flag:h.flag,value:h.value,notPost:!0});else f=h.value;if(f!=j&&(i=!0),i){var k={};k[h.field]=f,this.action.wmsvr({func:"user:setAttrs",body:{attrs:k},call:d,error:e})}}function e(a,b){function c(b){if(b&&(F.signList=b,!z.signFilter))for(var c=0;c<F.signList.length;c++)F.signList[c].content=F.signList[c].content.replace(/<iframe.+?<\/iframe>/i,"");a(b)}b||!F.signList?F.action.getSignList(c):a(F.signList)}function f(b,c){function d(a){return/^\S+\.\S+$/.test(a)||A.matchEmail(a)}function e(b){if(b.length>0){for(var c,e=b.split(","),f=[],g=e.length-1;g>=0;g--)c=a.String.trim(e[g]),d(c)&&f.push(c);return f}return[]}var f,g=b.name,h=b.value,i=$S("attrs").user[g]||"",j=[];f="refuselist"==g?$S("attrs").user.safelist:$S("attrs").user.refuselist;for(var k,l=e(i),m=e(f),n=e(h),o=!0,p="添加失败。",q=0;q<n.length;q++)if(k=n[q],d(k)){if(a.Array.has(l,k))p+=k+"已经存在。<br/>";else if((i+k).length>4e3){var r="safelist"==g?"白":"黑";p+=r+"名单超过限制。<br/>"}else if("refuselist"!=g||k!=$S("uid")){if(a.Array.has(m,k)){if(!b.forceAdd){var r="safelist"==g?"黑":"白";return new a.Msgbox({title:a.String.escapeHTML(k)+"已经存在于"+r+"名单中，请先在"+r+"名单中删除后再添加。"}),c&&c(!1),void 0}F.removeList({name:"refuselist"==g?"safelist":"refuselist",value:k})}l.push(k),j.push(k),o=!1}}else p+=k+"不是合法的Email地址或域名。<br/>";return o?(b.noErr||new a.Msgbox({title:p}),"function"==typeof c&&c(!1,p),void 0):(i=l.join(","),B.set({field:g,value:i,call:function(a){a.code==E.S_OK?($S("attrs").user[g]=i,c(!0,j.join(","))):c(!1)}}),void 0)}function g(b,c){var d=b.name,e=b.value,f=$S("attrs").user[d],g=function(b,c){c=a.String.trim(c);for(var d=f.length>0?f.split(","):[],e=0,g=d.length;g>e;e++)if(a.String.trim(d[e])==c){d.splice(e,1);break}f=d.join(",")};f.length>0&&e.length>0&&a.Array.each(e.split(","),g),B.set({field:d,value:f,call:function(a){a.code==E.S_OK?($S("attrs").user[d]=f,c(!0)):c(!1)}})}function h(a){return y.getDefined(a)}function i(a,b){$E(["module.options.CommonAction"],function(c){c.setAttrs({attrs:{true_name:a,displaysender:0},call:function(){var c=$S("attrs").user;c.true_name=a,c.displaysender=0,b(!0)},error:function(){b(!1)}})})}function j(a,b){B.set({field:"ntes_defaultsender",value:a,call:function(c){c.code==E.S_OK?($S("attrs").user.ntes_defaultsender=a,b&&b(!0)):b&&b(!1)}})}function k(b){function c(c){if(c.overflow)return new a.Msgbox({type:"confirm",title:"设置出错",content:"抱歉，来信分类规则条数达到上限，无法收取指定联系人邮件到此文件夹。<br/>建议您进行整理，删除可能无用的规则。",okText:"立即整理",ok:function(){$E(["interface.OptionInterface"],function(a){a.goFilter()})}}),void 0;var d=a.JS.modules["options.MailFilterModule"];c.code==E.S_OK&&d&&d.isLoaded&&d.getData(d.list.bind(d)),b.callback&&b.callback({code:c.code})}var d=this;d.action.addMailFilter({name:b.name,fid:b.fid,operand:b.email,accounts:b.accounts||[$S("uid")],limit:d.getFliterLimit()},c)}function l(){if($S("isCorp"))return 80;var a=$G.user.cosid||"",b="";switch($S("domain")){case"vip.163.com":b=",72,6,213,73,7,91,90,";break;case"188.com":b=",93,34,251,211,210,94,35,";break;case"vip.126.com":b=",26,25,104,28,27,30,29,"}return b.length>0&&b.indexOf(","+(a+","))>-1?60:30}function m(a){this.action.wmsvr({func:"user:getMailRules",body:{},call:a})}function n(b,c){var d=a.JS.modules["options.MailFilterModule"],e=function(d){var e,f=[];a.Array.each(d,function(c,d){switch(e=d.actions,b.type){case"forward":a.Array.each(e,function(b,c){if("forward"===c.type)throw f.push(d.id),a.$.BREAK})}}),c(f)};d&&d.data?e(d.data):this.action.getMailFilter(e)}function o(a){function b(a){return e.indexOf(a)}var c,d,e=$S("attrs").user.refuselist;return"string"==typeof a?(c=a,d=c.substring(c.indexOf("@"))):(c=a.address,d=a.domain),d="*"+d,0===b(c)||b(","+c)>=0||b(" "+c)>=0||b(d)>=0}function p(){var a=$S("attrs").user;return 1!=a.forwardactive&&2!=a.forwardactive?null:a.forwarddes}function q(a){function b(b){var d=b["var"],e=d[0]["var"]||[],f=d[1]["var"]||[],g=null,h=f.length;if(1==h)g=f[0];else if(h>1){for(var i=null,j=0,h=f.length;h>j;j+=1)i=f[j],i.disabled||(g=i);g=g?g:i}var k,l,m=0;if(1!=e.autorepmode&&g){var n=g.condictions[0]||{},o=g.actions[0]||{};m="boolean"!=typeof g.disabled?1:g.disabled?0:1;var p=o.content;if(1==m&&p&&(c.autoReplayCont=p),"undefined"!=typeof n&&"undefined"!=typeof n.operand){var q=n.operand;if(c.operator=n.operator,1==m)switch(n.operator){case"between":k=q[0],l=q[1];break;case">":k=q;break;case"<":l=q}}}else{m=e.autorepmode||0;var r=e.autoreptext;1==m&&r&&(c.autoReplayCont=r)}0===m?c.autoReplyActive=!1:(c.autoReplyActive=!0,c.start=k,c.end=l),a&&"function"==typeof a.call&&a.call(c)}var c={};F.action.getAutoReply(b)}function r(){var b=$S("attrs").user,c=!1;null===b.junkfilter&&(b.junkfilter=0);var d=b.keepspamdays;d=d>=-1?d:-1;var e=b.junkfilter;if(e=e>-1?e:1,d>0&&0===e&&(c=!0),!c&&z.deliver){var f=B.get({field:"ntes_option",flag:"deliver"})-0;(0!==a.Number.getBit(f,0)||0!==a.Number.getBit(f,1)||0!==a.Number.getBit(f,2))&&(c=!0)}return c}function s(c){function d(){var c;do c="padding"+a.Number.random((new Date).getTime());while(b[c]);return c}var e,f,g,h,i=$I("init.Avatar");c&&(e=c.uploader,f=c.cancel,h=d(),b[h]=function(b){a("#dvAvatarFalsh").hide(),a.Msgbox.msgbox.hide(),"ok"==b?(a.Listener.fire("user:avatarChanged"),e&&e()):"cancel"==b&&f&&f()},$S("isCorp")?i.getCorp({size:180},function(b){var c="http://mail"+$G.environment.uriFix+"."+$S("domain")+"/qiyeface/face/uploadSelfOne";g='<div id="dvAvatarFalsh" style="padding: 20px 0 0 20px;"><embed class="" src="/js6/h/AvatarUploader.swf" flashvars="baseurl='+c+"&amp;callback="+h+"&amp;sid="+$S("sid")+"&amp;imgurl="+encodeURIComponent(b)+'" '+'quality="high" wmode="transparent" allowscriptaccess="always" type="application/x-shockwave-flash" height="420x" width="710px">'+"</embed></div>",a.Msgbox.show({header:"修改头像",contentType:"custom",content:g,height:"452px",width:"730px",noFooter:!0,close:function(){a("#dvAvatarFalsh").hide()}})}):i.get($S("orgUid"),180,function(b){var c="http://config."+$S("fullDomain")+"/settings/face/uploadSelfOne.do";g='<div id="dvAvatarFalsh" style="padding: 20px 0 0 20px;"><embed class="" src="/js6/h/AvatarUploader.swf" flashvars="baseurl='+c+"&amp;callback="+h+"&amp;sid="+$S("sid")+"&amp;imgurl="+encodeURIComponent(b)+'" '+'quality="high" wmode="transparent" allowscriptaccess="always" type="application/x-shockwave-flash" height="420x" width="710px">'+"</embed></div>",a.Msgbox.show({header:"修改头像",contentType:"custom",content:g,height:"452px",width:"730px",noFooter:!0,close:function(){a("#dvAvatarFalsh").hide()}})}))}function t(c){function d(b,c){for(var d=A.getEmails(b),e=d.match,f=e.length,g=[],h=0;f>h;h++)g.push(e[h].address);return""==b?(c.showTips("请输入转发的邮箱地址"),!1):0!=d.wrong.length?(c.showTips("请输入正确的邮箱地址"),!1):a.Array.has(g,$S("uid"))||a.Array.has(g,$S("orgUid"))?(c.showTips("不能输入自己的邮箱地址"),!1):f>1&&($S("isFree")||i)?(c.showTips("您只能填写一个自动转发地址。"),!1):f>2?(c.showTips("您只能填写一到两个自动转发地址。"),!1):a.String.len(b)>248?(c.showTips("转发地址长度超过250个英文字符的限制。"),!1):!0}function e(){j.codeTimer&&b.clearInterval(j.codeTimer),h&&h()}var f,g,h,i,j=this,k=j.action,l="",m=$S("isCorp")?!0:!1;c&&(l=c.forwardAddress,m=c.keepLocal,f=c.preSubmit,g=c.submit,h=c.cancel,i=c.mailRule),k.getPhoneStatue(function(c){var n,o;if(200!=c.code)return a.Msgbox.show({content:"网络繁忙，请稍后再试"}),void 0;if(n=c.data.mobile,o=c.data.count,n&&-1!==n.indexOf("@")&&(n=n.split("@")[0]||""),n){j.randomId=(new Date).getTime();var p='<div class="nui-msgbox-title"><strong>为了避免自动转发可能造成的重要信息泄露，需进行手机短信验证</strong></div><div class="nui-simpleForm nui-form rX1"><table><tbody><tr><th class="nui-form-title">转发到邮箱</th><td class="nui-form-cont">'+a.Input.html({id:"oCompForwardAddress_"+j.randomId,width:"240px",value:l})+'<div class="nui-item">'+a.Checkbox.html({id:"oCompKeepLocal_"+j.randomId,text:"保留原邮件",checked:m})+"</div>"+(i||$S("isFree")?"":'<div class="nui-txt-tips nui-item">提示：最多可设置两个转发地址，用英文逗号(,)隔开即可。</div>')+"</td>"+"</tr>"+"<tr>"+'<th class="nui-form-title">验证码</th>'+'<td class="nui-form-cont">'+a.Input.html({id:"oCompVerifyCode_"+j.randomId,width:"110px"})+a.Button.html({extcls:"nui-inputBtn",text:"免费获取短信验证码",disabled:0===o,click:function(){var c=a.Component.find("#oCompVerifyCode_"+j.randomId),d=this,e=60;k.sendPhoneVerifyCode(n,function(b){200==b.code?(d.getEl().dom.nextSibling.nextSibling.innerHTML="剩余"+b.data.count+"次",0==b.data.count&&a(d.getEl().dom.nextSibling.nextSibling).setAttr({title:"今天验证次数已用完，请明天再试"})):400==b.code?c.showTips("验证短信发送失败"):407==b.code?c.showTips("请求次数过多"):408==b.code&&c.showTips("请求次数过于频繁")}),d.setDisabled(!0),j.codeTimer=b.setInterval(function(){return e--,0>=e?(d.setDisabled(!1),d.setText("免费获取短信验证码"),j.codeTimer&&b.clearInterval(j.codeTimer),void 0):(d.setText(e+"秒后可重新获取..."),void 0)},1e3)}})+'&nbsp;&nbsp;<span class="nui-txt-tips" '+(0===o?'title="今天验证次数已用完，请明天再试"':"")+">剩余"+o+"次</span>"+'<div class="nui-item">接收验证码的手机号：'+(3===n.length?"********"+n:n.slice(0,3)+"*****"+n.slice(8,11))+a.Link.html({text:"修改手机号",click:function(){if(e(),$S("isVip")){var b="vipsms",c="手机服务";$E("interface.OutlinkInterface",function(a){a.goOutlink({key:b,title:c})}),a.Msgbox.msgbox.hide()}else $S("isFree")&&($E("interface.OptionInterface",function(a){a.goOutlink("urs_update_phone")}),a.Msgbox.msgbox.hide())}})+"</div>"+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>";a.Msgbox.show({header:"自动转发设置",icon:{type:"info",extcls:"nui-ico-info-l"},width:"550px",content:p,type:"confirm",ok:function(){var c=a.Component,e="",h=!1,i="";try{var l=c.find("#oCompForwardAddress_"+j.randomId),m=c.find("#oCompKeepLocal_"+j.randomId),o=c.find("#oCompVerifyCode_"+j.randomId);return e=l.getValue(),h=m.getChecked(),i=o.getValue(),d(e,l)?(f&&!j.preSubmited&&(j.preSubmited=!0,f({forwardAddress:e,keepLocal:h})),""==i?(o.showTips("请输入验证码"),!0):(k.verifyCode(n,i,function(c){200==c.code?(g&&g({msas_sig:c.data.msas_sig,msas_ts:c.data.msas_ts,ms_mobile:n,forwardAddress:e,keepLocal:h}),j.codeTimer&&b.clearInterval(j.codeTimer),delete j.preSubmited,a.Msgbox.msgbox.hide()):201==c.code?o.showTips("验证码错误"):407==c.code?o.showTips("验证错误次数过多"):o.showTips("鉴权失败")}),!0)):!0}catch(p){}},listeners:{render:function(){a.Component.setEvents()},close:e,cancel:e}})}else a.Msgbox.show({header:"自动转发设置",title:"为了避免自动转发可能造成的重要信息泄露，请先关联手机号码，并进行短信验证。",type:"confirm",okText:"立即进行手机验证",ok:function(){if($S("isFree"))$E("interface.OptionInterface",function(a){a.goOutlink("urs_setting_phone")});else if($S("isVip")){var a="vipsms",b="手机服务";$E("interface.OutlinkInterface",function(c){c.goOutlink({key:a,title:b})})}h&&h()},cancel:function(){h&&h()}})})}function u(b,c){a.Ajax.request({url:a.Uri.getUrl("settingwithdraw_set")+"&withdrawconfig="+(b?"on":"off"),requestType:"script",paddingFunc:function(b){"200"==b.code?(a.Listener.fire("options:readModify",[{field:"recall",value:b.data.enable}]),z.letterRecall=b.data.enable):a.Tips.show({text:"设置失败",succ:!1}),c(b)}})}function v(c){function d(){g.bindCodeTimer&&b.clearInterval(g.bindCodeTimer)}var e,f=F.action,g=this;g.randomId=(new Date).getTime();var h=("lotteryPopup"==c?'<p style="font-size:16px;margin-bottom:10px;font-weight:bold">红包数量有限，每个用户限领一次，请输入手机号码验证</p>':"")+'<div class="nui-simpleForm nui-form Av0"><table><tbody>'+'<tr><th class="nui-form-title">您的手机号码</th>'+'<td class="nui-form-cont">'+a.Input.html({id:g.randomId+"oCompBindPhone",width:"140px"})+a.Button.html({extcls:"nui-inputBtn",text:"免费获取短信验证码",width:"100px",click:function(){var d=this,h=60,i=a.Component.find("#"+g.randomId+"oCompBindPhone");if(i){if(e=i.getValue(),""==e)return i.showTips("请填写手机号码"),!1;if(!D.checkMobile(e))return i.showTips("手机号码无效"),!1;f.sendMobileCode(e,function(a){0==a.code?(d.setDisabled(!0),g.bindCodeTimer=b.setInterval(function(){return h--,0>=h?(d.setDisabled(!1),d.setText("免费获取短信验证码"),g.bindCodeTimer&&b.clearInterval(g.bindCodeTimer),void 0):(d.setText(h+"秒后可重新获取..."),void 0)},1e3)):"-1"==a.code?i.showTips("手机号码无效"):"-2"==a.code&&("times over"==a.desc?i.showTips("已达到次数上限"):i.showTips("验证码过于频繁"))},c)}"lotteryPopup"==c?a.Log.cache({lotterySendBindMobileCode:"1"}):a.Log.cache({sendBindMobileCode:"1"})}})+"</td></tr>"+'<tr><th class="nui-form-title">验证码</th>'+'<td class="nui-form-cont">'+a.Input.html({id:g.randomId+"oCompBindVerifyCode",width:"271px"})+"</td></tr></tbody></table></div>";a.Msgbox.show({header:"验证手机号码",width:"550px",content:h,type:"confirm",contentType:"custom",extcls:"Av0 "+("lotteryPopup"==c?"Ax0":""),ok:function(){var d=a.Component.find("#"+g.randomId+"oCompBindPhone"),e=a.Component.find("#"+g.randomId+"oCompBindVerifyCode");try{var h=d.getValue(),i=e.getValue();if(""==h)return d.showTips("请填写手机号码"),!0;if(!D.checkMobile(h))return d.showTips("手机号码无效"),!0;if(""==i)return e.showTips("请输入您手机短信中的验证码"),!0;f.verifyMobileCode(h,i,function(f){"1"==f.code?"lotteryPopup"==c?a.Msgbox.show({header:"验证成功",icon:"suc",title:"恭喜，你已获得118元彩票红包资格，"+a.Link.html({text:"请马上领取",href:"http://caipiao.163.com/activity/crazy118.html?from=tanchuang",target:"_blank"}),ok:function(){b.open("http://caipiao.163.com/activity/crazy118.html?from=tanchuang")}}):a.Msgbox.show({header:"验证手机号码",icon:"suc",title:"还差一步",okText:"下一步",type:"confirm",ok:function(){b.open("https://reg.163.com/mibao/mob/bindIndex.do?noheader=0&url=")},content:"请进入在新打开的页面中按提示操作，完成手机号码验证。"}):"3"==f.code?d.showTips("手机号码邮箱已被绑定"):"-1"==f.code?e.showTips("验证码错误"):"-6"==f.code&&e.showTips("验证码错误次数过多")},c)}catch(j){}return"lotteryPopup"==c?a.Log.cache({lotteryVerifyBindMobileCode:"1"}):a.Log.cache({verifyBindMobileCode:"1"}),!0},listeners:{render:function(){a.Component.setEvents()},close:d,cancel:d}})}try{var w=$L("support.OptionSupportAction")}catch(x){return x}var y=$I("init.SenderList"),z=a.Ext,A=a.Uri,B=a.Ud,C=a.Listener,D=$I("util.Email"),E=$I("core.DataAction"),F=a.createClass($N("support.OptionSupport"));a.Object.extend(F,{action:new w,setAttr:d,getSignList:e,addList:f,removeList:g,getDefinedSenders:h,setName:i,setDefSender:j,addMailFilter:k,getFliterLimit:l,getFliterData:m,searchFilter:n,isRefuse:o,getForwardAddr:p,getAutoReply:q,isLowAntiSpamLevel:r,avatarUploader:s,forwardVerify:t,setWithDraw:u,bindMobile:v})}($,window),function(){function a(a){var b=a.param,c={ids:b.ids},d={func:"user:syncPOPAccount",body:c,call:function(b){a.callback(b)},error:a.error,wmsvrlog:{action:"syncPOPAccounts"}};this.wmsvr(d)}function b(a){var b=a.param,c={ids:b.ids,stats:!0},d={func:"user:getPOPAccounts",body:c,call:function(b){a.callback(b)},error:a.error,wmsvrlog:{action:"getPOPAccounts"}};this.wmsvr(d)}function c(a){var b=a.param,c={items:[b]},d={func:"user:updatePOPAccounts",body:c,call:function(b){a.callback(b)}};this.wmsvr(d)}var d=$I("core.DataAction"),e=$.createClass($N("support.MailCenterAction"));$.Object.mix(e,d,{},{sync:a,getStatus:b,update:c})}(),function(){function a(a){var b,c,d=$S("attrs").popAccounts;a.type?(b=a.type,c=a.value):a.id?(b="id",c=a.id):a.fid?(b="fid",c=a.fid):a.username&&(b="username",c=a.username);var e=null;return $.Array.each(d,function(a,d){return d[b]&&d[b]==c?(e=d,$.BREAK):void 0}),e}function b(){return $S("attrs").popAccounts}function c(){return v.getPop3()}function d(a){var b=this,c=b.get(a),d=c.id;if(d&&!$.Array.has(b.syncIds,d)){b.syncIds.push(d);var e={param:{ids:[d]},callback:function(){b.syncStart()},error:function(){b.syncError()}};b.action.sync(e),t.setReceiveIcon(c.fid,"receiving")}}function e(a){var b=this,c=$S("attrs").popAccounts,d=[];if($.Array.each(c,function(c,e){return $.Array.has(b.syncIds,e.id)?$.CONTINUE:a&&a.auto&&!e.autoSync?$.CONTINUE:"none"==e.type?$.CONTINUE:(d.push(e.id),void 0)}),0!==d.length){b.syncIds=b.syncIds.concat(d);var e={param:{ids:d},callback:function(){b.syncStart()},error:function(){return b.syncError()}};b.action.sync(e),t.setReceiveIcon(null,"receiving")}}function f(){var a=this;if(0!==a.syncIds.length){a.show("begin");var b={param:{ids:a.syncIds},callback:$.Function.bind(a.syncEnd,a),error:function(){return a.syncError()}};a.action.getStatus(b)}}function g(a){var b=this,c=a["var"],d=0,e=0,f=0,g=0,h=[];$.Array.each(c,function(a,c){var i=c.stats;return(!i||i.endTime&&"PENDING"!=i.code)&&($.Array.remove(b.syncIds,c.id),b.sessionUpdate(c),t.setReceiveIcon(c.fid,"receive"),i&&i.receivedMessageCount>0&&$I("init.Sync").request(),"FA_BAD_PASSWORD"==i.code&&h.push([c.username,c.id])),i?(i.messageCount>=0&&(d+=i.messageCount,e+=i.receivedMessageCount,f+=i.skippedMessageCount),i.spamMessageCount&&(g+=i.spamMessageCount),void 0):$.CONTINUE}),b.show("run",{all:d,received:e,skip:f,spam:g}),b.syncIds.length>0?window.setTimeout($.Function.bind(b.syncStart,b),3e3):(b.show("end",{received:e,skip:f,error:h}),t.setReceiveIcon(null,"receive"))}function h(){var a=this;return a.syncIds.length>0&&($.Array.each(a.syncIds,function(a,b){var c=x.get({id:b});c&&t.setReceiveIcon(c.fid,"receive")}),a.syncIds=[]),t.setReceiveIcon(null,"receive"),!0}function i(a,b){var c;switch(a){case"begin":c="邮件收取中..",$.Tips.loading(c);break;case"run":c="正在收取",c+=b.all>0?b.received+b.skip+"/"+b.all+" 封邮件...":"邮件...",$.Tips.show(c);break;case"end":$.Tips.loading(),c="收取完成！共收到"+b.received+"封邮件",b.skip&&(c+="，"+b.skip+"封邮件不在收取范围内，已跳过&nbsp;",c+=u?"":'<a href="'+w.getUrl("pop3_skip_info",!0)+'"  target="_blank">查看详情&gt;&gt;</a>');var d=5e3,e=[];if(b.error&&b.error.length>0){var f=b.error.length;d=12e3,c+="，部分帐号收取失败，";for(var g,h='<div class="nui-simpleTable nui-table nui-scroll">',i=0;f>i;i++)h+='<table><tbody class="nui-table-body"><tr class="nui-table-row"><td class="nui-table-cell">邮箱：<strong>'+b.error[i][0]+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;"+("mailcenter.MailCenterModule"==$.Context.module.mtype?"":new $.Link({text:"编辑",cls:"nui-txt-link",click:$.Function.bind(function(){g&&g.hide(),$.JS.go({module:"mailcenter.MailCenterModule"})},null,b.error[i][1])}).html())+"</td>"+"</tr>"+"</tbody>"+"</table>"+'<div class="nui-table-footerTips nui-normalTips nui-tips nui-normalTips-err">对方服务器拒绝、或用户名密码不正确，收取失败</div>',h+=i==f-1?"":'<div class="nui-split nui-split-cDark nui-split-dotted"></div>';h+="</div>",e=[{xtype:"link",text:"查看详情",click:function(){$.Tips.show({}),g?g.show():g=$.Msgbox.show({extcls:"sW0",header:"查看详情",contentType:"wide",content:h,listeners:[{name:"render",handler:function(){$.Component.setEvents()}}]})}}]}$.Tips.show({succ:!0,text:c,items:e,expires:d})}}function j(a,b,c){function d(a){var d=a.code;d==$.DataAction.S_OK&&$.Object.each(b,function(a,b){f[a]=b}),c&&c(a)}var e=this,f=e.get(a);if(f){var g={id:f.id};$.Object.each(b,function(a,b){g[a]=b});var h={param:g,callback:d};e.action.update(h)}}function k(a,b){function c(a){a&&a.length>0?f(a):f(null)}var d=this,e=a,f=b;if(e&&"function"==typeof f){var g=d.POP3_SERVER[e],h=[],i={};if(g)i.pop=g,i.port=$.Array.has(d.SSL_SERVER,g)?995:110,h.push(i),f(h);else{var j=w.getUrl("pop3_server",!0)+"?email=abc@"+e;$.Ajax.jsonp(j,c)}}}function l(a){var b=$S("attrs").popAccounts;return $.Array.has(b,function(b){return b.username.toLowerCase()==a&&"none"==b.type?!0:void 0})}function m(a){var b,c=$S("attrs").popAccounts;return $.Array.each(c,function(c,d){d.username.toLowerCase()==a&&(b=d.id)}),b}function n(a){var b=this,c=$S("attrs").popAccounts,d=!1;d=$.Array.has(c,function(b){return b.id==a.id}),d?b.sessionUpdate(a):(c.push(a),this.dataChange=!0)}function o(a,b){var c=$S("attrs").popAccounts,d=!1;return $.Array.each(c,function(c,e){return e.id==a.id?(b?e=a:$.Object.each(a,function(a,b){e[a]=b}),d=!0,$.BREAK):void 0}),this.dataChange=!0,d}function p(a){var b=$S("attrs").popAccounts,c=null,d=-1;return $.Array.each(b,function(b,e){return e.id==a.id?(d=b,c=a,$.BREAK):void 0}),d>=0&&b.splice(d,1),this.dataChange=!0,c}function q(a){var b=$S("attrs").popAccounts;return $.Array.has(b,function(b){return b.username.toLowerCase()==a?!0:void 0})}try{var r=$L("support.MailCenterAction")}catch(s){return s}var t=$I("init.Nav"),u=$S("isCorp"),v=$I("init.SenderList"),w=$.Uri,x=$.createClass($N("support.MailCenter"));$.Object.extend(x,{action:new r,POP3_SERVER:{"163.com":"pop.163.com","126.com":"pop.126.com","188.com":"pop.188.com","netease.com":"pop.netease.com","yeah.net":"pop.yeah.net","vip.163.com":"pop.vip.163.com","vip.126.com":"pop.vip.126.com","sina.com":"pop3.sina.com","sina.cn":"pop3.sina.cn","vip.sina.com":"pop3.vip.sina.com","sohu.com":"pop3.sohu.com","vip.sohu.com":"pop3.vip.sohu.com","china.com":"pop.china.com","21cn.com":"pop.21cn.com","21cn.net":"pop.21cn.net","tom.com":"pop.tom.com","163.net":"pop.163.net","263.net":"263.net","domain.com":"pop.yourdomain.com","eyou.com":"pop3.eyou.com","qq.com":"pop.qq.com","vip.qq.com":"pop.qq.com","foxmail.com":"pop.foxmail.com","gmail.com":"pop.gmail.com","yahoo.com":"pop.mail.yahoo.com.cn","msn.com":"pop3.live.com","msn.cn":"pop3.live.com","live.cn":"pop3.live.com","live.com":"pop3.live.com","hotmail.com":"pop3.live.com","qiye.163.com":"pop.qiye.163.com"},SSL_SERVER:["pop.gmail.com","pop3.live.com","pop.mail.yahoo.com.cn"],syncIds:[],get:a,getAll:b,getSender:c,receive:d,receiveAll:e,syncStart:f,syncEnd:g,syncError:h,show:i,update:j,searchPop3:k,isNone:l,getId:m,sessionAdd:n,sessionUpdate:o,sessionDel:p,sessionHas:q})}(),function(a,b,c){function d(b){function d(){var a=new o,b={func:"mbox:emptyFolder",body:{id:h,permanently:k},call:f,error:e};a.wmsvr(b)}function e(a){var b=a.code;return m.has(b,"FS_")?"清空文件夹出错":void 0}function f(){a.Tips.show({succ:!0,text:"成功清空文件夹"}),a.Listener.one("sync:request",function(){p.fire("folder:empty",h)}),$I("init.Sync").request(c,{listen:!0})}var g,h=b.fid,i=n.get(h),j=i.name,k=!1,q="确定删除“"+j+"”的所有邮件到已删除文件夹吗?";if(l.has($G.common.nolistids,h)){var r="";if($S("isVip")&&!($S("cos").pref_mail_preserving_days>0)){var s="文件恢复",t=new a.Link({text:s,click:function(){$I("util.CustomAppManager").goOutLink("recovery",s),g.close()}});r="&nbsp;[开启"+t.html()+"，邮件双重备份]"}k=!0,q="您确定要彻底删除“"+j+"”中的所有邮件吗？"+r}g=a.Msgbox.show({type:"confirm",content:q,title:"文件夹清空",ok:d}),a.Component.setEvents()}function e(b){function c(a){var b=a.code,c=null;switch(b){case"FA_HAS_CHILD":c="有子文件夹，无法删除此文件夹";break;case"FA_HAS_MAIL":c="文件夹中还有邮件，请先清空";break;case"FA_FORBIDDEN":c="不允许删除此文件夹"}return c}function d(){for(var b=$S("attrs").folders,c=0,d=b.length;d>c;c++)if(f.id===b[c].id){b.splice(c,1);break}n.init(!0),p.fire("folder:remove",e),a.Tips.show({succ:!0,text:"成功删除文件夹"})}var e=b.fid,f=n.get(e);f.name;var g,h="";if(f.flags.pop?(h="要删除该文件夹，请先到邮箱设置的邮箱中心里删除该邮箱帐号。",g=function(){$E("interface.OptionInterface",function(a){a.entry({module:"AccountCenterModule"})})}):n.getInfo(e)>0&&(h="请先将文件夹中所有的邮件全部删除后再操作。"),h)return a.Msgbox.show({type:"confirm",content:h,title:"删除文件夹",ok:g}),void 0;var i=new o,j={func:"mbox:deleteFolders",body:{ids:[e]},call:d,error:c};i.wmsvr(j)}function f(b){function c(b){function c(a){var b=a.code,c=null;switch(b){case"FA_ID_NOT_FOUND":c="找不到指定文件夹";break;case"FA_PARENT_NOT_FOUND":c="找不到指定文件夹的父文件夹";break;case"FA_INVALID_PARENT":c="错误的父文件夹";break;case"FA_NAME_EXISTS":c="文件夹重名";break;case"FA_NAME_INVALID":c="非法的文件夹名称";break;case"FA_FORBIDDEN":c="不允许修改此文件夹";break;case"FA_NAME_RESERVED":c="文件夹名和系统保留名重复"}return c}function d(){g.name=f,n.init(!0),p.fire("folder:modify",e,f),a.Tips.show({succ:!0,text:"成功修改文件夹"})}f=b;var h=new o,i={func:"mbox:updateFolders",body:{items:[{id:e,name:f}]},call:d,error:c};h.wmsvr(i)}var d=this,e=b.fid,f=b.newFolderName,g=n.get(e),h=g.name;f?c(f):d.showMsg({defaultValue:h,fid:e,callback:c})}function g(c){function d(a,b){b?e(a):f(a)}function e(c){function d(b){var c=m.trim(i.value);return c.length>0?(f(b,c),void 0):(a.fly("#addrErrTr").show(),!0)}var e,g='<div class="nui-simpleForm nui-form rQ0"><table><tbody><tr><th class="nui-form-title">输入联系人名称：</th><td class="nui-form-cont"><div class="nui-ipt"><input class="nui-ipt-input" type="text"/></div></td></tr><tr id="addrErrTr" style="display:none;"><th class="nui-form-title"></th><td class="nui-form-cont">请输入正确的联系人</div></td></tr><tr><th class="nui-form-title"></th><td class="nui-form-cont" id="addrSelTd"></td></tr></tbody></table></div>';e=a.Msgbox.show({type:"confirm",header:"设置来信分类",content:g,contentType:"normal",noIcon:!0,ok:a.Function.bind(d,b,c)});var h=e.getEl().find("input"),i=h.dom;$E("support.AddressSupport",function(b){b.contactSelector({call:function(a){i.value=a.email||a.name},renderTo:a("#addrSelTd")})})}function f(b,c){function d(a){var b=a.code,c=null;switch(b){case"FA_OVERFLOW":c="超过最大文件夹个数限制";break;case"FA_PARENT_NOT_FOUND":c="找不到指定文件夹的父文件夹";break;case"FA_NAME_EXISTS":c="文件夹重名";break;case"FA_NAME_INVALID":c="非法的文件夹名称";break;case"FA_NAME_RESERVED":c="文件夹名和系统保留名重复"}return c}function e(d){var e=d["var"][0];$S("attrs").folders.push({id:e,name:b,stats:{messageCount:0,messageSize:0,unreadMessageCount:0,unreadMessageSize:0,threadCount:0,unreadThreadCount:0}}),n.init(!0),p.fire("folder:add",e,b,c),i&&i(e),a.Tips.show({succ:!0,text:"成功添加文件夹"}),c&&$E("support.OptionSupport",function(a){a.addMailFilter({name:c,fid:e,email:c})})}var f=new o,g={func:"mbox:createUserFolders",body:{items:[{name:b}]},call:e,error:d};f.wmsvr(g)}var g=this;c||(c={});var h=c.folderName,i=c.callback;h?d(h):g.showMsg({callback:d})}function h(a){function b(){for(var a={},b=0,c=d.length;c>b;b++){var f=d[b],g=f.id,h=f.keepPeriod,i=n.get(g);i&&(i.flags||(i.flags={}),i.keepPeriod=h,a[g]=h)
}p.fire("folder:keep",a),e&&e()}function c(){f&&f()}var d=a.list,e=a.callback,f=a.error,g=new o;g.wmsvr({func:"mbox:updateFolders",body:{items:d},call:b,error:c})}function i(a,b){if(!a||""===a)return"请输入文件夹名称";if(m.len(a)>20)return"长度不能大于10个汉字(或20个字符)";if(m.check(a)||m.check(a,/[\&\.\*]/))return"请不要输入 ＂, % ' \" \\ / ；| &.*＂ 等特殊字符";var c=!1,d=n.getByName(a);return d&&d.id!==b&&(c=!0),c?"同名文件夹已存在":void 0}function j(b){function c(a){a=m.trim(a).replace(/\s+/gi," ");var b=e.checkName(a,g);return b?b:(h(a,i),void 0)}function d(){var a=n.find("button")[0];i=l.getChecked();var b;b=i?"下一步":"确 定",a.update({text:b})}var e=this,f=b.defaultValue,g=b.fid,h=b.callback,i=!1,j=g?"修改文件夹":"新建文件夹",k={type:"prompt",inputLabel:"输入文件夹名称",inputValue:f,header:j,ok:c};if(!g){var l=new a.Checkbox({text:"收取指定联系人邮件到该文件夹",checkedchange:d});k.footer=l}var n=a.Msgbox.show(k)}var k=a.Object,l=a.Array,m=a.String,n=$I("init.Folder"),o=$I("core.DataAction"),p=a.Listener,q=a.createClass($N("support.Folder"));k.extend(q,{empty:d,remove:e,rename:f,add:g,keep:h,checkName:i,showMsg:j})}($,window),function(a,b,c){function d(b){function c(a){var c=e&&l.has(e,a);b.callback(c,a)}var d,e=b.tag,f={reverse:!0,groups:[]},g=o.list(),h=f.groups;k.count(g)>0&&(d=[],k.each(g,function(a,b){var f=e&&l.has(e,b.name),g=b.name,h=b.alias,i=b.color,j=d.length;d.push({text:h,icon:{xtype:"icon",type:"tag",subtype:i,group:"tagitem"},checked:f,click:function(){c(g,j)}})}),h.push({items:d,type:"scroll",checkType:"checkbox"})),k.count(e)>0&&(d=[],d.push({text:"取消所有标签",click:function(){b.remove()}}),h.push({items:d}));var i=a.Context.getModule();return d=[],d.push({text:"新建标签并标记",click:function(){i.log("tag","new"),$E("support.Tag",function(a){a.add({callback:function(a){b.callback(!1,a)}})})}}),d.push({text:"管理标签",click:function(){i.log("tag","manage"),$E("interface.OptionInterface",function(a){a.entry({module:"FolderTagModule"})})}}),h.push({items:d}),f}function e(b){function d(b){function d(){}function e(){$S("attrs").tags.push([g,{color:i,alias:h}]),o.init(!0),q.fire("tag:add",g),f&&f(g),a.Tips.show({succ:!0,text:"成功添加标签"})}var g=b.name,h=b.alias,i=b.color,j=new p,k={func:"mbox:manageTags",body:{add:[[g,{color:i,alias:g===h?c:h}]]},call:e,error:d};j.wmsvr(k)}var e=this;b||(b={});var f=b.callback;e.showMsg({callback:d})}function f(b){function d(b){function d(){}function e(){for(var b=$S("attrs").tags,c=!1,d=0,e=b.length;e>d;d++){var k=b[d];if(g===k[0]){k[1].color=j,c=(k[1].alias||g)!==i,k[1].alias=i;break}}o.init(!0),q.fire("tag:modify",g,c),f&&f(h),a.Tips.show({succ:!0,text:"成功编辑标签"})}var g=b.name,i=b.alias,j=b.color,l=new($I("core.DataAction")),m={func:"mbox:manageTags",body:{replace:[[g,{color:j,alias:i===g?c:i,show:k.show}]]},call:e,error:d};l.wmsvr(m)}var e=this;b.tag;var f=b.callback,g=b.onlyName,h=b.name,i=b.alias,j=b.color,k=o.get(h);h&&i&&j>-1?d({name:h,color:j,alias:i}):e.showMsg({data:k,onlyName:g,callback:d})}function g(b){function c(){function b(){}function c(b){for(var c=$S("attrs").tags,f=0,g=c.length;g>f;f++)if(d===c[f][0]){c.splice(f,1);break}o.init(!0),q.fire("tag:remove",d),e&&e(b),a.Tips.show({succ:!0,text:"成功删除标签"})}var f=new($I("core.DataAction")),g={func:"mbox:manageTags",body:{"delete":[d]},call:c,error:b};f.wmsvr(g)}var d=b.name,e=b.callback,f=o.get(d),g=f.alias,h=[],i=o.getInfo(d);h[h.length]='<h4 class="g-dialogBox-title txt-impt">确定删除“'+g+"”这个标签？</h4>",i>0&&(h[h.length]='<p class="txt-12 txt-info">该标签将从 '+i+" 封邮件中删除，但是不会删除邮件</p>"),a.Msgbox.show({type:"confirm",content:h.join(""),title:"删除标签",ok:c})}function h(a,b){function d(){}function e(){for(var c=$S("attrs").tags,d=0,e=0,g=c.length,i=a.length;g>d&&i>e;d++){var j=c[d],k=j[0];l.has(a,k)&&(j[1].show=b,h[k].show=b,e++)}f()}function f(){q.fire("tag:setshow",a,b)}for(var g=[],h={},i=0,j=a.length;j>i;i++){var k=a[i],m=o.get(k);if(m.show!==b){var n=m.alias;n===m.name&&(n=c),g.push([k,{show:b,color:m.color,alias:n}]),h[k]=m}else a.splice(i,1),i--,j--}if(g.length>0){var p=new($I("core.DataAction")),r={func:"mbox:manageTags",body:{replace:g},call:e,error:d};p.wmsvr(r)}else f()}function i(b,c){if(!b||""===b)return"请输入标签名称";if(n.len(b)>20)return"长度不能大于10个汉字(或20个字符)";if(n.check(b)||n.check(b,/[\&\.\*]/))return"请不要输入 ＂, % ' \" \\ / ；| &.*＂ 等特殊字符";var d=!1,e=o.list();return k.each(e,function(e,f){return f.alias===b?(d=c!==f.name,a.BREAK):void 0}),d?"同名标签已存在":void 0}function j(b){function c(a){a=n.trim(a).replace(/\s+/gi," ");var b=i.checkAlias(a,f);return b?b:(l({name:e(f,a),alias:a,color:h}),void 0)}function d(){var a=o.list(),b={},c=0,d=!1;if(k.each(a,function(a,c){var e=c.color;b[e]||(b[e]=0),b[e]++,d=!0}),d)for(var e=-1,f=0;f<o.colorCount;f++){var g=b[f]||0;if(0===g){c=f;break}(e>g||-1===e)&&(e=g,c=f)}return c}function e(a,b){if(!a){var c=0;do a=b,c>0&&(a+=c),c++;while(o.get(a,"tags"))}return a}var f,g,h,i=this,j=b.data,l=b.callback,p=b.onlyName;j?(f=j.name,g=j.alias,h=j.color):h=d();var q=0===k.count(o.list())?'<h4 class="g-dialogBox-title">您还没有邮件标签，创建后可以更加方便管理邮件</h4><p class="txt-info txt-12" style="margin-bottom:20px">您可以给一封邮件设置多个标签，并为不同标签设置不同颜色...</p>':"",r=null;if(!p){for(var s={groups:[{items:[],type:"inlineItemList"}],width:"142px"},t=0;20>t;t++)s.groups[0].items.push({text:new a.Tag({type:t,subclass:"iconTag"}).html(),click:m.bind(function(a){h=a,u.find("icon")[0].update({subtype:h})},this,t)});r=[{html:'<div class="nui-simpleForm nui-form"><table><tr><th class="nui-form-title">选择标签颜色</th><td class="nui-form-cont" id="tdTagMenuButton"></td></tr></table></div>'}]}if(a.Msgbox.show({type:"prompt",items:r,inputLabel:"输入标签名称",content:q,inputValue:g,header:j?"修改标签":"添加标签",ok:c}),!p)var u=new a.Button({subclass:"dropdownBtn",text:"选择颜色",icon:{type:"tag",subtype:h},menu:s,renderTo:"tdTagMenuButton"})}var k=a.Object,l=a.Array,m=a.Function,n=a.String,o=$I("init.Tag"),p=$I("core.DataAction"),q=a.Listener,r=a.createClass($N("support.Tag"));k.extend(r,{getMenu:d,add:e,modify:f,remove:g,setShow:h,checkAlias:i,showMsg:j})}($,window),function(a,b,c){function d(a){var b=$I("init.Defer"),c=a.defer,d=a.flags&&a.flags.deferHandle,e="",f="";return d&&c?(f=c<b.getDate("today")?"尚未":c<b.getDate("tomorrow")?"今日":c<h.addDate(b.getDate("tomorrow"),1)?"明日":h.format(a.defer,"yyyy年M月d日"),e="已设为待办邮件，"+f+"处理"):e="设置待办",e}function e(b){var c,d=b.data,e=b.left||0,f=b.top||0,g=b.modify,h=b.modifyMemo,j=b.modifySms,k=b.complete,l=b["delete"],m=d.id,n=d.defer,o=d.flags.deferHandle;if(o&&n){c={reverse:!0,groups:[],extcls:"nui-menu-todosetting",extOffset:{left:e,top:f}};var p=c.groups,q=[],r=[];if(r.push('<b class="nui-layer-arr" style="left:auto;right:37px"></b><div class="nui-menu-item"><span class="nui-menu-item-icon"><b class="nui-ico nui-ico-todo nui-ico-todo-selected"></b></span>'),r.push('<div class="nui-menu-text">'),r.push("<span>"+i.expireNote(d)+"</span>"),r.push(new a.Link({text:"修改",extcls:"nui-txt-link",click:g}).html()),r.push("</div>"),r.push(new a.Button({subclass:"smallMainBtn",text:"设为完成",extcls:"nui-btn-done",icon:{type:"done",subtype:"white"},click:k}).html()),r.push("</div>"),q.push({html:r.join(""),xtype:"component"}),p.push({items:q}),a.Ext.scheduleRead)if($S("schedule")&&$S("schedule")[m]){var s=new a.Link({text:"修改",cls:"nui-txt-link",click:function(){$E("product.Schedule",function(a){a.edit(m)})}}),t=[],u=[];u.push('<div class="nui-menu-item"><span class="nui-menu-item-icon"><b class="nui-ico nui-ico-smsRemind"></b></span>'),u.push('<div class="nui-menu-text">已设置短信提醒 '+s.html()+"</div>"),u.push("</div>"),t.push({html:u.join(""),xtype:"component"}),p.push({items:t})}else{var v=new a.Link({text:"添加短信提醒",extcls:"nui-txt-link",click:j||g});p.push({items:[{html:'<p><span class="nui-menu-text">'+v.html()+"</span></p>",xtype:"component"}]})}var w=d.memo;if(w){var x=[],y=[];y.push('<div class="nui-menu-item nui-menu-todosetting-remark"><span class="nui-menu-item-icon"><b class="nui-ico nui-ico-remark-xs"></b></span>'),y.push('<p><span class="nui-menu-text">'+w+"</span></p>"),y.push(new a.Link({text:"修改",extcls:"nui-txt-link",click:g}).html()),y.push("&nbsp;"),y.push(new a.Link({text:"删除",extcls:"nui-txt-link",click:function(){a.Msgbox.show({type:"confirm",content:"您确定要删除备注吗？",title:"删除确认",ok:l})}}).html()),y.push("</div>"),x.push({html:y.join(""),xtype:"component"}),p.push({items:x})}else{var z=new a.Link({text:"添加备注",extcls:"nui-txt-link",click:h||g});p.push({items:[{html:'<p><span class="nui-menu-text">'+z.html()+"</span></p>",xtype:"component"}]})}}return c}function f(d){function e(){g(),y.getChecked()&&z.fire("show");try{if(T){for(var a,b=0,c=E.length;c>b;b++)if(E[b].getChecked()){a=D[b].date;break}a&&T.setValue(h.format(a,"yyyy-MM-dd"))}}catch(d){}}function f(b){if(b){x.date=b;var c=x.text=h.format(b,"yyyy-MM-dd"),d=y.getEl(),e=d.find(".nui-chk-text"),f=e.dom;f.innerHTML=c;var i=a(d.dom.parentNode);i.removeClass("nui-chk-someday"),i.addClass("nui-chk-thatday");try{T&&T.setValue(h.format(b,"yyyy-MM-dd"))}catch(j){}}y.getChecked()||(y.setChecked(!0,!0),g())}function g(){for(var b=0,c=E.length;c>b;b++){var d=E[b],e=a(d.getEl().dom.parentNode);d.getChecked()?e.addClass("selected"):e.removeClass("selected")}}function i(){for(var c,d=0,e=E.length;e>d;d++)if(E[d].getChecked()){c=D[d].date,a.Context.getModule().log("defer","date",d);break}var f;if(Z&&Z.getChecked()&&T&&V&&W)try{var g=T.getValue(),h=g.split("-");f=new b.Date(h[0],h[1]-1,h[2]),f.setHours(V.getValue()),f.setMinutes(W.getValue())}catch(i){}var j,k=$.getChecked()?db.value:"";return c?f&&A>f?j="短信提醒时间已过期":k.length>v&&(j="请输入 "+v+" 个字符"):j="请选择需要提醒的时间",j?(a("#deferMsgboxInfo").html('<span class="nui-txt-err">'+j+"</span>"),!0):(u({defer:c,smsDate:f,memo:k}),void 0)}function j(){var b=v,c=db.value.length,d=b-c,e="";$.getChecked()&&(e=d>=0?"还能输入&nbsp;<strong>"+d+"</strong>&nbsp;字":'<span class="nui-txt-err">请删除&nbsp;<strong>'+-d+"</strong>&nbsp;字</span>"),a("#deferMsgboxInfo").html(e)}function k(b){function c(){var c=this;c.calendar||(c.calendar=new a.Calendar({filterFn:function(a,b){return b>=a},onselect:function(a){c.setValue(h.format(a,"yyyy-MM-dd")),c.focus()},focus:b}),c.calendar.el=c.getEl()),setTimeout(function(){c.calendar.getLayer().show()},0)}var d=h.format(b,"yyyy-MM-dd");return new a.Input({width:"100px",placeholder:"yyyy-MM-dd",value:d||"",iconBtn:"calendar",iconbtnclick:c})}function l(b,c){var d=[];if("hour"===c)for(var e=0;24>e;e++)d.push({text:e+"时",value:e,checked:e===b});else for(var f=[0,15,30,45],e=0,g=f.length;g>e;e++){var h=f[e];d.push({text:h+"分",value:h,checked:h===b})}return new a.Select({options:d})}var m,n,o,p,q,r,s,t=(d.type,d.data),u=d.callback,v=a.Memo.maxLength,w=a.Context.getModule();t&&(m=t.defer,n=t.memo,o=t.mid,p=!!n||t.memoShow,q=!!o&&a.Ext.scheduleRead,r=q&&($S("schedule")&&$S("schedule")[o]||t.smsShow),s=q&&$S("schedule")&&$S("schedule")[o],m&&(m=new b.Date(m.getFullYear(),m.getMonth(),m.getDate())));var x,y,z,A=a.Misc.getTime(0),B=$I("init.Defer"),C=B.getDate("today"),D=[{text:"今天",date:C},{text:"明天",date:h.addDate(C,1)},{text:"后天",date:h.addDate(C,2)},{text:"这周末",date:function(){var a=C.getDay(),b=0;return a>0&&(b=6-a),h.addDate(C,b)}()},{text:"下个月",date:function(){return new b.Date(C.getFullYear(),C.getMonth()+1,1)}()},{text:"某一天",date:null}],E=[],F='<b class="nui-ico nui-ico-todo nui-ico-todo-transparent"></b>待办邮件设置',G=[];G[G.length]='<div class="nui-simpleForm nui-form">',G[G.length]='<div class="nui-form-title"><b class="nui-ico nui-ico-todo nui-ico-todo-selected"></b><span>您希望什么时候处理这封邮件呢？</span></div>',G[G.length]='<div class="nui-form-cont">';for(var H=!1,I=0,J=D.length;J>I;I++){var K=D[I],L=K.date,M=K.text,N=!1;m?L?m.getTime()===L.getTime()&&(N=!H,H=!0):H||(N=!0,M=h.format(m,"yyyy-MM-dd"),K.date=m):1===I&&(N=H=!0);var O=I===J-1,P=new a.Radio({value:L,checked:N,text:M,checkedchange:e,listeners:{click:O?e:c}});O&&(x=K,y=P,z=new a.Calendar({onselect:f,focus:m,forbidMonth:!0,filterFn:function(a,b){return b>=a}}));var Q=[];O&&(N?Q.push("nui-chk-thatday"):Q.push("nui-chk-someday")),N&&Q.push("selected"),G[G.length]='<label class="'+Q.join(" ")+'">'+P.html()+(z?z.html():"")+"</label>",E.push(P)}if(a.Radio.group(E),G[G.length]="</div>",o){if(G[G.length]='<div style="'+(r?"":"display:none;")+'" id="deferMsgboxSms">',G[G.length]='<div class="nui-menu-split nui-split"></div>',G[G.length]='<div class="nui-form-title"><b class="nui-ico nui-ico-smsRemind"></b><span style="color:#555555;font-weight:bold;">短信提醒我处理邮件</span></div>',s){var R=new a.Link({text:"修改提醒时间&gt;&gt;",cls:"nui-txt-link",click:function(){$E("product.Schedule",function(a){ab.close(),a.edit(o)})}});G[G.length]="<div>您已设置过短信提醒 "+R.html()+"</div>"}else{G[G.length]='									<div class="nui-form-cont">										<table class="nui-form-table">											<tbody>												<tr>													<th class="nui-form-cont-title">提醒时间：</th>													<td class="nui-form-cont-list">							';var S=m?m:h.addDate(A,1),T=k(S);G[G.length]=T.html();var U=S.getHours();0===U?U=8:23>U&&U++;var V=l(U,"hour");G[G.length]=V.html();var W=l(0,"minute");G[G.length]=W.html(),G[G.length]="														</td>													</tr>							";var X=new a.Link({text:"修改手机号码&gt;&gt;",cls:"nui-txt-link",click:function(){w.log("defer","mobile"),$E("interface.OutlinkInterface",function(c){ab.close();var d;$S("isFree")?d={key:"sms",title:"随身邮"}:$S("isVip")?d={key:"dxyycharge",title:"手机服务"}:$S("isCorp")&&(d={key:"apps_mibao",title:"密保平台"}),$S("isCorp")?b.open(a.Uri.getUrl(d.key),"_blank"):c.goOutlink(d)})}});G[G.length]='													<tr>														<th class="nui-form-cont-title">&nbsp;</th>														<td class="nui-form-cont-ext">															将发送短信至您绑定的手机号码 '+X.html()+"														</td>													</tr>												</tbody>											</table>										</div>"}G[G.length]="</div>"}G[G.length]='<div style="'+(p?"":"display:none;")+'" id="deferMsgboxMemo">',G[G.length]='<div class="nui-menu-split nui-split"></div>',G[G.length]='<div class="nui-form-title"><b class="nui-ico nui-ico-remark-xs"></b><span style="color:#555555;font-weight:bold;">备注</span></div>',G[G.length]='								<div class="nui-form-cont">									<div class="nui-multiLineIpt nui-ipt"><textarea class="nui-ipt-input" style="width:400px;height:40px;">'+(n?n:"")+"</textarea></div>								</div>",G[G.length]="</div>",G[G.length]="</div>";var Y=[];if(q){var Z=new a.Checkbox({text:"短信提醒我处理邮件",checked:!!r,checkedchange:function(){w.log("defer","sms"),a("#deferMsgboxSms")[this.getChecked()?"show":"hide"](),j()}});Y.push(Z.html())}var $=new a.Checkbox({text:"设置备注",checked:!!p,checkedchange:function(){w.log("defer","memo"),a("#deferMsgboxMemo")[this.getChecked()?"show":"hide"](),j()}});Y.push("&nbsp;"),Y.push($.html()),Y.push("&nbsp;"),Y[Y.length]='<span id="deferMsgboxInfo" class="nui-msgbox-todosetting-hint"></span>';var _={contentType:"normal",header:F,extcls:"nui-msgbox-todosetting",content:G.join(""),footer:Y.join(""),ok:i,cancel:function(){}},ab=a.Msgbox.show(_),bb=ab.getEl(),cb=bb.find("TEXTAREA"),db=cb.dom;cb.listen("keyup",j),cb.listen("paste",j),cb.listen("cut",j),a.Component.setEvents(),setTimeout(j,0),cb.destroy()}var g=a.Object,h=a.Date,i=a.createClass($N("support.Defer"));g.extend(i,{expireNote:d,getMenu:e,showMsgbox:f})}($,window),function(a,b){function c(){6!=a.Browser.ie()&&"standard"==$G.mailPattern.currentPattern&&r.getSkinConf(function(){var a=r.getCurrentSkin(),b=r.isUseHoliday();a.apply&&(b?a.apply.use({isHoliday:!0}):a.apply.use(a))})}function d(c){if(b.oSkinConf||$G.environment.skinConf)c(b.oSkinConf||$G.environment.skinConf);else{var d=$G.environment,e=d.cacheThemePath+"/"+d.themeJsFile;a.Ajax.request({url:e,requestType:a.Ajax.SCRIPT,call:function(){var a=b.oSkinConf||$G.environment.skinConf;a&&(r._orgiSkin=r._formatSkinData(a),c(a))}})}}function e(a){r.getSkinConf(function(c){var d=[];for(var e in c){var f=c[e];f instanceof b.Array?o.each(f,function(a,b){b.topshow&&d.push(b)}):f instanceof b.Object&&n.each(f,function(a,b){b.topshow&&d.push(b)})}a(d)})}function f(b,c){function d(b,c){function d(b){if(b){var c=b.code;c==a.S_OK?($S("skin",{name:g,color:h}),a.Tips.show({succ:!0,text:"邮箱皮肤设置成功"}),a.Listener.fire("options:skinChange"),r.updateIframeSkin(),e.apply&&e.apply.use(e)):a.Tips.show({text:"设置失败，请稍候再试"})}}var e=r.getSkin(b);if(e){var f=r.getCurrentSkin(),b=e.value,g=e.name,h=e.color,i=(b+"").split("");(c||!f||f.value!==b)&&(f.apply&&f.apply.unuse(e),$G.user.color=h,$G.user.css=g,$G.user.skin=b,i.length<2&&i.unshift(0),c||(q.set({field:"ntes_skin",flag:"jsSkin_units",value:i[1],notPost:!0}),q.set({field:"ntes_skin",flag:"jsSkin_tens",value:i[0],call:d,forcePost:!0})))}}6==a.Browser.ie()?r.noSupportTheme():r.getSkinConf(p.bind(d,this,b,c))}function g(a){try{return r._orgiSkin.skin_index[a]}catch(b){return null}}function h(){var a,c,d=(r._orgiSkin.skin_data,"0"),e=$S("attrs").user,f=b.oSkinConf||$G.environment.skinConf,g=$S("domain");return"string"==typeof e.ntes_skin?d=parseInt(e.ntes_skin.substr(4,2),10)||"":e.ntes_skin="0000000000000000",g.indexOf("188")>=0&&(g="188.com"),a=f.defaultSkin[g]||f.defaultSkin["163.com"],0===d-0&&(d=a.value),c=r.getSkin(d),c||(c=r.getSkin(a.value)),c}function i(c){var d=[],e={},f=$S("domain");for(var g in c){var h=c[g];if("otherSkin"==g)for(var d=[],i=0;i<h.length;i++){var j=h[i];j.domain.indexOf(f)>=0&&(d.push(j),e[j.value]=j)}else if(h instanceof b.Array)d=d.concat(h),a.Array.each(d,function(a,b){e[b.value]=b});else if(h instanceof b.Object)for(var i in h)d.push(h[i]),e[h[i].value]=h[i]}return{skin_data:d,skin_index:e}}function j(){function b(a,b,c){return a.replace(new RegExp("(^|&)"+b+"=([^&]*)(&|$)"),"")+"&"+b+"="+c}for(var c,d,e=[{domain:["vip.163.com","188.com"],id:"ifrmvipmsg",operator:"<",type:1},{domain:["vip.163.com"],id:"welcomeIfr",operator:"<"}],f=$S("domain"),g=!0,h=0,i=e.length;i>h;h+=1){if(c=e[h],d=a(c.id),!d)return;d=d.dom;for(var j=0,i=c.domain.length;i>j;j+=1){if(c.domain[j]==f&&">"===c.operator){g=!1;break}j==i&&c.domain[j]!=f&&"<"===c.operator&&(g=!1)}g&&(d.src=1===c.type?b(b(d.src,"skin",$G.user.css),"color",$G.user.color):d.src)}}function k(){var b="&product=js6&domain="+$S("domain")+"&uid="+$S("uid")+"&area=welcome"+a.Browser.ie(),c="http://count.mail.163.com/statistics/5xS5rC.do?"+b;a.Msgbox.show({icon:"alert",title:"您的浏览器版本过低，无法支持邮箱换肤特性。",content:'如需使用邮箱换肤功能，<a target="_blank" href="'+c+'" >请升级浏览器</a>',okText:"我知道了"})}function l(){return $G.environment.isHolidayTheme?""===a.Cookie.get("forceHideHoliday")?!0:!1:!1}function m(){$G.environment.holidayDays&&a.Cookie.set("forceHideHoliday","sjb",{expires:$G.environment.holidayDays-0})}var n=a.Object,o=a.Array,p=a.Function;a.String;var q=a.Ud,r=a.createClass($N("support.Theme"));n.extend(r,{init:c,getSkinConf:d,_formatSkinData:i,changeSkin:f,getSkin:g,getCurrentSkin:h,getTopConf:e,updateIframeSkin:j,noSupportTheme:k,isUseHoliday:l,notUseHoliday:m})}($,window),function(a,b,c){function d(a){var b=this;p.request({requestType:p.XMLHTTP,method:p.GET,rnd:!0,url:b._getApi("queryAuth"),call:function(d){function e(a){g(a||{});try{$C("yixinOauthBox").destroy()}catch(b){}$S(h)!==c&&$S(h,c)}var f=JSON.parse(d.responseText),g=a.call;if(f&&0===f.res)return e(f.info||{}),void 0;var h=b._showOauth(e)}})}function e(b,d){var e=this;if(d!==c){var f=b.content,g=b.getPostContent(),h=200,i=f.length>h;if(a.String.len(g)>10240)return a.Msgbox.show({header:"系统提示",content:"抱歉，邮件字节长度超过10K，无法收藏到易信。",icon:"info"}),void 0;var j,k=['<div class="vJ0">','<h4 class="uJ0">'+a.String.escapeHTML(b.title)+"</h4>",'<div class="vH1">'+a.String.escapeHTML(b.info)+"</div>",'<div class="vF0">',"<p>"+a.String.escapeHTML(i?f.substring(0,h-1)+"...":f)+"</p>","</div>",'<div class="ua0">提示：收藏内容未包括图片和附件</div>',"</div>",'<div class="tT1">','<div class="nf1">','<p class="kz2">',"易信昵称："+a.String.escapeHTML(d.nick||"")+"&nbsp;",a.Link.html({text:"更换帐号",cls:"nui-txt-link",click:function(){e._changeAccount(b)}}),"</p>","</div>",a.Button.html({extcls:"wJ1",icon:{type:"yixin-white",size:"l"},text:"添加到易信收藏",click:function(){e._getApi("yxAuthPack","",function(b){a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,url:b,rnd:!0,body:{content:JSON.stringify({type:"text",text_content:g})},call:function(b){var c=JSON.parse(b.responseText);1===c.res?a.Msgbox.show({header:"系统提示",title:"邮件已成功收藏到易信！",icon:"suc"}):a.Msgbox.show({header:"系统提示",title:"抱歉，收藏失败，请稍候再试。",icon:"info"})}})}),j.destroy()}}),"</div>"].join("");j=new a.Msgbox({id:"yixinPreviewBox",contentType:"wide",noFooter:!0,header:"添加易信收藏",content:k}),a.Component.setEvents()}}function f(b,d){var e=this;if(d!==c){if("wmsvr"===b.imgType&&b.url===c)return e._getWmsvrImgAddr(b.attachInfo,function(a){b.url=a,e.imageFavr(b,d)}),void 0;var f,g={type:"image",image:b.url},h=['<div class="vJ0">','<div class="wR0">','<img onload="$.fly(this.nextSibling).hide();$.fly(this).show();" src="'+(b.preview||g.image)+'" style="display:none;"></img>',a.Icon.html({type:"loading"}),"</div>","</div>",'<div class="tT1">','<div class="nf1">','<p class="kz2">',"易信昵称："+a.String.escapeHTML(d.nick||"")+"&nbsp;",a.Link.html({text:"更换帐号",cls:"nui-txt-link",click:function(){e._changeAccount(b)}}),"</p>","</div>",a.Button.html({extcls:"wJ1",icon:{type:"yixin-white",size:"l"},text:"添加到易信收藏",click:function(){e._getApi("yxAuthPack","",function(c){a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,url:c,rnd:!0,body:{content:JSON.stringify(g)},call:function(c){var d=JSON.parse(c.responseText);1===d.res?a.Msgbox.show({header:"系统提示",title:((b.attachInfo||{}).name||"图片")+"已成功收藏到易信！",icon:"suc"}):a.Msgbox.show({header:"系统提示",title:"抱歉，收藏失败，请稍候再试。",icon:"info"})}})}),f.destroy()}}),"</div>"].join("");f=new a.Msgbox({id:"yixinPreviewBox",contentType:"wide",noFooter:!0,header:"分享到易信",content:h}),a.Component.setEvents()}}function g(b,d){var e=this;if(d!==c){var f=b.toFriend,g=b.friend;if(f&&g===c)return e.selectFriend(function(a){b.friend=a,e.imageShare(b,d)}),void 0;if("wmsvr"===b.imgType&&b.url===c)return e._getWmsvrImgAddr(b.attachInfo,function(a){b.url=a,e.imageShare(b,d)}),void 0;var h,i={type:"image",image:b.url},j=['<div class="vJ0">','<div class="wR0">','<img onload="$.fly(this.nextSibling).hide();$.fly(this).show();" src="'+(b.preview||i.image)+'" style="display:none;"></img>',a.Icon.html({type:"loading"}),"</div>",f?"":['<div class="wM0">',a.Input.html({id:"addToYixinPicTxtInput",subclass:"multiLineIpt",extcls:"qr1",placeholder:"说点什么吧…"}),"</div>"].join(""),"</div>",'<div class="tT1">','<div class="nf1">','<p class="kz2">',"易信昵称："+a.String.escapeHTML(d.nick||"")+"&nbsp;",a.Link.html({text:"更换帐号",cls:"nui-txt-link",click:function(){e._changeAccount(b)}}),"</p>","</div>",a.Button.html({extcls:"wJ1",icon:{type:"yixin-white-1",size:"l"},text:f?"分享给这位好友":"分享到易信朋友圈",click:function(){try{i.ps=a.Component.find("#addToYixinPicTxtInput").getValue()}catch(c){}var d,j;f?(d="sendp2p",j="&taid="+g.accountId):d="yxAuthShare",e._getApi(d,j,function(c){a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,url:c,rnd:!0,body:{content:JSON.stringify(i)},call:function(c){var d=JSON.parse(c.responseText);1===d.res?a.Msgbox.show({header:"系统提示",title:((b.attachInfo||{}).name||"图片")+"已成功分享"+(f?"给："+a.String.escapeHTML(g.nick):"到易信朋友圈")+"！",icon:"suc"}):a.Msgbox.show({header:"系统提示",title:"抱歉，分享失败，请稍候再试。",icon:"info"})}})}),h.destroy()}}),"</div>"].join("");h=new a.Msgbox({id:"yixinPreviewBox",contentType:"wide",noFooter:!0,header:f?"分享给好友："+a.String.escapeHTML(g.nick):"分享到易信朋友圈",content:j}),a.Component.setEvents()}}function h(d){function e(e){function h(b,d,f){var h,i=b!==c,j=i?b:e,k=document.createDocumentFragment(),l="YX_friend_",m="您还没有易信好友";i&&(h=function(a){return'<b class="nui-txt-mark">'+a+"</b>"},l+="search_",m="未找到昵称中包含“"+a.String.escapeHTML(d)+"”的好友"),0===j.length?a.fly("#YX_friend_list_empty").html(m).show():a.fly("#YX_friend_list_empty").hide();for(var n,o,p,q=0,r=j.length;r>q;q+=1)n=j[q],g[n.accountId]=n,o=a.String.escapeHTML(a.String.trim(n.nick||"")),i&&(o=o.replace(f,h)),p=document.createElement("li"),p.id=l+n.accountId,p.className="lC1",p.innerHTML=['<div class="jm1">','<div class="eV1"></div>','<img src="'+(n.icon||"http://yixin.dl.126.net/open/resource/images/common/default_ava.png")+'" width="30" height="30" />',"</div>",'<div class="ly1">',o,"</div>"].join(""),k.appendChild(p);i?a.fly("#YX_friend_search_list").empty().append(k):a.fly("#YX_friend_list").append(k)}function i(b){var c,d=a.String.trim(b.getValue()),e=b.currentSearchKey,g=f.friendsList,i=[];if(0!==g.length){if(e!==d)if(c=a.AddressSupport._getReg(d),""===d&&e!==d)a.fly("#YX_friend_list_empty").hide(),b.currentSearchKey=d;else{for(var j,k=0,l=g.length;l>k;k+=1)j=g[k],c.test(j.nick||"")&&i.push(j);h(i,d,c),b.currentSearchKey=d}""===d?(a.fly("#YX_friend_search_list").hide(),a.fly("#YX_friend_list").show()):(a.fly("#YX_friend_list").hide(),a.fly("#YX_friend_search_list").show())}}var j,k=['<div class="tU1">','<div class="jj1">','<div class="fB1">选择易信好友</div>','<div class="dt1">',a.Input.html({placeholder:"搜索易信好友",iconBtn:"search",width:"116px",voiceInput:!0,maxLength:50,listeners:{keyup:function(){var a=this;try{b.clearTimeout(a.searchTimer)}catch(c){}a.searchTimer=b.setTimeout(function(){i(a)},500)}},iconbtnclick:function(){this.fire("keyup")}}),"</div>","</div>",'<div id="YX_friend_list_empty" style="text-align:center;line-height:48px;display:none;"></div>','<div class="lD2" id="YX_friend"><ul id="YX_friend_list"></ul><ul id="YX_friend_search_list" style="display:none;"></ul></div>',"</div>"].join("");j=a.Msgbox.show({header:"分享给易信好友",contentType:"wide",noFooter:!0,content:k}),f.friendsList=e,h(),a.Event.live({context:b.document.getElementById("YX_friend"),event:"click",selector:".lC1",handler:function(a,b){d(g[b.currentTarget.id.split("_").pop()])}}),a.Component.setEvents()}var f=this,g=f.friends;a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,url:f._getApi("friendlist"),rnd:!0,call:function(b){var c=JSON.parse(b.responseText);0===c.code?e(c.friendlist):a.Msgbox.show({header:"系统提示",title:"抱歉，获取好友列表失败，请稍候再试。",icon:"info"})}})}function i(b,d){var e,f=this,g=b.type;switch(g){case"textFavr":case"imageFavr":case"imageShare":e=g}return d===c?(f.queryAuth({call:a.Function.bind(f.entry,f,b)}),void 0):(f[e].apply(f,arguments),void 0)}function j(b,c,d){if(!d)return a.Uri.getUrl("yixin_api",!0).replace("API",b)+(c||"");var e=this;a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,url:e._getApi("settkn"),rnd:!0,call:function(f){var g=JSON.parse(f.responseText);return g.tkn?(d(e._getApi(b,c)+"&tkn="+g.tkn),void 0):(a.Msgbox.show({header:"系统提示",title:"抱歉，您的登录状态已失效，请重新登录邮箱后再试。",icon:"err"}),void 0)}})}function k(b,c){var d=this;a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,url:d._getApi("markPic","&mid="+b.mid+"&part="+b.part),rnd:!0,call:function(b){var d=JSON.parse(b.responseText);return 0!==d.res?(a.Msgbox.show({header:"系统提示",title:"抱歉，您的登录状态已失效，请重新登录邮箱后再试。",icon:"err"}),void 0):(c("http://yxproxy.mail.163.com/yixinproxy/picSeri.do?rank="+d.code),void 0)}})}function l(d){var e=this,f="fYiXin_"+(new Date).getTime().toString();return $S(f,d),a.Msgbox.show({id:"yixinOauthBox",header:"易信Oauth接入",contentType:"wide",noFooter:!0,content:'<iframe src="https://open.yixin.im/oauth/authorize?response_type=code&client_id='+e.APPKEY+"&redirect_uri="+b.encodeURIComponent(e._getApi("cb","&cb="+f+"&domainpath="+$S("host")))+'" frameborder="0" style="border:0;width:100%;height:469px"></iframe>',height:"500px",width:"500px",close:function(){$S(f,c)}}),f}function m(a){var b=this;try{$C("yixinPreviewBox").destroy()}catch(c){}b._logout(function(){b._showOauth(function(c){b.entry(a,c)})})}function n(b){p.request({requestType:a.Ajax.IFRAME,method:a.Ajax.GET,url:"https://open.yixin.im/logout",call:b})}function o(b){$E("product.Yixin",function(c){function d(){for(var a=0,b=f.length;b>a;a++)try{var d=f[a],g=c.get(d);if(g)for(var h=e[d],i=0,j=h.length;j>i;i++){var k=h[i],l=k.rawConfig;l.yixin=!0;var m=l.vip;m||k.update({})}}catch(n){}}try{var e={},f=[],g={};try{for(var h=0,i=b.length;i>h;h++)try{var j=b[h],k=j.rawConfig,l=k.yixin;if("undefined"==typeof l){try{var m=a.String.trim(k.address.toLowerCase());if(m){g[m]||(f.push(m),e[m]=[],g[m]=!0);var n=e[m];n.push(j)}}catch(o){}k.yixin=!1}}catch(o){}}catch(o){}f.length>0&&c.request({keys:f,callback:d})}catch(o){}})}var p=a.Ajax,q=a.createClass($N("support.YixinSupport"));a.Object.extend(q,{APPKEY:"yxf1e418d8ad4b42c6b061bf41d8840755",friends:{},friendsList:[],queryAuth:d,textFavr:e,imageFavr:f,imageShare:g,selectFriend:h,entry:i,mark:o,_getApi:j,_getWmsvrImgAddr:k,_showOauth:l,_changeAccount:m,_logout:n})}(window.$,window),function(a,b,c){function d(b,c){var d=this;$S("fullDomain");var e=$S("domain"),f=$S("orgUid"),g=d.product[e],h=a.Uri.getUrl("backurl",!0);if(!$S("isMailMasterLogined")){try{var i=a.Cookie.get("MAIL_MISC");if(i||(i=a.Cookie.get("S_INFO").split("|")[3]||""),i=i.replace(/\'/g,"")){var j=i.split("#");if(1===j.length)return d.hasRelateAccount=!1,void 0;d.hasRelateAccount=!0}}catch(l){}var m=a.Uri.getUrl("getRelateAccount",!0)+"?username={0}&product={1}";m=a.Support.format(m,f,g),a.Ajax.paddingGetRelateAccount=function(d){for(var e=d.substr(1).split("&"),f=["type","username","relateUsernames","relateUserStatus"],g={},h=0,i=e.length;i>h;h++)for(var j=e[h].split("="),l=0,m=f.length;m>l;l++)if(f[l]===j[0]){g[f[l]]=decodeURIComponent(j[1]);break}if(g.type&&200===g.type-0){var n=[],o=[],p=!1;n=g.relateUsernames.split(","),o=g.relateUserStatus.split(","),k.emRelateAccounts={};for(var q=n.length-1;q>-1;q--)n[q]+=-1===n[q].indexOf("@")?"@163.com":"",k.emRelateAccounts[n[q]]=0|o[q],n[q]===$S("orgUid")&&(n.splice(q,1),p=!0);if(n=p?n:[],n.length>0){a.Ext.accountRelate=!0;var r=$G.attrs.user.ntes_labs;if(r&&"0"===r.substr(20,1)){var s="http://lab.mail."+$S("domain")+"/labweb/lab.do?m=submit&id=20&act=enable&uid="+$S("orgUid")+"&sid="+$S("sid")+"&host="+$S("host");a.Ajax.jsonp(s,function(){},"jsonp")}}k.relateAccount=n,c&&c(),a.Listener.listen("accountRelate:getCount",function(b,c){if(b&&(k.relateAccountCount[b]=c,c.newCount>0)){var d=document.getElementById("_account_"+b);d&&a(d).html("<strong>("+c.newCount+")</strong>")}var e=0,f=0;for(var g in k.relateAccountCount)e+=k.relateAccountCount[g].newCount,f++;e+=$I("init.Folder").getTotal("unread");try{e>0?a(document.getElementById("_account_"+$G.user.uid)).html("<strong>("+e+")</strong>"):a(document.getElementById("_account_"+$G.user.uid)).html("")}catch(h){}var i=a.fly("#spnUid");i&&(i.dom.title="您已关联"+f+"个网易邮箱，共有"+e+"封未读邮件")}),k.getAllAccountCount(),a.Listener.listen("accountRelate:unRelate",function(a){delete k.relateAccountCount[a]})}else b||a.Msgbox.show({title:"获取关联帐号信息失败，请退出登录重试"}),a.Log.cache({account_related_error:g.type||"unknow"},!0)},h+="parent.$.Ajax.paddingGetRelateAccount&contact=location.search",a.Ajax.request({method:"post",requestType:a.Ajax.IFRAME,url:m,body:{loginCookie:a.Misc.getMailSess(),url:h}})}}function e(a){k.switchUid=a,k.switchAccount($S("orgUid"))}function f(c,d){function e(b,c){var d={loginCookie:a.Misc.getMailSess()};c&&(d.password=c),a.Ajax.request({method:"post",requestType:a.Ajax.IFRAME,url:b,body:d})}function f(){a.Msgbox.show({header:"密码验证",title:"您已设置&nbsp;"+a.Support.trimAccount(d)+"&nbsp;为所有关联邮箱中的重要邮箱，需要输入该邮箱密码才能进行切换：",type:"prompt",inputLabel:"邮箱密码：",inputType:"password",ok:function(b){return""===a.String.trim(b)?"请输入密码！":(e(t,h.encode(b)),!0)}}),a.Event.fire(document.body,"click")}var g=this;try{var h=$L("util.MD5",this)}catch(i){return i}if(d)return k.beforeSwitch(d),void 0;
(new a.DataAction).wmsvr({func:"user:getAttrs"});var j=k.relateAccount,l=c;if(l===$S("orgUid")||a.Array.has(j,l)){d=k.switchUid;var m,n=d.split("@")[1];a.Uri.getUrl("errorpage",!0);var o=this.product[n],p=7,q=p,r={"163.com":"http://entry.mail.163.com/coremail/fcg/ntesdoor2?lightweight%3D1%26verifycookie%3D1%26language%3D-1%26style%3D"+p+"%26df%3Dwm_switch","126.com":"http://entry.mail.126.com/cgi/ntesdoor?hid%3D10010102%26lightweight%3D1%26verifycookie%3D1%26language%3D0%26style%3D"+p+"%26df%3Dwm_switch","yeah.net":"http://entry.mail.yeah.net/cgi/ntesdoor?lightweight%3D1%26verifycookie%3D1%26style%3D"+p+"%26df%3Dwm_switch","vip.163.com":"http://reg.vip.163.com/enterMail.m?style%3D"+q+"%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26username%3D"+d,"188.com":"http://reg.mail.188.com/servlet/enter?verifycookie=1&enterWebmail=1&language=0&style="+q+"&username="+d,"vip.126.com":"http://reg.vip.126.com/enterMail.m?style%3D"+q+"%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26username%3D"+d};m=m||r[n];var s=m+encodeURIComponent("&related=true&MAIL_MISC="+a.Cookie.get("MAIL_MISC").replace(/\'/g,"").replace(/#/g,"%23")),t=a.Uri.getUrl("accountRelate",!0)+"?chgUsername={0}&url={1}&url1={2}&url2={3}&url3={4}&product={5}&remind=1&noRedirect=1",u=encodeURIComponent(a.Uri.getUrl("backurl",!0)+"parent.$.Ajax.paddingAccountSwitch&contact=location.search");t=a.Support.format(t,d,u+encodeURIComponent("&result=success"),u+encodeURIComponent("&result=failed"),u,u,o),a.Ajax.paddingAccountSwitch=function(c){for(var d,e,h,i,j=c.substr(1).split("&"),k=0,l=j.length;l>k;k++){var m=j[k].split("=");"errorType"===m[0]&&(d=m[1]-0),"result"===m[0]&&(h=decodeURIComponent(m[1])),"url"===m[0]&&(i=decodeURIComponent(m[1]))}if(h&&"success"===h||"failed"===h)return b.gAd.getBiz=null,top.location.href=decodeURIComponent(s),void 0;if(402===d)return a.Support.relogin(),void 0;if(461===d)return f(),void 0;if(428===d)return b.gAd.getBiz=null,top.location.href=i+"&url="+s,void 0;e=g.errorCode[d];try{a.Msgbox.msgbox&&a.Msgbox.msgbox.input?a.Msgbox.msgbox.input.showTips(e):a.Msgbox.show({title:e})}catch(n){return n}},e(t)}else a.Support.relogin("您已登录网易其他帐号，请重新登录。")}function g(){var b=this,c=k.relateAccount,d=b.product[$S("domain")];a.Ajax.jsonp("http://msg."+$S("fullDomain")+"/cgi/mc?funcid=getallmsgcnt&fid=0&username="+$S("uid")+"&product="+d,function(b){if(b)for(var d=0;d<c.length;d++){var e=c[d],f=b[e];if(f){var g=f.UNREAD,h=f.MSGCOUNT;if(-1===h)continue;g=Math.max(g,0),h=Math.max(h,0);var i={total:h,newCount:g};a.Listener.fire("accountRelate:getCount",e,i)}}})}function h(){var b={"163.com":"mail.163.com","126.com":"mail.126.com","yeah.net":"mail.yeah.net","vip.163.com":"vip.163.com","vip.126.com":"vip.126.com","188.com":"vip.188.com"},c=k.relateAccount;$I("init.Folder").getTotal("unread");for(var d=0;d<c.length;d++){var e=c[d];a.Ajax.jsonp("http://msg."+b[e.split("@")[1]]+"/cgi/mc?funcid=getusrnewmsgcnt&fid=0&addSubFdrs=1&language=0&style=0&template=newmsgres_setcookie.htm&cuslog=true&username="+e,function(b,c,d){b-=0,b=Math.max(b,0),c=Math.max(c,0);var e={total:c,newCount:b};a.Listener.fire("accountRelate:getCount",d,e)})}}function i(b){var c="",d=b.split("@")[1],e=!1;if(("163.com"===d||"126.com"===d||"yeah.net"===d)&&(e=!0),e){var f="mail"+d.split(".")[0],g={"126.com":"https://ssl.mail.126.com/entry/cgi/ntesdoor?","163.com":"https://ssl.mail.163.com/entry/coremail/fcg/ntesdoor2?","yeah.net":"https://ssl.mail.yeah.net/entry/cgi/ntesdoor?"},h="df=webmail&from=web&funcid=loginone&passtype=1&style=5&product="+f+"&"+"uid="+b;"hw"===a.Cookie.get("mail_dist")&&(h+="&mail_dist=hw"),c=g[d]+h}else{var i={"vip.163.com":"https://reg.163.com/logins.jsp?product=mailvip&type=1&url={0}&url2={1}","188.com":"http://reg.mail.188.com/servlet/login?verifycookie=1&enterWebmail=1&language=0&style=1%26df%3Dwebmail_relogin","vip.126.com":"https://reg.163.com/logins.jsp?product=mailvip&type=1&url=http://reg.vip.126.com/enterMail.m?style%3D9%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26username%3D"+b+"&url2=http://reg.vip.126.com/logon.m?style%3D9%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26df%3Dwebmail_relogin%26username%3D"+b};c=i[d]}return c}var j=a.Object,k=a.createClass($N("product.AccountRelate"));j.extend(k,{isMailMasterLogined:!1,hasRelateAccount:c,init:d,beforeSwitch:e,switchAccount:f,getCount:h,getAllAccountCount:g,relateAccountCount:{},relateAccount:[],product:{"126.com":"mail126","163.com":"mail163","yeah.net":"mailyeah","188.com":"mail188","vip.163.com":"mailvip","vip.126.com":"mailvip"},switchUid:null,errorCode:{401:"URL语法错误或参数值非法",402:"超时了，请您重新登录！",412:"您尝试的次数已经太多,请过一段时间再试",414:"您的IP登录失败次数过多,请稍后再试",415:"您今天登录错误次数已经太多,请明天再试",416:"您的IP今天登录过于频繁，请稍后再试",417:"您的IP今天登录次数过多，请明天再试",418:"您今天登录次数过多,请明天再试",419:"您的登录操作过于频繁，请稍候再试",420:"用户名不存在",422:"帐号锁定或靓号服务已到期",423:"VIP或188帐号已到期，请续费！",460:"密码错误",461:"重要帐号，需要验证密码",464:"帐号无关联关系",500:"系统繁忙，请您稍后再试！",503:"系统维护，请您稍后再试！"},emRelateAccounts:{},_getLoginUrl:i})}($,window),function(){function a(a){if(a.length&&a.length>0)for(var b=0;b<a.length;b++)arguments.callee(a[b]);else if(a.data){var c;"string"==typeof a.data&&(a.data=$.Eval.get(a.data)),c="string"==typeof a.data.event?a.data.event:(a.data.event||[])[0],c&&h._customEvent.fire(c,a.data)}}function b(){$I("init.Sync").request()}function c(){var a=new g.base.CustomEvent;this._customEvent=a;var b=this._events;for(var c in b){var d=b[c];a.listen(c,function(a){return function(b){a&&(b=a(b))}}(d,c))}g.comet.App.create({baseUrl:this._baseUrl,pushType:"ajax-flash",product:"all",call:function(b){a.fire("global",b)},service:"push"})}function d(){g.comet.App.init()}function e(){window.MailMsg.listen()}function f(){window.MailMsg.publish({uid:window.MailMsg.uid,event:"push_login",product:h._product})}var g=window.netease.mail,h=$.createClass($N("product.PushMail"));$.Object.extend(h,{_baseUrl:"http://push.webmail.mail."+$G.environment.domain+"/cometd",_product:"webmail",_events:{global:a,push_login:null,print:null,pushmail:b,imageUpload:function(a){$.Listener.fire("compose:imageUpload",a),$.Listener.fire("compose:imageUpload")},logout:function(a){$.Listener.fire("global:sweeplogout",a)}},_customEvent:null,init:c,subscribe:d,listen:e,login:f})}(),function(a,b){function c(c){function d(){a.Event.live({context:a(".gWel-pure .gWel-pure-preview .gWel-pure-switcher"),selector:"a.item",event:"click",handler:function(c,d){a(".gWel-pure .gWel-pure-preview .gWel-pure-switcher .item-on").removeClass("item-on");var e=a(d.currentTarget);e.addClass("item-on"),a(".gWel-pure .gWel-pure-preview .gWel-pure-pic").attr({src:e.attr("data-src")}),b.clearInterval(k)}})}function e(){var b=a(".gWel-pure .gWel-pure-preview .gWel-pure-switcher .item-on");b.removeClass("item-on");var c=b.next();null===c.dom&&(c=a(b.dom.parentNode.firstChild)),c.addClass("item-on"),a(".gWel-pure .gWel-pure-preview .gWel-pure-pic").attr({src:c.attr("data-src")})}var f,g,h,j=[];c.properties,g=c.price,h=c.unit,f=c.discount;var k=null;j[j.length]='<div class="gWel-pure"><h3 class="gWel-pure-title">首套邮箱付费唯美动态主题--纯净邮箱预览</h3><div class="gWel-pure-content">',j[j.length]='<div class="gWel-pure-preview"><img class="gWel-pure-pic" src="http://mimg.127.net/p/js6/lib/img/pure/20150824/0.gif" style="width:566px;height:330px;" alt=""/><div class="gWel-tabs-panel-ctrl gWel-pure-switcher" ><a href="javascript:void(0);" class="item item-on" data-index="0" data-src="http://mimg.127.net/p/js6/lib/img/pure/20160420/0.gif"><b class="gWel-ico"></b></a><a href="javascript:void(0);" class="item" data-index="1" data-src="http://mimg.127.net/p/js6/lib/img/pure/20150824/1.gif"><b class="gWel-ico"></b></a><a href="javascript:void(0);" class="item" data-index="2" data-src="http://mimg.127.net/p/js6/lib/img/pure/20150824/2.gif"><b class="gWel-ico"></b></a><a href="javascript:void(0);" class="item" data-index="3" data-src="http://mimg.127.net/p/js6/lib/img/pure/20150824/3.jpg"><b class="gWel-ico"></b></a></div></div>';var l=$S("ad").show===!1&&"ud"==$S("ad").userType,m=l?"再次购买":"立即购买";j[j.length]='<div class="gWel-pure-text"><div class="gWel-pure-price"><p style="white-space:nowrap;"><strong><em>'+f+"</em>元/"+i.UNIT_KEY[h]+"</strong> <del>原价："+g+"元/"+i.UNIT_KEY[h]+"</del></p>"+'<p id="dvPureExpireTime"></p>'+"</div>"+'<div class="gWel-pure-button">'+a.Button.html({subclass:"mainBtn",text:m,click:function(){i._goBuy("noAd"),a.Msgbox.msgbox.hide(),b.clearInterval(k)}})+a.Button.html({text:"了解更多",click:function(){a.Msgbox.msgbox.hide(),b.clearInterval(k),b.open("http://activity.vip.163.com/activity/event/20150518/pure.html?from=js6tanchuang")}})+"</div>"+'<div style="margin-top:16px;">'+'<p><a href="http://activity.vip.163.com/activity/event/20150518/pure.html?from=webmail" target="_blank" class="nui-txt-link">新用户免费试用1个月&gt;</a></p>'+"</div>"+"</div>",j[j.length]="</div></div>",a.Msgbox.show({extcls:"gWel-pure-msgbox",noHeader:!0,noFooter:!0,content:j.join(""),width:"1000px",contentType:"custom",close:function(){a.Msgbox.msgbox.hide(),b.clearInterval(k)}}),d(),k=b.setInterval(e,2e3),i.checkProductExpire("noAd",function(b){var c,d=!1;if(0>b)c="到期时间：永久";else if(0===b)c="您的纯净邮箱已过期",d=!0;else{var e=a.Misc.getTime(),f=e.getTime(),g=new Date(b),h=a.Date.format(g,"yyyy-MM-dd");c=2592e6>=b-f?"即将到期："+h:"到期时间："+h}a("#dvPureExpireTime").html(c),d&&a("#dvPureExpireTime").addClass("nui-txt-impt")})}function d(b){var c=i.PRODUCT_ID[b];if(null!==c){var d=a.Uri.getUrl("privileges_product")+"&gid="+c,e=this;a.Ajax.jsonp(d,function(c){if(200==c.code){var d,f,g=[],h=c.result,j=(h.properties,h.price,h.unit),k=h.discount;if(g[g.length]='<div class="APP-appcenter-gPrivilege"><table align="center" class="APP-appcenter-gPrivilege-table">',"noAd"==b)return i._noAdShow(h),void 0;switch(b){case"cloudFile":f="升级云附件保存期限",d='普通用户的云附件存储有效时间（即保存期限）一般为 15-30天，通过付费后，可以升级云附件存储时间为50天。</p><p class="pP1">小提示：购买该服务后，在购买之后的云附件保存期限才能进行升级，购买之前的云附件保存期限将不能更改。</p>',g[g.length]='<thead><tr><th class="th1">当前保存期限</th><th class="th2">选择升级后的保存期限</th><th class="th3">升级费用</th></tr></thead><tbody><tr><td rowspan="2" class="col1">15天</td></tr><tr><td class="col2"><span class="nui-chk-text">50天</span></td><td class="col3">'+e.parsePrice(k,j)+'<span id="dv'+b+'ExpireTime" class="nui-txt-normal"></span>'+"</td>"+"</tr>"+"</tbody>";break;case"deleteRecovery":f="邮件误删恢复",d='邮件误删恢复开启后： </p><p class="pP1">1.资料有保障：您的邮件双重备份 </p><p class="pP1" style="padding-top: 2px;">2.恢复很容易：您可以随时恢复10天内删除的邮件 </p><p class="pP1">小提示：<strong class="nui-txt-impt">未开启前删除的邮件无法恢复</strong>，建议您立即开启',g[g.length]='<thead><tr><th class="th1">可恢复的内容</th><th class="th2">服务费用</th></tr></thead><tbody><tr><td class="col2"><span class="nui-chk-text">10天内删除的邮件</span></td><td class="col3">'+e.parsePrice(k,j)+'<span id="dv'+b+'ExpireTime" class="nui-txt-normal"></span>'+"</td>"+"</tr>"+"</tbody>"}g[g.length]='</table><p class="pP1">'+d+"</p>"+"</div>",a.Msgbox.show({header:f,type:"confirm",okText:"立即购买",contentType:"custom",content:g.join(""),ok:function(){i._goBuy(b)}}),"deleteRecovery"==b&&i.checkProductExpire(b,function(c){var d;if(c>0){var e=new Date(c),f=a.Date.format(e,"yyyy-MM-dd");d="到期时间："+f,a("#dv"+b+"ExpireTime").html("( "+d+" )")}})}})}}function e(b,c){var d=i.PRODUCT_ID[b];if(d){c=c||"mailjs6";var e=a.Uri.getUrl("privileges_buy")+"&gid="+d+"&from="+c;$E("interface.OutlinkInterface",function(a){a.goOutlink({key:"privileges_buy",url:e,title:"购买支付"})})}}function f(b,c){switch(b){case"cloudFile":var d=a.Uri.getUrl("privileges_cloudFile")+"&op=get";a.Ajax.request({url:d,requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,call:function(b){try{var d=a.Eval.get(b.responseText);200==d.code&&c&&c(d.data.duration)}catch(e){}}});break;case"deleteRecovery":var e=$S("attrs").subcos.split(",");$S("is163")?a.Array.has(e,"166")?c&&c(!0):c&&c(!1):$S("is126")?a.Array.has(e,"419")?c&&c(!0):c&&c(!1):$S("isyeah")&&(a.Array.has(e,"681")?c&&c(!0):c&&c(!1))}}function g(b,c){var d=i.PRODUCT_ID[b];if(null!==d){var e=a.Uri.getUrl("privileges_expire")+"&prdid="+d;a.Ajax.jsonp(e,function(a){if(200==a.code){var b=a.result,d=b.exptime;c(d)}})}}function h(a,b){return 0==b?"<strong>"+a+"</strong>元 ":"<strong>"+a+"</strong>元 /"+i.UNIT_KEY[b]+" "}a.Object,a.Function,a.Array;var i=a.createClass($N("product.Privileges"));a.Object.extend(i,{PRODUCT_ID:{cloudFile:3,deleteRecovery:6,noAd:4},UNIT_KEY:{0:"永久",1:"页",2:"月",12:"年"},showProduct:d,checkProductExpire:g,_noAdShow:c,getProductStatue:f,_goBuy:e,parsePrice:h})}($,window),function(a){function b(a){var b=h.getModule();if(b&&b.name.indexOf("contact.ContactModule")>=0)b.cache("welcome",a);else{var c=i.get("contact.ContactModule");c?(i.go({module:"contact.ContactModule",param:{}}),c.cache("welcome",a)):i.go({module:"contact.ContactModule",param:{},__other:a})}}function c(a){var b=this;a&&b.entry({action:a})}function d(a){var b=this;if(a){var c=h.getModule()||{},d={action:"Search",key:a};return c.name&&c.name.indexOf("contact.ContactModule")>=0?(c.entryCall(d),void 0):(b.entry(d),void 0)}}function e(a){var b=this,c=h.getModule()||{},d={action:a.id?"Modify":"Add",id:a.id,data:a?{FN:a.name||"",N:";"+(a.name||"")+";;;",NICKNAME:a.nickname||"","EMAIL;PREF":a.email||"","TEL;type=CELL;type=VOICE;type=pref":a.phone||"",GROUPING:a.grouping||""}:null};return"contact.ContactModule"===c.name?(c.entryCall(d),void 0):(b.entry(d),void 0)}function f(a){if(a){var b=i.find("contact.ContactModule_0");b&&b.action.reflash({call:function(){j.update(),j.getModule(b);try{b.emptyAddList()}catch(a){}}})}}function g(a){try{h.getModule().response.mergeResponse(a)}catch(b){}}var h=a.Context,i=a.JS,j=a.Nav,k=a.Object,l=a.createClass($N("interface.AddressInterface"));k.extend(l,{entry:b,directEntry:c,search:d,contactModify:e,contactRefresh:f,mergeCall:g})}($,window),function(a,b){function c(b){var c="t2";$S("isVip")&&(c="recommend_app");var d=a.Array.findObject($G.get("multiTabConf"),"tabid",c)||{},e={};b&&b.showinfo&&(e.showinfo=b.showinfo),b&&b.name&&(d.name=b.name),$E("interface.OutlinkInterface",function(a){a.goOutlink({key:d.name,title:d.text,fullScreen:d.fullScreen,group:d.group,param:e})})}function d(a){this.entry({showinfo:a})}function e(b){function c(b){var c=a.AppManager.getApp(b),e=c&&c.display;$S("isVip")&&(e=!a.Object.isEmpty(c)),e?a.AppManager.startApp(b):d.entryAndShowApp(b)}var d=this;if(a.Object.isObject(b)){var e=b,f=e.key,g=e.title,h=e.url;g&&h?$E("interface.OutlinkInterface",function(a){a.goOutlink(e)}):c(f)}else c(b)}function f(a){a=a||{},a.name="msgcenter",a.text="消息中心";var b=a.param||{};a&&a.sysMsg&&(b.msgType="sysMsg"),$E("interface.OutlinkInterface",function(c){c.goOutlink({key:a.name,title:a.text,fullScreen:!0,param:b})})}function g(c){var d=c.url||c.id,e={};if(c.newWindow){var f=a.Uri.getUrl(d);return f&&b.open(f),void 0}$E("interface.OutlinkInterface",function(a){var b={key:d,title:c.name,fullScreen:!0,param:e};c.isBeta&&(b.isBeta=!0),a.goOutlink(b)})}function h(){var a=b.location.host;return a.indexOf("o.mail")>-1||a.indexOf("d.mail")>-1?62001:152e3}function i(a,b){var c=this;c.gotoApp({key:c.appIdForYiqipin(),title:"一起拼",url:b&&b.indexOf("http://")>-1?b:"http://pin.mail.163.com?utm_source=webmail&utm_medium="+a,fullScreen:!0,appId:c.appIdForYiqipin()})}var j=a.createClass($N("interface.AppCenterInterface"));a.AppCenterInterface=j,a.Object.extend(j,{entry:c,entryAndShowApp:d,gotoApp:e,gotoCorpApp:g,goMsgCenter:f,gotoYiqipin:i,appIdForYiqipin:h})}($,window),function(a,b){function c(a){$E("interface.ComposeInterface",function(b){b.entry(a)})}function d(a){var b="ifrmYixin";v._setBox(a,b)}function e(a){v._previewImages(a.images)}function f(b){var c=this;b=b||{};var d=b.call;a.fly(document).listen("click",function(){d&&d(),c.changeIframeIndex(!0,!0)}),a.Listener.fire("plugin:yixin_loaded")}function g(c){c=c||{};var d=c.images,e="dvYixinWrapper",f=a("#"+e);if(d&&d.length>0?(delete c.images,b.gYixinImageIndex=0,b.gYixinImageIntervel&&b.clearInterval(b.gYixinImageIntervel),1===d.length?f.css({background:d[b.gYixinImageIndex]}):b.gYixinImageIntervel=b.setInterval(function(){b.gYixinImageIndex++,b.gYixinImageIndex===d.length&&(b.gYixinImageIndex=0),f.css({background:d[b.gYixinImageIndex]})},400)):b.gYixinImageIntervel&&b.clearInterval(b.gYixinImageIntervel),c.cursor||(c.cursor="pointer"),c.zIndex&&c.zIndex>0?(this.changeIframeIndex(!0),delete c.zIndex):this.changeIframeIndex(!1),c.yxText){var g=a("#dvYixinText");g&&g.html(c.yxText),delete c.yxText}f.css(c)}function h(b,c){var d="dvYixinWrapper",e=$S("navTopAccount");if(!e){if(e=a("#"+d),!e)return;$S("navTopAccount",e.findParent("li"))}if(b){var f=$S("ifrmYixinTop");if(!f&&!c){var g=a("#ifrmYixin");g&&g.css({top:"-15px"}),$S("ifrmYixinTop",!0)}e.addClass("hj1")}else e.removeClass("hj1")}function i(){$S("accountMenu")&&$S("accountMenu").hide(),a.Menu&&a.Menu.hideAllMenu(),b.gYixinBoxLayer&&b.gYixinBoxLayer.fire("closeclick"),this.changeIframeIndex(!1);var c=a.SenderList.getMobile();c=c?c.address.split("@")[0]:"",a.Log.cache({topNav_yixinPlugin_click:!0,topNav_yixinPlugin_userMobile:c})}function j(a){var b="ifrmMusic";v._setBox(a,b)}function k(b){var c=b&&b.url||"http://music.163.com/musicbox?ref=mail#http://"+$S("host")+"/proxy.htm",d="music_outlink";$E("interface.OutlinkInterface",function(a){a.goOutlink({key:d,title:"网易云音乐",url:c,fullScreen:!0,group:d,removeSameModule:!0})}),a.Log.cache({topNav_musicPlugin_click:1})}function l(a){var b="ifrmVipMsgCenter";v._setBox(a,b)}function m(b){$E("interface.OutlinkInterface",function(a){a.goOutlink({key:b,title:"消息中心",fullScreen:!0,group:"vipMsgCenter"})}),a.Log.cache({topNav_vipMsgCenter_click:b})}function n(a){var b="ifrmMailMaster";v._setBox(a,b)}function o(a){v._previewImages(a.images)}function p(b){var c=this;b=b||{};var d=b.call;a.fly(document).listen("click",function(){d&&d(),c.changeIframeIndex(!0,!0)}),a.Listener.fire("plugin:mailmaster_photouploader_loaded")}function q(c){c=c||{};var d=c.images,e="dvIfrmMailMasterWrapper",f=a("#"+e);d&&d.length>0?(delete c.images,b.gAppInterface_MailMaster_ImageIndex=0,b.gAppInterface_MailMaster_ImageIntervel&&b.clearInterval(b.gAppInterface_MailMaster_ImageIntervel),1===d.length?f.css({background:d[b.gAppInterface_MailMaster_ImageIndex]}):b.gAppInterface_MailMaster_ImageIntervel=b.setInterval(function(){b.gAppInterface_MailMaster_ImageIndex++,b.gAppInterface_MailMaster_ImageIndex===d.length&&(b.gAppInterface_MailMaster_ImageIndex=0),f.css({background:d[b.gAppInterface_MailMaster_ImageIndex]})},400)):b.gAppInterface_MailMaster_ImageIntervel&&b.clearInterval(b.gAppInterface_MailMaster_ImageIntervel),c.cursor||(c.cursor="pointer"),c.zIndex&&c.zIndex>0?(this.changeIframeIndex(!0),delete c.zIndex):this.changeIframeIndex(!1),f.css(c)}function r(b,c){var d="dvIfrmMailMasterWrapper",e="cachedvIfrmMailMasterWrapper",f=$S(e);if(!f){if(f=a("#"+d),!f)return;$S(e,f.findParent("li"))}if(b){var g=$S("ifrmMailMasterTop");if(!g&&!c){var h=a("#ifrmMailMaster");h&&h.css({top:"-15px"}),$S("ifrmMailMasterTop",!0)}f.addClass("hj1")}else f.removeClass("hj1")}function s(){$S("accountMenu")&&$S("accountMenu").hide(),a.Menu&&a.Menu.hideAllMenu(),this.changeIframeIndex(!1),a.Log.cache({topNav_mailmaster_photoloader_click:!0})}function t(b,c){var d=(b.height||20)+"px",e=(b.width||20)+"px",f=c,g=a("#"+f),h={height:d,width:e};if(a.Object.isNumber(parseInt(b.left,10))){var i=b.left+"px";h.left=i}g.css(h)}function u(c){var d=this,e=b.Preview;return c=c||[],0!==c.length?e?(e.init({mustArr:!1,data:c}),void 0):(a.Ajax.request({requestType:a.Ajax.SCRIPT,url:"http://mimg.127.net/xm/all2/preview/preview-1.4.min.js",call:function(){void 0!==b.Preview&&d._previewImages(c)}}),void 0):void 0}var v=a.createClass($N("interface.AppInterface"));a.AppInterface=v,a.Object.extend(v,{meitu:{compose:c},yixin:{setBox:d,bodyClick:f,setWrapperStyle:g,changeIframeIndex:h,previewImages:e,frameClick:i},cloudmusic:{setMusicBox:j,goMusicBox:k},vipMsgCenter:{setBox:l,gotoPage:m},mailmaster:{setBox:n,bodyClick:p,setWrapperStyle:q,changeIframeIndex:r,previewImages:o,frameClick:s},_previewImages:u,_setBox:t})}($,window),function(a){function b(a){try{var b=$L("module.compose.ComposeManager")}catch(c){return c}b.entry(a)}function c(a,b){var c=this;c.entry({type:"reply",param:a,history:b})}function d(a,b){var c=this;c.entry({type:"forward",param:a,history:b})}function e(a){var b=this;a&&a.folderData&&a.folderData.flags&&a.folderData.flags.locked?$E(["product.MailUnlock"],function(c){c.unlockMail(function(){b.entry({type:"draft",param:a})},function(){})}):b.entry({type:"draft",param:a})}function f(a,b){var c=this;c.entry({type:"edit",param:a,history:b})}function g(){var b=a.Context.module;b&&b.mtype&&"compose.ComposeModule"==b.mtype&&b.base.connectBreak()}function h(){var b=a.Context.module;b&&b.mtype&&"compose.ComposeModule"==b.mtype&&b.base.sessionBreak()}function i(b,c,d){var e=a.Context.module;e&&e.mtype&&"compose.ComposeModule"==e.mtype&&e[b][c](d)}function j(a){try{var b=$L("module.compose.ComposeManager")}catch(c){return c}b.quickReply(a)}function k(a){try{var b=$L("module.compose.ComposeManager")}catch(c){return c}b.quickForward(a)}var l=a.Object,m=a.createClass($N("interface.ComposeInterface"));l.extend(m,{compose:b,entry:b,reply:c,forward:d,draft:e,edit:f,connectBreak:g,sessionBreak:h,currentCall:i,quickReply:j,quickForward:k})}($,window),function(){function a(a){"string"==typeof a&&(a={type:a}),a.section="mailcenter";var b=$.JS.get("options.AccountCenterModule",{});if(b)try{b._var.extra=a}catch(c){}$.JS.go({module:"options.AccountCenterModule",param:{},extra:a})}function b(a){"string"==typeof a&&(a={type:a});var b=$.JS.get("options.AccountCenterModule",{});if(b)try{b._var.extra=a}catch(c){}$.JS.go({module:"options.AccountCenterModule",param:{},extra:a,reset:!1})}var c=$.createClass($N("interface.MailCenterInterface"));$.Object.extend(c,{entry:a,related:b})}(),function(a,b,c){function d(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.data;d.flags.read^a.isRead&&(a.data=[d],b.setRead(a)),$S("lastRead",d.id)}function e(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}a.data.label0^a.flag&&(a.data=[a.data],b.setFlag(a))}function f(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.data.tag,e=a.tag,f=!1;f=a.isAdd?!(d&&E.has(d,e)):!e||d&&E.has(d,e),f&&(a.data=[a.data],b.setTag(a))}function g(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.type,e=a.defer,f=!1;switch(d){case"add":case"modify":f=!!e;break;case"complete":case"delete":f=!0}f&&(a.data=[a.data],b.setDefer(a))}function h(a){try{var b=$L("module.mbox.ListModule",this)}catch(c){return c}var d=a.isTop,e=a.data;!!d^!!e.flags.top&&(a.data=[e],b.setTop(a))}function i(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.memo,e=a.data;e.memo!==d&&b.setMemo({memo:d,data:[e]})}function j(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.ruleConditions,e=a.fids,f=a.attrs,g=a.callback;b.setFilter({ruleConditions:d,fids:e,attrs:f,callback:g})}function k(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=$I("init.Thread"),e=a.fid,f=d.check(e);b.setAllRead({area:"normal",body:{search:{fid:e,filter:{flags:{read:!1}}},action:{flags:{read:!0}},isThread:f}})}function l(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.data,e=a.moveToId;d.fid!==e&&(a.data=[d],b.move(a))}function m(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}a.isSpam;var d=a.data;a.data=[d],b.setSpam(a)}function n(a,b){$S("refw")||$S("refw",{});var c={};$S("refw")[a]?c=$S("refw")[a]:$S("refw")[a]=c,c[b]=!0}function o(b,c){if(b&&c?($S("brandAd",b),$S("brandData",c)):(b=$S("brandAd"),c=$S("brandData")),b&&c)try{setTimeout(function(){a.Context.getModule().initBrand()},0)}catch(d){}else a.Ajax.jsonp("http://mimg.127.net/m/subs/brands_"+$G.environment.domain.split(".")[0]+".js")}function p(a,b,c){try{var d=b&&"search"===b.type?"SearchAction":"ListAction",e=$L("module.mbox."+d,this)}catch(f){return f}(new e).getList(a,b,c)}function q(b){function c(){function a(){var a,c;c=Math.floor(d/p),r&&(a=c-1),s&&(a=c+1),k.autoGetData(a,b)}function b(){c=k.data;var a={pos:d};if(!i&&d>0){var b=D.clone(m),g=d-1;b.index=Math.floor(g/p),a.pre={moduleName:k.name,moduleParam:l,moduleExtend:b,folderData:c[g]}}if(!j&&f-1>d){var h=D.clone(m),n=d+1;h.index=Math.floor(n/p),a.next={moduleName:k.name,moduleParam:l,moduleExtend:h,folderData:c[n]}}e(a)}if(k&&k.data){for(var c=k.data,d=-1,f=k.getTotal(),g=0,n=c.length;n>g;g++){var q=c[g];if(q&&q.id===o){d=g;break}}if(d>-1){var r,s;!i&&d>0&&!c[d-1]&&(r=!0),!j&&f-1>d&&!c[d+1]&&(s=!0),r||s?a():b()}else h()}else h()}function d(){function a(){var a,c;c=Math.floor(f/p),s&&(a=c-1),t&&(a=c+1),k.autoGetData(a,b)}function b(){var a=k.result["var"],b={pos:f};if(!i&&f>0){var c=D.clone(m),d=f-1;c.index=Math.floor(d/p),b.pre={moduleName:k.name,moduleParam:l,moduleExtend:c,folderData:a[d]}}if(!j&&g-1>f){var h=D.clone(m),n=f+1;h.index=Math.floor(n/p),b.next={moduleName:k.name,moduleParam:l,moduleExtend:h,folderData:a[n]}}e(b)}var c=k.result;if(k&&c){for(var d=c["var"],f=-1,g=d.length,n=0,q=g;q>n;n++){var r=d[n];if(r===o||r.id===o){f=n;break}}if(f>-1){var s,t;!i&&f>0&&"string"==typeof d[f-1]&&(s=!0),!j&&g-1>f&&"string"==typeof d[f+1]&&(t=!0),s||t?a():b()}else h()}else h()}function e(a){function b(a){a.pre&&a.pre.folderData.fid!==e?F.getPosition({moduleName:f,data:a.pre.folderData,voidNext:!0,callback:function(b){a.pre=b.pre,c(a)}}):c(a)}function c(a){a.next&&a.next.folderData.fid!==e?F.getPosition({moduleName:f,data:a.next.folderData,voidPre:!0,callback:function(b){a.next=b.next,d(a)}}):d(a)}function d(a){h(a)}var e=k.param("fid");"folder"===k.extend("subtype")&&(k.extend("forceReplace")||k.extend("forceRequest")||k.extend("forcePage"))?b(a):d(a)}var f=b.moduleName,g=b.data,h=b.callback,i=b.voidPre,j=b.voidNext,k=a.JS.find(f);if(!k)return h(),void 0;var l=D.clone(k.param()),m=D.clone(k.extend()),n=k.extend("type"),o=g.id,p=m.limit;"search"===n?d():c()}function r(a){function b(a){h(a)}function c(a){return h(null,a),!0}try{var d=$L("module.mbox.MboxModule",this)}catch(e){return e}var f=a.mid,g=a.isThread,h=a.callback;d.action.getLetterInfo({id:f,isThread:g,callback:b,error:c})}function s(a){try{var b=$L("module.mbox.Letter",this)}catch(c){return c}var d=new b(null,a);return d.getSendLogo(a)}function t(b,c){var d=b.action,e=b.value,f=!1;switch(d){case"read":f=c.flags.read!==e,c.flags.read=e;break;case"flag":f=c.label0!==e,c.label0=e;break;case"tag":var g=b.isAdd,h=e,i=c.tag;if(g)i||(c.tag=i=[]),a.Array.has(i,h)||(i.push(h),f=!0);else if(h){for(var j=0,k=i.length;k>j;j++)if(i[j]===h){i.splice(j,1),f=!0;break}}else c.tag=i=[],f=!0;break;case"defer":f=c.flags.deferHandle!==e.deferHandle,c.flags.deferHandle=!!e.defer,e.deferHandle!==!1&&(f=f||c.defer!==e.defer||c.memo!==e.memo,c.defer=e.defer,c.memo=e.memo);break;case"memo":f=c.memo!==e,c.memo=e;break;case"top":f=c.flags.top!==e,c.flags.top=e;break;case"move":f=c.fid!==e,c.fid=e}return f}function u(){var a=$I("init.Folder").getFids();this.entry({fids:a,order:"deferredDate",desc:!1,filter:{defer:"19700101:"}},{type:"list",subtype:"defer"})}function v(a,b){if(a){var c;if(c="string"==typeof a?a:$I("init.Contacts").parseEmail(a)){b||(b={});var d={filter:{}},e=d.filter;if("from"===b.type)e.fromAddress=c;else if("to"===b.type){var f=$I("init.SenderList").getList(),g=[];E.each(f,function(a,b){g.push(b.address)}),e.fromAddress=g.join(),e.toAddress=c}else e.chatWithAddress=c;b.read===!1&&(e.flags={read:!1}),b.from&&(d.from=b.from),b.cid&&(d.cid=b.cid),this.entry(d,{type:"list",subtype:"contacts",systemContacts:b.systemContacts})}}}function w(){var a=[],b={};try{for(var d=$I("support.AddressSupport").getMarkData(),e=d.contact,f=0,g=e.length;g>f;f++){var h=e[f];if("group"!==h.ctype){var i=h.emails?h.emails:h.email?[h.email]:c;if(i)for(var j=0,k=i.length;k>j;j++){var l=i[j].toLowerCase();b[l]||(a.push(l),b[l]=!0)}}}}catch(m){}this.entry({filter:{chatWithAddress:a.join()||"",flags:{read:!1}},order:"from"})}function x(b){if(a.Ext.smart){var c,d=$I("init.Tag"),e=[];if(b)c=d.get(b,"smart",!0),c&&e.push(c.name);else for(var f in d.smarts)c=d.get(f,"smart",!0),c&&e.push(c.name);e.length>0&&this.entry({tag:e})}}function y(a){try{var b=$L("module.mbox.Field",this)}catch(c){return c}$I("init.Folder");var d=a.isFullSearch,e=a.keyword,f={};if(d){var g=$I("init.Folder").total.messageCount,h=$S("searchIndexed");if(h>=0)try{.9>h/g&&(d=!1)}catch(c){}}d?(f.pattern=e,f["fts.ext"]=!0,f["fts.fields"]=b.getField(),f.groupings={fromAddress:"",fid:"",sentDate:"","flags.attached":"","flags.read":""}):(f.operator="or",f.conditions=[{field:"subject",operator:"contains",ignoreCase:!0,operand:e},{field:"from",operator:"contains",ignoreCase:!0,operand:e},{field:"to",operator:"contains",ignoreCase:!0,operand:e}]),this.entry(f)}function z(a){var b={};b.conditions=[{field:"subject",operator:"contains",operand:a,ignoreCase:!0}],this.entry(b)}function A(b,d,e){var f=b.fid,g=b.tag,h=b.filter,i=h?h.flags:c,j=d.subtype;if(!j){var j;b.fid>0?j="folder":b.fids&&(g?j="tag":h&&(h.defer?j="defer":"string"==typeof h.fromAddress||"string"==typeof h.chatWithAddress||"string"==typeof h.toAddress?j="date"!==b.order?"emails":"contacts":D.has(h,"label0")?j="flag":h.sentDate?j="calendar":i&&D.has(i,"read")&&(j="read"),j||(j="filter"))),j&&(d.subtype=j)}var k=!1;if(a.Ext.brand)if("folder"===j)18===b.fid&&(k=!0);else if("tag"===j){var l=$I("init.Tag").get(b.tag[0],"brand");l&&(k=!0)}d.brand=k;var m=!1;if(a.Ext.smart&&"tag"===j){var l=$I("init.Tag").get(b.tag[0],"smart");l&&(m=!0)}d.smart=m;var n=!1;if(a.Ext.defer&&"folder"===j){var o=d.area,p=$I("init.Defer");"archive"!==o&&p.showTop(f)&&(n=!0)}d.expire=n;var q;q=i&&D.has(i,"read")?i.read:c,d.read=q;var r;r=h&&D.has(h,"label0")?h.label0:c,d.flag=r,$E("module.mbox.ListModule",function(a){if(!d.calendar){var c;if(h&&D.has(h,"sentDate")){var f=h.sentDate.split(":"),g=(a.parseSentDate(f[1]).getTime()-a.parseSentDate(f[0]).getTime())/1e3/60/60/24;c=0===g?"date":6===g?"week":"month"}d.calendar=c}a.entry(b,d,e)})}function B(a,b,c){b.subtype||(b.subtype=a.pattern?"full":"normal"),$E("module.mbox.SearchModule",function(d){d.entry(a,b,c)})}function C(b,c,d){var e=this;b||(b={});var f,g=!1;b.conditions||b.pattern||b.operator?(f="search",g=!0):f="list";var h,i=b.moduleName;i&&(h=a.JS.find(i)),h||!b||c||(h=a.JS.get("mbox."+(g?"SearchModule":"ListModule"),b)),h&&(b=h.param(),c=h.extend(),c.moduleName=h.name),c||(c={}),c.type||(c.type=f),b.order||(b.order="date"),"undefined"==typeof b.desc&&(b.desc="date"===b.order?!0:!1),b.desc=b.desc?!0:!1,c.index||(c.index=0);var j=$S("attrs").user.maxlist;if(a.Ext.limit_max){var k=20;j>k&&(j=k)}if(j!==c.limit&&(c.limit=j),!c.area){var l;switch(!b.mboxa&&a.Ext.archive&&g&&(b.mboxa="0"),b.mboxa){case"0":l="all";break;case"2":l="archive";break;default:l="normal"}c.area=l}if(!b.fid){var m=b.fids;if(!m){var n=c.exceptFids;n||(n=g?[4]:$G.common.unnormalids),m=$I("init.Folder").getFids(n),b.fids=m}}if(g?e.search(b,c,d):e.list(b,c,d),c.receive){var o=$I("init.Sync");o.request(),$E("support.MailCenter",function(a){a.receiveAll()}),delete c.receive}3===b.fid&&$I("init.Sent").reset()}var D=a.Object,E=a.Array,F=a.createClass($N("interface.MboxInterface"));D.extend(F,{setRead:d,setFlag:e,setTag:f,setDefer:g,setTop:h,setMemo:i,setFilter:j,setAllRead:k,move:l,setSpam:m,setReFw:n,brandLoad:o,getList:p,getPosition:q,getLetterData:r,getSendInfo:s,syncData:t,defer:u,contacts:v,emails:w,smarts:x,find:y,title:z,list:A,search:B,entry:C})}($,window),function(){function a(a){$E(["module.options.MailFilterModule"],function(b){b.checkOverLimit(a)})}function b(a){try{var b=$L("module.options.NavConf",this)}catch(c){return c}var d,e=typeof a,f=b.oldModConfig.subModules;if("string"==e){if(a.indexOf("optionOutLink.")>=0||a.indexOf("LinkModule.")>=0){var g=a.replace("optionOutLink.","").replace("LinkModule.","");
a={linkName:g}}else if(d=a,"options.MainModule"==d||"MainModule"==d?d="BaseSetModule":("options.AccountManage"==d||"AccountManage"==d)&&(d="AccountManageModule"),a=arguments.length>1?arguments[1]:{},d.indexOf("#")>=0){var h=d.split("#");if(d=h[0],h.length>1){h=h[1].split("&");for(var i,j=0,k=h.length;k>j;j++)i=h[j].split("="),a[i[0]]=i[1]}}}else"undefined"==e?d="BaseSetModule":(d=a.module,delete a.module);if(a&&a.link&&(a.subModName=d,d="LinkModule"),a&&a.linkName){var l=a.linkName;delete a.linkName;var m=l.split("#");if(a.subModName=m[0],m.length>1&&(a.linkext=m[1]),!f[a.subModName])for(var n in f)if(f[n].link&&f[n].link==a.subModName){a.subModName=n;break}f[a.subModName]&&(a.link=f[a.subModName].link),d="LinkModule"}d.indexOf(".")<0&&(d="options."+d);var o;a&&"exit"in a&&(o=a.exit,delete a.exit),$.JS.go({module:d,param:a,exit:o})}function c(a){$E(["module.options.RecommendSignlist"],function(b){b.show(a)})}function d(a){var b=7;"js6"==a&&(b=7),("jy6"==a||"jy6s"==a)&&(b=6),"jy3"==a&&(b=10),"js4"==a&&(b=8),"js5"==a&&(b=5),"qn"==a&&(b=2);var c=function(){if("student"===$G.mailPattern.currentPattern){var b=window;if("js6"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("df=qingning",""),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}}else var b=top;if("jy3"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("js6/main.jsp","jy3/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("js4"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("js6/main.jsp","js4/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("jy6"==a||"jy6s"==a){var d="jy6s"==a?b.location.href.replace(/http:\/\/[^.]*[.]+mail\./,"https://ssl.mail."):b.location.href,c=d+"&rnd="+Math.random();c=c.replace("js6/main.jsp","jy6/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("js5"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("js6/main.jsp","js5/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("qn"==a){var c="http://18.mail.163.com/login.do?from=mailin&sid="+$S("sid");top.location.href=c}};(new k).wmsvr({func:"user:changeStyle",body:{style:b,language:parseInt($S("attrs").user.langauge,0)||0},call:c})}function e(a){var b;if("string"==typeof a)b={link:a};else{if("object"!=typeof a)return;b=a,b.link=b.url}$.JS.go({module:"options.LinkModule",param:b})}function f(a){a?(a.type="edit",a.id&&(a.type="modify")):a={type:"list"};var b=l.getModule();b&&"options.MailFilterModule"==b.name?b.nav(a):$.JS.go({module:"options.MailFilterModule",param:a})}function g(){var a=l.getModule();a&&"options.MailFilterModule"==a.name&&a.resetDependPart()}function h(a){$.JS.go({module:"options.SearchModule",param:{type:a}})}function i(){window.open("https://reg.163.com/setinfo/ChangePwd_1.jsp")}function j(a){"string"==typeof a&&(a={type:a});var b="options.AccountCenterModule",c=$.JS.get(b,{});if(c)try{c._var.extra=a}catch(d){}$.JS.go({module:b,param:{},extra:a,reset:!1})}var k=$I("core.DataAction"),l=$.Context,m=$.createClass($N("interface.OptionInterface"));$.Object.extend(m,{entry:b,showSignList:c,changeStyle:d,goOutlink:e,goFilter:f,refreshFilter:g,goSearch:h,checkFilterLimit:a,changePassword:i,related:j})}(),function(a,b){function c(c){var d=this;return"apps_blog"===c.key?(b.open(c.url),void 0):"apps_shop"===c.key?(b.open(c.url),void 0):"nf_center"!==c.key||c.group&&"nf_center"!==c.group?($E("module.outlink.OutlinkModule",function(){c.url&&c.url.indexOf("$")>-1&&(c.url=a.Uri.getUrl(c.url,!0));var b={module:"outlink.OutlinkModule",param:c,useParam:{key:!0,url:!0,cross:!0}};b.call=function(b){if(b.container){if(c.group&&c.removeSameModule){var e=d._groupModuleMap[c.group];e&&e.name!==b.name&&a.JS.remove(e)}c.group&&(d._groupModuleMap[c.group]=b)}},a.JS.go(b);var e=a.Context.getModule();if(c._call&&c._call(e),"weibo"===c.key)try{var f=a("#spnDockNew"),g=a("#dvDock").find("#dvNew_22");f&&f.hide(),g&&g.hide();var h=(a.Component.find("$title$邮箱应用")||[])[0];h&&h.getEl().find(".nui-tabs-item-status").hide(),a.Cookie.set("checkWeibo","1",{path:"/",domain:$S("fullDomain"),expires:new Date((new Date).valueOf()+3e5)})}catch(i){}}),void 0):($E("product.FileCenter",function(a){a.entry("nf_center")}),c.url&&(c.url+="&redirect=false&retype=0",a.Ajax.request({requestType:a.Ajax.IFRAME,url:c.url})),void 0)}function d(c){var d=this;if(c.lockid){var e=$S("advLock");if(e[c.lockid]&&!e.authenticated2){var f={};return a.Object.extend(f,c),delete f.lockid,a.AdvLock.show(a.Function.bind(h.goOutlink,h,f)),void 0}}var g,i=!1,j=$G.get("uriConf"),k=j.free;if($S("isVip")){var l=a.AppManager.getAppsList(),m=a.Array.findObject(l,"name",c.key);if(!$S("AppDataPrepared")&&!d._waitingDataComeback)return d._waitingDataComeback=!0,b.setTimeout(function(){d.goOutlink(c)},1e3),void 0;m&&m.url&&"nf_center"!==m.name&&(g=m.url,i=!0),m&&"music_outlink"===m.name&&(c.url=m.name,i=!1,c.title="网易云音乐"),k=j.vip}else $S("isCorp")&&(k=j.corp);var n=c.key+""||"outlink",o=$Fix.titlesFix&&$Fix.titlesFix[n]||c.title||(j.all[n]||k[n]||j[$S("domain")]&&j[$S("domain")][n]||[])[1]||"其它",p=(c.listen,c.param);i?g=a.Uri.getUrl(g):(c.url&&c.url.indexOf("$")>-1&&(c.url=a.Uri.getUrl(c.url,!0)),g=c.url||a.Uri.getUrl(n)),-1===g.indexOf("http")&&"about:blank"!=g&&(g=a.Uri.getUrl(g));var q=!1,r=c.isAppCenter;if(c.appId===a.AppCenterInterface.appIdForYiqipin()&&(r=!1),r&&c.isAppCenter&&-1===g.indexOf("appgo.do?")){if(!g){var l=$I("util.CustomAppManager").getAppsList(),m=a.Array.findObject(l,"id",c.appId);m&&(g=m.url),g&&-1!==g.indexOf("http")||(g="")}var s="http://"+$S("host")+"/appcenter/appgo.do?sid="+$S("sid");$S("isyeah")&&(s="http://appcenter.mail."+$S("domain")+"/appgo.do?sid="+$S("sid")),g=s+"&func="+"mapp:appgo"+"&appId="+c.appId+"&url="+encodeURIComponent(g),p&&p.log||(p=p||{},p.log=JSON.stringify({AppCenter_AppId:c.appId,uid:$S("uid")})),("23004"==c.appId+""||"斗地主"===c.title)&&(q=!0)}p&&(g=a.Location.addParam(p,g)),$S("isVip")&&"recommend_app"===n&&(c.group="appMoudle");var t={url:g,key:n,title:o,group:c.group,cross:c.cross,fullScreen:c.fullScreen,isAppCenter:c.isAppCenter,appId:c.appId,pureUrl:c.pureUrl,showDefTree:c.showDefTree,_call:function(a){c.call&&c.call(a)}};q&&(t.hideDock=!0),c.removeSameModule&&(t.removeSameModule=!0),c.isBeta&&(t.isBeta=!0),h.entry(t)}function e(b){if(b){var c=b.substr(3),d=a.JS.find(c);if(d)return d.frame}}function f(a){try{return $I("module.outlink.OutlinkModule").modules[a]}catch(b){return!1}}function g(b){var c=this;try{b=b.replace(/'/g,'"');var d=a.Misc.parseJson(b);c.goOutlink(d)}catch(e){}}var h=a.createClass($N("interface.OutlinkInterface"));a.Object.extend(h,{entry:c,goOutlink:d,getFrame:e,getModule:f,edmLink:g,_groupModuleMap:{}})}($,window),function(a,b,c){function d(b){var d,e,f,g,h,i,j,k,l,m=this;if("string"==typeof b&&(b={id:b}),"mid"in b&&(b.id=b.mid,delete b.mid),"moduleName"in b&&(d=b.moduleName,delete b.moduleName),"moduleParam"in b&&(e=b.moduleParam,delete b.moduleParam),"moduleExtend"in b&&(f=b.moduleExtend,b.area=f.area,delete b.moduleExtend),"isRead"in b&&(l=b.isRead,delete b.isRead),"call"in b&&(i=b.call,delete b.call),"hiddenCall"in b&&(k=b.hiddenCall,delete b.hiddenCall),b.hidden&&(j=b.hidden,delete b.hidden),g=b.group,h=b.folderData,delete b.folderData,h!==c&&(b.id=b.id||h.id,b.fid=b.fid||h.fid,h.flags&&(b.locked=h.flags.locked)),j||$S("lastRead",b.id),b.isThread)if(b.viewType)a.SM.go({parent:d,module:"thread.ThreadModule",param:b,listModule:d,listUnstable:l,folderData:h,viewType:b.viewType,sharebar:!0,group:g,hidden:j,call:i,hiddenCall:k});else{var n,o,p;if(h!==c&&(n=h.threadMessageCount,o=!h.flags.read),p=m._goCacheModule({id:b.id,group:g,isThread:!0,count:n,unread:o,listParam:e,listExtend:f}),p===!0)return;"string"==typeof p&&(g=p),a.JS.go({module:"thread.ThreadModule",param:b,listModule:d,listParam:e,listExtend:f,listUnstable:l,folderData:h,group:g,hidden:j,call:i,hiddenCall:k})}else if(b.viewType)m.preload(b),a.SM.go({parent:d,module:"read.ReadModule",param:b,listModule:d,listUnstable:l,folderData:h,viewType:b.viewType,sharebar:!0,group:g,hidden:j,call:i,hiddenCall:k,speed:m.needSpeed});else{if(b.part)return a.JS.go({module:"read.ReadModule",listModule:d,param:b,folderData:h,group:g,call:i}),void 0;if(m._goCacheModule({id:b.id,group:g,folderData:h,listParam:e,listExtend:f},j))return;m.preload(b),a.JS.go({module:"read.ReadModule",param:b,listModule:d,listParam:e,listExtend:f,listUnstable:l,folderData:h,group:g,hidden:j,call:i,speed:m.needSpeed})}}function e(a){var b=this;a.locked||$E("module.read.Turbo",function(c){c.start({level:b.needSpeed?2:1,param:a})})}function f(b,d){var e,f,g,h,i=b.id,j=b.group,k=!!b.isThread;if(k?(e="thread.ThreadModule",f="tid"):(e="read.ReadModule",f="mid"),g=a.JS.modules[e])for(var l in g)if(h=g[l],h[f]===i){if(!d){if(j&&j!==h.group)return!1;if(k&&(b.unread||b.count!==a.Object.count(h.threadMessageIdMap))){var m=h._var.group||h.group;return a.JS.cleanCache(h),a.JS.remove(h),m}var n=b.folderData;try{h._var.hidden&&delete h._var.hidden}catch(o){}h.listParam=b.listParam,h.listExtend=b.listExtend,n!==c&&(h.folderData=n,h.reader!==c&&(h.reader.folderData=n)),a.JS.go(h)}return!0}}var g=a.createClass($N("interface.ReadInterface"));a.Object.extend(g,{needSpeed:a.Browser.isIE("<9"),entry:d,preload:e,_goCacheModule:f})}($,window),function(a,b,c){function d(){if(!eb.dom){var a=bb?"A":"DIV",b=document.createElement(a);eb.dom=b}}function e(a){var b=this,c=eb.dom.tagName,d=U.clone(eb.attribute);if(U.extend(d,b.getAttribute()),d.sign="letter",bb&&(d.href="#",d.onclick="return false;"),b.id=d.id,a){var e=[],f="";for(var g in d){var h=d[g];switch(g){case"className":e.push('class="'+h+'"');break;case"tabIndex":e.push('tabindex="'+h+'"');break;case"innerHTML":f=h;break;case"title":case"aria-label":h=W.encodeHTML(h);default:e.push(g+'="'+h+'"')}}b.html=["<",c," ",e.join(" "),bb?' href="javascript:void(0)"':"",">",f,"</",c,">"].join("")}else{var i=b.div=eb.dom.cloneNode(!0);for(g in d){var h=d[g];"aria-label"===g||"sign"===g?i.setAttribute(g,d[g]):i[g]=h}}}function f(){function d(a){var b=i.getKeyword();if(b)try{var c=new RegExp("("+b+")","ig");a=a.replace(c,'<b class="ch0">$1</b>')}catch(d){}return a}function e(a){function b(b,c){var d=[];d=a.match(b),d&&(c.count=d.length)}function c(b,c){c.count>0&&(c.handle=!0,k[k.length]=c.type+(c.count>1?"("+c.count+")":""),a=a.replace(b,""))}if(!f.isThread)return a;try{var d,e,g,h,i={type:"Re"},j={type:"Fw"};if(d=/(re|reply|回复|答复)[:|：]/gi,e=/(fw|forward|转发)[:|：]/gi,g=/^(re|reply|回复|答复)[:|：]/gi,h=/^(fw|forward|转发)[:|：]/gi,i.isFirst=g.test(a),j.isFirst=h.test(a),!i.isFirst&&!j.isFirst)return a;var k=[];b(d,i),b(e,j),(i.count>1||j.count>1)&&(c(d,i),c(e,j),j.isFirst&&k.reverse(),a=k.join(":")+":"+W.trim(a).replace(/^(&nbsp;|_)+/gi,""))}catch(l){}return a}var f=this,g=f.view,h=g.config,i=g.module;i.extend("type");var j=i.extend("subtype"),k="folder"===j,l={},m=f.components,n=i.param("fid"),o=f.data,p=o.fid,q=o.flags,r=o.id,s=f.nodes,t=o.threadMessageCount,u=f.isThread,v=[eb.attribute.className],w="full"===j,x="undefined"!=typeof o.summary,y=w,z=x&&!y,A=x?o.summary:"",B=q.deferHandle,C=f.expire,D=i.createId(r+(new b.Date).getTime()),E=D+"Dom";if(l.id=E,l.role="link",!n){var F=i.param("fids");1===F.length&&(n=F[0])}q.read||v.push("kw0"),q.top&&v.push("oh0"),B&&(v.push("oU1"),C&&v.push("gv0"));var G,H,I=s.drag=D+"DragDiv",J=s.dragitem=D+"DragB",K=s.checkbox=D+"CheckboxB",L=s.logo=D+"LogoB",M=s.trash=D+"TrashB",N=s.flag=D+"FlagB";(!k||C)&&(G=s.folder=D+"FolderSpan",H=s.subject=D+"SubjectSpan");var O=s.tag=D+"TagDiv",P=s.defer=D+"DeferB",Q=s.date=D+"DateDiv",R=s.mid=D+"MidDiv",S=s.end=D+"EndDiv";if(y)var T=s.summary=D+"SummaryDiv";var U=[];U[U.length]='<div class="nl0 hA0'+(!A||w?" ck0":"")+'">';var V=[];V[V.length]='<div class="gB0" sign="start">',cb||(V[V.length]=['<div class="dS0" id="',I,'"><b class="nui-ico nui-ico-drag" id="',J,'"></b></div>'].join("")),V[V.length]=['<label aria-checked="false" sign="checkbox" class="nui-chk cS0" title="选中此邮件" role="checkbox" tabIndex="0" aria-label="选中此邮件"><span class="nui-chk-symbol"><b class="nui-ico nui-ico-checkbox" id="',K,'"></b></span></label>'].join("");var Y=f.getLogoInfo(),Z=Y.config;V[V.length]=Z.sub?['<b class="dT0 nui-ico nui-ico-hasSub nui-ico-',Z.type,'" title="',Z.title,'" tabindex="-1" aria-label="',Z.title,'" sign="logo" id="',L,'"><b class="nui-ico-sub nui-ico-sub-',Z.sub,'"></b></b>'].join(""):['<b class="dT0 nui-ico nui-ico-',Z.type,'" title="',Z.title,'" tabindex="-1" aria-label="',Z.title,'" ',Z.url?' style="background-image:url('+Z.url+')"':"",' sign="logo" id="',L,'"></b>'].join("");var $=f.getPriorityInfo();$&&(V[V.length]=['<b class="cR0 nui-ico nui-ico-mailLv nui-ico-',$[0],'" title="',$[1],'" tabindex="-1" aria-label="',$[1],'"></b>'].join("")),V[V.length]='<div class="dP0" sign="start-from">';var ab=2===n||3===n?o.to:o.from;W.has(ab,"@netease>")&&(ab=ab.replace(/@netease>/gi,"@netease.com>"));var bb=a.Uri.getEmails(ab,c,!0),db=bb.match;if(0===db.length){var fb=bb.wrong;fb.length>0?db.push({name:ab,address:null}):db.push({name:"(未填写)",address:null})}for(var gb=[],hb=[],ib=m.userlabel=[],jb=0,kb=db.length;kb>jb;jb++)try{var lb=db[jb],mb=new a.UserLabel({email:lb,extcls:"ci0",popupRenderTo:i.scroller,lazyListen:!0,noListen:!0});ib.push(mb),hb[hb.length]=mb.html(),gb.push(mb.rawConfig.name)}catch(nb){}V[V.length]=hb.join("，"),V[V.length]="</div>",cb||(V[V.length]=['<b class="cC0 nui-ico nui-ico-smartTrash" title="点击删除邮件" id="',M,'" sign="trash"><b class="nui-ico nui-ico-smartTrash-head"></b><b class="nui-ico nui-ico-smartTrash-body"></b></b>'].join(""));var ob=o.label0;V[V.length]=['<div class="dU0" title="',ob>0?"点击取消旗帜":"设为红旗",'" role="button" tabindex="-1" aria-label="',ob>0?"点击取消旗帜":"设为红旗",'" sign="flag"><b class="nui-ico nui-ico-flag nui-ico-flag-',ob,'" id="',N,'"></b></div>'].join(""),v.push("nui-txt-flag"+ob),V[V.length]="</div>",U[U.length]=V.join("");var pb=[];if(pb[pb.length]=['<div class="il0" id="',R,'">'].join(""),!q.deferHandle){try{if(a.Ext.memo&&o.memo){var qb=m.memo=new a.Memo({content:W.encodeHTML(o.memo),modify:X.bind(f.modifyMemo,f),extcls:"iu0",lazyListen:!0,noListen:!0});pb[pb.length]=qb.html()}}catch(nb){}try{if(a.Ext.scheduleMbox&&$S("schedule")&&$S("schedule")[r]){var rb=m.schedule=new a.Schedule({mid:r,extcls:"iu0",lazyListen:!0,noListen:!0});pb[pb.length]=rb.html()}}catch(nb){}}var sb=d(o.subject?e(W.encodeHTML(o.subject)):"(无主题)"),tb=y?W.encodeHTML(W.stripTags(A)):W.stripTags(sb);4===o.fid&&4!==n&&(sb="<del>"+sb+"</del>"),sb=['<span class="da0"',H?' id="'+H+'"':"",">",sb,"</span>"].join("");var ub=!k||C?['<span class="nui-txt-tips nui-txt-s12 dL0" id="',G,'">[',_.get(o.fid).name,"]</span>"].join(""):"",vb=u&&t>1?['<span class="bL0" title="共 ',t,' 封会话">',t,"</span>"].join(""):"",wb=z?['<span class="dd0">',W.encodeHTML(A),"</span>"].join(""):"";pb[pb.length]=[ub,sb,vb,wb].join(""),pb[pb.length]="</div>",U[U.length]=pb.join("");var xb=[];if(xb[xb.length]=['<div class="hV0" id="',S,'">'].join(""),h.sizeShow){var yb=a.Number.convert(o.size,1);xb[xb.length]=['<div class="es0" title="邮件大小为',yb,'">',yb,"</div>"].join("")}var zb=f.getDateInfo();xb[xb.length]=['<div id="',Q,'" class="eO0',zb.important?" bS0":"",'" title="',zb.title,'">',zb.value,"</div>"].join("");var Ab="",Bb="",Cb="";q.linkAttached||(a.Ext.newAttach?q.realAttached:q.attached)?q.linkAttached?(Ab="nui-ico-bigAtt",Bb="此邮件包含云附件"):(Ab="nui-ico-att",Bb="此邮件包含附件"):Cb=' style="visibility:hidden"',xb[xb.length]=['<div class="nui-ico ',Ab,' dQ0" title="',Bb,'"',Cb,"></div>"].join(""),xb[xb.length]=['<b class="hp0 nui-ico nui-ico-todo nui-ico-todo-selected" sign="defer" id="',P,'" style="',q.deferHandle&&o.defer?"":"display:none",'"></b>'].join(""),xb[xb.length]="</div>",U[U.length]=xb.join("");try{if(a.Ext.tag){var Db=[],Eb=$I("init.Tag"),Fb=o.tag,Gb="";if(Fb)for(var Hb=m.tag=[],jb=0,kb=Fb.length;kb>jb;jb++)try{var Ib=W.trim(Fb[jb]),Jb=Eb.get(Ib);if(Jb){var Kb=new a.Tag({text:Jb.alias,type:Jb.color,attrs:"hasClose",click:function(a){return function(){$E("interface.MboxInterface",function(b){b.entry({tag:[a]})})}}(Ib),closeclick:function(a,b){return function(){g.setTag(!1,a,[b])}}(Ib,f),lazyListen:!0,noListen:!0});Db[Db.length]=Kb.html(),Hb.push(Kb)}}catch(nb){}else Gb=' style="display:none"';Db.unshift(['<div class="im0" id="',O,'"',Gb,' sign="tag" tabindex="-1">'].join("")),Db.push("</div>"),U[U.length]=Db.join("")}}catch(nb){}if(U[U.length]="</div>",y){var Lb=[],Mb=f.getSummary(A);Lb[Lb.length]='<div class="nl0 fQ0">',Lb[Lb.length]=['<div class="il0" id="',T,'">',Mb,"</div>"].join(""),Lb[Lb.length]='<div class="hV0">&nbsp;</div>',Lb[Lb.length]="</div>",U[U.length]=Lb.join("")}if(l.className=v.join(" "),l.innerHTML=U.join(""),!cb){var Nb=2===p||3===p?"收件人":"发件人";l["aria-label"]=W.decodeHTML([tb,Nb,"：",gb.join(),"时间：",zb.title].join(" "))}return l}function g(){function a(){var a=d.isTop&&f.top,c=a?["top","置顶"]:null;if(c)return c;var h=b.getSendLogo();if(h)return h;var i=f.system?["ntes","网易系统邮件"]:null;if(e.ctrls&&e.ctrls.RulesType&&!V.has([5,7,18],e.fid)){var j=e.ctrls.RulesType.split(";")[0];j.indexOf("_")>-1?j=j.split("_")[1]:"ntessys"!==j&&(e.ctrls.RulesType=null),j&&(i="ntessys"===j?["ntes","网易诚信邮件联盟认证邮件"]:["integrity","网易诚信邮件联盟认证邮件",eb.systemUrl+j+".gif"])}if(i)return i;var k=f.encrypted?["encrypt","加密邮件"]:null;if(k)return k;var l=f.scheduleDelivery?["regular","定时发信"]:null;if(l)return l;var m=2===g&&f.draft?["draft","草稿"]:null;if(m)return m;var n=b.getReFwLogo();if(n)return n;var o=b.getSmartLogo();if(o)return o;var p=b.getReadLogo();return p?(b.isNormalLogo=!0,p):void 0}var b=this,c=b.view,d=c.config,e=b.data,f=e.flags,g=e.fid,h=a();return h.config={type:h[0],title:h[1],url:h[2],sub:h[3]},h}function h(){var b=this,c=b.data,d=c.flags;if(3!==c.fid||b.isThread)return null;var e,f,g,h,i,j=null;if((a.Ext.letterRecall||a.Ext.letterRecall_vip)&&c.recallable){e="recall";var k=c.rclStatus,l=eb.rclStatus;k&&k>0&&(3>k?(f=l[3],g=0):3===k?(f=l[1],g=1,i="suc"):4===k?(f=l[2],g=2,i="err"):5===k&&(f=l[0],g=3,i="pause"))}if(f&&e)h="recall";else{var m=c.composeExtra,n=m&&m.showOneRcpt;e=n?"sendSeparate":"mail";var o=c.sndStatus;if("number"!=typeof o){var p=d.rcptQueued,q=d.rcptSucceed,r=d.rcptFailed;(p||q||r)&&(o=q?r?5:3:r?4:1,c.sndStatus=o)}if("number"==typeof o){var s=eb.sendStatus;3>o?(f=s[3],i="ing",g=0):3===o?(f=s[1],i=n?"sepaSucc":"suc",g=1):4===o?(f=s[2],i="err",g=2):5===o&&(f=s[0],i="part",g=3)}h="send"}return f&&e&&(j=[e,f,null,i],j.ext={status:g,type:h}),j}function i(){var a=this;if(a.isThread)return null;var b=a.data.flags,c=b.replied&&b.forwarded?["refw","回复且转发"]:null,d=b.replied?["re","已回复"]:null,e=b.forwarded?["fw","已转发"]:null;return c?c:d?d:e?e:null}function j(){var a=this,b=a.data.flags,c=a.isThread,d=b.popRead,e=b.read;return e?["read","已读"]:c?["unreadThread","未读"]:d?["unreadPop","已被邮件客户端，其他邮箱代收或手机等通过POP3协议收取"]:["unread","未读"]}function k(){var a=this,b=$I("init.Tag"),c=a.data.tag,d=null;if(c)for(var e=0,f=c.length;f>e;e++){var g=c[e],h=b.get(g,"smart");if(h){var i=b.smarts[h.alias];d=["category-"+i.index,i.name]}}return d}function l(){var a,b,c=this,d=c.data.priority;return 3>d?(a="mailLv-1",b="紧急"):d>3&&(a="mailLv-3",b="缓慢"),a&&b?[a,b]:void 0}function m(){var a,b,c,d=this,e=d.data,f=d.isDefer,g=d.expire,h=d.today,c=f&&e.defer?e.defer:e.sentDate;if(g)b=a=h?"今日处理":"尚未处理";else{var i=$I("init.Defer");b=Z.format(c,"yyyy年M月d日 HH:mm (星期w)");var j=i.getDate("yesterday"),k=i.getDate("today"),l=c.getYear(),m=c.getMonth(),n=c.getDate();a=l===k.getYear()&&m===j.getMonth()&&n===j.getDate()?"昨日":l===k.getYear()?m===k.getMonth()&&n===k.getDate()?Z.format(c,"HH:mm"):Z.format(c,"M月d日"):Z.format(c,"yyyy-MM-dd"),f&&(a+="处理",b+="处理")}return{important:g&&!h,title:b,value:a}}function n(a){return a?a.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/&lt;b&gt;/gi,'<span class="nui-txt nui-txt-mark">').replace(/&lt;\/b&gt;/gi,"</span>"):""}function o(b){var c=this;if(!c.inited){b=c.getDiv(b);for(var d=b.getElementsByTagName("*"),e=c.nodes,f=U.count(e),g=0,h=0,i=d.length;i>h;h++){var j=d[h],k=j.id;if(U.each(e,function(b,c){return c===k?(e[b]=j,g++,a.BREAK):void 0}),g===f)break}c.inited=!0}}function p(){var b=this,c=b.components.memo;c||(c=b.components.memo=new a.Memo({renderTo:b.nodes.mid,renderBy:"prepend",content:W.encodeHTML(b.data.memo||""),modify:X.bind(b.modifyMemo,b),extcls:"iu0"}))}function q(c){function d(a){a.setEventListeners(),a.fireRender()}var e=this,f=e.view,g=f.module;if(g.getDom("ListDiv"),e.lazyInit(c.div),!e.componentInited){try{var h=e.nodes,i=e.components;if(!bb){if(g.isDefer()){var j=e.data,k=S.expireNote(j),l=i.defermanage=new a.Button({renderTo:h.end,title:k,simple:!0,subclass:"miniBtn",icon:j.flags.deferHandle?"todo-selected":"todo",extcls:"cT0",menu:e.deferManage(),popupRenderTo:g.scroller,click:function(){e.gotoDefer("add")},lazyListen:!0,noListen:!0});l.getDom().setAttribute("sign","defermanage")}if(g.isTag()){var m=i.tagmanage=new a.Button({renderTo:h.end,title:"选择邮件标签",simple:!0,subclass:"miniBtn",icon:"tags",extcls:"dK0",menu:e.tagManage(),popupRenderTo:g.scroller,click:function(){},lazyListen:!0,noListen:!0});m.getDom().setAttribute("sign","tagmanage")}}if(!cb){var n=b.netease.mail.util.DragDrop;new n({drag:f.dragDiv,trigger:h.drag,listeners:[{name:"mousedown",handler:X.bind(f.drag,f,e,"mousedown")},{name:"start",handler:X.bind(f.drag,f,e,"start")},{name:"drag",handler:X.bind(f.drag,f,e,"drag")},{name:"end",handler:X.bind(f.drag,f,e,"end")}]})}for(var o in i){var p=i[o];if(U.isArray(p))for(var q=0,r=p.length;r>q;q++)d(p[q]);else d(p)}}catch(s){}e.componentInited=!0}}function r(a){var b=this;b.view,Y.getTarget();var c=a.sign;switch(b.data,b.lazyInit(a.div),c){case"checkbox":case"logo":case"trash":case"flag":case"tag":case"defer":case"tagmanage":case"defermanage":break;default:var d=!1,e=!1;d=d||"start-from"===c,e=e||"start"===c,(!e||d)&&b.gotoRead({preload:!0})}}function s(a){var b=this,c=b.view,d=c.module;Y.getTarget();var e=a.sign,f=b.data;switch(b.lazyInit(a.div),e){case"checkbox":b.setChecked(!b.checked);break;case"logo":var g=f.flags.read;g||(d.log("letter","read"),b.setChecked(!0),c.setRead(!g,[b]));break;case"trash":d.log("letter","remove"),b.setChecked(!0),c.remove(4===f.fid,[b]);break;case"flag":d.log("letter","flag"),b.setChecked(!0),c.setFlag(0===f.label0?1:0,[b]);break;case"tag":case"defer":case"tagmanage":case"defermanage":break;default:var h=!1,i=!1;h=h||"start-from"===e,i=i||"start"===e,(!i||h)&&b.gotoRead()}}function t(b){function c(a){return function(){d.checked||d.setChecked(!0),d.view.selectAll(),a()}}var d=this,e=d.data,f=d.view,g=f.module,h=$I("util.Contextmenu"),i=g.param("fid"),j="archive"===g.extend("area"),k=e.fid;d.lazyInit(b.div);for(var l=f.letters,m=e.id,n=!0,o=0,p=l.length;p>o;o++){var q=l[o];if(q.checked&&q.data.id!==m){n=!1;break}}var r={groups:[]},s=r.groups,t=[];if(g.isDefer()&&(e.flags.deferHandle?t.push({text:"完成待办",icon:"done",click:c(X.bind(f.setDefer,f,"complete"))}):t.push({text:"设为待办",icon:"todo",click:c(X.bind(f.setDefer,f,"add"))})),e.flags.read?t.push({text:"设为未读",icon:"unread",click:c(X.bind(f.setRead,f,!1))}):t.push({text:"设为已读",click:c(X.bind(f.setRead,f,!0))}),(i>0||n)&&_.isTop(k)&&!f.folderSelected&&(j||(e.flags.top?t.push({text:"取消置顶",click:c(X.bind(f.setTop,f,!1,null,k))}):t.push({text:"置顶邮件",click:c(X.bind(f.setTop,f,!0,null,k))}))),n&&a.Ext.memo){var u=e.memo?"修改备注":"添加备注";t.push({text:u,click:c(function(){d.initMemo(),a.Memo.modify(d.components.memo)})})}if(s.push({items:t}),t=[],V.has([4,5,7,18],i)?t.push({text:"彻底删除",icon:"trash",click:c(X.bind(f.remove,f,!0))}):t.push({text:"删除邮件",icon:"trash",click:c(X.bind(f.remove,f))}),!j&&!V.has([2,3],i)){var v="举报垃圾邮件",w=!0;t.push({text:v,click:c(X.bind(f.setSpam,f,w))})}if(V.has([5,7,18],i)){var v="信任选中邮件",w=!1;t.push({text:v,click:c(X.bind(f.setSpam,f,w))})}s.push({items:t}),h.show(r)}function u(a){var b=this;b.lazyInit(a.div);var c=Y.get();"DIV"===c.target.tagName&&13===c.which&&b.gotoRead()}function v(b){var d=this,e=d.view,f=e.module;if(d.lazyInit(),!!d.checked!==b){d.checked=b;var g=a.fly(d.nodes.checkbox);b?g.addClass("nui-ico-checkbox-checked"):g.removeClass("nui-ico-checkbox-checked"),g.dom.parentNode.parentNode.setAttribute("aria-checked",!!b),d.setClass(),e.selectAll(b===!1?!1:c);var h=[],i=e.letters;V.each(i,function(a,b){h.push(b)});try{$I("util.Shift").handle(d,h,function(){d.setClass()}),Y.stop()}catch(j){}try{f._child.view.changeSelect()}catch(j){}}}function w(){var b=this;b.lazyInit();var c=b.div,d=a.fly(c),e=b.nodes.checkbox;b.checked?d.addClass("ij0"):d.removeClass("ij0");var f=eb.checkboxTitle;e.title=b.checked?f[1]:f[0]}function x(b){var c=this;if(!cb){c.lazyInit();var d=c.nodes,e=d.drag,f=d.dragitem,g=a(c.div),h=a(e),i=a(f),j="nui-ico-drag",k="nui-ico-drag2",l="ik0";b?(i.replaceClass(j,k),g.addClass(l),e.title="最近阅读邮件"):(i.replaceClass(k,j),g.removeClass(l),e.title=""),g.destroy(),h.destroy(),i.destroy()}}function y(){var a=this;if(a.lazyInit(),a.isNormalLogo){var b=a.nodes.logo,c=a.getLogoInfo();b.className="dT0 nui-ico nui-ico-"+c[0],b.title=c[1]}}function z(b){var c=this;c.lazyInit();var d=c.data.flags.read;if(c.isNormalLogo||b){var e=c.nodes.logo,f=c.getLogoInfo();e.className="dT0 nui-ico nui-ico-"+f[0],e.title=f[1]}c.checked&&c.setChecked(!1);var g=a.fly(c.div);d?g.removeClass("kw0"):g.addClass("kw0")}function A(){var a=this;a.lazyInit();var b=a.nodes.flag,c=a.data.label0;b.className="nui-ico nui-ico-flag nui-ico-flag-"+c,b.parentNode.title=c>0?"点击取消旗帜":"设为红旗",a.checked&&a.setChecked(!1);var d=a.div;d.className=d.className.replace(/nui-txt\-flag\d{1,2}/gi,"nui-txt-flag"+c)}function B(){var b=this;b.lazyInit();for(var c=b.view,d=$I("init.Tag"),e=b.nodes.tag,f=b.data,g=f.tag,h=b.components,i=h.tag=[],j=[],k=0,l=g.length;l>k;k++)try{var m=g[k],n=d.get(m),o=new a.Tag({text:n.alias,type:n.color,attrs:"hasClose",click:function(a){return function(){$E("interface.MboxInterface",function(b){b.entry({fid:0,showTag:!0,tag:[a]})}),Y.stop()}}(m),closeclick:function(a,b){return function(){c.setTag(!1,a,[b]),Y.stop()}}(m,b)});j[j.length]=o.html(),i.push(o)}catch(p){}e.innerHTML=j.join(""),e.style.display="";try{if(!bb){var q=h.tagmanage;q.update({menu:b.tagManage()}),q.getDom().setAttribute("sign","tagmanage")}}catch(p){}a.Component.setEvents(),b.checked&&b.setChecked(!1)}function C(){var b=this,c=b.data;b.lazyInit();var d=c.flags.deferHandle;b.nodes.defer.style.display=c.defer&&d?"":"none";try{if(!bb){var e=b.components.defermanage;e.update({title:S.expireNote(c),menu:b.deferManage(),icon:d?"todo-selected":"todo"}),e.getDom().setAttribute("sign","defermanage")}}catch(f){}var g=b.getDateInfo(),h=b.nodes.date;h.title=g.title,h.innerHTML=g.value,a.fly(h)[g.important?"addClass":"removeClass"]("bS0");var i=a.fly(b.div);d?(i.addClass("oU1"),b.expire?i.addClass("gv0"):i.removeClass("gv0")):(i.removeClass("oU1"),i.removeClass("gv0"))}function D(){var a=this;a.lazyInit(),a.initMemo();var b=a.data.memo||"",c=a.components.memo;c.show(),c.updateContent(W.encodeHTML(b))}function E(){var a=this,b=a.data;a.lazyInit();var c=a.nodes,d=c.folder,e=c.subject;try{d&&(d.innerHTML="["+_.get(b.fid).name+"]")}catch(f){}try{var g=b.fid,h=4===g,i=e.getElementsByTagName("DEL").length>0;if(h^i){var j=b.subject;h&&(j="<del>"+j+"</del>"),e.innerHTML=j}}catch(f){}}function F(){var b=this,c=b.data;b.lazyInit();var d=a.fly(b.div);c.flags.top?d.addClass("oh0"):d.removeClass("oh0"),b.setRead(!0)}function G(){var a=this,b=a.data;a.formatSummary();var c=b.summary;a.lazyInit(),a.nodes.summary.innerHTML=a.getSummary(c)}function H(){var a=this,b=a.view;b.module;var c=a.data,d={};return d.data=c,d.left=38,d.top=10,d.modify=function(){a.gotoDefer("modify")},d.modifySms=function(){a.gotoDefer("modify",{smsShow:!0})},d.modifyMemo=function(){a.gotoDefer("modify",{memoShow:!0})},d.complete=function(){a.gotoDefer("complete")},d["delete"]=function(){a.gotoDefer("delete")},S.getMenu(d)}function I(){var a=this,b=a.view,c=a.data,d=c.tag||[],e={};return e.tag=d,e.callback=function(c,d){b.module.log("letter","settag"),b.setTag(!c,d,[a])},e.remove=function(){b.setTag(!1,null,[a])},R.getMenu(e)}function J(a){var b=this,c=b.view,d=c.module,e=b.data;a||(a={});var f=a.hidden,g=a.preload,h=a.call,i=a.hiddenCall;if(2!==e.fid){var j=d.extend("area");if(g)b.isThread||$E("interface.ReadInterface",function(a){a.preload({id:e.id,fid:e.fid,locked:e.flags?e.flags.locked:!1,area:j})});else if(!$I("util.TimeFlag").handle(e.id,800)){var k=c.getLayout();if($E("interface.ReadInterface",function(a){var c=d.name,g=U.clone(d.param()),l=U.clone(d.extend());l.moduleName=c,a.entry({moduleName:c,moduleParam:g,moduleExtend:l,area:j,folderData:e,isThread:b.isThread,isRead:"read"===d.extend("subtype"),viewType:k,hidden:f,call:h,hiddenCall:i})}),""!==k&&!f)try{c.markReaded()}catch(l){}}}else g||($E("interface.ComposeInterface",function(a){a.draft({id:e.id,info:{subject:e.subject,priority:e.priority},folderData:e,date:e.flags.scheduleDelivery?e.sentDate:null})}),$E("interface.MboxInterface",function(a){a.setRead({fid:d.param("fid"),isRead:!0,data:e})}))}function K(a,b){var d=this,e=d.view,f=e.module,g=d.data;switch(b||(b={}),a){case"add":g.flags.deferHandle||(f.log("letter","defer","add"),e.setDefer("add",c,[d]));break;case"complete":f.log("letter","defer","complete"),e.setDefer("complete",c,[d]);break;case"modify":f.log("letter","defer","modify"),S.showMsgbox({type:"modify",data:{defer:g.defer,memo:g.memo,mid:g.id,memoShow:b.memoShow,smsShow:b.smsShow},callback:function(a){e.setDefer("modify",a,[d])}});break;case"delete":e.setDefer("delete",{defer:g.defer},[d])}}function L(b){var c=this;try{if(b){var d=c.components;for(var e in d)try{var f=d[e];if(U.isArray(f))for(var g=0,h=f.length;h>g;g++)f[g].destroy();else f.destroy()}catch(i){}try{var j=c.getDiv();j&&(Y.unlistenAll(j),a.fly(j).remove())}catch(i){}}}catch(i){}c.html=null,c.div=null,c.nodes=null,c.components=null,c.data=null,c.view=null}function M(a){var b=this;return b.div||(b.div=a?a:document.getElementById(b.id)),b.div}function N(){var a=this,c=a.data,d=$I("init.Defer"),e=a.view,f=e.module,g=f.extend("subtype"),h=c.threadMessageCount;if(a.isThread=h>1,"defer"===g||c.flags.expire){a.isDefer=!0;var i=c.defer,j=a.expire=i<d.getDate("tomorrow");a.today=j&&i>=d.getDate("today")}else a.isDefer=!1,delete a.expire,delete a.today;if(c.flags||(c.flags={}),c.tag||(c.tag=[]),a.isThread){var k=f.param("fid"),g=f.extend("subtype");if("flag"===g){var l=f.param("filter");c.label0=l.label0}k>0&&c.fid!==k&&(c.fid=k)}try{c.sentDate.getTime()<=0&&(c.sentDate=new b.Date(ab.getTime(0)))}catch(m){}a.formatSummary(),db&&(c.subject=c.subject.replace(/　/g," ")),c.subject=W.trim(c.subject)
}function O(){var a=this,b=a.data;b.summary=b.summary?b.summary.replace(/\n|\|/g,"").replace(/(\s|　)+/g," "):c}function P(a){var b=this;b.view.setMemo(a,[b])}function Q(a,b){var c=this;c.data=b,c.view=a,c.nodes={},c.components={};try{c.format()}catch(d){}}try{var R=$L("support.Tag"),S=$L("support.Defer");$L("support.AddressSupport")}catch(T){return T}var U=a.Object,V=a.Array,W=a.String,X=a.Function,Y=a.Event,Z=a.Date,$=a.Browser,_=$I("init.Folder"),ab=$I("util.Misc"),bb=$.isIE(6),cb=$.isIE("<9"),db=!!$.chrome(),eb=a.createClass($N("module.mbox.Letter"));U.extend(eb,{dom:null,attribute:{className:"rF0",tabIndex:0},checkboxTitle:["选中此邮件","取消选中"],sendStatus:["部分成功","发送成功","发送不成功","邮件发送中"],rclStatus:["部分成功","撤回成功","撤回不成功","邮件撤回中"],systemUrl:"http://mimg.127.net/p/images/ibx/cx/",config:d}),U.extend(eb.prototype,{data:null,isThread:!1,isDefer:!1,id:null,html:null,dom:null,nodes:null,components:null,inited:!1,componentInited:!1,checked:!1,today:!1,expire:!1,initDom:e,getAttribute:f,getLogoInfo:g,getSendLogo:h,getReFwLogo:i,getReadLogo:j,getSmartLogo:k,getPriorityInfo:l,getDateInfo:m,getSummary:n,lazyInit:o,initMemo:p,mouseover:q,mousedown:r,click:s,contextmenu:t,keypress:u,setChecked:v,setClass:w,setLastRead:x,setReFw:y,setRead:z,setFlag:A,setTag:B,setDefer:C,setMemo:D,setMove:E,setTop:F,setSummary:G,deferManage:H,tagManage:I,gotoRead:J,gotoDefer:K,remove:L,getDiv:M,format:N,formatSummary:O,modifyMemo:P,initialize:Q})}($,window),function(a,b,c){function d(){var a=this,b=a.view.module,c={},d=b.extend("type"),e=b.extend("subtype");return"list"===d?"tag"===e?a.getTag(c):"defer"===e?a.getDefer(c):"flag"===e?a.getFlag(c):"read"===e?a.getRead(c):"calendar"===e?a.getCalendar(c):"folder"===e?a.getFolder(c):"contacts"===e?a.getContacts(c):"emails"===e?a.getEmails(c):a.getFilter(c):"normal"===e?a.getNormal(c):a.getFull(c),c}function e(b){var d=this,e=d.view,f=e.module,g=f.param("tag"),h=D.getName(g[0]),i=f.getTotal(),j=f.param("filter");j?j.flags:c;var k=f.extend("read")===!1,l=f.extend("brand"),m=z.clone(f.param()),n=z.clone(f.extend());if(k){delete m.filter.flags.read;var o=A.bind(x.entry,x,m,n);b.path={items:[{xtype:"link",text:h,extcls:"nui-txt-link",click:o}]},b.text="未读",b.tips=d.getAllRead(!0)}else{var p=f.getCount("unread"),q=f.extend("limit");if(p>0&&i>q){var r=new a.Link({title:"点击查看未读邮件",text:"有  <strong>"+p+"</strong> 封未读",extcls:"nui-txt-link",click:function(){f.log("title","unread");var a;try{a=m.filter.flags}catch(b){}a||(m.filter||(m.filter={}),a=m.filter.flags={}),a.read=!1,x.entry(m,n)}}).html();b.tips=" "+r+d.getAllRead()}}if(l){var s=w.get(18);b.path={items:[{xtype:"link",extcls:"nui-txt-link",text:s.name,click:A.bind(x.entry,x,{fid:s.id},{type:"list",subtype:"folder"})}]},b.text=h}}function f(){}function g(b){var c=this,d=c.view,e=d.module,f=e.getCondition();b.text=f;var g=A.bind(x.entry,x,{exceptFids:$G.common.unnormalids,conditions:[{field:"label0",operator:">",operand:0}]},{type:"search",subtype:"normal"});b.path={items:[{xtype:"link",text:"旗帜邮件",extcls:"nui-txt-link",click:g}]};for(var h=b.extItems=[],i=a.LETTERFLAG,j=[],k=1,l=i.length;l>k;k++)i[k]&&(j[j.length]={text:i[k],icon:"flag-"+k,extcls:"nui-txt-flag"+k,click:function(a){return function(){e.log("title","otherflag"),x.entry({filter:{label0:a}},{type:"list",subtype:"flag"})}}(k)});h[h.length]={xtype:"link",extcls:"nui-txt-link",text:'<b class="nui-ico nui-ico-flag nui-ico-flag-0"></b>其他旗帜&nbsp;<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:j}],reverse:!0});b.attachTo({clickFrom:this.getEl()})}}}}function h(b){var c=this,d=c.view,e=d.module,f=e.extend("read")===!1,g=e.param("fids"),h=g.length,i=e.getTotal(),j=f?"未读":"已读",k=[];if(h>0)if(1===h){var l,m,n=g[0],o=w.get(n),p=o.name;"unread"===e.param("from")?(l="未读邮件",m=function(){x.entry({filter:{flags:{read:!1}}})},j=p+"&nbsp;"+j):(l=p,m=A.bind(x.entry,x,{fid:n},{type:"list",subtype:"folder"})),b.path={items:[{xtype:"link",text:l,extcls:"nui-txt-link",click:m}]}}else if(B.has(g,1))for(var q=$G.common.nolistids.concat([2]),r=w.list(),s=0,t=r.length;t>s;s++){var o=r[s],u=o.id;if(!B.has(q,u)){var v=w.getInfo(u,"unread");if(v>0){var y=new a.Link({text:v+"封",extcls:"nui-txt-link",click:function(a){return function(){x.entry({fids:[a],filter:{flags:{read:!1}},from:"unread"},{type:"list",subtype:"read"})}}(u)});k.push(o.name+"&nbsp;"+y.html())}}}else{var m=A.bind(x.entry,x,{filter:{flags:{read:!1}}},{type:"list",subtype:"read"});b.path={items:[{xtype:"link",text:j,extcls:"nui-txt-link",click:m}]};for(var z="",q=$G.common.nolistids,C=!0,s=0,t=g.length;t>s;s++)if(!B.has(q,g[s])){C=!1;break}if(C){for(var D=[],s=0,t=q.length;t>s;s++)D.push(w.get(q[s]).name);z=D.join("，")}else z="其他";j=z+j}b.text=j;var E="";f&&i>0&&(E=c.getAllRead()),b.tips=E+(k.length>0?"("+k.join("，")+")":""),c.getContactRead(b)}function i(a){var b=this,c=b.view,d=c.module,e=d.param("fids"),f=e.length;d.getTotal();var g=d.getCondition();if(f>0&&1===f){var h=e[0],i=w.get(h),j=i.name,k=A.bind(x.entry,x,{fid:h},{type:"list",subtype:"folder"});a.path={items:[{xtype:"link",text:j,extcls:"nui-txt-link",click:k}]}}a.text=g}function j(b){var c=this,d=c.view,e=d.module,f=e.param("fid"),g=e.extend("area");w.get(f),w.getPopInfo(f);var h=e.getCount("unread");if("archive"!==g&&h>0&&2!==f){var i=[],j=new a.Link({title:"点击查看未读邮件",text:"有 <strong>"+h+"</strong> 封未读",extcls:"nui-txt-link",click:function(){e.log("title","unread","folder"),x.entry({fids:[f],filter:{flags:{read:!1}}})}});i.push(j.html()),i.push(c.getAllRead(!0)),b.tips=" "+i.join(" ")}}function k(b){var d,e,f,g,h,i,j=this,k=j.view,l=k.module,m=l.param("filter"),n=$I("init.Contacts"),o=m.flags&&m.flags.read===!1;m&&(d=m.chatWithAddress,e=m.fromAddress,f=m.toAddress),g=!!d,i=!!f,h=!!e&&!i;var p=g?d:i?f:e,q=p.split(","),r=n.getContact(p),s=r?r.data.name:c;if(!s)try{var t=$I("support.AddressSupport");try{var u=l.param("cid");if(u){var v=t.data.extDataMap.contact[u];s=t.getGivenName(v)}}catch(w){}if(!s)if(1===q.length)try{s=t.getAddrObj(p,!0).FN}catch(w){s=a.Uri.getName(p)||p}else s="联系人"}catch(w){s="联系人"}var y,z,A,B=!1;try{A=q[0],B=0===A.indexOf("*@")}catch(w){}var D=r&&"group"===r.ctype;B?y=A.replace(/\*@/,""):(z=new a.UserLabel({name:s,address:D?c:A,group:D?r:c,popupRenderTo:l.scroller}),y=z.html()),o||(y='<b class="nui-txt-mark">'+y+"</b>"),g?y="与 "+y+" 的邮件往来":i?y="发给 "+y+" 的邮件":h&&(y+=" 发来的邮件");var E=l.param("from");if(o){var F,G;"emails"===E?(G="联系人邮件",F=function(){x.emails()}):(G=y,y="未读邮件",F=function(){x.contacts(r?r.data:p)}),b.path={items:[{xtype:"link",text:G,extcls:"nui-txt-link",click:F}]},b.text=y,b.tips=j.getAllRead()}else{if(E&&"emails"!==E)try{var H=n.getGroup(E);H&&(b.path={items:[{xtype:"link",text:C.encodeHTML(H.data.name),extcls:"nui-txt-link",click:function(){x.contacts(H.data)}}]})}catch(w){}b.extcls="qf1",b.text=y;var I=[],J=l.getTotal(),K=$I("init.Contacts").getInfo(p,"unread");if(g&&K>0){var L=new a.Link({text:K+" 封未读",extcls:"nui-txt-link",click:function(){l.log("title","unread","contact"),x.contacts(r?r.data:p,{read:!1})}});I.push(L.html()),I.push(j.getAllRead(!0))}else I.push("共 "+J+" 封");if(!l.extend("systemContacts")){if(!g){var M=new a.Link({text:"查看邮件往来",extcls:"nui-txt-link",click:function(){l.log("title","contact","from"),x.contacts(r?r.data:p,{from:l.param("from")})}});I.push(M.html())}if(!i){var N=new a.Link({text:"查看我发送的",extcls:"nui-txt-link",click:function(){l.log("title","contact","to"),x.contacts(r?r.data:p,{type:"to",from:l.param("from")})}});I.push(N.html())}if(!h){var O=new a.Link({text:"查看发给我的",extcls:"nui-txt-link",click:function(){x.contacts(r?r.data:p,{type:"from",from:l.param("from")})}});I.push(O.html())}}I.length>0&&(b.tips=" ( "+I.join(" ")+" )")}r&&"group"===r.ctype&&j.getGroupContact(b,r)}function l(a){var b=this,c=b.view,d=c.module,e=d.param("filter"),f=e&&e.flags&&e.flags.read===!1;a.text="联系人"+(f?"未读":"")+"邮件",a.tips=b.getAllRead(),b.getContactRead(a)}function m(a){var b=this,c=b.view,d=c.module,e=d.param("fids");if(e&&1===e.length){var f=e[0],g=w.get(f),h=A.bind(x.entry,x,{fid:f},{type:"list",subtype:"folder"});a.path={items:[{xtype:"link",text:g.name,extcls:"nui-txt-link",click:h}]}}var i=d.getCondition();i&&(a.text=i)}function n(b){var c=this,d=c.view,e=d.module,f=e.getTotal(),g=e.getCondition();g&&(g="已搜索到 "+f+" 封"+g+"的邮件");var h="";if(f>0){var i=new a.Link({title:"删除所有邮件",text:"删除所有邮件",extcls:"nui-txt-link",click:A.bind(d.removeAll,d)});h="&nbsp;"+i.html()}b.text="搜索结果",b.tips=" "+g+h;var j=e.param("fids");if(j&&1===j.length){var k=w.get(j[0]),l=A.bind(x.entry,x,{fid:j[0]},{type:"list",subtype:"folder"});b.path={items:[{xtype:"link",text:k.name,click:l}]}}}function o(b){var c=this,d=c.view,e=d.module,f=e.getTotal(),g=e.getCondition();g&&(g="已搜索到 "+f+" 封"+g+"的邮件");var h="";if(e.hasAdditional()){var i=new a.Link({title:"取消所有附加条件",text:"取消所有附加条件",bracket:!0,extcls:"nui-txt-cLink",click:A.bind(d.additionalSearch,d)});h="&nbsp;"+i.html()}var j="";if(f>0){var k=new a.Link({title:"删除所有邮件",text:"删除所有邮件",extcls:"nui-txt-cLink",click:A.bind(d.removeAll,d)});j="&nbsp;"+k.html()}if(b.text="搜索结果",b.tips=" "+g+h+j,f>0){var l=1===a.Ud.get({field:"ntes_global",flag:"secondSearch"})-0,m=b.extItems=[],n=l?'完整信息<b class="nui-ico jV0">j</b>':'精简信息<b class="nui-ico jV0">k</b>';m[m.length]={xtype:"link",extcls:"nui-txt-link",text:n,click:function(){d.toggleControl()}}}}function p(b){var c=this,d=c.view,e=new a.Link({title:"全部设置为已读邮件",text:"全部设为已读",extcls:"nui-txt-link",click:function(){d.module.log("title","setallread"),d.setAllRead()}}).html();return b||(e="&nbsp;"+e+"&nbsp;"),e}function q(b){var c=this;if("l-r"!==c.view.getLayout()){var d=$I("init.Contacts");if(b){var e=0,f=d.contacts;if(f){var g=[];g[g.length]={text:"全部联系人",click:A.bind(x.emails,x)};for(var h=0,i=f.length;i>h;h++){var j=f[h],k=d.getInfo(j.data,"unread");e+=k,k>0&&(g[g.length]={text:C.encodeHTML(j.data.name),click:A.bind(x.entry,x,{filter:{chatWithAddress:j.str,flags:{read:!1}},from:"emails"},{type:"list",subtype:"contacts"})})}if(e>0){var l=b.extItems=[];l[l.length]={xtype:"link",extcls:"nui-txt-link",text:'按星标联系人筛选&nbsp;<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:g}],reverse:!0});b.attachTo({clickFrom:this.getEl()})}}}}}}}}function r(b,c){var d=this;if("l-r"!==d.view.getLayout()&&($I("init.Contacts"),b)){for(var e=c.data.contacts,f=[],g=c.data.cid,h=0,i=e.length;i>h;h++){var j=e[h];f[f.length]={text:C.encodeHTML(j.name),click:A.bind(x.entry,x,{filter:{chatWithAddress:j.emails.join().toLowerCase()},from:g,cid:j.cid},{type:"list",subtype:"contacts"})}}var k=b.extItems=[];k[k.length]={xtype:"link",extcls:"nui-txt-link",text:'全部成员的邮件&nbsp;<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:f}],reverse:!0});b.attachTo({clickFrom:this.getEl()})}}}}}function s(){var b=this,c=b.view.module,d=b.getConfig(),e=b.title=new a.Title(d),f=!c.isNone()&&z.count(d)>0?"":"display:none;",g='<div class="tb0" style="'+f+'">'+e.html()+"</div>";return g}function t(){var b=this,c=b.view.module,d=b.title,e=b.getConfig(),f=a(d.getEl().dom.parentNode);!c.isNone()&&z.count(e)>0?(d.update(e),f.show()):f.hide()}function u(){var a=this;try{a.title.destroy(),a.title=null}catch(b){}}function v(a){var b=this;b.view=a}try{var w=$L("support.Folder"),x=$L("interface.MboxInterface")}catch(y){return y}var z=a.Object,A=a.Function,B=a.Array,C=a.String,w=$I("init.Folder"),D=$I("init.Tag"),E=a.createClass($N("module.mbox.Title"));z.extend(E.prototype,{view:null,title:null,getConfig:d,getTag:e,getDefer:f,getFlag:g,getRead:h,getCalendar:i,getFolder:j,getContacts:k,getEmails:l,getFilter:m,getNormal:n,getFull:o,getAllRead:p,getContactRead:q,getGroupContact:r,get:s,update:t,destory:u,initialize:v})}($,window),function(a){function b(b){"undefined"==typeof b&&(b=a.Ud.get({field:"ntes_inbox",flag:"search_type"})-0);var c="",d=this.fields;return f.each(d,function(d,e){return b===e.value?(c=e.key,a.BREAK):void 0}),c}function c(){return g.fields}function d(){var b=g.dateDiff;if(!g._dateInited){var c=$I("util.Misc").getTime(0);a.Array.each(b,function(b,d){var e=a.Date.addDate(c,-d.diff);e.setHours(23),e.setMinutes(59),e.setSeconds(59),d.date=new Date(1e3*Math.floor(e.getTime()/1e3)+999),d.count=0}),g._dateInited=!0}return b}function e(b){function c(){for(var c,d,e=g.getFields(),f=0,i=h.length;i>f;f++){var j=h[f];if(j.checked){d=j.value,c=e[d];break}}a.Ud.set({field:"ntes_inbox",flag:"search_type",value:c.value}),b.additionalSearch("scope",d)}function d(b,c,d,e){var g=b===c-0,i=(g?"<strong>"+d+"</strong>":d)+(e?'<span class="nui-txt-mark">(推荐)</span>':""),j=new a.Radio({text:i,value:c,name:f,checked:g});return h.push(j),j.html()+"<br/>"}var e=b.module,f=e.createId("searchFiledRadio"),h=[];a.Ud.get({field:"ntes_inbox",flag:"search_type"})-0;var i="					"+d(2,"title","主题")+"					"+d(1,"sender","发件人+收件人")+"					"+d(4,"sendtitle","发件人+主题")+"					"+d(0,"default","主题+正文",!0)+"					"+d(3,"all","主题+正文+附件",!1,!0)+"		";a.Msgbox.show({type:"confirm",content:i,title:"请选择默认搜索范围",header:"设置默认搜索范围",ok:c}),a.Radio.group(h),a.Component.setEvents()}var f=a.Object,g=a.createClass($N("module.mbox.Field"));f.extend(g,{fields:{title:{key:"subj",title:"主题",value:2},sender:{key:"from,to",title:"发件人+收件人",value:1},sendtitle:{key:"from,subj",title:"发件人+主题",value:4},"default":{key:"from,to,subj,cont,aname",title:"主题+正文",value:0},all:{key:"from,to,subj,cont,aname,acont",title:"主题+正文+附件",value:3}},dateDiff:[{name:"三天内",diff:3},{name:"一周内",diff:7},{name:"一月内",diff:30},{name:"三月内",diff:90},{name:"三月前",diff:1e5}],_dateInited:!1,getField:b,getFields:c,getDateDiff:d,setDefaultFields:e})}($,window),function(a,b){function c(){var b=this,c=b.view.module;b.init();var d=b.getContent(),e=c.isNone();e&&a.fly(c.container).addClass("vH0");var f=['<div id="',c.createId("NoneDiv"),'"',e?"":' style="display:none;"',">",d,"</div>"].join("");return f}function d(){var b=this,c=b.view.module;b.init();var d=c.isNone(),e=c.getEl("NoneDiv"),f=a.fly(c.container);d?(e.html(b.getContent()),e.show(),f.addClass("vH0")):(e.hide(),f.removeClass("vH0"))}function e(){function c(){g.log("none","composescene");var c=a.Uri.getUrl("compose_scene",!0);b.open(c)}function d(b){var c=new a.Link({title:"输入安全锁密码查看所有邮件",text:"输入安全锁密码查看所有邮件",cls:"nui-txt-link mh1",click:function(){a.AdvLock.show(function(){f.refresh()})}});b.push(c.html())}var e=this,f=e.view,g=f.module,j=g.extend("type"),k=g.extend("subtype"),l=g.extend("systemContacts"),m="search"===j,n="flag"===k,o="tag"===k,p="defer"===k,q="folder"===k,r="calendar"===k,s="emails"===k,t="read"===k,u="contacts"===k,v=!1,w=g.getCondition(),x=$S("advLock"),y=!x.disabled&&!x.authenticated2&&(x.pop||x.folders);try{v=g.param("filter").flags.read===!1}catch(z){}var A,B,C,D=["vj0"],E=[];if(y&&d(E),t||v){var F=g.param("filter");if(F&&""===F.chatWithAddress){B="没有设置星标联系人哦，您可以：";var G=new a.Link({title:"设置联系人或联系组",text:"设置联系人或联系组",cls:"nui-txt-link mh1",click:function(){g.log("none","setcontact"),$E("interface.AddressInterface",function(a){a.entry({action:"marked"})})}});E.push("您可以"+G.html()+"为“星标联系人”"),E.push("并在左侧栏“联系人邮件”查看和他们的来往邮件")}else{B="没有未读邮件哦，您可以：";var H=new a.Link({title:"查看已删除邮件",text:"查看已删除邮件",cls:"nui-txt-link mh1",click:function(){g.log("none","viewdeleted"),$E("interface.MboxInterface",function(a){a.entry({fid:4})})}});E.push(H.html());var I=new a.Link({title:"返回所有邮件列表",text:"返回所有邮件列表",cls:"nui-txt-link mh1",click:function(){g.log("none","returnall");var a=h.clone(g.param()),b=h.clone(g.extend());delete a.filter.flags.read,1===a.fids.length&&(a.fid=a.fids[0],delete a.fids),delete b.subtype,$E("interface.MboxInterface",function(c){c.entry(a,b)})}});E.push(I.html())}}else if(m){B="抱歉，没有搜索到",w&&(B+='<span class="nui-txt nui-txt-mark">'+w+"</span>"),B+="的邮件，建议您：";try{var J=$I("module.mbox.Field");if(g.param("pattern")&&g.param("fts.fields")!==J.getField(3)){var K=new a.Link({title:"重新搜索",text:"点击这里以 主题+正文+附件 搜索模式重新搜索",cls:"nui-txt-link mh1",click:function(){g.log("none","research"),f.additionalSearch("scope","all")}});E.push(K.html())}}catch(z){}E.push("检查关键字是否有错误，或者更换关键字搜索"),E.push("去掉特殊符号，重新进行搜索"),E.push("使用高级搜索功能进行搜索"),D.push("vo0")}else if(n){B="没有设置 "+(w?w:"旗帜")+"邮件哦，您可以：",E.push("一键标记，您可以在邮件列表中点击红旗图标，<br />标为红旗的邮件可以通过左侧栏快速查找。");for(var L=a.LETTERFLAG,M=[],N=1,O=L.length;O>N;N++)L[N]&&(M[M.length]={text:L[N],icon:"flag-"+N,extcls:"nui-txt-flag"+N,click:function(a){return function(){$E("interface.MboxInterface",function(b){b.entry({filter:{label0:a}},{type:"list",subtype:"flag"})})}}(N)});var P=new a.Link({extcls:"nui-txt-link",text:'<b class="nui-ico nui-ico-flag nui-ico-flag-0"></b>其他旗帜&nbsp;<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:M}]});b.attachTo({clickFrom:this.getEl()})}}});E.push("您可以点击查看"+P.html()),D.push("si1")}else if(o){B="用“邮件标签”功能将您的邮件进行分类",E.push("不同的邮件采用不同的标签进行标记，<br />方便您更高效地处理邮件事务。");var H=new a.Link({title:"查看已删除邮件",text:"查看已删除邮件",cls:"nui-txt-link mh1",click:function(){g.log("none","viewdeleted"),$E("interface.MboxInterface",function(a){a.entry({fid:4})})}});E.push(H.html()),D.push("sJ1")}else if(p)B="没有设置待办邮件哦，您可以：",E.push("在邮件列表中点击待办邮件图标，<br />设置邮件的处理时间，<br />到期后会提醒您处理这封邮件。"),D.push("ro1");else if(s)B="没有未读的联系人邮件哦，您可以：";else if(q){var Q=g.param("fid"),R=$I("init.Folder").get(Q);if(B=R.name+"没有邮件哦，您可以：",g.isArchive()){var S=g.extend("area"),T="查看"+("archive"===S?"最近":"更早")+"的邮件",U=new a.Link({title:T,text:T,cls:"nui-txt-link mh1",click:function(){g.log("none","viewarea"),f.goPage("archive"===S?-1:g.getPage())}});E.push(U.html())}if((4===Q||15===Q)&&a.Ext.recovery&&!$S("isVip")){var V=new a.Link({title:"通过误删恢复找回邮件",text:"恢复误删的邮件",cls:"nui-txt-link mh1",click:function(){g.log("none","recovery"),$E("interface.OutlinkInterface",function(a){a.goOutlink({key:"recovery",title:"误删恢复"})})}});E.push(V.html())}var W=R.flags;if(!W.system)if(W.custom){var X=new a.Link({title:"设置来信分类",text:"设置来信分类",cls:"nui-txt-link mh1",click:function(){g.log("none","setfilter"),$E("interface.OptionInterface",function(a){a.goFilter({folder:Q})})}});E.push(X.html()+"，将指定的邮件收取到此文件夹")}else if(W.pop){var Y=new a.Link({title:"立即收取邮件",text:"立即收取邮件",cls:"nui-txt-link mh1",click:function(){g.log("none","receive"),$E(["support.MailCenter"],function(a){a.receive({type:"fid",value:Q})})}});E.push(Y.html())}}else if(r){if(B=w+" 没有收到邮件","date"===g.extend("calendar"))try{var Z=g.param("filter").sentDate,$=g.constructor,_=Z.split(":")[0],ab=$.parseSentDate(_),bb=new a.Link({title:"查看 "+w+" 附近七天邮件",text:"查看附近七天邮件",cls:"nui-txt-link mh1",click:function(){g.log("none","calendar"),f.toolbar.toolbar.find("calendar")[0].fire("select",i.addDate(ab,-3),i.addDate(ab,3))}});E.push(bb.html())}catch(z){}}else u&&l?(B="系统没找到相关邮件，原因可能是:",E.push("1.您曾经清理过相关的邮件"),E.push("2.该网站的确没给您发过邮件")):B="没有找到 "+w+" 相关邮件哦";var cb=s||q;if(""!==f.getLayout()?A="lh1 nui-infoBlock nui-block":(1===D.length&&D.push(cb?"on1":"sj1"),A=D.join(" ")),0===E.length)if(cb){if(a.Ext.compose_scene){var db=new a.Link({title:"虚拟场景写信",text:"虚拟场景写信",cls:"nui-txt-link mh1",click:c});E.push(db.html())}}else if($S("isFree")){var eb=new a.Link({title:"看看每日轻松一刻",text:"看看每日轻松一刻",cls:"nui-txt-link mh1",click:function(){g.log("none","happytime"),$I("init.CustomAppManager").startApp({name:"123000",appId:123e3,text:"轻松一刻",key:"happy_time"})}});E.push(eb.html())}if($S("isVip")){var fb=new a.Link({text:"文件恢复",cls:"nui-txt-link",click:function(){$I("util.CustomAppManager").goOutLink("recovery","文件恢复")}}),gb=new a.Icon({extcls:"nui-ico-tequan"});E.push("试试"+fb.html()+gb.html())}var hb=new a.Link({title:"重新刷新试试",text:"重新刷新试试",cls:"nui-txt-link mh1",click:function(){g.log("none","refresh"),g.container.style.display="none",f.refresh()}});E.push(hb.html()),C=E.join("<br />");var ib=['<div class="',A,'"><div class="ph1"><div class="rm1">',B,'</div><div class="rt1">',C,"</div></div></div>"].join("");return ib}function f(){var a=this,b=a.view.module;a.page=b.getPage(),a.type=b.extend("type"),a.subtype=b.extend("subtype")}function g(a){var b=this;b.view=a}var h=a.Object,i=a.Date,j=a.createClass($N("module.mbox.None"));h.extend(j.prototype,{view:null,page:0,type:null,subtype:null,get:c,update:d,getContent:e,init:f,initialize:g})}($,window),function(a,b,c){function d(){var a=this,b=a.view.module;a.init();var c=a.getContent(),d=['<div class="te0 nui-btnGroup" id="',b.createId("PagerDiv"),'" style="display:none;">',c,"</div>"].join("");return d}function e(){var a=this,b=a.view.module;a.init();var c=b.getEl("PagerDiv");a.hidden?c.hide():(c.html(a.getContent()),c.show())}function f(){var b,d,e=this,f=e.view,g=f.module,h=e.page,i=g.extend("index"),j=g.extend("area");g.isArchive()&&(b="normal"===j,d="archive"===j);var k=[];if(!e.hidden){var l=h-1,m=i>0||d?function(){g.log("pager","previous"),f.goPage(i-1)}:c,n=!m,o=l>i||b?function(){g.log("pager","next"),f.goPage(i+1)}:c,p=!o;k[k.length]=new a.Button({xtype:"button",icon:"prev",subclass:"roundBtn",params:"hasText",disabled:n,click:m,text:"上一页",title:"上一页"}).html(),k[k.length]=new a.Button({xtype:"button",icon:"next",subclass:"roundBtn",params:"hasText hasLeftText",disabled:p,click:o,text:"下一页",title:"下一页"}).html()}return k.join("")}function g(){var a=this,b=a.view.module;try{a.hidden||b.getEl("PagerDiv").show()}catch(c){}}function h(){var a=this,b=a.view.module;a.page=b.getPage(),a.hidden=a.page<(b.isArchive()?1:2)}function i(a){var b=this;b.view=a}var j=a.Object,k=a.createClass($N("module.mbox.Pager"));j.extend(k.prototype,{view:null,hidden:!1,page:0,get:d,update:e,getContent:f,show:g,init:h,initialize:i})}($,window),function(a,b,c){function d(d,e){var f=this,g=f.view,h=g.module,i=h.extend("subtype"),j={};if(f.inited||f.initialize(g),f.infos!==!1){for(var k,l=h.param("order"),m=d.flags.expire,n=d.flags.top,o="defer"===i?d.defer:d.sentDate,p="from"===l?a.Uri.getAddress(d.from.toLowerCase()):c,q=h.isTop(),r=f.infos,s=0,t=r.length;t>s;s++)if(k=r[s],"from"===l){if(k.email===p)break}else{if(m&&k.expire)break;if(n&&q&&k.top)break;if(o>=k.start&&o<k.end)break}if(k.div||k.id)k.count?k.count++:k.count=1;else{k.count=1;var u={},v="nn0";if(!f.once){var w=$S("isFree"),x=h.param("fid");w&&2!==x&&k.date&&(v="nn0 gU0",h.extend("smart")&&(u.style="display:none;")),f.once=!0}if(u.id=h.createId((k.start?k.start.getTime().toString():"top")+(new b.Date).getTime().toString()),u.className="tb0 "+v,u.innerHTML='<span class="jM0">'+k.name+'</span><span class="nui-title-tips nui-txt-tips"></span>',u["aria-label"]=k.name+(k.email?"&lt;"+k.email+"&gt;":""),u.tabIndex=0,e){var y=[],z="";for(var A in u){var B=u[A];switch(A){case"className":y.push('class="'+B+'"');break;case"tabIndex":y.push('tabindex="'+B+'"');break;case"innerHTML":z=B;break;default:y.push(A+'="'+B+'"')}}var C=["<div ",y.join(" "),">",z,"</div>"].join("");k.id=u.id,j.html=C}else{var D=k.div=document.createElement("DIV");for(A in u){var B=u[A];"aria-label"===A?D.setAttribute(A,B):D[A]=B}j.div=D}}}return j}function e(){for(var a=this,b=a.infos,c=0,d=b.length;d>c;c++){var e=b[c],f=e.div;if(f||(f=e.div=document.getElementById(e.id),e.id=null),f)try{var g=f.getElementsByTagName("SPAN"),h=g[g.length-1];h.innerHTML="("+e.count+")"}catch(i){}}}function f(){var a=this,b=a.infos;if(b!==!1)for(var c=0,d=b.length;d>c;c++){var e=b[c],f=e.div?e.div:e.id?document.getElementById(e.id):null;try{f&&f.parentNode.removeChild(f)}catch(g){}delete e.div,delete e.id,delete e.count}a.reinit&&(a.inited=!1),a.once=!1}function g(d){var e=this;e.view=d;var f=d.module,g=f.param("order"),h=!0;if("date"===g||"deferredDate"===g){var j,k,l,m=e.infos=[],n=1,o=a.Misc.getTime(0),p=new b.Date(-1e4,0,1),q=new b.Date(1e4,0,1),r=new b.Date(o.getFullYear(),o.getMonth(),o.getDate()+1),s=r;if("date"===g){f.extend("expire")&&(m[m.length]={name:"今日需要处理的待办邮件",expire:!0}),f.isTop()&&(m[m.length]={name:"置顶",top:!0});for(var t=0,u=o.getDay();u>=t&&!(n>-1&&t>n);t++)0===t?(j="今日",k=m.length):j=1===t?"昨日":"周"+i.getWeek(o,-t),l=new b.Date(i.addDate(s,-1)),m[m.length]={name:j,start:l,end:s,date:!0},s=l;m[m.length]={name:"更早",start:p,end:s,date:!0},m[k].end=q}else"deferredDate"===g&&(m[m.length]={name:"需要处理的待办邮件",start:p,end:r},m[m.length]={name:"尚未到期的待办邮件",start:r,end:q})}if("from"===g){var v;try{v=$I("support.AddressSupport")}catch(w){}e.reinit=!0;var x=f.getCacheData(),y={};if(x&&x.length>0)for(var m=e.infos=[],t=0,u=x.length;u>t;t++){var z=x[t],A=a.Uri.getAddress(z.from.toLowerCase());if(!y[A]){var B=a.Uri.getEmails(A,c,!0),C=B.match,j=A;try{if(1===C.length){var D=C[0];D.force=!0,j=v.getName(D)}}catch(w){}m[m.length]={name:a.String.encodeHTML(j),email:A},y[A]=!0}}else h=!1}e.inited=h}var h=a.Object,i=a.Date,j=a.createClass($N("module.mbox.Period"));h.extend(j.prototype,{infos:!1,view:null,once:!1,inited:!1,reinit:!1,get:d,count:e,reset:f,initialize:g})}($,window),function(a,b){function c(){var a=this,b=a.view.module,c=null;return b.extend("brand")||(c=a.selectFolder(c),c=a.defer(c),c=a.popDeleteInfo(c),c=a.popDeleteFolder(c),c=a.advLock(c),c=a.spamFolder(c),c=a.deleteFolder(c),c=a.systemDelete(c),c=a.forward(c),c=a.antiSpam(c),c=a.popInfo(c),c=a.recovery(c)),c=a.hide(c),c.subclass="tipsBlock",c.closeclick||(c.closeclick=null),c}function d(b){var c=this;if(b)return b;try{var d=c.view,e=d.module;if(e.isSelectFolder()&&d.allSelected){var f,g,h=$I("init.Folder"),i=!!d.folderSelected,j=e.param("fid"),k=h.get(j),l=h.getInfo(j);i?(f=new a.Link({text:"清除选中",cls:"nui-txt-link",click:function(){a.Thread.run(function(){d.setFolderSelect(!1)},0)}}),g="已选中 "+k.name+" "+l+" 封邮件，您也可以 "+f.html()):(f=new a.Link({text:"选择所有",cls:"nui-txt-link",click:function(){a.Thread.run(function(){d.setFolderSelect(!0)},0)}}),g="已选中当前页所有邮件，您也可以 "+f.html()+" "+k.name+" "+l+" 封邮件"),b={content:g}}}catch(m){}return b}function e(b){var c=this;if(b)return b;try{var d=c.view.module,e=d.param("fid"),f=$I("init.Defer"),g=f.getInfo("expire");if($I("init.Thread").check()&&f.showTop(e,!0)&&g>0){var h,i=new a.Link({text:"立即查看并处理",cls:"nui-txt-link",click:function(){d.log("tips","defer"),$E("interface.MboxInterface",function(a){a.defer()})}});h='<span class="nui-txt-alert uT0"><b class="nui-ico nui-ico-todo nui-ico-todo-selected"></b> 您有 <strong>'+g+"</strong> 封待办邮件尚未处理，</span>"+i.html(),b={content:h}}}catch(j){}return b}function f(c){var d=this,e=d.view,f=e.module,g=f.param("fid");if(c||1!==g)return c;try{var h=$I("init.Folder").get(15);if(!h)return c;var i="popDeleteInfo";if($S(i))try{var j=$S(i).data,k=j.lastDelTime;if(k>j.lastCloseTipsTime){var l,m,n=new b.Date(k);l=new a.Link({text:h.name,cls:"nui-txt-link",click:function(){$E("interface.MboxInterface",function(a){a.entry({fid:15},{type:"list",subtype:"folder"})})}}),m="部分邮件在 "+a.Date.format(n,"yyyy-MM-dd HH:mm")+" 被客户端收取并删除，被删邮件已备份到 "+l.html()+" 文件夹",c={content:m,closeclick:function(){a.Ajax.jsonp(a.Uri.getUrl("popDelSet"),function(a){$S(i,a)}),j.lastCloseTipsTime=(new b.Date).getTime(),d.update()}}}}catch(o){}else $S(i,!0),a.Ajax.jsonp(a.Uri.getUrl("popDelQuery"),function(a){$S(i,a),d.update()})}catch(o){}return c}function g(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fid");if(15===f){var g,h,i,j,k=$I("init.Folder").get(f),l={cls:"nui-txt-link",click:function(){$E("interface.OptionInterface",function(a){a.entry({module:"options.AntiSpamModule",inputName:"keepPeriod4"})}),e.cleanCache()}},m=k.keepPeriod;m>0?(l.text="修改",i=new a.Link(l),j="自动删除"+m+"天"+($S("isCorp")?"":"("+i.html()+")")+"以上邮件"):(l.text="点击设置自动清理",i=new a.Link(l),j=i.html()),g=new a.Link({text:"禁止客户端收信",cls:"nui-txt-link",click:function(){a.Nav.entry("OptionInterface",{module:"options.OptionOutLinkModule",linkName:"smtp"})}});var n="";if($S("isFree")){var o="deleteRecovery";v.getProductStatue(o,function(b){if(!b){var c=new a.Link({text:"误删恢复（误删10天内的邮件可恢复）",cls:"nui-txt-link",click:function(){v.showProduct(o)}});n="&nbsp;"+c.html()}})}h="被客户端收取并删除的邮件备份在此，"+j+"，"+g.html()+n,b={content:h}}}catch(p){}return b}function h(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fid"),g=e.param("fids"),h=$S("advLock"),i=!h.disabled&&!h.authenticated2&&(h.pop||h.folders),j=!1;if(!f&&g&&1===g.length&&(f=g[0]),f>0)j=h[f];else try{var k;try{k=e.param("filter").flags.read===!1}catch(l){}var m=k?"unread":"",n=e.getTotal(),o=e.extend("subtype");if("defer"===o)j=$I("init.Defer").getInfo("total")>n;else if("tag"===o){var p=e.param("tag");j=$I("init.Tag").getInfo(p[0],m)>n}else if("contacts"===o){var q=e.param("filter").chatWithAddress;j=$I("init.Contacts").getInfo(q,m)>n}else for(var r=$I("init.Folder"),s=0,n=0,t=0,u=g.length;u>t;t++){var v=g[t];if(h[v])if(k){if(s+=r.getInfo(v,"unread"),s>0){j=!0;break}}else if(n+=r.getInfo(v),n>0){j=!0;break}}}catch(l){}if(i&&j){var w=new a.Link({text:"输入安全锁密码",cls:"nui-txt-link",click:function(){a.AdvLock.show(function(){d.refresh()})}}),x=w.html()+" 查看全部邮件";b={content:x}}}catch(l){}return b}function i(b){var c=this;if(b)return b;try{var d=$I("init.Folder"),e=c.view,f=e.module;f.param("fid"),f.extend("type");var g=f.extend("subtype"),h=f.extend("read"),i=f.param("fids");if("read"===g&&h===!1&&i.length>1){for(var j=$G.common.nolistids,k=!1,l=j.length-1;l>-1;l--)if(y.has(i,j[l])){k=!0;break}for(var m=0,n=[],l=j.length-1;l>-1;l--){var o=j[l],p=d.getInfo(o,"unread");m+=p,p>0&&n.push(d.get(o).name)}var q=n.join("，");if(k){var r,s;r=new a.Link({text:"点击此处查看",cls:"nui-txt-link",click:function(){var a={exceptFids:$G.common.unnormalids.concat(1),filter:{flags:{read:!1}}},b=x.clone(f.getVar("extend"));b.index=0,$E("interface.MboxInterface",function(c){c.entry(a,b)})}}),s=r.html()+"普通文件夹未读邮件",b={content:s}}else if(m>0){var r,s;r=new a.Link({text:"点击此处查看",cls:"nui-txt-link",click:function(){var a={fids:j,filter:{flags:{read:!1}}},b=x.clone(f.getVar("extend"));b.index=0,$E("interface.MboxInterface",function(c){c.entry(a,b)})}}),s="不包含 "+q+" 的未读邮件，"+r.html(),b={content:s}}}}catch(t){}return b}function j(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fids");if(f){var g,h,i=4;f.length>1&&!y.has(f,i)?$I("init.Folder").getInfo(i)>0&&(g=new a.Link({text:"点击此处查看",cls:"nui-txt-link",click:function(){var a=x.clone(e.getVar("param"));a.fids=[i];var b=x.clone(e.getVar("extend"));b.index=0,$E("interface.MboxInterface",function(c){c.entry(a,b)})}}),h="不包含 已删除 文件夹的邮件， "+g.html()):1===f.length&&f[0]===i&&(g=new a.Link({text:"点击此处查看",cls:"nui-txt-link",click:function(){var a=x.clone(e.getVar("param")),b=x.clone(e.getVar("extend"));delete a.fids,delete b.index,$E("interface.MboxInterface",function(c){c.entry(a,b)})}}),h=g.html()+" 普通文件夹邮件"),h&&(b={content:h})}}catch(j){}return b}function k(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fid"),g=$S("isCorp"),h=$I("init.Folder").get(f);if(h.keepPeriod){var i="";if(4!==f){var j=new a.Link({text:"修改",cls:"nui-txt-link",click:function(){$E("interface.OptionInterface",function(a){a.entry({module:"options.AntiSpamModule",inputName:"keepPeriod2"})}),e.cleanCache()}});i="("+j.html()+")"}var k="";if($S("isFree")){var l="deleteRecovery";v.getProductStatue(l,function(b){if(!b){var c=new a.Link({text:"误删恢复（误删10天内的邮件可恢复）",cls:"nui-txt-link",click:function(){v.showProduct(l)}});k="&nbsp;"+c.html()}})}var m="";if($S("isVip")){var n=new a.Link({text:"文件恢复",cls:"nui-txt-link",click:function(){$I("util.CustomAppManager").goOutLink("recovery","文件恢复")}}),o=new a.Icon({extcls:"nui-ico-tequan"});
m=n.html()+o.html()}b={content:"“"+h.name+"” 自动删除 "+h.keepPeriod+" 天"+i+"以上的邮件 ("+(g?"":"网易")+"强大的反垃圾系统已帮您拦截99.8%的垃圾邮件)"+k+m}}}catch(p){}return b}function l(b){function c(){$S("closeForwardTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if("folder"===e&&!$S("closeForwardTips")){var f=d.view;f.module;var g=u.getForwardAddr();if(g){var h=new a.Link({text:"自动转发设置",cls:"nui-txt-link",click:function(){c(),$E("interface.OptionInterface",function(a){a.entry({module:"BaseSetModule",inputName:"autoForward"})})}}),i="目前您的邮件已设置自动转发到 "+g+"。如需修改请点击 "+h.html();b={content:i,closeclick:c}}}}catch(j){}return b}function m(b){function c(){$S("closeAntiSpamTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if("folder"===e&&!$S("closeAntiSpamTips")){var f=d.view,g=f.module,h=g.param("fid"),i=$I("init.Folder").getInfo(h,"unread"),j=u.isLowAntiSpamLevel();if(20>h&&i>0&&j){var k=new a.Link({text:"重新设置",cls:"nui-txt-link",click:function(){c(),$E("interface.OptionInterface",function(a){a.entry({module:"AntiSpamModule"})})}}),l="垃圾邮件过多？可能是由于反垃圾级别设置过低或关闭了邮件智能分类，建议您 检查 或 "+k.html();b={content:l,closeclick:c}}}}catch(m){}return b}function n(b){function c(){$S("closePopInfoTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if("folder"===e&&!$S("closePopInfoTips")){var f=d.view,g=f.module,h=g.param("fid"),i=$I("init.Folder").getPopInfo(h);if(i.isPop&&i.stats){z.encodeHTML(new a.Email(i.username,i.name).toString());var j=i.stats.endTime||$I("util.Misc").getTime(0),k=A.format(j,"yyyy-M-d HH:mm"),l=i.stats,m=new a.Link({link:"pop3_skip_info",text:"查看详情",cls:"nui-txt-link",target:"_blank"}),n=[i.username,"&nbsp;于&nbsp;",k,"&nbsp;收取到 <strong>",l.receivedMessageCount?l.receivedMessageCount:0,"</strong> 封新邮件",l.skippedMessageCount?"，跳过了 <strong>"+l.skippedMessageCount+"</strong> 封邮件"+($S("isCorp")?"":"("+m.html()+")"):"",l.spamMessageCount?"，其中  <strong>"+l.spamMessageCount+"</strong> 封被移到垃圾邮件箱":"",l.errorMessageCount?"，收取  <strong>"+l.errorMessageCount+"</strong> 封出错":"",l.rejectedMessageCount?"，  <strong>"+l.rejectedMessageCount+"</strong> 封被拒收":"",l.excessMessageCount?"，  <strong>"+l.excessMessageCount+"</strong> 封超过单封邮件容量":""].join("");b={content:n,closeclick:c}}}}catch(o){}return b}function o(b){function c(){$S("closeRecoveryTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if($S("isVip")&&"folder"===e&&!$S("closeRecoveryTips")&&!($S("cos").pref_mail_preserving_days>0)){var f=1;if(f>0){var g=new a.Link({text:"立即开启&gt;&gt;",cls:"nui-txt-link",click:function(){c(),$I("util.CustomAppManager").goOutLink("recovery","文件恢复")}}),h=new a.Icon({extcls:"nui-ico-tequan"}),i="开启文件恢复，防止邮件丢失！"+h.html()+" "+g.html();b={content:i,closeclick:c}}}}catch(j){}return b}function p(a){var b=this,c=b.view.module;return!a||c.isNone()?a={hidden:!0}:a.hidden=!1,a}function q(){var b=this,c=b.getConfig(),d=b.block=new a.Block(c);return d.html()}function r(){var b=this,c=b.block,d=b.getConfig();c.update(d),a.Component.setEvents()}function s(){var a=this;try{a.block.destroy(),a.block=null}catch(b){}}function t(a){var b=this;b.view=a}try{var u=$L("support.OptionSupport"),v=$L("product.Privileges")}catch(w){return w}var x=a.Object;a.Function;var y=a.Array,z=a.String,A=a.Date,B=a.createClass($N("module.mbox.Tips"));x.extend(B.prototype,{view:null,block:null,getConfig:c,selectFolder:d,defer:e,popDeleteInfo:f,popDeleteFolder:g,advLock:h,spamFolder:i,deleteFolder:j,systemDelete:k,forward:l,antiSpam:m,popInfo:n,recovery:o,hide:p,get:q,update:r,destroy:s,initialize:t})}($,window),function(a,b,c){function d(a){var b=this,c={groups:[]},d=b.view,e=b.view.module;return b.select(c),b.complete(c),b.remove(c),"archive"!==e.extend("area")&&"defer"!==e.extend("subtype")&&b.report(c),b.control(c),b.recovery(c),b.refresh(c),b.calendar(c),b.extend(c,a),c.hidden=""===d.getLayout()&&e.isNone(),c}function e(a){var b=this,c=b.view,d=c.module,e=a.groups,f=[{xtype:"button",subclass:"dropdownBtn",checkbox:{checkedchange:function(a){d.log("toolbar","allornone"),c.select(a?"all":"none")},checked:c.allSelected},menu:{groups:[{items:[{text:"全选",click:function(){d.log("toolbar","all"),c.select("all")}},{text:"不选",click:function(){d.log("toolbar","none"),c.select("none")}},{text:"未读",click:function(){d.log("toolbar","unread"),c.select("unread")}},{text:"已读",click:function(){d.log("toolbar","read"),c.select("read")}}]}]}}];"defer"===d.extend("subtype")&&f[0].menu.groups[0].items.push({text:"到期",click:function(){c.select("expire")}}),e[e.length]={items:f}}function f(a){var b=this,c=b.view,d=c.module;if("defer"===d.extend("subtype")){var e=a.groups,f=[];f.push({xtype:"button",subclass:"mainBtn",text:"设为完成",icon:{type:"done",subtype:"white"},click:function(){d.log("toolbar","defercomplete"),c.setDefer("complete")}}),e[e.length]={items:f}}}function g(a){var b,c=this,d=c.view,e=d.module,f=a.groups,g=e.param("fid"),b=e.param("fids"),h=e.param("tag"),i=e.extend("smart"),j="删 除",k=!1,l=!1;g>0?l=B.has([4,5,7,15,18],g):b&&(l=B.has(b,4)&&1===b.length),l||!h||i||(l=0===h[0].indexOf("%")),l?(j="彻底删除",k=!0):2===g&&(j="删除草稿"),f[f.length]={items:[{xtype:"button",text:j,click:function(){e.log("toolbar",k?"permanentdeleted":"movetodeleted"),d.remove(k)},disabled:l?d.folderSelected:!1}]}}function h(a){var b=this,c=b.view,d=c.module,e=a.groups,f=d.param("fid"),g=c.folderSelected;if(!f||!B.has([2,3],f)){var h=[];B.has([5,7,18],f)&&h.push({xtype:"button",text:"信 任",click:function(){d.log("toolbar","report","normal"),c.setSpam(!1)},disabled:g}),h.push({xtype:"button",text:"举 报",click:function(){d.log("toolbar","report","spam"),c.setSpam(!0)},disabled:g}),e[e.length]={items:h}}}function i(a){var b=this,c=a.groups,d=c[c.length]={items:[]},e=d.items;b.mark(e),b.move(e),b.more(e)}function j(b){var c=this,d=c.view,e=d.module,f=(e.extend("type"),e.extend("subtype")),g=d.folderSelected,h={xtype:"button",subclass:"dropdownBtn",text:"标记为",menu:{groups:[]}};b.push(h);var i=h.menu.groups;if("defer"===f){var j=[{text:"完成",click:function(){d.setDefer("complete")},icon:"todo"}];i[i.length]={items:j}}var k="read"===f,l=e.extend("read"),m=[{text:"已读",click:function(){e.log("toolbar","setread"),d.setRead(!0)},disabled:k&&l},{text:"未读",icon:"unread",click:function(){e.log("toolbar","setunread"),d.setRead(!1)},disabled:k&&!l}];if("folder"===f&&m.push({text:"全部设为已读",click:function(){e.log("toolbar","setallread"),d.setAllRead()}}),i[i.length]={items:m},e.isDefer()&&"defer"!==f){var n=[{text:"待办邮件",click:function(){e.log("toolbar","setdefer"),d.setDefer("add")},disabled:g,icon:"todo"}];i[i.length]={items:n}}if(e.isFlag()){for(var o=a.LETTERFLAG,p=[],q="flag"===f,r=e.extend("flag"),s=2,t=o.length;t>s;s++)o[s]&&(p[p.length]={text:o[s],icon:"flag-"+s,extcls:"txt-flag"+s,click:function(a){return function(){e.log("toolbar","setflag",a),d.setFlag(a)}}(s),disabled:q&&r===s});i[i.length]={items:[{text:"红旗",icon:"flag-1",extcls:"txt-flag1",click:function(){e.log("toolbar","setflag",1),d.setFlag(1)},disabled:q&&1===r},{text:"其他旗帜",icon:"flag-0",menu:{groups:[{items:p}]}},{text:"取消旗帜",click:function(){e.log("toolbar","setflag",0),d.setFlag(0)}}]}}if(e.isTag()){var u=E.list(),v=[],w="tag"===f,x=e.param("Tag");for(var y in u){var z=u[y];v[v.length]={text:E.getName(z),icon:{type:"tag",subtype:z.color,xtype:"icon"},click:function(a){return function(){e.log("toolbar","settag",1),d.setTag(!0,a)}}(z.name),dieabled:function(a){return w&&x&&B.has(x,a)}(z.name)}}var A=i[i.length]={items:[{text:"标签",menu:{groups:[]}}]},C=A.items[0].menu.groups;v.length>0&&(C.push({items:v,type:"scroll"}),A.items.push({text:"取消所有标签",click:function(){e.log("toolbar","settag",0),d.setTag()}})),C.push({items:[{text:"新建标签并标记",click:function(){e.log("toolbar","settag",2),$E("support.Tag",function(a){a.add({callback:function(a){d.setTag(!0,a)}})})}}]})}e.isTop()&&(i[i.length]={items:[{text:"置顶邮件",click:function(){e.log("toolbar","settop",1),d.setTop(!0)},disabled:g},{text:"取消置顶",click:function(){e.log("toolbar","settop",0),d.setTop(!1)},disabled:g}]})}function k(a){var b=this,d=b.view,e=d.module,f=e.param("fid"),g={xtype:"button",subclass:"dropdownBtn",text:"移动到",menu:{groups:[]}};a.push(g);var h=g.menu.groups,i=D.list(),j={custom:[],pop:[],system:[]};B.each(i,function(a,b){if(f!==b.id){var g,h=b.flags;g=h.custom?"custom":h.pop?"pop":"system";var i=j[g];i[i.length]={text:b.name,click:function(){e.log("toolbar","move",1),d.move(b.id)},icon:h.pop?{type:"folder",subtype:b.flags.iconSubtype,xtype:"icon"}:c}}});var k=[],l=!1;A.each(j,function(a,b){var c=b.length>0;l&&c&&k.push({type:"split"}),l=l||c;for(var d=0,e=b.length;e>d;d++)k.push(b[d])}),h[h.length]={items:k,type:"scroll"},h[h.length]={items:[{text:"新建文件夹并移动",click:function(){e.log("toolbar","move",2),$E("support.Folder",function(a){a.add({callback:function(a){d.move(a)}})})}}]}}function l(b){var c=this,d=c.view,e=d.module,f=d.folderSelected,g={xtype:"button",subclass:"dropdownBtn",text:"更多",menu:{groups:[]},disabled:f};b.push(g);var h=g.menu.groups,i=[{text:"导出选中邮件",click:function(){e.log("toolbar","export"),d.exportLetter()},disabled:f},{text:"转发选中邮件",click:function(){e.log("toolbar","forward"),d.forwardLetter()},disabled:f}],j=e.param("fid");if(j>0){var k=a.Ud.get({field:"ntes_option",flag:"sizeshow"})-0,l=!(F||$S("isFree")&&1!==k),m="发件人",n="from";(2===j||3===j)&&(m="收件人",n="to");var o=[],o=[["按时间从新到旧","date",!0],["按时间从旧到新","date",!1],["按"+m+"降序",n,!0],["按"+m+"升序",n,!1],["按主题降序","subject",!0],["按主题升序","subject",!1]];l&&(o.push(["按邮件从大到小","size",!0]),o.push(["按邮件从小到大","size",!1]));var p=0,q=e.param("order"),r=e.param("desc");switch(q){case"date":p=r?0:1;break;case"to":case"from":p=r?2:3;break;case"subject":p=r?4:5;break;case"size":p=r?6:7}for(var s=[],t=0,u=o.length;u>t;t++){var v=A.clone(e.param()),w=A.clone(e.extend()),y=o[t];v.order=y[1],v.desc=y[2],s[s.length]={text:y[0],click:function(a,b){return function(){e.log("toolbar","sort",a.order+"_"+a.desc),x.entry(a,b)}}(v,w),checked:t===p}}i.push({text:"排序",menu:{groups:[{items:s,checkType:"radio"}]}})}h[h.length]={items:i}}function m(b){var c=this,d=c.view,e=d.module,f=b.groups,g=e.param("fid");4!==g&&15!==g||!a.Ext.recovery||(f[f.length]={items:[{xtype:"button",text:"误删恢复",click:function(){e.log("toolbar","recovery"),$E("interface.OutlinkInterface",function(a){a.goOutlink({key:"recovery",title:"误删恢复"})})}}]})}function n(a){var b=this,c=b.view,d=a.groups;d[d.length]={items:[{xtype:"button",text:"刷 新",click:function(){c.module.log("toolbar","refresh"),c.refresh()}}]}}function o(a){var c=this,d=c.view,e=d.module,f=a.groups,g=e.extend("subtype");if("folder"===g||"calendar"===g){var h;try{var i=e.param("filter");if(i&&i.sentDate){var j=i.sentDate,k=e.constructor,l=j.split(":"),m=l[0],n=l[1],o=k.parseSentDate(m),p=k.parseSentDate(n);h=0===o-p?o:[o,p]}}catch(q){}f[f.length]={items:[{xtype:"calendar",onselect:function(a,c){e.log("toolbar","calendar"),c||(c=new b.Date(a));var d=C.format(a,"yyyyMMdd"),f=C.format(c,"yyyyMMdd"),g=A.clone(e.param()),h=A.clone(e.extend());g.fid&&(g.fids=[g.fid],delete g.fid);var i=(c.getTime()-a.getTime())/1e3/60/60/24;h.calendar=0===i?"date":6===i?"week":"month",h.subtype="calendar",g.filter={sentDate:d+":"+f},x.entry(g,h)},focus:h}],type:"ext"}}}function p(a,b){var c=this,d=a.groups;c.page(d,b),c.option(d)}function q(a,b){var d,e,f=this,g=f.view,h=g.module,i=h.getPage(),j=h.extend("index"),k=h.extend("area");if(h.isArchive()&&(d="normal"===k,e="archive"===k),i>0||d||e){var l=i-1,m=j>0||e?function(){h.log("toolbar","previous"),g.goPage(j-1),j--}:c,n=!m,o=l>j||d?function(){h.log("toolbar","next"),g.goPage(j+1),j++}:c,p=!o,q=[];if(e&&q.push({text:"最近的邮件",value:-1,checked:!1}),0===i&&(i=1),!F||b)for(var r=0;i>r;r++)q.push({text:r+1+"/"+i,value:r,checked:r===j});else q.push({text:j+1+"/"+i,value:j,checked:!0});d&&q.push({text:"更早的邮件",value:i,checked:!1});var s=a[a.length]={items:[],type:"ext"},t=s.items;t.push({xtype:"select",system:F,subclass:"simpleSelect",options:q,title:"当前第"+(j+1)+"页",selectedchange:function(){var a=this,b=a.value-0;b!==j&&(h.log("toolbar","gopage"),g.goPage(b),(-1===b||b===i)&&(-1===b?a.setValue(j):a.setSelected(j),a.fire("selectedchange")))},listeners:F&&!b?{mouseover:{handler:function(){f.update(!0)}}}:c});var s=a[a.length]={items:[],type:"ext"},t=s.items;t.push({xtype:"button",icon:"prev",subclass:"roundBtn",disabled:n,click:m,title:"上一页",lazyListen:!1},{xtype:"button",icon:"next",subclass:"roundBtn",disabled:p,click:o,title:"下一页",lazyListen:!1})}}function r(b){var d=this,e=d.view,f=e.module,g=(f.extend("type"),f.extend("subtype")),h=f.param("fid"),i=b[b.length]={items:[],type:"ext"},j=i.items,k={groups:[],extcls:"nui-settingMenu",delegateTo:"self",reverse:!0};j.push({xtype:"button",icon:"setting",subclass:"roundBtn",menu:k,title:"设置"});var l,m=k.groups;l=[];var n=a.Ud;if(!F){var o=n.get({field:"ntes_inbox",flag:"layout"})-0;0===o&&(o=1);for(var p=[["关闭",1],["底部",2],["右侧",3]],q=[],r=0,s=p.length;s>r;r++){var t=p[r],u=t[1];q[q.length]={text:t[0],value:u,checked:o===u,subclass:"btn"}}l.push({doNotHide:!0,text:"读信窗口",extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setlayout",a),e.setLayout(a)},items:q}})}var v=n.get({field:"ntes_letter",flag:"line_height"})-0;0===v&&(v=3);var w=n.get({field:"ntes_letter",flag:"font_size"})-0;0===w&&(w=1);var x=-1;1!==v&&2!==v||2!==w?3!==v&&0!==v||1!==w&&0!==w?4===v&&3===w&&(x=3):x=2:x=1;for(var z=[["宽松",1],["适中",2],["紧凑",3]],A=[],r=0,s=z.length;s>r;r++){var C=z[r],D=C[1];A[A.length]={text:C[0],value:D,checked:x===D,subclass:"btn"}}if(l.push({text:"列表间距",extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setspace",a),e.setSpace(a)},items:A}}),!a.Ext.limit_max){for(var E=[],G=[["10",10],["15",15],["20",20],["30",30],["50",50],["100",100]],H=f.extend("limit"),r=0,s=G.length;s>r;r++){var I=G[r],J=I[1];E[E.length]={text:I[0],value:J,checked:H===J,subclass:"btn"}}l.push({text:"每页显示邮件数量",extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setmaxlist",a),e.setMaxList(a)},items:E}})}for(var K=n.get({field:"ntes_option",flag:"sendershow"})-0,L=[["发件人姓名",1],["通讯录昵称",2]],M=[],r=0,s=L.length;s>r;r++){var N=L[r],O=N[1];M[M.length]={text:N[0],value:O,checked:2===K^2!==O,subclass:"btn"}}if(l.push({gap:"before",text:"发/收件人姓名显示",extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setsendershow",a),e.setSenderShow(a)},items:M}}),!F&&$S("isFree")&&"l-r"!==e.getLayout()){var P=n.get({field:"ntes_option",flag:"sizeshow"})-0;l.push({text:"邮件大小",extText:{xtype:"checkbox",subclass:"switch",checked:1===P,text:"显示",unCheckText:"隐藏",checkedchange:function(a){f.log("toolbar","setsize",a?1:0),e.setSize(a?1:0)}}})}if(f.isThread(!0)){var Q=$S("isFree"),R=Q?0:1,S=Q?1:0,T=n.get({field:"ntes_option",flag:"thread"})-0;l.push({text:"邮件会话",extText:{xtype:"checkbox",subclass:"switch",checked:T===R,text:"开启",unCheckText:"关闭",checkedchange:function(a){f.log("toolbar","setthread",a?1:0),e.setThread(a?R:S)}}})}if(a.Ext.summary&&"full"!==g){var U=n.get({field:"ntes_option",flag:"summary"})-0;l.push({text:"邮件摘要",extText:{xtype:"checkbox",subclass:"switch",checked:1===U,text:"开启",unCheckText:"关闭",checkedchange:function(a){f.log("toolbar","setsummaryshow",a?1:0),e.setSummaryShow(a?1:0)}}})}var V=!1;3===h&&!$S("isCorp")&&a.Ext.letterRecall&&(l.push({gap:"before",text:"邮件撤回",click:function(){f.log("toolbar","gomailback"),$E("interface.OptionInterface",function(a){a.entry({module:"mailback",link:"backout"})})}}),V=!0),l.push({gap:V?c:"before",text:"邮箱中心",click:function(){f.log("toolbar","gomailcenter"),y.entry({module:"AccountCenterModule"})}}),l.push({text:"来信分类",click:function(){f.log("toolbar","gofilter"),y.entry({module:"MailFilterModule"})}}),l.push({text:"文件夹管理",click:function(){f.log("toolbar","gofoldermanager"),y.entry({module:"FolderTagModule"})}}),B.has([5,7,18],h)&&l.push({text:"智能分类设置",click:function(){f.log("toolbar","goantispam"),y.entry("AntiSpamModule")}}),l.push({text:"更多设置",click:function(){f.log("toolbar","moresetting"),y.entry({module:"BaseSetModule"})}}),m.push({items:l})}function s(){var b=this,c=b.getConfig(),d=b.toolbar=new a.Toolbar(c);return b.view.module._toolbar=d,d.html()}function t(a){var b=this,c=b.toolbar,d=b.getConfig(a);c.update(d)}function u(){var a=this;try{a.toolbar.destroy(),a.toolbar=null}catch(b){}}function v(a){var b=this;try{b.toolbar.find("checkbox")[0].setChecked(a,!0)}catch(c){}}function w(a){var b=this;b.view=a}try{var x=$L("interface.MboxInterface"),y=$L("interface.OptionInterface")}catch(z){return z}var A=a.Object;a.Function;var B=a.Array,C=a.Date,D=$I("init.Folder"),E=$I("init.Tag"),F=a.Browser.isIE("<9"),G=a.createClass($N("module.mbox.Toolbar"));A.extend(G.prototype,{view:null,toolbar:null,getConfig:d,select:e,complete:f,remove:g,report:h,control:i,mark:j,move:k,more:l,recovery:m,refresh:n,calendar:o,extend:p,page:q,option:r,get:s,update:t,destory:u,selectAll:v,initialize:w})}($,window),function(a){function b(b,c){var d=c.listen,e=this,f=e.module;f.view;var g=(f.extend("type"),f.extend("subtype")),h=a.Context.getModule(),i=f===h,j=!1;try{switch(g){case"folder":var k=f.param("fid"),l=b.Folder;l&&l.info.stats&&l.info.stats[k]&&(j=!0);var m=$I("init.Defer");if(f.isThread()&&m.showTop(k,!0)){var n=b.Defer;n&&n.info.stats&&n.info.stats.expire&&(j=!0)}break;case"flag":var o=f.param("filter").label0,p=b.Flag;p&&p.info.stats&&p.info.stats[o]&&(j=!0);break;case"tag":var q=f.param("tag"),r=b.Tag;if(r&&r.info.stats)for(var s=0,t=q.length;t>s;s++)if(r.info.stats[q[s]]){j=!0;break}break;case"contacts":var u=f.param("filter"),v=u.chatWithAddress||u.fromAddress||u.toAddress,w=b.Contacts;if(w&&w.info.stats)for(var x=v.split(","),s=0,t=x.length;t>s;s++)if(w.info.stats[x[s]]){j=!0;break}break;case"defer":var n=b.Defer;n&&n.info.stats&&(j=!0);break;case"read":var l=b.Folder;l&&l.changed&&(j=!0);break;case"emails":var w=b.Contacts;w&&w.changed&&(j=!0);break;default:H.each(b,function(b,c){return c.changed?(j=!0,a.BREAK):void 0})}}catch(y){}j&&(d||(i?f.replace():e.lazyReplace(f)),f.view.update())}function c(b){function c(){try{var a=g.getCacheData(-1);if(!a)try{var c=h.letters;a=[];for(var e=0,f=c.length;f>e;e++)a.push(c[e].data)}catch(i){}if(a)for(var j=0,k=0,l=a.length,m=q.length;l>j&&m>k;j++){var o=a[j];if(o&&n[o.id]){var p=d.syncData(b,o);p&&(z[o.id]=!0),k++}}}catch(i){}}try{var d=$L("interface.MboxInterface",this)}catch(e){return e}var f=this,g=f.module,h=g.view,i=g.param("fid"),j=g.extend("subtype"),k=g.extend("brand"),l=$I("init.Thread"),m=b.fid,n=b.list,o=b.action,p=b.value,q=b.data,r=b.type,s=q.length,t=b.hasThread,u=b.hasSent,v=b.allFid,w=g.isThread(),x=a.Context.getModule(),y=g===x,z={},A=!1,B=!1,C=!0,D=!1,E=!1,F=!1,G=!1,J=!1;if(v>0)A=!0;else if("top"===o&&m&&(m[i]||w)&&g.isTop())A=!0;else if("flag"===o){if("flag"===j)A=!0,B=!0;else if("normal"===j)for(var K=g.param("conditions"),L=0,M=K.length;M>L;L++){var N=K[L];if("label0"===N.field){A=!0;break}}}else if("read"===o){if("read"===j||"emails"===j)E=!0;else try{g.param("filter").flags.read===!1&&(E=!0)}catch(e){}G=!0}else if("tag"===o&&"tag"===j)A=!0;else if("defer"===o&&"defer"===j)A=!0,F=!0;else if("defer"!==o||"add"!==r&&"complete"!==r&&"modify"!==r||"folder"!==j){if("move"===o){if(m[i]||i===p||w)A=!0,B=!0;else if(p&&4!==p||"search"!==g.extend("type")){if(p)switch(j){case"contacts":case"flag":case"tag":var O=$G.common.unnormalids;if(!p||I.has(O,p))A=!0,B=!0;else for(var L=0,M=q.length;M>L;L++)if(I.has(O,q[L].fid)){A=!0;break}break;case"defer":break;default:A=!0,B=!0}else if("defer"===j||k)A=!0,B=!0;else if("folder"===j)for(var P=$I("init.Defer"),Q=P.getDate("tomorrow"),L=0,M=q.length;M>L;L++)try{var R=q[L];if(R.flags.deferHandle&&R.defer<Q){F=!0,A=!0;break}}catch(e){}}else A=!0,B=!0;"archive"===b.area&&"archive"!==g.extend("area")&&"folder"===j&&(D=!0),G=!0}}else A=!0,C=!0,F=!0,w&&(J=!0);if(D&&g.extend("forceRequest",!0),E&&g.extend("forcePage",!0),F&&$I("init.Defer").setCache(),J&&h.tips.update(),G&&k)if(y)try{g.refreshBrand()}catch(e){}else g.extend("forceBrand",!0);if(c(),A&&!y)f.lazyReplace(g);else{if(C)for(var L=0,M=q.length;M>L;L++)z[q[L].id]=!0;if(H.count(z)>0){if(A?g.replace(o,B,s,n,z):h.syncLetter(o,s,n,z),y&&A){var S=h.getLayout();S&&a.SM.go({parent:g,module:"mbox.PreviewModule",param:{layout:S},viewType:S,sharebar:!0,cacheDom:!1,reset:!1})}}else(t||l.check()&&u||v)&&f.lazyReplace(g)}}function d(){var b=this,c=b.module;c.view;try{c.getDom("AdDiv").style.display="none"}catch(d){}try{c.getDom("FooterDiv").style.display="none"}catch(d){}$S("closeAd",!0),a.Cookie.set("mailmboxpro","1",{domain:$S("fullDomain"),expires:21})}function e(){var b=this,c=b.module,d=c.view,e=a.Context.getModule();c===e?d.refresh(c.extend("index")):b.cleanCache(c)}function f(){var b=this,c=b.module,d=c.view,e=a.Context.getModule();c===e?d.refresh(c.extend("index")):b.cleanCache(c)}function g(b){var c=this,d=c.module,e=d.view;if(b===d.extend("area")){var f=a.Context.getModule();d===f?e.refresh(d.extend("index")):c.cleanCache(d)}}function h(){var a=this,b=a.module;a.cleanCache(b)}function i(b){if(b){var c=this,d=c.module,e=d.view,f=a.Context.getModule();d===f?e.refresh(d.extend("index")):c.cleanCache(d)}}function j(){var a=this,b=a.module;a.lazyReplace(b)}function k(){var a=this,b=a.module;a.cleanCache(b)}function l(){var a=this,b=a.module,c=b.param("fid");(2===c||3===c)&&a.cleanCache(b)}function m(a){var b=this,c=b.module,d=c.view;if(d.toolbar.update(),"search"===c.extend("type")){var e=c.param("fids");e.push(a)}}function n(b){var c=this,d=c.module,e=d.param("fid");if(e===b){var f=d.view;f.update()}if(!e){var g=a.Context.getModule();d===g?d.view.goPage(d.extend("index"),!0):c.cleanCache(d)}}function o(b){var c=this,d=c.module,e=a.Context.getModule();b===d.param("fid")?d===e?$E("interface.MboxInterface",function(a){a.entry({fid:1})}):(c.cleanCache(d,!0),a.MultiTab.remove(d)):d.view.toolbar.update()}function p(b){var c=this,d=c.module;d.view;var e=a.Context.getModule(),f=d.param("fid");b!==f&&4!==b&&f||(e===d?d.replace("folder"):c.lazyReplace(d))}function q(a){var b=this,c=b.module,d=c.view;a[c.param("fid")]&&d.tips.update()}function r(){var a=this,b=a.module,c=b.view;c.toolbar.update(),H.each(c.letters,function(a,b){try{b.components.tagmanage.menu.update(b.tagManage())}catch(c){}})}function s(b,c){var d=this,e=d.module,f=e.view,g=a.Context.getModule(),h=!1;if("tag"===e.extend("subtype")&&c){var i=e.param("tag");I.has(i,b)&&(a.MultiTab.remove(e),a.JS.remove(e),h=!0)}g===e?h||e.replace("tag"):d.lazyReplace(e),f.toolbar.update()}function t(b){var c=this,d=c.module,e=d.view,f=a.Context.getModule(),g=!1;if("tag"===d.extend("subtype")){var h=d.param("tag");I.has(h,b)&&(a.MultiTab.remove(d),a.JS.remove(d),g=!0)}d===f?g||d.replace("tag"):c.lazyReplace(d),e.toolbar.update()}function u(b){for(var c=this,d=c.module,e=d.view,f=a.Context.getModule(),g=d===f,h=d.extend("index"),i={},j=0,k=b.length;k>j;j++){var l=b[j],m=l.field,n=l.flag,o=l.value;"ntes_letter"===m?("font_size"===n||"line_height"===n)&&(i.setClass=!0):"ntes_option"===m?"sizeshow"===n?i.forceRequest=!0:("sendershow"===n||"summary"===n)&&(i.forceRequest=!0):"ntes_inbox"===m?"layout"===n&&(d.extend("forceRequest",!0),i.forceRequest=!0):"maxlist"===m&&(d.extend("limit",o),i.forceRequest=!0)}i.setClass&&(e.setClass(),g||e.toolbar.update()),i.forceRequest&&(g?d.view.refresh(h,!0,!1,!0):c.cleanCache(d)),a.Object.count(i)>0&&g&&e.toolbar.update()}function v(b){var c=this,d=c.module;d.view;for(var e=d.extend("index"),f=a.Context.getModule(),g=0,h=b.length;h>g;g++){var i=b[g],j=i.field,k=i.flag;i.value,"ntes_option"===j&&"sendershow"===k&&(d===f?d.view.refresh(e,!0):c.cleanCache(d))}}function w(){var b=this,c=b.module,d=c.view,e=c.extend("index"),f=a.Context.getModule(),g=a.Ud.get({field:"ntes_option",flag:"sendershow"})-0;if(2===g?c===f?c.view.refresh(e):b.cleanCache(c):c.view.markContact(),"contacts"===c.extend("subtype"))try{d.title.update()}catch(h){}}function x(){var b=this,c=b.module,d=c.view,e=c.extend("index"),f=a.Context.getModule(),g=a.Ud.get({field:"ntes_option",flag:"sendershow"})-0;if(2===g?c===f?c.view.refresh(e):b.cleanCache(c):c.view.markContact(),"contacts"===c.extend("subtype"))try{d.title.update()}catch(h){}}function y(){var a=this,b=a.module;try{if("emails"===b.extend("subtype")){var c=b.param("filter");""===c.chatWithAddress&&$E("support.AddressSupport",function(){var a=$I("support.AddressSupport").getMarkData();$E("interface.MboxInterface",function(b){b.contacts(a.contact[0])})})}}catch(d){}}function z(){var b=this,c=b.module,d=c.view,e=a.Context.getModule();3===c.param("fid")&&(c===e?c.replace("recall"):b.lazyReplace(c),d.update())}function A(){var b=this,c=b.module;c.view;var d=a.Context.getModule();3===c.param("fid")&&(c===d?c.view.refresh(c.extend("index")):b.cleanCache(c))}function B(){var a=this,b=a.module;if(3===b.param("fid"))try{a.cleanCache(b)}catch(c){}}function C(){try{var a=this.module;a._child.setWidth()}catch(b){}}function D(a){try{for(var b=this,c=b.module.view,d=c.letters,e=0,f=d.length;f>e;e++){var g=d[e];if(g.data.id===a){g.setDefer();break}}}catch(h){}}function E(a){try{var b=this,c=b.module.view;switch(a){case"letter":c.getAd(!0);break;case"inboxBottom":c.getFooter(!0);break;case"brand":c.showBanner(!0)}}catch(d){}}function F(a,b){if(a.isRendered){try{}catch(c){}a.cleanCache(b)}}function G(a){a.isRendered&&a.lazyReplace()}var H=a.Object,I=a.Array,J=$I("module.BaseListener"),K=a.createClass($N("module.mbox.MboxListener"));H.mix(K,J,null,{_listeners:{"sync:request":{handler:b},"letter:update":{handler:c},"letter:closead":{handler:d},"letter:rollback":{handler:e},"letter:setspam":{handler:f},"letter:allread":{handler:g},"letter:setfilter":{handler:h},"letter:setfilterrule":{handler:i},"letter:schedule":{handler:j},"search:removeall":{handler:k},"compose:send":{handler:l},"folder:add":{handler:m},"folder:modify":{handler:n},"folder:remove":{handler:o},"folder:empty":{handler:p},"folder:keep":{handler:q},"tag:add":{handler:r},"tag:modify":{handler:s},"tag:remove":{handler:t},"options:inboxModify":{handler:u},"options:contactModify":{handler:v},"addr:dataInit":{handler:w},"addr:dataReset":{handler:x},"addr:dataMark":{handler:y},"read:recall":{handler:z},"read:wmsvrDelete":{handler:A},"read:mailStatusUpdate":{handler:B},"global:resize":{handler:C},"schedule:insert":{handler:D},"schedule:remove":{handler:D},"ad:dataChange":{handler:E}},cleanCache:F,lazyReplace:G})}($,window),function(a,b,c){function d(a,b,c,d){var e,f=G.funcs[a.func];if(b&&(e=f[0],e&&(a.func=e,a.thread=!0,a.sent=c)),d>0){e=f[1],a.func=e;var g=a.body;g.fid=d,delete g.ids,f[2]&&f[2](a,d)}}function e(a,b){"archive"===b&&(a.body.mboxa="2")}function f(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d],g=f.id||f;g&&(b.push(g),c[g]=!0)}return[b,c]}function g(){}function h(a,b){function c(a){for(var b=a["var"],a=b.shift(),c=0,d=h.length;d>c;c++)h[c](b.shift());return a}function d(a){i.setCache(a)}function e(a){k.initArchive(a)}var f={},g=[],h=[];if(a.loadExpire){var i=$I("init.Defer"),j=i.loadCache(!0);g.push(j),h.push(d)}if(a.loadArchive){var k=$I("init.Folder"),l=k.loadArchive();g.push(l),h.push(e)}return g.length>0?(g.unshift(b),D.each(g,function(a,b){b["var"]=b.body,delete b.body}),f.request={func:"global:sequential",body:{items:g}},f.handleExtra=c):f.request=b,f}function i(b){function c(a){var b=a["var"];i(g?b:b.length>0?b[0]:null)}var d,e,f=this,g=b.isThread,h=b.id,i=b.callback,j=a.Ext.tag;if(g)d="mbox:getThreadMessageInfos",e={id:h,returnTag:j};else{var k;a.Ext.summary&&1===a.Ud.get({field:"ntes_option",flag:"summary"})-0&&(k=1),d="mbox:getMessageInfos",e={ids:[h],"summaryWindowSize ":k,returnTag:j}}var l={func:d,body:e,call:c};b.error&&(l.error=b.error),f.wmsvr(l)}function j(a){function b(b){a.callback(b)}for(var c=a.ids,d={func:"global:sequential",body:{items:[]},call:b},e=d.body.items,f=0,g=c.length;g>f;f++)e.push({func:"mbox:getThreadMessageInfos","var":{id:c[f]}});this.wmsvr(d)}function k(a){function b(b){for(var c=$I("core.DataAction").S_OK,d=b["var"],e=[],f=0,g=d.length;g>f;f++){var h=d[f];if(h.code===c)for(var i=h["var"],j=0,k=i.length;k>j;j++)e.push(i[j].id)}a.callback(e)}var c=this;c.getThreadInfo({ids:a.ids,callback:b})}function l(a){function b(b){a.callback(b)}var c=this,d=a.fid;d||(d=c.module.param("fid"));var e={flags:{top:!0}};c.getList({fid:d,filter:e,returnTotal:!0,limit:0},{sync:!0},b)}function m(a){function b(a){g(a["var"])}function c(){return!0}var d=this,e=a.ids,f=a.pattern,g=a.callback,h={func:"mbox:getMessageSummaryInfos",body:{ids:e,pattern:f},call:b,error:c};d.wmsvr(h)}function n(b){function d(b){function c(a){e.rollback({uk:b.uk,data:{ids:p.ids,attrs:{flags:{read:!h}}},callback:a,area:g})}E.fire("letter:update",{list:o[1],action:"read",value:h,data:i,hasThread:l,hasSent:m,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&(b.uk||p)&&(d=c),k(b,d)}var e=this,f=b.allFid,g=b.area,h=b.isRead,i=b.data,j=!!b.voidRequest,k=b.callback,l=b.hasThread,m=b.hasSent,n={flags:{read:h}},o=e.getIds(i),p=e.getRollbackData(null,i,"read");if(j)d();else{var q={func:"mbox:updateMessageInfos",body:{ids:o[0],attrs:n},call:d};e.setFunc(q,l,c,f),e.setArea(q,g),e.wmsvr(q)}}function o(b){function d(b){function c(a){var c=[];for(var d in o.items)c.push({ids:o.items[d],attrs:{label0:d-0}});e.rollback({uk:b.uk,data:{items:c},callback:a,area:g})}E.fire("letter:update",{list:n[1],action:"flag",value:h,data:i,hasThread:j,hasSent:k,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&(b.uk||o)&&(d=c),l(b,d)}var e=this,f=b.allFid,g=b.area,h=b.flag,i=b.data,j=b.hasThread,k=b.hasSent,l=b.callback,m={label0:h};1!==h&&(m.flags={flagged:!1});var n=e.getIds(i),o=e.getRollbackData(null,i,"flag"),p={func:"mbox:updateMessageInfos",body:{ids:n[0],attrs:m},call:d};e.setFunc(p,j,c,f),e.setArea(p,g),e.wmsvr(p)}function p(b){function d(b){function c(a){var c=[];for(var d in r.items){var f="%default%"===d?[]:d.split(","),j={ids:r.items[d]};h?j["delete"]=[i]:j.add=i?[i]:f,c.push(j)}e.rollback({type:"tag",uk:b.uk,data:{items:c},callback:a,area:g})}E.fire("letter:update",{list:o[1],action:"tag",value:i,data:j,isAdd:h,hasThread:k,hasSent:l,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&(b.uk||r)&&(d=c),m(b,d)}var e=this,f=b.allFid,g=b.area,h=b.isAdd,i=b.tag,j=b.data,k=b.hasThread,l=b.hasSent,m=b.callback,n=$I("init.Tag"),o=e.getIds(j),p=h&&i?[i]:c,q=h?c:i?[i]:function(){var a=[];if(f){var b=n.list();for(var c in b){var d=b[c];a.push(d.name)}}else for(var e=0,g=j.length;g>e;e++){var h=j[e].tag;if(h)for(var i=0,k=h.length;k>i;i++){var l=h[i];n.get(l)&&!D.has(a,l)&&a.push(l)}}return a}(),r=e.getRollbackData(null,j,"tag"),s={func:"mbox:updateMessageTags",body:{ids:o[0],add:p,"delete":q},call:d};e.setFunc(s,k,c,f),e.setArea(s,g),e.wmsvr(s)}function q(b){function d(b){function d(a){var d=[];for(var f in q.items){var h=JSON.parse(f),i=h.defer?new Date(h.defer):c,j=h.deferHandle,k=h.memo;d.push({ids:q.items[f],attrs:{memo:k?k:"",defer:j&&i?i:c,flags:{deferHandle:j}}})}e.rollback({uk:b.uk,data:{items:d},callback:a,area:g})}E.fire("letter:update",{list:p[1],action:"defer",value:{deferHandle:i,defer:j,memo:k},data:l,type:h,hasThread:m,hasSent:n,allFid:f,area:g});var r;b&&a.Ext.rollback&&(b.uk||q)&&(r=d),o(b,r)}var e=this,f=b.allFid,g=b.area,h=b.type,i=!1,j=b.defer,k=b.memo,l=b.data,m=b.hasThread,n=b.hasSent,o=b.callback,p=e.getIds(l),q=e.getRollbackData(null,l,"defer"),r={};switch(h){case"add":case"modify":r.memo=k?k:"",r.defer=j?j:null,i=!!j,r.flags={deferHandle:i};break;case"complete":var s=new Date(0);r.defer=new Date(s.getTime()+6e4*s.getTimezoneOffset()),r.flags={deferHandle:i};break;case"delete":i=!0,r.memo=""}var t={func:"mbox:updateMessageInfos",body:{ids:p[0],attrs:r},call:d};e.setArea(t,g),e.wmsvr(t)}function r(b){function c(b){function c(a){var c=[];for(var f in m.items){var g=f;"undefined"===f&&(g=""),c.push({ids:m.items[f],attrs:{memo:g}})
}d.rollback({uk:b.uk,data:{items:c},callback:a,area:e})}E.fire("letter:update",{list:l[1],action:"memo",value:f,data:g,hasThread:h,hasSent:i,area:e});var k;b&&a.Ext.rollback&&(b.uk||m)&&(k=c),j(b,k)}var d=this,e=b.area,f=b.memo,g=b.data,h=b.hasThread,i=b.hasSent,j=b.callback,k={memo:f?f:""},l=d.getIds(g),m=d.getRollbackData(null,g,"memo"),n={func:"mbox:updateMessageInfos",body:{ids:l[0],attrs:k},call:c};d.setArea(n,e),d.wmsvr(n)}function s(b){function c(b){function c(a){d.rollback({uk:b.uk,data:{ids:m.ids,attrs:{flags:{top:!f}}},callback:a})}E.fire("letter:update",{fid:e[1],list:l[1],action:"top",value:f,data:g,hasThread:h,hasSent:i});var k;b&&a.Ext.rollback&&(b.uk||m)&&(k=c),j(b,k)}var d=this,e=b.fidInfo,f=b.isTop,g=b.data,h=b.hasThread,i=b.hasSent,j=b.callback,k={flags:{top:f}},l=d.getIds(g),m=d.getRollbackData(null,g,"top"),n={func:"mbox:updateMessageInfos",body:{ids:l[0],attrs:k},call:c};d.wmsvr(n)}function t(a){function b(a){function b(){E.fire("letter:setfilter"),h&&h()}var f;if(a)try{f=a["var"]}catch(i){}var j={func:"mbox:updateMessageInfos",body:{ids:f,attrs:f?g:c,rule:f&&g?c:e},call:b};d.wmsvr(j)}var d=this,e=a.ruleConditions,f=a.fids,g=a.attrs,h=a.callback;if(f&&g){var i={func:"mbox:searchMessages",body:{fids:f,ruleConditions:e},call:b};d.wmsvr(i)}else b()}function u(a){function b(a){E.fire("letter:setfilterrule",g),h&&h(a)}function c(a){var b=a.code;return"FA_ATTR_SIZE_EXCEEDED"===b?(h&&h(),!0):void 0}var d=this,e=a.fid,f=a.email,g=a.history,h=a.callback,i={func:"ntes:mbox:addHistoryFilter",body:{fid:e,email:f,history:!!g},call:b,error:c};d.wmsvr(i)}function v(c){function d(a){E.fire("letter:rollback",{data:j}),l(a)}function e(c){if(i&&"FA_NEED_AUTH2"===c.code){for(var e=c["var"],f=[],h=0,j=e.length;j>h;h++)f.push(e[h].param);var k={func:"ntes:mbox:updateMessageInfos",body:{items:f,type:"multi"},call:d};return a.AdvLock.show(function(){b.setTimeout(function(){g.wmsvr(k)},500)},!1),!0}}function f(a){"archive"===k&&(a.mboxa="2")}var g=this,h=c.type,i=c.uk,j=c.data,k=c.area,l=c.callback;if(j&&(j.type=j.items?"multi":"single",k))if("single"===j.type)f(j);else for(var m=j.items,n=0,o=m.length;o>n;n++)f(m[n]);var p={func:i?"ntes:mbox:messageUndo":"tag"===h?"ntes:mbox:updateMessageTags":"ntes:mbox:updateMessageInfos",body:i?{uk:i}:j,call:d,error:e};g.wmsvr(p)}function w(b){function d(b){function c(a){var c=[];for(var d in p.items)c.push({ids:p.items[d],attrs:{fid:d-0}});e.rollback({uk:b.uk,data:{items:c},callback:a,area:g})}E.fire("letter:update",{fid:h[1],list:o[1],action:"move",value:i,data:j,isThread:k||l,fromThread:m,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&i&&(b.uk||p)&&(d=c),n(b,d)}var e=this,f=b.allFid,g=b.area,h=b.fidInfo,i=b.moveToId,j=b.data,k=b.hasThread,l=b.hasSent,m=b.fromThread,n=b.callback,o=e.getIds(j),p=e.getRollbackData(null,j,"move"),q={body:{ids:o[0]},call:d};if(i){var r=!1;if(15!==i)for(var s=0,t=j.length;t>s;s++)if(15===j[s].fid){r=!0;break}q.func="mbox:updateMessageInfos",q.body.attrs={fid:i,flags:r?{deleted:!1}:c}}else q.func="mbox:deleteMessages";e.setFunc(q,k,!0,f),e.setArea(q,g),e.wmsvr(q)}function x(a){function b(a){d(a),i&&(E.fire("rslist:add",h?"refuse":"safe",o),$E("support.OptionSupport",function(a){a.addList({name:h?"refuselist":"safelist",value:o.join(),noErr:!0,forceAdd:!0})})),m(e(a))}function c(a){var b=a.code;return"FA_LIST_FULL"===b||"FA_LIST_NOT_UPDATE"===b?(d(a,!0),m(e(a,!0)),!0):void 0}function d(a,b){var c,d;try{c=a["var"].updateMessageInfos["var"].mid,d={};for(var e=0,f=c.length;f>e;e++)d[c[e]]=!0}catch(i){}E.fire("letter:setspam",h,j,k||l,!!b,d,g)}function e(a,b){var c={},d=a["var"];c.lettercount=d.updateMessageInfos["var"].count;try{c.historycount=d.deleteHistory["var"].count}catch(e){}try{c.listcount=i?o.length:0}catch(e){}return c.listerror=!!b,c}var f=this,g=a.area;a.data;var h=a.isSpam,i=a.addList,j=a.deleteLetter,k=a.hasThread,l=a.hasSent,m=a.callback,n=a.ids,o=a.emails,p=a.reportType,q=a.spamType;o&&0!==o.length||(i=!1,j=!1);var r={func:"ntes:mbox:reportSpam",body:{ids:n,emails:o,reportType:p,spamType:q,attrs:{deleteHistory:j,addList:i,thread:k}},call:b,error:c};f.setArea(r,g),f.wmsvr(r)}function y(b){function c(b){function c(a){d.rollback({data:{ids:h,attrs:{flags:{read:!1}}},callback:a,area:e})}E.fire("letter:allread",e);var f;if(b){var h=b["var"].mids;a.Ext.rollback&&(f=c)}g(b,f)}var d=this,e=b.area,f=b.body;f.isThread;var g=b.callback,h={func:"ntes:mbox:updateAllMessages",body:f,call:c};d.setArea(h,e),h.body.search.mboxa=h.body.mboxa,d.wmsvr(h)}function z(b){function c(b){var c=a.Ajax.IFRAME,e=$S("sid"),f={requestType:c,method:a.Ajax.POST};b.length>1?(f.url="./s?sid="+e+"&func=mbox:packMessages",f.body="mid="+b.join("&mid=")):f.url=a.Uri.getUrl("read_data",!0)+"&mode=download&mid="+b.join("")+"&l=inbox&action=export",d.request(f),g()}var d=this,e=b.ids,f=b.isThread,g=b.callback;f?d.getThreadIds({ids:e,callback:c}):c(e)}function A(b,c,d){if(a.Ext.rollback){if(b||(b={}),c)for(var e=0,f=c.length;f>e;e++){var g,h,i=c[e],j=i.id;switch(d){case"read":case"top":g="single";break;case"flag":h=i.label0,g="multi";break;case"memo":h=i.memo,g="multi";break;case"move":h=i.fid,g="multi";break;case"tag":h=(i.tag||[]).join()||"%default%",g="multi";break;case"defer":var k=i.defer;h=JSON.stringify({defer:k?k.getTime():k,deferHandle:!!i.flags.deferHandle,memo:i.memo||""}),g="multi"}if("single"===g){var l=b.ids;l||(l=b.ids=[]),l.push(j)}else{var m=b.items;m||(m=b.items={});var l=m[h];l||(l=m[h]=[]),l.push(j)}}return b.ids||b.items||(b=null),b}}function B(){}var C=a.Object,D=a.Array;$I("init.Thread"),$I("init.Sync");var E=a.Listener,F=$I("module.BaseAction"),G=a.createClass($N("module.mbox.MboxAction"));C.mix(G,F,{funcs:{"mbox:updateMessageInfos":["ntes:mbox:updateThreadInfos","ntes:mbox:updateFolderMessageInfos"],"mbox:updateMessageTags":["ntes:mbox:updateThreadTags","ntes:mbox:updateFolderMessageTags"],"mbox:deleteMessages":[null,"mbox:emptyFolder",function(a,b){a.body={id:b,permanently:!0}}]}},{setFunc:d,setArea:e,getIds:f,getList:g,bindExtra:h,getLetterInfo:i,getThreadInfo:j,getThreadIds:k,getTop:l,getSummary:m,setRead:n,setFlag:o,setTag:p,setDefer:q,setMemo:r,setTop:s,setFilter:t,setFilterRule:u,rollback:v,move:w,setSpam:x,setAllRead:y,exportLetter:z,getRollbackData:A,initialize:B})}($,window),function(a,b,c){function d(){var b=$G.environment,c=[];c.push(b.cacheRootPath),c.push("pattern"),c.push(b.mailPattern),c.push("css"),c.push("gibx_custom.css"),Kb.addedCss||(a.Ajax.request({requestType:a.Ajax.CSS,url:c.join("/")}),Kb.addedCss=!0)}function e(){var a=this,b=a.module,c=a.setClass("Html"),d=[];return a.completed=!1,d[d.length]='<div id="'+b.createId("HtmlDiv")+'" class="'+c+'">',d.push(a.getAd()),d.push(a.getBanner()),d.push(a.getTips()),d.push(a.getTitle()),d.push(a.getControl()),d.push(a.getSmarts()),d.push(a.getList()),d.push(a.getPager()),d.push(a.getNone()),d.push(a.getFooter()),d[d.length]="</div>",a.addHeader(a.getToolbar(),d.join(""),"frame-main-cont-body-first")}function f(a){function c(a){h[h.length]=a}function d(a){h.unshift('<div class="tN0" id="'+a+'"'+(f.isNone()?' style="display:none"':"")+">"),h.push("</div>")}var e=this,f=e.module,g=f.isAd(),h=[];if(g)try{var i=b.gAd.get("letter"),j=f.createId("AdDiv");i&&(a&&(f.getDom("AdDiv").innerHTML=i),c(i),d(j))}catch(k){}return h.join("")}function g(){return""}function h(){var a=this;return a.tips.get()}function i(){var a=this;return a.title.get()}function j(){return""}function k(){return""}function l(){var b=this,c=b.module,d=c.extend("area"),e=c.extend("index"),f=c.getPage(),g=b.setClass("List"),h=[];if(h[h.length]=['<div id="',c.createId("ListDiv"),'" class="',g,'"></div>'].join(""),c.isArchive()&&"normal"===d){var i={},j=new a.Link({text:"查看更早的邮件",click:function(){b.goPage(f)}});i.content=j.html(),i.subclass="tipsBlock",i.hidden=!(e===f-1||0===f);var k=new a.Block(i);h[h.length]=k.html(),b.archiveTips=k}return h.join("")}function m(){var a=this;return a.pager.get()}function n(){var a=this;return a.none.get()}function o(){return""}function p(){var a=this;return a.toolbar.get()}function q(){var a=this;try{a.inserted=0,a.inserting=!1,clearTimeout(a.interval)}catch(b){}}function r(){function a(){b.insertLetter(d)}var b=this,c=b.module,d=!Ib||c.extend("limit")<=b.insertLimit;b.deleteInterval(),b.initThreads(),c.removeCache(),b.period.reset(),a()}function s(){var b=this,c=b.threads;for(c||(c=b.threads=[]);c.length>0;)a.Thread.clear(c.pop())}function t(a){this.threads.push(a)}function u(b,c,d){function e(){g.interval=setTimeout(function(){g.insertLetter(b,c,d)},0)}function f(){g.inserting=!1,g.completed=!0,g.deleteInterval(),g.pager.show(),g.pushThread(a.Thread.run(function(){h.getSummary(),g.period.count()},0)),g.pushThread(a.Thread.run(function(){g.markReaded(),g.markReFw(),g.markContact(),g.markYixin(),g.pushThread(a.Thread.run(function(){if(h.lazyLoad(),!Ib){var b,c="mboxDragDiv",d=a.fly("#"+c);d?b=d.dom:(b=document.createElement("DIV"),b.id=c,b.style.display="none",b.className="nui-layer tD0 sc0",document.body.appendChild(b)),g.dragDiv=b}var e=g.letters;if(e.length>0)try{e[0].getDiv().focus()}catch(f){}})),a.Component.setEvents(10)},0))}var g=this,h=g.module;g.period;var i;if(g.inserting)return e(),void 0;g.inserting=!0;try{d||(d=h.getCacheData());var j=h.extend("limit"),k=g.insertLimit,l=g.inserted,m=g.letters,n=g.ids,o=!(l>0),p=h.getDom("ListDiv"),q=document.createDocumentFragment(),r=[],s=0;h.extend("expire")&&(s+=$I("init.Defer").getInfo("expire"));var t=j+s;if(d&&l<d.length&&t>l){o||(k=2*k);for(var u=0,v=d.length,w=b?t:k;v>l&&w>u;l++,u++)try{var x=d[l],y=new Bb(g,x);y.initDom(b);var z;if(!c)var z=g.period.get(x,b);b?(r.push(z.html||""),r.push(y.html)):(z.div&&q.appendChild(z.div),q.appendChild(y.getDiv())),m.push(y),n[y.id]=y}catch(A){}g.inserted=l,b?(i=r.join(""),p&&(p.innerHTML=r.join(""))):p&&(o&&(p.innerHTML=""),p.appendChild(q)),v>l?e():f()}else f()}catch(A){g.deleteInterval(),g.initThreads(),h.extend("retry")||(a.Thread.run(function(){g.refresh(h.extend("index"),!0,!0)},0),h.extend("retry",!0))}return g.inserting=!1,i}function v(b,c,d,e,f){function g(b,c){c||(w?w.after(b):z.prepend(b)),w=a(b)}function h(a,b,c){var d=a.data;if(a.data=b,a.format(),!f||f[b.id])switch(c){case"read":case"recall":a.setRead();break;case"flag":a.setFlag();break;case"tag":a.setTag();break;case"defer":case"memo":a.setDefer(),a.setMemo();break;case"move":case"folder":a.setMove();break;case"top":a.setTop();break;default:var e;if(!c){e=[];var g=d.flags||{},h=b.flags||{};!g.read!=!h.read&&e.push("Read"),d.label0!==b.label0&&e.push("Flag"),d.fid!==b.fid&&e.push("Move"),b.tag||(b.tag=[]),Db.isEqual(d.tag,b.tag)||e.push("Tag"),(d.defer!==b.defer||!g.deferHandle!=!b.deferHandle)&&e.push("Defer"),d.memo!==b.memo&&e.push("Memo"),!g.top!=!h.top&&e.push("Top")}if(e.length>0)for(var i=0,j=e.length;j>i;i++)try{a["set"+e[i]]()}catch(k){}}}var i=this,j=i.module,k=j.extend("index"),l=j.getCacheData(k)||[],m=i.letters,n={},o={},p=c&&d>0&&Db.count(e)===d;if(p)for(var q=0,r=m.length;r>q;q++){var s=m[q],t=s.data.id;e[t]?o[t]=s:n[t]=s}else{for(var u={},q=0,r=l.length;r>q;q++){var v=l[q];u[v.id]=v}for(var q=0,r=m.length;r>q;q++){var s=m[q],v=m[q].data,t=v.id;u[t]?n[t]=s:o[t]=s}}Db.each(o,function(a,b){try{b.remove(!0)}catch(c){}}),i.period.reset();for(var w,x=[],y={},z=j.getEl("ListDiv"),q=0,r=l.length;r>q;q++){var v=l[q],t=v.id,A=i.period.get(v);A.div&&g(A.div);var s=n[t],B=!!s;B?h(s,v,b):(s=new Bb(i,v),s.initDom());var C=s.getDiv();g(C,B&&c),x.push(s),y[C.id]=s}i.letters=x,i.ids=y,i.pushThread(a.Thread.run(function(){j.getSummary(),i.period.count(),i.markContact(),i.markYixin(),i.update(),i.selectAll(!1)},0))}function w(a,b,c,d){function e(b){switch(a){case"read":b.setRead();break;case"flag":b.setFlag();break;case"tag":b.setTag();break;case"defer":case"memo":b.setDefer(),b.setMemo();break;case"move":b.setMove();break;case"top":b.setTop()}}try{$L("interface.MboxInterface")}catch(f){return f}var g=this;g.module;try{for(var h=g.letters,i=0,j=0,k=h.length;k>i&&b>j;i++){var l=h[i],m=l.data.id;(c[m]||d[m])&&(e(l),j++)}}catch(f){}g.update()}function x(b){var c,d,e=this,f=this.module,g=f.extend("subtype"),h="full"===g,i="defer"===g,j=f.extend("brand"),k=1===a.Ud.get({field:"ntes_option",flag:"summary"})-0,l=f.isThread()||h||k,m=e.getLayout();if(!b||"Html"===b){c=["tc0"];var n=a.Ud.get({field:"ntes_letter",flag:"font_size"})-0;c.push(Kb.fontSize[n]),0!==n&&1!==n&&(l=!0);var o=a.Ud.get({field:"ntes_letter",flag:"line_height"})-0;"l-r"===m&&(o=1),0!==o&&3!==o&&(l=!0);var p=a.Ud.get({field:"ntes_option",flag:"sizeshow"})-0,q=e.config.sizeShow=!(Ib||$S("isFree")&&1!==p);q&&(c.push("ts1"),l=!0)," "+Kb.lineHeight[o],c.push(Kb.lineHeight[o])}if(!b||"List"===b){var d=["tv0"];h&&(d.push("nF0"),l=!0),"l-r"===m&&(d.push("oo1"),l=!0),i&&(d.push("sv1"),l=!0),j&&(l=!0)}if(f.isDefer()&&$I("init.Defer").getInfo("total")>0&&(l=!0),l&&Kb.addCss(),b){if("Html"===b)return c.join(" ");if("List"===b)return d.join(" ")}else{var r=f.getEl("HtmlDiv"),s=f.getEl("ListDiv");r.setClass(c.join(" ")),s.setClass(d.join(" ")),r.destroy(),s.destroy()}}function y(){var a=this,b=a.module;return b.constructor.getLayout()}function z(b,c){var d=this;d.module;var e=a(document.body),f=d.dragDiv,g=a.Event.get();switch(c){case"mousedown":b.setChecked(!0);var h=d.getSelected(),i=h.length,j='移动<span class="qI0">'+i+"</span>封邮件";f.innerHTML=j,f.style.left=g.clientX+2+"px",f.style.top=g.clientY+2+"px";break;case"start":f.style.display="";break;case"drag":var k,l=a.Event.getTarget(),m=a.fly(l).findParent("LI",!0,!0);m&&(k=a.Nav.getFid(m.dom.id)),k>0&&k!==(a.Context.getModule()||{}).fid?(d.dragToFid=k,e.removeClass("sc0"),e.addClass("rA0")):(d.dragToFid=null,e.addClass("sc0"),e.removeClass("rA0"));break;case"end":e.removeClass("sc0"),e.removeClass("rA0"),f.style.display="none";var n=d.dragToFid;n>0&&(d.move(n),delete d.dragToFid)}e.destroy()}function A(){var b=this,c=b.module,d=a.fly(c.getDom("ListDiv"));d.listen("mouseover",Eb.bind(b.mouseover,b)),d.listen("mousedown",Eb.bind(b.mousedown,b)),d.listen("click",Eb.bind(b.click,b)),d.listen("touchend",Eb.bind(b.click,b)),d.listen("keypress",Eb.bind(b.keypress,b)),d.listen("contextmenu",Eb.bind(b.contextmenu,b))}function B(){for(var a=this,b=a.module,c=Fb.getTarget(),d=b.getDom("ListDiv"),e={};c&&c!==d;){var f=c.getAttribute("sign");if(f){if("letter"===f){e.div=c;break}e.sign||(e.sign=f,e.target=c)}c=c.parentNode}return e.div||(e=null),e}function C(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.mouseover(b)}}catch(e){}}function D(){var b=this,c=a.Event.get();if(1===c.which)try{var d=b.getTargetInfo();if(d){var e=d.div,f=b.ids[e.id];f.mousedown(d)}}catch(g){}}function E(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.click(b)}}catch(e){}}function F(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.keypress(b)}}catch(e){}}function G(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.contextmenu(b)}}catch(e){}}function H(a){for(var b=this,c=b.module,d=b.letters,e=0,f=0,g=d.length;g>f;f++){var h=d[f],i=h.data,j=i.flags,k=!!h.checked,l=!0;switch(a){case"all":k&&(l=!1);break;case"none":k||(l=!1);break;case"unread":!j.read===k&&(l=!1);break;case"read":!!j.read===k&&(l=!1);break;case"expire":!!h.expire===k&&(l=!1)}l&&h.setChecked(!h.checked),h.checked&&e++}b.selectAll(e>0&&e===d.length);try{c._child.view.changeSelect()}catch(m){}}function I(a){var b=this,c=b.toolbar;if("undefined"==typeof a){a=!0;for(var d=b.letters,e=0,f=d.length;f>e;e++)if(!d[e].checked){a=!1;break}}b.allSelected^a&&(c.selectAll(a),b.allSelected=a,b.folderSelected=!1,b.selectFolder())}function J(){var a=this,b=a.module;b.isSelectFolder()&&(a.tips.update(),a.toolbar.update())}function K(a){var b=this;b.folderSelected=!!a,a?b.selectFolder():b.select("none")}function L(b,c,d){function e(){j.createInterval(),a.Thread.run(function(){j.toolbar.update(),j.pager.update(),j.tips.update(),j.toggleFooter();var a=j.archiveTips;a&&a.getEl()[b===o-1?"show":"hide"]()},0)}try{var f=$L("interface.MboxInterface")}catch(g){return g}var h,i,j=this,k=j.module,l=k.extend("area");a.Ext.archive&&(h="normal"===l,i="archive"===l);var m,n,o=k.getPage();if(b>=o&&(h?m=!0:b=o-1),b>=0||(i?n=!0:b=0),m||n){var p=Db.clone(k.param()),q=Db.clone(k.extend());if(m)p.mboxa="2",q.index=0;else{delete p.mboxa;var b=0;try{var r=a.JS.get("mbox.ListModule",p);if(r)b=r.getPage()-1,0>b&&(b=0);else{var s=$I("init.Folder").getInfo(k.param("fid")),t=k.extend("limit");b=Math.floor(s/t)}}catch(g){}q.index=b}delete q.area,j.initThreads(),f.entry(p,q)}else if(c||k.extend("forcePage")||k._cacheCleaned){j.deleteInterval();var p=Db.clone(k.param()),q=Db.clone(k.extend());q.index=b,q.saveLayout=!d,j.initThreads(),f.entry(p,q)}else b!==k.extend("index")&&(k.extend("index",b),k.getData(e,b),a.Thread.run(function(){k.getDom("ScrollDiv").scrollTop=0,delete k.scrollTop}))}function M(b,d,e,f){try{var g=$L("interface.MboxInterface")}catch(h){return h}var i=this,j=i.module,k=$I("init.Sync"),l=Db.clone(j.param()),m=Db.clone(j.extend());m.forceRequest=!0,m.retry=e,m.saveLayout=!f;var n=j.getPage();b>=n&&(b=n-1),b>0||(b=0),m.index=b,i.deleteInterval(),i.initThreads(),d?g.entry(l,m):(a.Listener.one("sync:request",function(){try{$I("init.Defer").setCache()}catch(a){}g.entry(l,m)}),k.request(c,{listen:!0}))}function N(b,d,e){function f(d,f){function h(){g.rollback(f)}if(!e){var i="";f&&(i="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:h}).html()),a.Tips.show({succ:!0,text:"成功设置邮件为"+(b?"已读":"未读")+i,expires:i?g.succExpires:c})}}var g=this,h=g.module,i=g.allSelected&&g.folderSelected,j=h.param("fid");if(d=g.getSelected(d,function(a){return a.data.flags.read^b}),!i&&!g.checkLetters(d,e))return!1;var k=g.getSelectedData(d);$E("module.mbox.MboxModule",function(a){a.setRead({allFid:i?j:c,area:h.extend("area"),isRead:b,data:k,callback:f})})}function O(b,d){function e(d,e){function g(){f.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:g}).html()),a.Tips.show({succ:!0,text:"成功"+(b>0?"设置":"取消")+"邮件旗帜"+h,expires:h?f.succExpires:c})}var f=this,g=f.module,h=g.param("fid"),i=f.allSelected&&f.folderSelected;if(d=f.getSelected(d,function(a){return a.data.label0!==b}),!i&&!f.checkLetters(d))return!1;var j=f.getSelectedData(d);$E("module.mbox.MboxModule",function(a){a.setFlag({allFid:i?h:c,area:g.extend("area"),flag:b,data:j,callback:e})})}function P(b,d,e){function f(e,f){function h(){g.rollback(f)}var i="";f&&(i="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:h}).html()),a.Tips.show({succ:!0,text:"成功"+(b?"设置":"取消"+(d?"":"所有"))+"邮件标签"+i,expires:i?g.succExpires:c})}var g=this,h=g.module,i=h.param("fid"),j=g.allSelected&&g.folderSelected;if(e=g.getSelected(e,function(a){var c=a.data.tag,e=!1;return e=b?!(c&&Gb.has(c,d)):!d||d&&Gb.has(c,d)}),!j&&!g.checkLetters(e))return!1;var k=g.getSelectedData(e);$E("module.mbox.MboxModule",function(a){a.setTag({allFid:j?i:c,area:h.extend("area"),isAdd:b,tag:d,data:k,callback:f})})}function Q(b,d,e){function f(d,e){function f(){g.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:f}).html());var i;switch(b){case"add":case"modify":i="成功设置邮件待办";break;case"complete":i="成功完成邮件待办";break;case"delete":i="成功删除邮件备注"}a.Tips.show({succ:!0,text:i+h,expires:h?g.succExpires:c})}var g=this,h=g.module,i=h.param("fid"),j=g.allSelected&&g.folderSelected,k=!d;k&&(d={});var l=d.defer,m=d.memo,n=d.smsDate;if(e=g.getSelected(e,function(a){var c=!1,d=a.data;switch(b){case"add":case"modify":c=!0;break;case"complete":c=d.defer&&d.flags.deferHandle;break;case"delete":c=!!d.memo}return c}),!g.checkLetters(e))return!1;if("add"===b&&k)return e&&1===e.length&&(d.mid=e[0].data.id),$E("support.Defer",function(a){a.showMsgbox({type:b,data:d,callback:function(a){g.setDefer(b,a,e)}})}),void 0;if(!j&&!g.checkLetters(e))return!1;var o=g.getSelectedData(e);$E("module.mbox.MboxModule",function(a){a.setDefer({allFid:j?i:c,area:h.extend("area"),type:b,defer:l,memo:m,smsDate:n,data:o,callback:f})})}function R(b,d){function e(d,e){function g(){f.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:g}).html()),a.Tips.show({succ:!0,text:"成功"+(b?"设置":"取消")+"邮件备注"+h,expires:h?f.succExpires:c})}var f=this;if(d=f.getSelected(d,function(a){return a.data.memo!==b}),!f.checkLetters(d,!0))return!1;var g=f.getSelectedData(d);$E("module.mbox.MboxModule",function(a){a.setMemo({area:f.module.extend("area"),memo:b,data:g,callback:e})})}function S(b,d,e){function f(d,e){function f(){g.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:f}).html()),d&&a.Tips.show({succ:!0,text:"成功"+(b?"设置":"取消")+"邮件置顶"+h,expires:h?g.succExpires:c})}var g=this,h=g.module;if(e||(e=h.param("fid")),d=g.getSelected(d,function(a){return!!a.data.flags.top!==b}),!g.checkLetters(d))return!1;var i=g.getSelectedData(d);$E("module.mbox.ListModule",function(a){a.setTop({fid:e,isTop:b,data:i,callback:f})})}function T(){for(var a=this,b=a.letters,c=0,d=b.length;d>c;c++)b[c].setSummary()}function U(b){function c(){a.Tips.show({succ:!0,text:"成功取消操作"})}var d=this;d.module,$E("module.mbox.MboxModule",function(a){a.rollback({rollback:b,callback:c})})}function V(b,d){function e(d,e){function j(){f.rollback(e)}function l(){if(!(k.length<2)){for(var c,d=0,e=k.length;e>d;d++){if(k[d].threadMessageCount>1)return;var f=a.Uri.getAddress(k[d].from).toLowerCase();if(c){if(c!==f)return}else c=f}c&&$E("interface.OptionInterface",function(d){function e(d){function e(){j.checked&&g.action.setFilterRule({fid:b,email:c,history:k.checked,callback:f})}function f(b){b?a.Tips.show({succ:!0,text:"成功设置来信分类"}):a.Msgbox.show({content:"无法添加来信分类，请先清理已存在来信分类规则。",title:"设置来信分类失败"})}if(!d){var h="对来自 "+c+" 的邮件执行以下规则：",j=new a.Checkbox({text:"以后自动移动到&nbsp;<strong>"+i.get(b).name+"</strong>&nbsp;文件夹",checkedchange:function(){this.checked||k.setChecked(!1,!0)}}),k=new a.Checkbox({text:"对已收到邮件执行相同操作",checkedchange:function(){this.checked&&j.setChecked(!0,!0)}}),l=j.html()+"<br/>"+k.html();a.Msgbox.show({type:"confirm",header:"新建来信分类规则",content:l,title:h,ok:e}),a.Component.setEvents()}}d.checkFilterLimit(e)})}}try{var m=$L("interface.MboxInterface")}catch(n){return n}if(b){var o="";e&&(o="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:j}).html());var p=new a.Link({text:i.get(b).name,click:Eb.bind(m.entry,m,{fid:b},{type:"list",subtype:"folder"})});a.Tips.show({succ:!0,text:"成功移动邮件到 "+p.html()+o,expires:o?f.succExpires:c}),a.Component.setEvents()}else{var q="";a.Ext.recovery&&(q="&nbsp;"+new a.Link({text:"恢复误删邮件",bracket:!0,click:function(){$E("interface.OutlinkInterface",function(a){a.goOutlink({key:"recovery",title:"误删恢复"})})}}).html()),a.Tips.show({succ:!0,text:"成功删除邮件"+q}),a.Component.setEvents()}1===h&&b>20&&l()}var f=this,g=f.module,h=g.param("fid"),i=$I("init.Folder"),j=f.allSelected&&f.folderSelected;if(d=f.getSelected(d,function(a){return a.data.fid!==b||h>0&&h!==b}),!j&&!f.checkLetters(d))return!1;var k=f.getSelectedData(d);$E("module.mbox.MboxModule",function(a){a.move({allFid:j?g.param("fid"):c,area:g.extend("area"),moveToId:b,data:k,callback:e})})}function W(a,b){var c=this,d=a?null:4;c.move(d,b)}function X(b,c){function d(c){var d=[];d[d.length]="成功"+(b?"举报":"信任")+"邮件",c.historycount&&(d[d.length]="删除历史来信"+c.historycount+"封"),c.listcount?d[d.length]="将"+c.listcount+"个发件人加入"+(b?"黑名单":"白名单"):c.listerror&&(d[d.length]="发件人没有加入"+(b?"黑名单":"白名单")+"，请进入设置清理名单"),a.Tips.show({succ:!0,text:d.join("，")})}var e=this,f=e.module;if(c=e.getSelected(c),!e.checkLetters(c))return!1;var g=f.param("fid"),h=e.getSelectedData(c);$E("module.mbox.MboxModule",function(a){a.setSpam({area:f.extend("area"),fid:g,data:h,isSpam:b,callback:d})})}function Y(){function b(b,e){function f(){d.rollback(e)}var g="";e&&(g="&nbsp;"+new a.Link({text:"撤销",bracket:!0,click:f}).html()),a.Tips.show({succ:!0,text:"成功设置全部已读"+g,expires:g?d.succExpires:c})}var d=this,e=d.module,f=Db.clone(e.param()),g=f.fids;g&&(f.fids=g.concat("search"===e.extend("type")?[4]:$G.common.unnormalids));var h=f.filter;h||(h=f.filter={});var i=h.flags;i||(i=h.flags={}),i.read=!1;var j={flags:{read:!0}},k=$S("advLock"),l=!k.disabled&&!k.authenticated2&&(k.pop||k.folders);if(l){var m=!0;if(f.fid>0)m=!0;else for(var n=$I("init.Folder"),g=f.fids||n.getFids(),o=0,p=0,q=g.length;q>p;p++){var r=g[p];if(k[r]&&(o+=n.getInfo(r,"unread"),o>0)){m=!1;break}}f.skipLockedFolders=m}$E("module.mbox.MboxModule",function(a){a.setAllRead({area:e.extend("area"),body:{search:f,action:j,isThread:e.isThread()},callback:b})})}function Z(a){function b(){Gb.each(a,function(a,b){b.setChecked(!1)})}var c=this,d=c.module;if(a=c.getSelected(a),!c.checkLetters(a))return!1;var e=c.getSelectedData(a,!0);$E("module.mbox.MboxModule",function(a){a.exportLetter({ids:e,isThread:d.isThread(),callback:b})})}function $(){function a(){Gb.each(d,function(a,b){b.setChecked(!1)})}var b=this,c=b.module;c.isThread();var d=b.getSelected();if(!b.checkLetters(d))return!1;var e=b.getSelectedData(d,!0);$E("module.mbox.MboxModule",function(b){b.forwardLetter({ids:e,isThread:c.isThread(),callback:a})})}function _(){try{var a=this,b=a.readedMid,c=$S("lastRead");if(c&&c!==b){for(var d,e,f=a.letters,g=0,h=f.length;h>g;g++){var i=f[g];if(i.data.id===c&&(i.setLastRead(!0),d=!0),i.data.id===b&&(i.setLastRead(!1),e=!0),d&&e)break}a.readedMid=c}}catch(j){}}function ab(){try{var a=this,b=$S("refw"),c=a.letters;if(b)for(var d in b)for(var e=b[d],f=0,g=c.length;g>f;f++){var h=c[f],i=h.data;if(i.id===d){var j=i.flags;j||(i.flags=j={}),j.replied||(j.replied=e.replied),j.forwarded||(j.forwarded=e.forwarded),h.setReFw(),delete b[d];break}}}catch(k){}}function bb(){var b=this;if(a.Ext.yixin_logo){for(var c=b.letters,d=[],e=0,f=c.length;f>e;e++)try{d=d.concat(c[e].components.userlabel)}catch(g){}$E("support.YixinSupport",function(a){a.mark(d)})}}function cb(){for(var a=this,b=a.letters,c=[],d=0,e=b.length;e>d;d++)try{c=c.concat(b[d].components.userlabel)}catch(f){}$E("support.AddressSupport",function(a){a.mark(c)})}function db(){}function eb(a,b){var c=this;if(!a){a=[];for(var d=c.letters,e=0,f=d.length;f>e;e++){var g=d[e];g.checked&&a.push(g)}}return 0===a.length?a.empty=!0:(b&&c.filterSelected(a,b),0===a.length&&(a["void"]=!0)),a}function fb(a,b){for(var c=a.length-1;c>-1;c--){var d=a[c];b(d)||(d.setChecked(!1),a.splice(c,1))}}function gb(b,c){var d=this,e="";return b.empty&&(e="没有选中任何邮件，请重新选择"),b["void"]&&(e="选择的邮件已是需要设置的状态，无需再设置"),e?(c||a.Tips.show({text:e}),d.selectAll(!1),!1):!0}function hb(a,b){for(var c=[],d=0,e=a.length;e>d;d++){var f=a[d],g=f.data;c.push(b?g.id:g),f.setChecked(!1)}return c}function ib(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c].id);return b}function jb(b){function c(){a.Tips.show({succ:!0,text:"成功设置列表分栏布局"})}0===b&&(b=1),$E("support.OptionSupport",function(a){a.setAttr({field:"ntes_inbox",flag:"layout",value:b,relModule:["inbox","read"],callback:c})})}function kb(b){function c(){a.Tips.show({succ:!0,text:"成功设置列表显示"})}var d=0,e=0;1===b?(d=2,e=2):2===b?(d=3,e=1):3===b&&(d=4,e=3),$E("support.OptionSupport",function(a){a.setAttr({field:"ntes_letter",flag:"font_size",value:e,module:"inbox",noFire:!0,callback:function(){a.setAttr({field:"ntes_letter",flag:"line_height",value:d,module:"inbox",callback:c})}})})}function lb(b){function c(){a.Tips.show({succ:!0,text:"成功设置发件人显示"})}$E("support.OptionSupport",function(a){a.setAttr({field:"ntes_option",flag:"sendershow",value:b,module:"contact",callback:c})})}function mb(b){function c(){a.Tips.show({succ:!0,text:"成功设置邮件显示"})}$E("support.OptionSupport",function(a){a.setAttr({field:"ntes_option",flag:"sizeshow",value:b,module:"inbox",callback:c})})}function nb(b){function c(){a.Tips.show({succ:!0,text:"成功设置每页显示邮件数"})}$E("support.OptionSupport",function(a){a.setAttr({field:"maxlist",value:b,module:"inbox",callback:c})})}function ob(b){function c(){a.Msgbox.show({title:"会话设置成功，点击确定刷新邮箱",ok:d,close:d})}function d(){top.location.reload()}$E("support.OptionSupport",function(a){a.setAttr({field:"ntes_option",flag:"thread",value:b,module:"inbox",callback:c})})}function pb(b){function c(){a.Tips.show({succ:!0,text:"成功设置邮件摘要"})}$E("support.OptionSupport",function(a){a.setAttr({field:"ntes_option",flag:"summary",value:b,module:"inbox",callback:c})})}function qb(){var a,b,c=this,d=c.module,e=d.param("fid"),f=d.getFolder(),g=$S("advLock");f.pop?(a="pop",b=g.pop):(a="folder",b=g[e]),$I("init.AdvLock").setProduct({product:a,fid:e,cancel:b})}function rb(){var a=this;a.title.update(),a.toolbar.update(),a.pager.update(),a.none.update(),a.tips.update()}function sb(b){function c(){$E("interface.MboxInterface",function(a){a.defer()})}Kb.noticed||(a.Msgbox.show({type:"confirm",header:"到期待办邮件提醒",content:"您有 "+b+" 封到期待办邮件需要处理",title:"您有到期待办邮件",okText:"立即处理",cancelText:"不再提示",ok:c}),Kb.noticed=!0)}function tb(a){var b=this;b.module=a,b.letters=[],b.ids={};var c=b.config={};c.isTop=a.isTop(),b.tips=new vb(b),b.title=new wb(b),b.pager=new xb(b),b.none=new yb(b),b.toolbar=new zb(b),b.period=new Ab(b),Bb.config()}var ub="module.mbox.";try{var vb=$L(ub+"Tips"),wb=$L(ub+"Title"),xb=$L(ub+"Pager"),yb=$L(ub+"None"),zb=$L(ub+"Toolbar"),Ab=$L(ub+"Period"),Bb=$L(ub+"Letter")}catch(Cb){return Cb}var Db=a.Object,Eb=a.Function,Fb=a.Event,Gb=a.Array;a.Date;var Hb=a.Browser,Ib=Hb.isIE("<9"),Jb=$I("module.BaseView"),Kb=a.createClass($N(ub+"MboxView"));Db.mix(Kb,Jb,{addedCss:!1,fontSize:["","","nui-txt-s16","nui-txt-s12"],lineHeight:["","tE0","pI0","","tw0"],addCss:d,noticed:!1},{config:null,pager:null,none:null,archiveTips:null,inserted:0,inserting:!1,completed:!1,interval:null,threads:[],insertLimit:Ib?20:100,succExpires:15e3,letters:null,ids:null,dragDiv:null,readedMid:null,allSelected:!1,folderSelected:!1,getHtml:e,getAd:f,getBanner:g,getTips:h,getTitle:i,getControl:j,getSmarts:k,getList:l,getPager:m,getNone:n,getFooter:o,getToolbar:p,deleteInterval:q,createInterval:r,initThreads:s,pushThread:t,insertLetter:u,replaceLetter:v,syncLetter:w,setClass:x,getLayout:y,drag:z,listen:A,getTargetInfo:B,mouseover:C,mousedown:D,click:E,keypress:F,contextmenu:G,select:H,selectAll:I,selectFolder:J,setFolderSelect:K,goPage:L,refresh:M,setRead:N,setFlag:O,setTag:P,setDefer:Q,setMemo:R,setTop:S,setSummary:T,rollback:U,move:V,remove:W,setSpam:X,setAllRead:Y,exportLetter:Z,forwardLetter:$,markReaded:_,markReFw:ab,markYixin:bb,markContact:cb,toggleFooter:db,getSelected:eb,filterSelected:fb,checkLetters:gb,getSelectedData:hb,getSelectedId:ib,setLayout:jb,setSpace:kb,setSenderShow:lb,setSize:mb,setMaxList:nb,setThread:ob,setSummaryShow:pb,setAdvLock:qb,update:rb,showDefer:sb,initialize:tb})}($,window),function(a,b,c){function d(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d].fid;c[f]||(b.push(f),c[f]=!0)}return[b,c]}function e(a){function b(a,b){d&&d(a,b)}var c=this,d=a.callback,e=c.hasThreadAndSent(a.data),f=e[0],g=e[1],h=c.action;ob.extend(a,{hasThread:f,hasSent:g,callback:b}),h.setRead(a)}function f(a){function b(a,b){e&&e(a,b)}var c=this,d=a.single,e=a.callback,f=c.hasThreadAndSent(a.data),g=!d&&f[0],h=!d&&f[1];ob.extend(a,{hasThread:g,hasSent:h,callback:b}),delete a.single;var i=c.action;i.setFlag(a)}function g(a){function b(a,b){d&&d(a,b)}var c=this,d=a.callback,e=c.hasThreadAndSent(a.data),f=e[0],g=e[1],h=c.action;ob.extend(a,{hasThread:f,hasSent:g,callback:b}),h.setTag(a)}function h(a){function b(b,c){if(1===e.length){var f=e[0],g=a.smsDate;g&&$E("product.Schedule",function(a){a.insert(f.subject,f.id,g)})}d&&d(b,c)}var c=this,d=a.callback,e=a.data,f=c.hasThreadAndSent(e),g=f[0],h=f[1],i=c.action;ob.extend(a,{hasThread:g,hasSent:h,callback:b}),i.setDefer(a)}function i(a){function b(a,b){d&&d(a,b)}var c=this,d=a.callback,e=c.hasThreadAndSent(a.data),f=e[0],g=e[1];ob.extend(a,{hasThread:f,hasSent:g,callback:b});var h=c.action;h.setMemo(a)}function j(a){function b(a){g&&g(a)}var c=this,d=a.ruleConditions,e=a.fids,f=a.attrs,g=a.callback,h=c.action;
h.setFilter({ruleConditions:d,fids:e,attrs:f,callback:b})}function k(a){function b(a){d&&d(a)}var c=a.rollback,d=a.callback;c(b)}function l(b){function c(){i.move(b)}function d(a,b){h&&h(a,b)}var e=this,f=b.moveToId,g=b.data,h=b.callback,i=e.action,j=e.parseFid(g),k=e.hasThreadAndSent(g),l=k[0],m=k[1];if(ob.extend(b,{fidInfo:j,hasThread:l,hasSent:m,callback:d}),f>0)c();else{var n,o="",p=!!($S("cos").pref_mail_preserving_days>0);if($S("isFree")||$S("isVip")){var q=p?"误删恢复":"开启误删恢复",r=new a.Link({text:q,click:function(){!p&&$S("isFree")?$E("product.Privileges",function(a){a.showProduct("deleteRecovery")}):$I("util.CustomAppManager").goOutLink("recovery",q),n.close()}});p?Preserving="通过 "+r.html()+"，可恢复10天内彻底删除的邮件":o="提前"+r.html()+"，可找回10天内彻底删除邮件"}n=a.Msgbox.show({type:"confirm",content:o,title:"确定彻底删除邮件吗？",ok:c}),a.Component.setEvents()}}function m(b){function c(){function b(){u.log("spam","normal");var a=e();f(c.checked,!1,o,a)}var c=new a.Checkbox({text:"把发件人加入白名单"});a.Msgbox.show({type:"confirm",content:c.html(),title:"所选邮件将被移动到收件箱",ok:b}),a.Component.setEvents()}function d(){function b(){var a="确 定";(j.checked||k.checked)&&(a="下一步"),g.buttons.ok.setText(a)}function c(){try{u.log("spam","close")}catch(a){}}function d(){function b(){var a;if(c){a=[];var b=c.getValue();ob.each(b,function(b,c){a.push(c)})}f(d,g,o,a,h)}var c,d=j.checked,g=k.checked,h=i.value,l=e();try{u.log("spam","type",h),d&&u.log("spam","add"),g&&u.log("spam","delete")}catch(m){}if(d||g)if(l.length>0){for(var n=[],p=[],q=0,r=l.length;r>q;q++)try{var s=new a.Uri(l[q]),t=s.getNameWithoutPrefix(),v=s.address;v&&p.push({value:v,text:'<strong class="nui-txt-normal">'+t+'</strong><em class="nui-txt-tips">&lt;'+v+"&gt;</em>",title:v,checked:!0})}catch(m){}c=new a.CheckGroup({type:"vertical",items:p,checkType:"checkbox"});var w=[];d&&(w[w.length]='<p class="nui-item"><strong class="nui-txt-impt">确定要把下列选中的发件人加入黑名单？</strong></p>'),g&&(w[w.length]='<p class="nui-item"><strong class="nui-txt-impt">确定要删除该发件人的历史来信（谨慎）？</strong></p>'),n[n.length]='<div class="nui-scroll qn0" style="height:180px;">'+c.html()+"</div>",a.Msgbox.show({type:"confirm",header:"禁止发件人",content:n.join(""),title:w.join(""),ok:b}),a.Component.setEvents()}else b();else b()}var g,i=new a.Select({options:[{text:"垃圾邮件",value:"1",checked:!0},{text:"违法邮件",value:"2"},{text:"其他邮件",value:"0"}]}),j=new a.Checkbox({extcls:"nui-item",text:"将发件人加入黑名单",checkedchange:b}),k=new a.Checkbox({extcls:"nui-item",text:"将发件人的历史来信移到垃圾邮件",checkedchange:b}),l="<strong>您举报的垃圾邮件类型为：</strong>"+i.html(),m=""+j.html()+"<br/>"+k.html()+'<span class="nui-txt-impt">(谨慎)</span></label>',n=h.isLowAntiSpamLevel();n&&(m+='<br/><br/><span class="nui-txt-impt">小提示：反垃圾级别设置过低或关闭了智能分类，建议重新</span> '+new a.Link({text:"设置",click:function(){$E("interface.OptionInterface",function(a){a.entry({module:"AntiSpamModule"})}),g.close()}}).html()),g=a.Msgbox.show({type:"confirm",header:"举报垃圾邮件",content:m,title:l,ok:d,cancel:c,close:c}),a.Component.setEvents()}function e(){for(var b=[],c={},d=0,e=n.length;e>d;d++){var f=n[d];o.push(f.id);for(var g=f.from.split(","),h=0,i=g.length;i>h;h++){var k=a.String.trim(a.Uri.getAddress(a.String.trim(g[h]).replace("+",""))).toLowerCase();c[k]||j.isSender(k)||(c[k]=!0,b.push(k))}}return b}function f(a,b,c,d,e){q.setSpam({area:l,reportType:m?"spam":"notspam",spamType:e,isSpam:m,addList:a,deleteLetter:b,data:n,ids:c,emails:d,hasThread:s,hasSent:t,callback:g})}function g(a){p&&p(a)}try{var h=$L("support.OptionSupport")}catch(i){return i}var j=a.SenderList,k=this,l=b.area,m=b.isSpam,n=b.data,o=[],p=b.callback,q=k.action,r=k.hasThreadAndSent(n),s=r[0],t=r[1],u=a.Context.getModule();m?d():c()}function n(a){function b(a,b){e&&e(a,b)}var c=this,d=c.action,e=a.callback;a.callback=b,d.setAllRead(a)}function o(a){function b(){g&&g()}var c=this,d=c.action,e=a.ids,f=a.isThread,g=a.callback;d.exportLetter({ids:e,isThread:f,callback:b})}function p(a){function b(a){$E(["interface.ComposeInterface"],function(b){b.forward({id:a}),g&&g()})}var c=this,d=c.action,e=a.ids,f=a.isThread,g=a.callback;f?d.getThreadIds({ids:e,callback:b}):b(e)}function q(a){var b=!1,c=!1,d=sb.check();if(d)for(var e=0,f=a.length;f>e;e++){var g=a[e];if(3===g.fid&&(c=!0),g.threadMessageCount>1&&(b=!0),b&&c)break}return[b,c]}function r(){var b=a.Ud.get({field:"ntes_inbox",flag:"layout"})-0;qb&&(b=0);var c;switch(b){case 3:c="l-r";break;case 2:c="t-b";break;default:c=""}return c}function s(){try{var b=a.Event.get(),c=a.Context.getModule();"mbox"==c.logPrefix&&(38===b.which?c.onFocus(-1):40===b.which&&c.onFocus(1))}catch(d){}}function t(b,c,d){var e,f,g=this;if(c.moduleName&&(e=a.JS.find(c.moduleName),delete c.moduleName),e){var h=e._var;h.call=d,h.cacheDom=!0,f=e}else{var i="search"===c.type,j="mbox."+(i?"SearchModule":"ListModule");e=a.JS.get(j,b);var k=!1,l=!1;if(e){if(e._cacheCleaned)l=!0;else{var m=c.index;e.extend("index")===m?k=!0:e.setVar("extend","index",m)}2===e.param("fid")&&(l=!0,k=!1),(c.forceRequest||e.extend("forceRequest")||e.extend("forceReplace")||e.extend("forcePage"))&&(l=!0,k=!1,delete c.forceRequest,e.setVar("extend","forceRequest"),e.setVar("extend","forceReplace"),e.setVar("extend","forcePage")),e.view.completed||(k=!1);try{e._child.view.changeSelect()}catch(n){}e===a.Context.getModule()&&(e.scrollTop=0),l&&e.cleanData(),ob.extend(e.extend(),c)}f={module:j,param:b,extend:c,call:d,cacheDom:k,reset:!1,exit:!1};var o=g.getLayout();f.hasChildMod=!0,f.sharebar=!0,f.viewType=o;try{var c=f.extend;c.brand&&(o?c.brand=!1:(f.noDragbar=!0,f.fixViewType="brand"))}catch(n){}}e&&(e._viewType=o),"folder"===c.subtype&&a.Log.cache({mbox_folder_enter:b.fid}),a.JS.go(f)}function u(){}function v(){function b(){i.createInterval(),i.listen()}function d(){delete h.scrollTop,h.scroll(c,e)}function e(){h.scrollTop=j.scrollTop}function f(){try{var b=i.getLayout();b?h.extend("saveLayout")?h.extend("saveLayout",c):a.SM.go({parent:h,module:"mbox.PreviewModule",param:{layout:b},viewType:b,sharebar:!0,cacheDom:!1,reset:!1}):h.extend("brand")&&$E("interface.MboxInterface",function(a){a.brandLoad()})}catch(d){}}function g(){try{if(h.param("fid")>0){var a=$I("init.Defer").get("expire"),b=a.stats.messageCount;b>0&&i.showDefer(b)}}catch(c){}}var h=this,i=h.view,j=h.getDom("ScrollDiv");d(),b(),f(),a.Thread.delay(g)}function w(a,b,c){var d=this,e=d.view;if("beforeunload"!==c)try{e.select("none")}catch(f){}try{d._child.exit()}catch(f){}return!0}function x(){}function y(){var a=this,b=a.param("filter"),c="";return b&&b.sentDate&&(c="date"),a.mtype+c}function z(){var a=this;a.view;try{a._child.switchIn()}catch(b){}}function A(){var a=this;try{a._child.switchOut()}catch(b){}}function B(){var b=this,d=b.view,e=b.getStats(),f=b.getTotal();if(!d.completed||b.extend("forceRequest")||!b.extend("forcePage")&&e>-1&&e!==f)d.refresh(b.extend("index"));else{if(b.extend("forceReplace"))b.extend("forceReplace",c),b.replace();else{d.markReaded(),d.markReFw();var g=b.scrollTop;if("undefined"!=typeof g){g||(g=0);var h=b.getDom("ScrollDiv");0!==g&&(h.scrollTop=g),delete b.scrollTop}b.extend("brand")&&b._child&&a.Frame.setViewType("l-r",b)}if(b.extend("forceBrand")){b.extend("forceBrand",c);try{b.refreshBrand()}catch(i){}}}try{b.onFocus()}catch(i){}}function C(){var a=this,b=a.view;b.dragDiv=null,a.removeCache()}function D(b){try{var c=a.Context.getModule(),d=c.view,e=d.letters,f=c.diff||0;if(b&&(f+=b),0>f&&(f=0),f>e.length-1&&(f=e.length-1),c.diff=f,e.length>0)try{e[f].getDiv().focus()}catch(g){}}catch(g){}}function E(a,b,c,d,e){function f(){var f=g.getCacheData(i);if(!f||f.onlyExpire){var j=i-1;j>=0||"archive"===g.extend("area")?h.goPage(j):h.refresh()}else h.replaceLetter(a,b,c,d,e)}var g=this,h=g.view,i=g.extend("index");g.extend("limit");var j=b&&c>0&&ob.count(d)===c;j?g.removeData(c,d):g.cleanData(),g.getData(f,i,!0)}function F(){function b(a,b){if(b>=0?b++:b=0,2>b&&b<a.length&&f){var d=a[b];try{d.gotoRead({preload:!0,hiddenCall:function(){c(a,b)}})}catch(e){}}}function c(c,d){a.Thread.delay(function(){b(c,d)})}var d=this,e=d.view,f=d===a.Context.getModule();if(f){var g=d.extend("index");if(d.autoGetData(g-1),d.autoGetData(g+1),0===g){for(var h=e.letters,i=[],j=[],k=0,l=h.length;l>k;k++){var m=h[k],n=m.data;2===n.fid||n.flags.top||m.isThread||n.flags.read||i.push(m)}var o=i.concat(j);c(o)}}}function G(a,b){function c(){b&&b()}var d=this,e=d.extend("type"),f=d.getPage();!(a>f-1)&&a>=0&&"search"!==e&&(d.getCacheData(a,!0)||d.getData(c,a,!0))}function H(){}function I(b){var c=this;if(b)c.removeCache(),a.JS.cleanCache(c);else{c.extend("forceRequest",!0);try{c.view.completed=!1}catch(d){}}}function J(){}function K(){var a=this;a.extend("forceReplace",!0)}function L(){var b=this,c=b.view;try{var d=c.letters;d.length>0&&a.Array.each(d,function(b,c){a.Thread.delay(function(){try{c.remove()}catch(a){}})}),c.letters=[],c.ids={},delete c.allSelected,delete c.folderSelected}catch(e){}}function M(){}function N(){var a=this,b=a.total;try{-1===b&&(b=a.getStats())}catch(c){}return b>=0||(b=0),b}function O(b){var c=this;b>=0||(b=0);var d=c.getStats();d>-1&&d!==b&&a.Thread.delay(function(){$I("init.Sync").request()},0),c.total=b}function P(){var a=this,b=-1;try{var c=a.param("fid"),d=a.isDefer(),e=d&&c>0&&tb.showTop(c)&&tb.getInfo("expire")>0;if(!e){var f,g=a.extend("subtype"),h="";if("read"===g){var i=a.param("filter"),j=!i.flags.read;j&&(f=1===a.param("fids").length?"folder":a.param("tag")?"tag":i.chatWithAddress?"contacts":"read",h="unread")}else f=g;switch(f){case"folder":var c=a.param("fid")||a.param("fids")[0];b=rb.getInfo(c,h);break;case"tag":var k=a.param("tag");b=$I("init.Tag").getInfo(k[0],h);break;case"defer":b=tb.getInfo("total",h);break;case"contacts":var l=a.param("filter").chatWithAddress;b=$I("init.Contacts").getInfo(l,h);break;case"read":b=rb.getTotal(h)}}}catch(m){}return b}function Q(){var a=this,b=a.getTotal(),c=a.extend("limit");return Math.ceil(b/c)}function R(a){var b,c=this,d=c.extend("subtype");switch(d){case"folder":var e=c.param("fid");b=$I("init.Folder").getInfo(e,a);break;case"tag":var f=c.param("tag"),g=$I("init.Tag");b=0;for(var h=0,i=f.length;i>h;h++)b+=g.getInfo(f[h],a);break;case"normal":case"full":"unread"!==a&&(b=c.getTotal());break;case"flag":b=$I("init.Flag").getInfo(1,a);break;case"defer":}return b}function S(){return""}function T(){var a=this,b=a.keyword;if("string"!=typeof b){b="";var c=a.param("pattern");if(c)b=c;else{var d=a.param("conditions");try{ob.isArray(d)||(d=[d]);for(var e=0,f=d.length;f>e;e++){var g=d[e];if("subject"===g.field){b=g.operand;break}}}catch(h){}}a.keyword=b}return b}function U(){}function V(a,b){var c=this;try{var d;return d=b?c._var[a][b]:c._var[a]}catch(e){}}function W(a,b,c){var d=this;try{d._var[a][b]=c}catch(e){}}function X(a,b){var c=this,d="param",e=arguments.length;return 0===e?c.getVar(d):1===e?c.getVar(d,a):(2===e&&c.setVar(d,a,b),void 0)}function Y(a,b){var c=this,d="extend",e=arguments.length;return 0===e?c.getVar(d):1===e?c.getVar(d,a):(2===e&&c.setVar(d,a,b),void 0)}function Z(a){var b=this,c=!1;b.param("fid");var d=b.extend("subtype");switch(d){case"folder":case"flag":case"tag":case"read":c=$I("init.Thread").check(b.param("fid"),a)&&"archive"!==b.extend("area")}return c}function $(a){var b=this,c=b instanceof vb;try{!a&&c&&(a=b.param("fid"))}catch(d){}return rb.isTop(a)&&(!c||"archive"!==b.extend("area")&&"date"===b.param("order")&&b.param("desc")===!0)}function _(){var a=this,b=a.extend("area");return"archive"!==b}function ab(){var b=this,c=b.extend("area");return a.Ext.tag&&"archive"!==c}function bb(){var b=this,c=b.extend("area");return a.Ext.defer&&"archive"!==c}function cb(){var b=this,c=a.Ext.archive;if(c){var d=b.extend("subtype");switch(d){case"flag":case"tag":break;case"folder":var e=b.param("fid");0===rb.getArchive(e)&&(c=!1);break;default:c=!1}}return c}function db(){var a=this,b=a.param("fid"),c=a.isDefer(),d=c&&b>0&&tb.showTop(b)&&tb.getInfo("expire")>0,e=a.getPage();return!d&&0===e}function eb(){var b=this,c=b.extend("type"),d=b.extend("brand"),e="standard"===$G.mailPattern.currentPattern,f=$S("ad");return $S("isFree")&&e&&"1"!=a.Cookie.get("mailmboxpro")&&!$S("closeAd")&&"list"===c&&!d&&!(!f.show&&"ud"===f.userType)}function fb(){var b=this;b.extend("subtype");var c=b.param("fid"),d="standard"===$G.mailPattern.currentPattern,e=$S("ad"),f=b.getTotal()>=10;return $S("isFree")&&d&&f&&"1"!=a.Cookie.get("mailmboxpro")&&!$S("closeAd")&&!(!e.show&&"ud"===e.userType)&&(1===c||3===c)}function gb(){var b=this,c=b.extend("subtype"),d=b.param("fid"),e=tb.getInfo("expire");return a.Ext.selectFolder&&"folder"===c&&d>1&&0===e&&b.getPage()>1&&!b.isThread()}function hb(){var b=this,c=b.extend("subtype"),d="full"===c;return d||a.Ext.summary&&1===a.Ud.get({field:"ntes_option",flag:"summary"})-0&&(d=!0),d}function ib(){try{if(!vb.listened){var b=a.fly(document);b.listen("keydown",a.Function.bind(vb.keydown,vb)),vb.listened=!0}}catch(c){}}try{var jb=$L("interface.MboxInterface"),kb=$L("module.mbox.MboxListener"),lb=$L("module.mbox.MboxView"),mb=$L("module.mbox.MboxAction")}catch(nb){return nb}var ob=a.Object;a.Number;var pb=a.Browser,qb=pb.isIE("<9"),rb=$I("init.Folder"),sb=$I("init.Thread"),tb=$I("init.Defer"),ub=$I("module.BaseModule"),vb=a.createClass($N("module.mbox.MboxModule"));ob.mix(vb,ub,{"interface":jb,View:lb,Listener:kb,Action:mb,cls:"tX0",ariaLabel:"收件箱",action:new mb,parseFid:d,isTop:$,setRead:e,setFlag:f,setTag:g,setDefer:h,setMemo:i,setFilter:j,rollback:k,move:l,setSpam:m,setAllRead:n,exportLetter:o,forwardLetter:p,hasThreadAndSent:q,getLayout:r,keydown:s,entry:t},{logPrefix:"mbox",total:-1,scrollTop:0,keyword:c,getData:u,init:v,exit:w,getText:x,getGroup:y,switchIn:z,switchOut:A,cache:B,clean:C,onFocus:D,replace:E,lazyLoad:F,autoGetData:G,getCacheData:H,cleanCache:I,cleanData:J,lazyReplace:K,removeCache:L,removeData:M,getTotal:N,setTotal:O,getStats:P,getPage:Q,getCount:R,getCondition:S,getKeyword:T,getSummary:U,getVar:V,setVar:W,param:X,extend:Y,isThread:Z,isTop:$,isFlag:_,isTag:ab,isDefer:bb,isArchive:cb,isNone:db,isAd:eb,isFooter:fb,isSelectFolder:gb,isSummary:hb,initialize:ib})}($,window),function(a){try{var b=$L("module.mbox.MboxListener")}catch(c){return c}var d=a.Object,e=a.createClass($N("module.mbox.ListListener"));d.mix(e,b,{},{})}($,window),function(a){function b(a,b,c){function d(a){l&&(a=l(a)),c(a)}var e=this,g=e.module;b||(b={});var h=g&&g.isThread(),i=h?"mbox:listThreads":"mbox:listMessages",j={func:i,body:a},k=e.bindExtra(b,j);j=k.request,f.extend(j,{sync:b.sync,call:d,hideWait:b.hideWait});var l=k.handleExtra;e.wmsvr(j)}function c(a){var b=this;g.superClass.initialize.call(b,a)}try{var d=$L("module.mbox.MboxAction")}catch(e){return e}var f=a.Object,g=a.createClass($N("module.mbox.ListAction"));f.mix(g,d,{},{getList:b,initialize:c})}($,window),function(a,b,c){function d(){var a=this,b=a.module,c="";if(b.extend("brand")){var d=18===b.extend("fid")?"sk0":"qJ0";c='<div class="'+d+'" id="'+b.createId("BannerDiv")+'" style="display:none;"></div>'}return c}function e(){var b=this,d=b.module;if(d.extend("brand")){var e=d.getDom("BannerDiv");if(18===d.param("fid")){for(var f=$S("brandAd"),g=$I("util.Misc").getTime(0).getTime(),h=[],i=0,j=f.length;j>i;i++){var k=f[i];if(k){if(k.startTime&&k.startTime>g)continue;if(k.endTime&&k.endTime<=g)continue;if(!k.img||!k.pdlink)continue;h.push(k)}}if(d.extend("ad",h),h.length>0){var l=d.createId("adDiv"),m=d.createId("adLink"),n=d.createId("adSelectDiv"),o=d.createId("adImg"),p=[];p[p.length]='					<div class="pm0" id="'+l+'">						<a class="iQ0" id="'+m+'" target="_blank">							<img class="fJ0" id="'+o+'" />						</a>					</div>					',p[p.length]='<div class="oF0" id="'+n+'">';for(var i=0,j=h.length;j>i;i++)p[p.length]='<a class="hO0"></a>';p[p.length]="</div>",e.innerHTML=p.join("");var q=a("#"+m);q.listen("mouseover",function(){d.extend("adMouseover",!0)}),q.listen("mouseout",function(){d.extend("adMouseover",c)});for(var r=a("#"+n).find("A"),s=r.doms,i=0,j=s.length;j>i;i++){var t=function(a){return function(){b.toggleBanner(a,!0)}}(i);a.Event.listen(s[i],"click",t)}d.extend("adIndex",-1),b.toggleBanner(0),e.style.display=""}else{var u=$S("ad");if(u.show||"ud"!==u.userType){var v="";try{v=gAd.get("brand")}catch(w){}v&&(v+=new a.Link({text:"关闭",cls:"rt2",click:function(){$E("product.Privileges",function(a){a.showProduct("noAd")})}}).html(),e.innerHTML=v,e.style.display="")}}}else{var x=$I("init.Tag"),y=d.param("tag")[0],z=x.getBrand(y);z&&z.logo2&&z.description&&(e.innerHTML='					<div class="kb0">						<div class="gO0"><img src="'+z.logo2+'" alt="'+z.name+'" /></div>						<h1 class="fk0">'+z.name+'</h1>						<h1 class="fX0">'+z.description+"</h1>					</div>					",e.style.display="")}}}function f(b,c){var d=this,e=d.module,f=e.extend("ad"),g=e.extend("adIndex")||0,h=d.timeout,i=!!e.extend("adMouseover"),j=5e3;try{clearTimeout(h)}catch(k){}if(i&&!c)d.timeout=setTimeout(function(){d.toggleBanner(b)},j/2);else if(b!==g){b%=f.length;for(var l=a("#"+e.createId("adSelectDiv")).find("A").doms,m=0,n=l.length;n>m;m++){var o=a(l[m]);m!==b?o.removeClass("ek0"):o.addClass("ek0")}var p=f[b],q=a("#"+e.createId("adDiv")).dom,r=a("#"+e.createId("adLink")).dom,s=a("#"+e.createId("adImg")).dom;q.style.backgroundColor="#"+(p.color?p.color:"E0ECF4"),s.src=p.img;var t=p.pdlink;r.href=t;var u=null;a.String.has(t,"http")||(u=function(){try{a.Eval.exec(t)}catch(b){}return!1}),r.onclick=function(){var a=!0;return u&&(a=u()),a},e.extend("adIndex",b),d.timeout=setTimeout(function(){d.toggleBanner(b+1)},j)}}function g(){var b=this,c=b.module,d=c.extend("smart"),e=c.param("tag"),f="";if(!c.isNone()&&d){var g=$I("init.Tag"),h=a.getClass($N("component.Tab"));a.getClass($N("component.TabItem"));var i=g.smart,j=[],k={render:function(){this.activeStyle()}};j.push({text:'<div class="ui0">所有分类</div><span class="pz2 nui-txt-cLink">●</span>',nonClose:!0,extcls:"nui-txt-cLink",listeners:e.length>1?k:null,noDelayClick:!0,click:function(){return $E("interface.MboxInterface",function(a){a.smarts()}),!0}});for(var l in i){var m=i[l],n=m.alias,o=g.smarts[n],p="",q="";("bill"===n||"bank"===n)&&(p='<div class="nui-layer tL1" style="left:-132px;top:32px;padding:0"><b class="nui-layer-arr" style="left:175px;"></b><div class="nui-layer-normal"><iframe src="http://qian.163.com/promote/web_promote_small.html" frameborder="0" style="width:368px;height:143px;"></iframe></div></div>',q=" jz1"),j.push({text:'<div class="ui0 kA1"><b class="nui-ico nui-ico-category-'+o.index+'"></b>'+o.name+'</div><span class="pz2 nui-txt-cLink">●</span>'+p,nonClose:!0,extcls:"nui-txt-cLink"+q,listeners:1===e.length&&e[0]===l?k:null,noDelayClick:!0,click:function(a){return function(){return $E("interface.MboxInterface",function(b){b.smarts(a)}),!0}}(n)})}var r=new h({type:"",extcls:"AH1",hasClose:!1,items:j});f=r.html()}return f}function h(b){function c(b){g[g.length]=b,g[g.length]=new a.Link({text:"关闭",cls:"rt2",click:function(){$E("product.Privileges",function(a){a.showProduct("noAd")})}}).html()}function d(a){b&&(f.getDom("FooterDiv").innerHTML=g.join()),g.unshift('<div class="xd0" id="'+a+'"'+(f.isNone()||0!==f.extend("index")?' style="display:none"':"")+">"),g.push("</div>")}var e=this,f=e.module,g=[];if(f.isFooter()){var h=gAd.get("inboxBottom"),i=f.createId("FooterDiv");h&&(c(h),d(i))}return g.join("")}function i(){var a=this,b=a.module,c=b.extend("index");try{b.isFooter()&&b.getEl("FooterDiv")[0===c?"show":"hide"]()}catch(d){}}function j(a){var b=this;n.superClass.initialize.call(b,a)}try{var k=$L("module.mbox.MboxView")}catch(l){return l}var m=a.Object,n=a.createClass($N("module.mbox.ListView"));m.mix(n,k,{},{getBanner:d,showBanner:e,toggleBanner:f,getSmarts:g,getFooter:h,toggleFooter:i,initialize:j})}($,window),function(a,b,c){function d(b){function c(a,b){i&&i(a,b)}function d(a){var b=$G.user.topMailCount-0,c=a.total,d=h.length,f=d+c;f>b&&(e="每个文件夹最多可以设置 "+b+" 封置顶邮件(您设置后为 "+f+' 封)<div style="padding-top:15px" class="txt-12 txt-info">提示：您可以取消部分已置顶邮件的置顶状态，再进行设置</div>')}var e,f=this,g=(b.fid,b.isTop),h=b.data,i=b.callback,j=f.hasThreadAndSent(h),k=j[0],l=j[1],m=f.action,n=f.parseFid(h),o=n[0];n[1];for(var p=0,q=o.length;q>p;p++){var r=o[p];if(!f.isTop(r)){e=y.get(r).name+" 文件夹无法设置置顶";break}}if(g)for(var p=0,q=o.length;q>p;p++)e||m.getTop({fid:o[p],callback:d});e?(a.Msgbox.show({title:e}),i&&i(!1)):(w.extend(b,{fidInfo:n,hasThread:k,hasSent:l,callback:c}),m.setTop(b))}function e(a){var c=a.substring(0,4),d=parseInt(a.substring(4,6),10)-1,e=a.substring(6,8);return new b.Date(c,d,e)}function f(a,b,c){var d=this;u.entry.call(d,a,b,c)}function g(b,d){var e=this,f=d.limit,g=d.index,h=d.start;w.extend(b,{limit:f,start:h>=0?h:g*f}),e.isSummary()&&(b.summaryWindowSize=f),b.skipLockedFolders=!(b.fid>0||1===b.fids.length),b.topFlag=e.isTop()?"top":c,b.returnTag=!!a.Ext.tag,b.returnTotal=!0}function h(b,c,d){function e(a){if(!d&&0===a["var"].length&&c>0){var e=f.getPage()-1;i.index=0>e?0:e,f.getData(b)}else b()}var f=this,g=f._var,h=g.param,i=g.extend,j=i.limit;if(g.cacheDom=!0,c>=0||(c=i.index),!d){try{f.view.deleteInterval()}catch(k){}f.removeCache()}if(f.getCacheData(c,!0))a.Thread.run(function(){b()},0);else{var l=f.param("fid"),m=f.extend("area"),n=f.extend("expire")&&A.getInfo("expire")>0,o=a.Ext.archive&&l>0&&"archive"!==m,p=w.clone(h);if(f.extendParam(p,{index:c,limit:j}),n){var q=p.filter;q||(q=p.filter={}),q.todoList=!0}var r={hideWait:d,loadExpire:n&&!A.getCache(),loadArchive:o&&!(y.getArchive(l)>=0)};f.getList(p,r,e)}}function i(){var b=this,c=(b.extend("type"),b.extend("subtype")),d=b.param("fid"),e=(b.param("fids"),b.param("tag")),f=b.param("filter"),g=b.extend("systemContacts"),h=b.extend("smart"),i="邮件列表";try{switch(c){case"flag":i="旗帜邮件";var j=f.label0;j>=0&&(i=a.LETTERFLAG[j]+"邮件");break;case"tag":i="标签邮件",i=h&&e.length>0?"智能标签":z.getName(e[0]);break;case"defer":i="待办邮件";break;case"contacts":if(g)i="帐号通邮件";else{i="联系人邮件";var k=f.chatWithAddress||f.fromAddress||f.toAddress,l=$I("init.Contacts").getContact(k);l&&(i=l.data.name+"邮件")}break;case"folder":var m=y.get(d);i=m.name;break;case"read":var n=b.extend("read");i=(n?"已读":"未读")+"邮件";break;case"calendar":i=b.getCondition();break;case"emails":i="联系人邮件"}}catch(o){}return i}function j(){var b=this,c=b.view,d=$I("init.Tag"),e=d.getMatch();e.length>0&&(e.sort(function(a,b){return a.logo1&&!b.logo1?-1:!a.logo1&&b.logo1?1:a.weight-b.weight}),a.SM.go({parent:b,module:"mbox.BrandModule",param:b.param(),viewType:"l-r",setIEViewType:!0,hideSplit:!0,sharebar:!0,reset:!1,cacheDom:!1}),a.Frame.setViewType("l-r",b)),c.showBanner();var f=c.constructor;f.addCss()}function k(){var b=this;try{var c=$I("init.Tag"),d=c.getMatch();d.length>0?"address.AddressModule"!==b._child.mtype&&a.SM.refresh(b._child):a.Frame.setViewType("normal")}catch(e){}}function l(a,b){var d,e=this,f=e.data;a||(a=e.extend("index"));var g=0>a,h=!1,i=e.getTotal();if(f.length>0)if(g)d=f.slice();else{var j=e._var.extend;a>=0||(a=j.index),d=[];for(var k=j.limit,l=a*k,m=0,n=l,o=f.length;k>m&&o>n;m++,n++){var p=f[l+m];p&&d.push(p)}h=d.length===k||m+l===i}else h=0===a&&0===i,(g||h)&&(d=[]);if(g||h){if(!b&&e.extend("expire")&&A.getInfo("expire")>0)try{var q=A.getCache("var");if(q.length>0){var r=0===d.length;d=q.concat(d),d.onlyExpire=r}}catch(s){d=null}return d&&d.length>0?d:c}}function m(){var a=this;a.data=[]}function n(a,b){for(var c=this,d=c.data,e=c.getTotal(),f=d.length-1,g=0;f>-1&&a>g;){var h=d[f];h&&b[h.id]&&(d.splice(f,1),g++,e--),f--}c.setTotal(e)}function o(a,b,c){function d(b){for(var d=a.start,f=b["var"],g=b.total,h=e.data,i=0,j=f.length;j>i;i++)h[d+i]=f[i];e.setTotal(g),c(b)}var e=this,f=e.extend("subtype");if("emails"===f)try{var g=e.param("filter"),h=g.chatWithAddress||g.fromAddress||g.toAddress;if(!h)return d({"var":[],total:0}),void 0}catch(i){}e.action.getList(a,b,d)}function p(){var b=this,c=[],d=b.param("filter"),e=b.param("tag");b.extend("type");var f=b.extend("subtype");if(d){if(d.label0>=0&&"flag"===f){var g=a.LETTERFLAG[d.label0];g&&c.push(g)}var h=d.flags;if(h)for(var i in h){var j=h[i];switch(i){case"priority":c.push(1===j?"紧急":5===j?"缓慢":"普通");break;case"read":"read"===f&&c.push(j?"已读":"未读");break;case"attached":c.push((j?"普通":"无")+"附件");break;case"linkAttached":c.push(j?"云附件":"");break;case"replied":c.push((j?"已":"未")+"回复");break;case"forwarded":c.push((j?"已":"未")+"转发")}}var k=d.chatWithAddress,l=d.fromAddress,m=d.toAddress,n=d.chatWithAddress||d.fromAddress||d.toAddress;if(n){var o=$I("init.Contacts").getContact(n),p=a.String.encodeHTML(o?o.data.name:n);k?c.push("与 "+p+" 的往来"):l?c.push("发自 "+p):m&&c.push("发给 "+p)}if(d.sentDate){var q,r=d.sentDate.split(":"),s=r[0],t=r[1],u=B.parseSentDate(s),v=B.parseSentDate(t);q=0===u-v?x.format(u,"yyyy年M月d日"):x.format(u,"yyyy年M月d日")+"-"+x.format(v,"yyyy年M月d日"),c.push(q)}d.defer&&c.push("待办")}else if(e){for(var w=$I("init.Tag"),y=[],z=0,A=e.length;A>z;z++){var C=e[z],D=w.getName(C);y.push(D)}c.push(y.join())}return c.join()}function q(a){var b=this;B.superClass.initialize.call(b,a),b.cleanData()}try{var r=$L("module.mbox.ListListener"),s=$L("module.mbox.ListView"),t=$L("module.mbox.ListAction"),u=$L("module.mbox.MboxModule")}catch(v){return v}var w=a.Object;a.Number,a.Browser;var x=a.Date,y=$I("init.Folder"),z=$I("init.Tag"),A=$I("init.Defer"),B=a.createClass($N("module.mbox.ListModule"));w.mix(B,u,{View:s,Listener:r,Action:t,action:new t,setTop:d,parseSentDate:e,entry:f},{data:null,extendParam:g,getData:h,getText:i,initBrand:j,refreshBrand:k,getCacheData:l,cleanData:m,removeData:n,getList:o,getCondition:p,initialize:q})}($,window),function(a){try{var b=$L("module.mbox.MboxListener")}catch(c){return c}var d=a.Object,e=a.createClass($N("module.mbox.SearchListener"));d.mix(e,b,{},{})}($,window),function(a){function b(a,b,c){function d(a){c(a)}var e=this;e.module,b||(b={});var f,h=a.ids;f=h?{func:"mbox:getMessageInfos"}:{func:"mbox:searchMessages"},g.extend(f,{body:a,call:d,hideWait:b.hideWait,sync:b.sync}),e.wmsvr(f)}function c(b){function c(b){a.Listener.fire("search:removeall"),g(b)}var d=this,e=b.data,f=b.moveToId,g=b.callback,h=d.getIds(e,!0),i={func:"mbox:updateMessageInfos",body:{ids:h[0],attrs:{fid:f}},call:c};d.wmsvr(i)}function d(a){var b=this;h.superClass.initialize.call(b,a)}try{var e=$L("module.mbox.MboxAction")}catch(f){return f}var g=a.Object,h=a.createClass($N("module.mbox.SearchAction"));g.mix(h,e,{},{getList:b,moveAll:c,initialize:d})}($,window),function(a,b,c){function d(){function b(a){var b=null;if(q)for(var c=0,d=q.length;d>c;c++){var e=q[c];e.field===a&&(b=e)}return b}try{var d=$L("support.AddressSupport",this)}catch(e){return e}var f=this,g=f.module,h=g.param(),j=g.extend(),k=g.result,o=$I("init.Folder");if("full"!==j.subtype||0===g.getTotal())return"";var p=(h.pattern,h.fids),q=h.conditions,r=h["fts.fields"],s=k.groupings,t=1===a.Ud.get({field:"ntes_global",flag:"secondSearch"})-0;a.Ud.get({field:"ntes_inbox",flag:"search_type"})-0;var u;u=t?"pJ0":"ob0",g.hasAdditional();var v=[];v[v.length]='<div class="sG0 '+u+'" id="'+g.createId("ControlDiv")+'">';var w=new a.Link({title:"设置默认搜索范围",bracket:!0,text:"设置默认",extcls:"nui-txt-cLink",click:n.bind(i.setDefaultFields,i,f)});v[v.length]='<div class="pl0" tabindex="0" aria-label="默认搜索范围"><div class="pk0">搜索范围'+w.html()+'</div><div class="lo0"><ul>';var x=[],y=i.getFields();if(l.each(y,function(b,c){var d=r===c.key,e=d?" cU0":"",g=new a.Radio({text:c.title,value:b,checked:d,checkedchange:function(){return f.additionalSearch("scope",this.value),!1}});v[v.length]='<li class="gq0'+e+'">'+g.html()+"</li>",x.push(g)}),a.Radio.group(x),v[v.length]="</ul></div></div>",v[v.length]='<div class="or0" tabindex="0" aria-label="文件夹"><div class="pk0">文件夹</div><div class="lo0"><ul>',p&&1===p.length){var z=new a.Link({title:"取消此附加条件",text:"取消",bracket:!0,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"fid",c)});v[v.length]='<li class="gq0">'+z.html()+new a.Label({text:o.get(p[0]).name}).html()+"</li>"}else{var A=[];s&&(A=s.fid);for(var B=0,C=A.length;C>B;B++){var D=A[B],E=D.val,F=D.cnt,G=o.get(E).name,z=new a.Link({title:"在搜索结果中精确文件夹为"+G,text:G,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"fid",E)});v[v.length]='<li class="gq0">'+z.html()+new a.Label({text:"("+F+")",type:"tips"}).html()+"</li>"}}v[v.length]="</ul></div></div>",v[v.length]='<div class="pL0" tabindex="0" aria-label="发件人"><div class="pk0">发件人+收件人</div><div class="lo0"><ul>';var H=b("from");if(H){var I=new a.Link({title:"取消此附加条件",text:"取消",bracket:!0,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"from",c)}),J=H.operand,K=d.getName(a.Uri.matchEmail(J)),L=m.encodeHTML(K?K:J);v[v.length]='<li class="gq0">'+I.html()+new a.Label({text:L}).html()+"</li>"}else{var M=[];s&&(M=s.fromAddress);for(var N,O=[],P=[],B=0,C=M.length;C>B;B++){var Q=M[B],J=Q.val.toLowerCase();d.getAddrObj(J)||J===$S("uid")?O.push(Q):P.push(Q)}N=O.concat(P);for(var B=0,C=N.length;C>B;B++){var R=N[B],S=m.trim(R.val);if(S){try{var T=d.getName(a.Uri.matchEmail(S))}catch(e){}var F=R.cnt,U=m.encodeHTML(T?T:S),I=new a.Link({title:"在搜索结果中精确发件人为"+S,text:U,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"from",S)});v[v.length]='<li class="gq0">'+I.html()+new a.Label({text:"("+F+")",type:"tips"}).html()+"</li>"}}}v[v.length]="</ul></div></div>",v[v.length]='<div class="pM0" tabindex="0" aria-label="时间"><div class="pk0">时间范围</div><div class="lo0"><ul>';var V=b("sentDate"),W=i.getDateDiff();if(V){for(var X=V.operand,Y=W[4].name,B=0,C=W.length;C>B;B++){var Z=W[B];if(Z.date<=X){"<="===V.operator&&(B++,Z=W[B]),Y=Z.name;break}}var $=new a.Link({title:"取消此附加条件",text:"取消",bracket:!0,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"sentDate",c)});v[v.length]='<li class="gq0">'+$.html()+new a.Label({text:Y}).html()+"</li>"}else{var _=[];s&&(_=s.sentDate);for(var B=0,C=_.length;C>B;B++)for(var ab=0,bb=W.length;bb>ab;ab++){var cb=_[B],Z=W[ab];if(Z.date<=cb.val){if(Z.count+=cb.cnt,ab===bb-2)break}else;}for(var B=0,C=W.length;C>B;B++){var Z=W[B];if(Z.count>0){var db=Z.name,eb=Z.count,$=new a.Link({title:"在搜索结果中精确时间范围为"+db,text:db,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"sentDate",B)});v[v.length]='<li class="gq0">'+$.html()+new a.Label({text:"("+eb+")",type:"tips"}).html()+"</li>"}Z.count=0}}v[v.length]="</ul></div></div>",v[v.length]='<div class="ol0" tabindex="0" aria-label="状态"><div class="pk0">邮件状态</div><div class="lo0"><ul>';var fb=b("flags");if(fb){var gb=fb.operand.attached,hb=fb.operand.read;if("boolean"==typeof gb){var ib=new a.Link({title:"取消此附加条件",text:"取消",bracket:!0,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"attached",c)});v[v.length]='<li class="gq0">'+ib.html()+new a.Label({text:"("+(gb?"有附件":"无附件")+")",type:"tips"}).html()+"</li>"}else if("boolean"==typeof hb){var jb=new a.Link({title:"取消此附加条件",text:"取消",bracket:!0,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"read",c)});v[v.length]='<li class="gq0">'+jb.html()+new a.Label({text:"("+(hb?"已读":"未读")+")",type:"tips"}).html()+"</li>"
}}else{var kb=[];s&&(kb=s["flags.attached"]);for(var B=0,C=kb.length;C>B;B++){var lb=kb[B],mb=lb.val?"有附件":"无附件",nb=lb.cnt,ib=new a.Link({title:"在搜索结果中精确邮件状态为"+mb,text:mb,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"attached",lb.val)});v[v.length]='<li class="gq0">'+ib.html()+new a.Label({text:"("+nb+")",type:"tips"}).html()+"</li>"}var ob=[];s&&(ob=s["flags.read"]);for(var B=0,C=ob.length;C>B;B++){var pb=ob[B],qb=pb.val?"已读":"未读",rb=pb.cnt,jb=new a.Link({title:"在搜索结果中精确邮件状态为"+qb,text:qb,extcls:"nui-txt-cLink",click:n.bind(f.additionalSearch,f,"read",pb.val)});v[v.length]='<li class="gq0">'+jb.html()+new a.Label({text:"("+rb+")",type:"tips"}).html()+"</li>"}}return v[v.length]="</ul></div></div></div>",v.join("")}function e(){var b,c,d,e=this,f=e.module,g=1===a.Ud.get({field:"ntes_global",flag:"secondSearch"})-0,h=f.getEl("ControlDiv");g?(b="pJ0",c="ob0",d=0):(b="ob0",c="pJ0",d=1),h.removeClass(b),h.addClass(c),a.Ud.set({field:"ntes_global",flag:"secondSearch",value:d}),e.title.update(),h.destroy()}function f(a,b){function c(a){var b=h.conditions;if(b)for(var c=0,d=b.length;d>c;c++)if(b[c].field===a){b.splice(c,1);break}}function d(a,b){var c=h.conditions;c||(c=h.conditions=[]),e(a)||(c[c.length]=b)}function e(a){var b=!1,c=h.conditions;if(c)for(var d=0,e=c.length;e>d;d++)if(c[d].field===a){b=!0;break}return b}var f=this,g=f.module,h=l.clone(g.param()),j=l.clone(g.extend());if(j.index=0,"undefined"==typeof b)switch(a){case"from":case"sentDate":c(a);break;case"attached":case"read":c("flags");break;case"fid":h.fids=f.fidbak,delete f.fidbak;break;default:!h.fids&&f.fidbak?h.fids=f.fidbak:delete h.fids,delete f.fidbak,h.conditions&&delete h.conditions}else{var k=i.getFields(),m=i.getDateDiff();switch(a){case"scope":if(h["fts.fields"]===k[b].key)return;h["fts.fields"]=k[b].key;break;case"from":d(a,{field:a,operator:"contains",ignoreCase:!0,operand:b});break;case"fid":f.fidbak=h.fids,h.fids=[b];break;case"sentDate":b===m.length-1?d(a,{field:a,operator:"<=",operand:m[b-1].date}):d(a,{field:a,operator:">",operand:m[b].date});break;case"attached":d("flags",{field:"flags",operator:"=",operand:{attached:b}});break;case"read":d("flags",{field:"flags",operator:"=",operand:{read:b}})}}$E("interface.MboxInterface",function(a){a.entry(h,j)})}function g(){function b(){$E("module.mbox.SearchModule",function(a){a.removeAll({data:e.result["var"],callback:c})})}function c(){d.refresh()}var d=this,e=d.module;a.Msgbox.show({type:"confirm",content:"确定将所有搜索出来的邮件都移动到 已删除 文件夹吗？",title:"删除确认",ok:b})}function h(a){var b=this;o.superClass.initialize.call(b,a)}try{var i=$L("module.mbox.Field"),j=$L("module.mbox.MboxView")}catch(k){return k}var l=a.Object,m=a.String,n=a.Function,o=a.createClass($N("module.mbox.SearchView"));l.mix(o,j,{},{getControl:d,toggleControl:e,additionalSearch:f,removeAll:g,initialize:h})}($,window),function(a,b,c){function d(a){function b(){e&&e(!0)}var c=this,d=a.data,e=a.callback,f=c.action;f.moveAll({data:d,moveToId:4,callback:b})}function e(a,b,c){var d=this;v.entry.call(d,a,b,c)}function f(b,c){var d=this;d.isSummary();var e=c.limit;x.extend(b,{windowSize:e,returnTag:!!a.Ext.tag})}function g(b,c,d){function e(a){g.extendParam(a,{limit:j}),g.getList(a,n,f)}function f(){var a=!1;if(k&&c>0){var e=g.getPage();c>=e&&(c=e-1),a=!0}a?g.getData(b,c,d):b()}var g=this,h=g.param(),i=g.extend(),j=i.limit,k=!1;c>=0||(c=i.index);var l=j*c;if(!d){try{g.view.deleteInterval()}catch(m){}g.removeCache()}var n=x.clone(i);if(n.hideWait=!!d,n.start=l,g.result){var o=g.checkCacheData(c);if(o.cached)a.Thread.run(function(){b()},0);else{var p=o.ids;e({mboxa:h.mboxa,ids:p})}}else k=!0,e(x.clone(h))}function h(){return"搜索邮件"}function i(a){var b=this,d=(b.param(),b.extend());a||(a=d.index);var e,f=0>a;try{var g=b.result["var"];if(g)if(f)e=g.slice();else{e=[];for(var h=d.limit,i=a*h,j=0,k=g.length;k>j+i&&h>j;j++)e.push(g[j+i])}}catch(l){}return e&&e.length>0?e:c}function j(a){var b=this,c=(b.param(),b.extend());a||(a=c.index);var d=b.getCacheData(a),e=[],f=!0;if(d)for(var g=0,h=d.length;h>g;g++){var i=d[g];"string"==typeof i?(f=!1,e.push(i)):e.push(i.id)}return{cached:f,ids:e,cacheData:d}}function k(){var a=this;delete a.result}function l(a,b){for(var c=this,d=c.result["var"],e=c.getTotal(),f=d.length-1,g=0;f>-1&&a>g;){var h=d[f];h&&b[h.id]&&(d.splice(f,1),g++,e--),f--}c.setTotal(e)}function m(a,b,c){function d(d){var f=d["var"];if(a.ids)for(var g=e.result["var"],h=b.start,i=0,j=f.length;j>i;i++){var k=h+i,l=g[k],m=f[i];"string"==typeof l&&m.id===l&&(g[k]=m)}else e.result=d,e.setTotal(f?f.length:0);c(d)}var e=this;e.action.getList(a,b,d)}function n(){function b(){var a=e.pattern,b=[],c=e.fids;if(c&&1===c.length){var d=$I("init.Folder");b.push(d.get(c[0]).name)}var f=e.conditions;if(f)for(var g=0,h=f.length;h>g;g++){var i=f[g];switch(i.field){case"from":b.push(i.operand);break;case"sentDate":for(var j=r.getDateDiff(),k=0,l=j.length;l>k;k++){var m=j[k];if(m.date===i.operand){"<="===i.operator&&(k+=1,m=j[k]),b.push(m.name);break}}break;case"flags":var n=i.operand.attached;"boolean"==typeof n&&b.push(n?"有附件":"无附件");var o=i.operand.read;"boolean"==typeof o&&b.push(o?"已读":"未读")}}return'关键字为“<strong class="txt-keyword">'+y.encodeHTML(a)+"</strong>”"+(b.length>0?'，附加条件为“<strong class="txt-keyword">'+b.join('</strong>，<strong class="txt-keyword">')+"</strong>”":"")}function c(){var b=[];try{var c=e.conditions;if(x.isArray(c)&&(c=c[0]),c){var d=c.field,f=c.operand,g=c.operator;switch(d){case"flags":f.replied&&b.push("已回复"),f.forwarded&&b.push("已转发");var h=a.Ext.newAttach?f.realAttached:f.attached;h?b.push("有附件"):h===!1&&b.push("无附件"),f.linkAttached?b.push("有云附件"):f.linkAttached===!1&&b.push("无云附件"),f.read?b.push("已读"):0===b.length&&b.push("未读");break;case"label0":b.push(0===f?"所有旗帜":a.LETTERFLAG[f]);break;case"priority":switch(g){case">":b.push("缓慢");break;case"<":b.push("紧急");break;default:b.push("普通")}break;case"subject":b.push('关键字为“<strong class="txt-keyword">'+y.encodeHTML(f)+"</strong>”");break;case"from":case"to":b.push("与 "+y.encodeHTML(f)+" 往来")}if(!d){var f=e.conditions[0].conditions[0].operand;if(f&&("string"==typeof f&&(a.Uri.matchEmail(f)?b.push("与 "+y.encodeHTML(f)+" 往来"):b.push('关键字为“<strong class="txt-keyword">'+y.encodeHTML(f)+"</strong>”")),"object"==typeof f)){var h=a.Ext.newAttach?f.realAttached:f.attached;h&&b.push("有附件"),h===!1&&b.push("无附件"),f.linkAttached&&b.push("有云附件"),f.linkAttached===!0&&b.push("无云附件")}}}}catch(i){}return 0===b.length?"":b.join()}var d=this,e=d.param(),f=d.extend();return"full"===f.subtype?b():c()}function o(){function a(a){if(d===e.extend("index")){for(var b=0,f=a.length;f>b;b++)try{var g=a[b];c[g.mid].summary=g.summary}catch(h){}e.view.setSummary()}}var b,c,d,e=this,f=(e.param(),e.extend());if("full"===f.subtype){var g=[],c={};b=e.getCacheData(),d=f.index;for(var h=0,i=b.length;i>h;h++){var j=b[h],k=j.id;g.push(k);var l=k;try{l=/(\d+\:)?([^:_]+)/.exec(l)[2]}catch(m){}c[l]=j}e.action.getSummary({ids:g,pattern:e.param("pattern"),callback:a})}}function p(){var a=this,b=a.param(),c=b.fids,d=b.conditions;return c&&1===c.length||d&&d.length>0}function q(a){var b=this;z.superClass.initialize.call(b,a)}try{var r=$L("module.mbox.Field"),s=$L("module.mbox.SearchListener"),t=$L("module.mbox.SearchView"),u=$L("module.mbox.SearchAction"),v=$L("module.mbox.MboxModule")}catch(w){return w}var x=a.Object,y=a.String,z=a.createClass($N("module.mbox.SearchModule"));x.mix(z,v,{View:t,Listener:s,Action:u,action:new u,removeAll:d,entry:e},{result:null,extendParam:f,getData:g,getText:h,getCacheData:i,checkCacheData:j,cleanData:k,removeData:l,getList:m,getCondition:n,getSummary:o,hasAdditional:p,initialize:q})}($,window),function(a){function b(b){var d=this,e=d.module,f=e.view,g=b.Tag;if(g&&g.changed){var h=g.info.stats;if(h){var i=!1;c.each(h,function(b){return $I("init.Tag").get(b,"brand")?(i=!0,a.BREAK):void 0}),i&&(e.container.innerHTML=f.getHtml(),a.Component.setEvents())}}}var c=a.Object,d=$I("module.BaseListener"),e=a.createClass($N("module.mbox.BrandListener"));c.mix(e,d,null,{_listeners:{"sync:request":{handler:b},"sync:cache":{handler:b}}})}($,window),function(a){function b(){function b(){for(var b,c=[],g=f.QRHerf=[],l=h.createId("ImgUl"),m=0,n=i.length;n>m;m++){var o=i[m];if(o.logo1){var p=j.get(o.id,"brand",!0),q=j.getInfo(p.name,"unread"),r=j.getInfo(p.name),s=o.largeTwoDimenCode||"",t=o.smallTwoDimenCode||"";c[c.length]='<li class="fh0">';var u='<span class="bF0"><img src="'+o.logo1+'" alt="'+o.name+'" /></span><span class="bu0">'+o.name+"</span>";u+=q>0?'<span class="bx0 nui-txt-cLink">'+q+"封未读</span>":'<span class="bx0">'+r+"封邮件</span>",t&&(u+='<span class="cz1"><img src="'+t+'" width="20" height="20" /></span>');var v=new a.Link({text:u,extcls:"cD0",click:function(a){return function(){d(o.statId),$E("interface.MboxInterface",function(b){b.entry({tag:[a.name]},{type:"list",subtype:"tag"})})}}(p)});c[c.length]=v.html(),c[c.length]="</li>",k.push(o.statId),e||(e=o.openUrl),s&&g.push({link:v,image:s})}}return c.length>0&&(b='<ul class="iZ0" id="'+l+'">'+c.join("")+"</ul>"),b}function c(){for(var b,c=[],f=0,g=i.length;g>f;f++){var h=i[f];if(!h.logo1){var l=j.get(h.id,"brand",!0),m=j.getInfo(l.name,"unread");c[c.length]='<li class="hz0">',c[c.length]=new a.Link({text:h.name+(m>0?" ("+m+")":""),extcls:"dY0",click:function(a){return function(){d(h.statId),$E("interface.MboxInterface",function(b){b.entry({tag:[a.name]},{type:"list",subtype:"tag"})})}}(l)}).html(),c[c.length]="</li>",k.push(h.statId),e||(e=h.openUrl)}}return c.length>0&&(b='<ul class="nt0">'+c.join("")+"</ul>"),b}function d(b){a.Log.record("brandClick",b)}var e,f=this,h=f.module,i=$I("init.Tag").getMatch(),j=$I("init.Tag"),k=[],l=[];l[l.length]='				<div class="re0 nui-scroll" style="height:98%">					<h1 class="ly0">品牌分类</h1>					<div class="iY0">			';var m=b(),n=c();return m&&(l[l.length]=m),m&&n&&(l[l.length]='<div class="nx0"></div>'),n&&(l[l.length]=n),l[l.length]="					</div>				</div>			",e&&k.length>0&&a.Thread.delay(function(){g.request({requestType:a.Ajax.IFRAME,url:e,body:{statId:k.join(),uid:$S("uid")}})}),f.addHeader(null,l.join(""),"frame-main-cont-body-second-brand")}function c(){var b=this,c=b.module,d=b.QRLayer,e=c.getEl("ImgUl");e.listen("mouseover",a.Function.bind(b.showQRCode,b)),e.listen("mouseout",function(){try{d.hide()}catch(a){}}),f.listen(e.dom.parentNode.parentNode,"scroll",function(){try{d.hide()}catch(a){}})}function d(){for(var b,c=this,d=a.Event.getTarget(),e=!0,f=c.QRLayer;d&&"UL"!=d.tagName;){if("A"===d.tagName){b=d;break}d=d.parentNode}if(b)for(var g=c.QRHerf,h=0,i=g.length;i>h;h++){var j=g[h];if(b===j.link.getEl().dom){var k=j.image,l=!1;if(c.QRLayer){var m=f.getEl().find("IMG").dom;m.src!=k&&(m.src=k,l=!0)}else f=c.QRLayer=new a.Layer({text:'<img src="'+k+'" width="200" height="200"/>',params:["arrRight"],renderTo:document.body,fixY:40}),l=!0;f.show(),l&&f.pointTo(b,document.body),e=!1;break}}if(e)try{f&&f.hide()}catch(n){}}function e(){}var f=a.Event,g=a.Ajax,h=$I("module.BaseView"),i=a.createClass($N("module.mbox.BrandView"));a.Object.mix(i,h,{},{QRHerf:null,QRLayer:null,getHtml:b,initQRCode:c,showQRCode:d,initialize:e})}($,window),function(a){function b(){var a=this,b=a.view;try{b.initQRCode()}catch(c){}}function c(){}function d(){return!0}function e(){}try{var f=$L("module.mbox.BrandListener"),g=$L("module.mbox.BrandView")}catch(h){return h}var i=$I("module.BaseModule"),j=a.createClass($N("module.mbox.BrandModule"));a.Object.mix(j,i,{View:g,Listener:f},{logPrefix:"brand",init:b,cache:c,reset:d,initialize:e})}($,window),function(){function a(){var a=this;return a.addHeader(null,a.getNone(),"frame-main-cont-body-second frame-main-cont-body-noToolbar")}function b(){var a='<div class="nui-infoBlock nui-block si0"><div class="nui-block-title">未选中邮件</div></div>';return a}function c(a){var b=this,c=b.module,d=c._parent,e=new $.Link({text:"取消选择",click:function(){d.view.select("none"),b.changeSelect()}}),f=[];f[f.length]='<div class="rm0">已选择 <strong>'+a.length+'</strong> 封邮件<span class="op0">'+e.html()+"</span></div>",f[f.length]='<div class="po0">';for(var g=0,h=a.length;h>g;g++){var i=a[g],j=i.getDiv(),k="",l="",m="";try{k=$.fly(j).find(".dP0").dom.innerHTML}catch(n){}try{l=$.fly(j).find(".eO0").dom.innerHTML}catch(n){}try{m=$.fly(j).find(".dd0").dom.innerHTML}catch(n){}f[f.length]='<div class="nui-infoBlock nui-block pn0"><div class="nui-block-text">',f[f.length]='<div class="ji0">'+k+"</div>",f[f.length]='<div class="jg0"><span class="nui-txt-tips">'+l+"</span></div>",m&&(f[f.length]='<div class="jf0">'+m+"</div>"),f[f.length]="</div></div>"}return f[f.length]="</div>",f.join("")}function d(){for(var a=this,b=a.module,c=b._parent,d=c.view.letters,e=c.extend("index")*c.extend("limit"),f=[],g=e,h=d.length;h>g;g++){var i=d[g];i.checked&&f.push(i)}var j=0===f.length?a.getNone():a.getSelected(f);b.getDom("ScrollDiv").innerHTML=j,$.Component.setEvents()}function e(){}var f=$I("module.BaseView"),g=$.createClass($N("module.mbox.PreviewView"));$.Object.mix(g,f,{},{getHtml:a,getNone:b,getSelected:c,changeSelect:d,initialize:e})}(),function(a){function b(){}function c(){}try{var d=$L("module.mbox.PreviewView")}catch(e){return e}var f=$I("module.BaseModule"),g=a.createClass($N("module.mbox.PreviewModule"));a.Object.mix(g,f,{View:d},{init:b,initialize:c})}($,window),function(a,b,c){function d(b,d){var e,f=this;if(b&&(f.fid=b.fid,f.group=b.group,f.viewType=b.viewType,f.isThread=b.isThread,f.area=b.area),d!==c&&(f.folderData=e=d.folderData,f.listModule=d.listModule,f.listParam=d.listParam,f.listExtend=d.listExtend,f.listUnstable=d.listUnstable,d.hidden&&(f.isHiddenMod=!0)),e===c){var g=f._var;g&&(f.folderData=e=g.folderData)}e!==c&&(f.fid=e.fid),f.isIE678=a.Browser.isIE("<9"),f.isChrome=!!a.Browser.chrome(),f._initFrameOnloadHandler(),f.userLabels={}}function e(a){var b=this,d=b.folderData;return d!==c?d.subject||"无主题":(b.textCall=a,"信件加载中")}function f(){var c=this;c.part||c.fixSibling(),c.markRead(!1),b.setTimeout(function(){c.part||c.updateTag(),(!c.isIE678||c.isThread)&&c.scroll(null,a.Function.bind(c._scrollHandler,c))},200),c.updateUserLabel()}function g(){var a=this;return a.group||a.name}function h(){try{var b={},d=this._var.param;return d!==c&&d.hidden?(a.Object.extend(b,d),delete b.hidden,delete b.moduleName,b):d}catch(e){}}function i(){var a=this,b=a.reader,c=b.body;b.notFocus=!1,a.listUnstable&&a.siblingInited&&a.fixSibling(),c.greetingCardContent&&b.assistant.bodyFilter("mail")}function j(){var c=this,d=c.reader,e=[],f=d.body;d.notFocus=!0,f.mediaContent&&e.push(function(){f.stopAllMedia()}),f.greetingCardContent&&e.push(function(){f.destroy(!0)}),e.length>0&&b.setTimeout(function(){a.Array.each(e,function(a,b){b()})},200)}function k(){var a=this;a.viewType&&a.switchIn(),$S("lastRead",a.mid||a.tid),a.markRead(!1)}function l(){var a=this;return a.viewType&&a.switchOut(),!0}function m(a){var b=this;b.part?(history.back(),"function"==typeof a&&a()):b.listParam!==c?F.entry(b.listParam,b.listExtend,a):F.entry({fid:b.fid},null,a)}function n(){var b=this;b.viewType||F.getPosition({moduleName:b.listModule,data:b.folderData,callback:function(c){var d,e,f=$C(b.createId("pre")),g=$C(b.createId("next"));return c?(d=c.pre,e=c.next,d?(b.preMail=d,f.getEl().dom.title="上一封："+a.String.escapeHTML(d.folderData.subject)):(f.setDisabled(),f.getEl().dom.title="无上一封"),e?(b.nextMail=e,g.getEl().dom.title="下一封："+a.String.escapeHTML(e.folderData.subject)):(g.setDisabled(),g.getEl().dom.title="无下一封"),b.siblingInited=!0,void 0):(f.setDisabled(),g.setDisabled(),void 0)}})}function o(a){var b=this;$E(["interface.ReadInterface"],function(c){var d,e=b[a+"Mail"];e&&(d=e.folderData,c.entry({isThread:(d.threadMessageCount||0)>1,moduleName:e.moduleName,moduleParam:e.moduleParam,moduleExtend:e.moduleExtend,folderData:d,group:b.getGroup()}))});try{b.switchOut()}catch(c){}b.log({action:"click",item:a})}function p(a){var b,c,d=this;d.isThread||(b=d[a+"Mail"],b&&(c=b.folderData,G.preload({id:c.id,fid:c.fid,locked:c.flags?c.flags.locked:!1})))}function q(){var d=this,e=d.labelHandler;if(e!==c)try{b.clearTimeout(e)}catch(f){}d.labelHandler=b.setTimeout(function(){var b=d.userLabels,c=[];a.Object.each(b,function(a,b){c.push($C(b))}),c.length>0&&$E("support.YixinSupport",function(a){a.mark(c)})},1800)}function r(a){var c,d=this,e=d.folderData;d.isHiddenMod||d.part||(c=(e.flags||{}).read)||b.setTimeout(function(){F.setRead({moduleName:d.listModule,isRead:!c,data:e,area:d.area,voidRequest:a})},300)}function s(a){var b=this,c=a.folderData||b.folderData,d={moduleName:b.listModule,data:c,fromThread:a.threadItem};if(a.threadItem&&(b.moveLock=!0),a.del){var e=c.fid;4!==e&&15!==e&&18!==e&&(d.moveToId=4)}else d.moveToId=a.toFid;F.move(d)}function t(b){var c=this;F.setSpam({isSpam:b,data:c.folderData,callback:function(){a.Tips.show({text:"成功"+(b?"举报":"信任")+"邮件",type:"suc"})}})}function u(a,b){function c(a){F.setDefer(a)}var d=this;if(a)return c(b),void 0;var e=d.folderData;(e.flags||{}).deferHandle&&e.defer?c({type:"complete",data:e}):d.showDeferPanel({type:"modify"})}function v(a){var b=this,c=b.folderData,d=a.type;$E("support.Defer",function(e){e.showMsgbox({type:d,data:{defer:c.defer,memo:c.memo,mid:b.mid,smsShow:a.smsShow,memoShow:a.memoShow},callback:function(a){b.setDefer(!0,{type:d,defer:a.defer,memo:a.memo,smsDate:a.smsDate,data:c})}})})}function w(){var b=this,c=b.folderData,d=c.flags||{},e=!d.top;F.setTop({isTop:e,moduleName:b.listModule,data:c,callback:function(c){if(c){var d=e?"成功设置":"成功取消";a.Tips.show({text:d+"邮件置顶",type:"suc"})}else a.Tips.show({text:"置顶设置失败",type:"err"});F.entry({moduleName:b.listModule,fid:b.fid})}})}function x(a){var b=this,c={moduleName:b.listModule,tag:a.value,data:b.folderData};b.isThread&&(c.single=!0),"add"===a.type&&(c.isAdd=!0),F.setTag(c)}function y(b){var c=this;if(a.Ext.tag&&"archive"!==c.area){var d=$I("init.Tag"),e=b||c.folderData,f=e.tag,g=[];f&&a.Array.each(f,function(b,e){var f,h=d.get(e);h&&(f=new a.Tag({text:d.getName(h),type:h.color,attrs:"hasClose",click:function(){c.log({action:"click",item:"icon_tag"}),F.entry({fid:0,showTag:!0,tag:[h.name]})},closeclick:a.Function.bind(c.setTag,c,{type:"remove",value:h.name})}),g.push(f.html()))}),a.fly(c.getDom("divTag")).empty().html(g.join(""))}}function z(){var b=this;a.MultiTab.remove(b),a[b.viewType?"SM":"JS"].remove(b)}function A(){var d,e=this,f=a.Element,g=b.HTMLElement;try{for(var h in e)if(d=e[h]||h,!(d instanceof a.Component))if(d instanceof f)d.destroy();else if(d instanceof g){if("container"===h)continue;d=e[h]=c}else d.module===e&&e.clean.call(d)}catch(i){}}function B(){}function C(){$S("readFraLd")===c&&$S("readFraLd",function(b,d,e){var f=a[$S("viewType")?"SM":"JS"].find(b);(null!==f||(f=a[$S("viewType")?"JS":"SM"].find(b),null!==f))&&(f.isThread?f.threadItems[e].reader.body.onLoadHandler(d):f.reader.body.onLoadHandler(d),d=c)})}var D,E,F,G;try{F=$L("interface.MboxInterface"),G=$L("interface.ReadInterface")}catch(H){return H}E=$I("module.BaseModule"),D=a.createClass($N("module.read.BaseReadModule")),a.Object.mix(D,E,null,{initialize:d,init:f,getText:e,getGroup:g,getHistoryParam:h,switchIn:i,switchOut:j,cache:k,exit:l,back:m,fixSibling:n,enterSibling:o,preloadSibling:p,updateUserLabel:q,markRead:r,moveTo:s,report:t,setDefer:u,showDeferPanel:v,setTop:w,setTag:x,updateTag:y,moduleRemove:z,clean:A,_scrollHandler:B,_initFrameOnloadHandler:C}),b.DoFSCommand=function(b){try{if("quit"===b){var c=a("div .sp0");c&&a.Array.each(c.doms,function(b,c){c=a(c),c.empty(),a(c.dom.parentNode).removeClass("oT0"),c.remove().destroy()}),c.destroy(),a.Ext.useNewAd&&a.Ud.set({field:"ntes_letter",flag:"read_ad",value:1})}}catch(d){}}}($,window),function(a,b){function c(a){this.module=a}function d(a){var b=a.param,c={id:b.mid,header:!0,returnImageInfo:!0,returnAntispamInfo:!0,autoName:!0,returnHeaders:{"Resent-From":"A",Sender:"A","List-Unsubscribe":"A","Reply-To":"A"},supportTNEF:!0};b.part&&(c.part=b.part),b.markRead&&(c.markRead=!0),"archive"===b.area&&(c.mboxa="2"),this.wmsvr({func:"mbox:readMessage",body:c,call:function(b){a.call(b)},log:{l:"read",action:"read"},cacheFlag:a.cacheFlag,hideWait:a.isHidden})}function e(a){var b=a.param;this.wmsvr({func:"mbox:decryptMessage",body:{id:b.mid,password:b.pwd,mode:"both",filterImages:!1,wmsvrlog:{action:"decryptMessage"}},ignoreError:!0,call:a.call,log:{l:"read",action:"decrypt"}})}function f(b){this.wmsvr({func:"mbox:sendMDN",body:{id:b,dispositionInfo:{mode:"manual",type:"displayed"}},call:function(b){return b.code!==a.S_OK?!0:(a.Tips.show({text:"回执发送成功",type:"suc"}),void 0)}})}function g(a){var b;switch(a.type){case"send":case"recall":b={mid:a.mid};break;case"mail":b={pid:a.mid}}this.wmsvr({func:"user:listDeliveryHistory",body:b,call:function(b){a.callback(a.type,b)}})}function h(a){this.wmsvr({func:"mbox:recallMessage",body:{mid:a.mid},call:a.callback,log:{l:"read",action:"recallMessage"}})}function i(a){this.wmsvr({func:"ntes:mbox:ynote",body:{action:"saveEmail",mid:a.mid,password:a.pwd},call:a.call,error:a.error})}function j(a){this.wmsvr({func:"global:sequential",body:{items:[{func:"mbox:saveSent","var":{id:a.fullSaveId}},{func:"mbox:deleteMessages","var":{id:a.mid}}]},ignoreError:!0,call:a.call})}function k(b){var c=$I("util.Misc").getMailSess(),d=a.Cookie.get("Coremail",!0),e={mail_id:b.mid,option:b.option||"all",NTES_SESS:c,Coremail:d,sender:b.sender,subject:b.subject,mobile:null===a.SenderList.getMobile()?0:1};b.tag&&(e.tag=b.tag),a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,rnd:!0,url:a.Uri.getUrl("smart_mailtag2",!0),body:e,call:b.call})}function l(c){a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,rnd:!0,url:a.Uri.getUrl("read_mail_service",!0)+"?uid="+c.uid+"&sender="+c.sender+"&hmid="+b.encodeURIComponent(c.hmid||"")+"&time="+c.time+"&appid=js6",call:c.call})}var m,n;n=$I("module.BaseAction"),m=a.createClass($N("module.read.ReadAction")),a.Object.mix(m,n,null,{initialize:c,readMessage:d,decrypt:e,sendReceipt:f,listDeliveryHistory:g,recallMessage:h,saveToYNote:i,saveAttachMissed:j,getSmartTag:k,getMailServiceData:l})}($,window),function(a,b,c){function d(a){var b=this;b.module=a}function e(){var a=this,b=a.module,c=!!b.viewType;return a.addHeader(c?"":a.getToolbar(),a.getContentHtml(),c?"frame-main-cont-body-noToolbar":"")+a.getOuterHtml()}function f(){var b=this;return a.Toolbar.html(b.getToolbarConf())}function g(){}function h(){return""}function i(){return""}function j(){var a=this.module;return{items:[{xtype:"button",id:a.createId("pre"),subclass:"roundBtn",icon:"prev",listeners:{mousedown:{handler:function(){a.preloadSibling("pre")}},click:{handler:function(){a.enterSibling("pre"),a.log({action:"click",item:"toolbar_pre"})}}}},{xtype:"button",id:a.createId("next"),subclass:"roundBtn",icon:"next",listeners:{mousedown:{handler:function(){a.preloadSibling("next")}},click:{handler:function(){a.enterSibling("next"),a.log({action:"click",item:"toolbar_next"})}}}}],type:"ext"}}function k(b){var d=this,e=d.module,f=e.folderData;return b=b===c?"":b+"_",a.Object.clone(x.getMenu({tag:f.tag,callback:function(a,c){a?(e.log({action:"click",item:b+"menu_tagremove"}),e.setTag({type:"remove",value:c})):(e.log({action:"click",item:b+"menu_tagadd"}),e.setTag({type:"add",value:c}))},remove:function(){e.log({action:"click",item:b+"menu_tagremoveall"}),e.setTag({type:"remove",value:null})}}))}function l(a){var b=this,c=b.module;return{width:160,groups:[{items:[{text:"回复全部",click:function(){c.log({action:"click",item:"menu_replyall"}),(a||b.module.reader).assistant.fullReply()},extText:"Shift + A"},{text:"回复全部(带附件)",click:function(){c.log({action:"click",item:"menu_replyall_attach"}),(a||b.module.reader).assistant.fullReply({withAttachments:!0})}},{text:"回复全部(新邮件)",click:function(){c.log({action:"click",item:"menu_replyall_new"}),(a||b.module.reader).assistant.reply({type:"new"})}}]}]}}function m(a){var b=this,c=b.module;return{width:120,groups:[{items:[{text:"转发",click:function(){c.log({action:"click",item:"menu_forward"}),(a||b.module.reader).assistant.forward()},extText:"Shift + F"},{text:"原信转发...",click:function(){c.log({action:"click",item:"menu_forwardtransmit"}),(a||b.module.reader).assistant.originalForward()}},{text:"作为附件转发",click:function(){c.log({action:"click",item:"menu_forwardattach"}),(a||b.module.reader).assistant.forward({asAttachment:!0})}}]}]}}function n(){for(var b,c,d=this,e=d.module,f={width:100,groups:[{items:[]},{items:[{text:"取消旗帜",icon:"flag-0",click:function(){e.log({action:"click",item:"menu_flag_clear"}),e.reader.assistant.setFlag(0)}}]}]},g=f.groups[0].items,h=1,i=a.LETTERFLAG,j=i.length;j>h;h+=1)b=i[h],c=h+"",b&&g.push({text:b,icon:"flag-"+c,extcls:"txt-flag"+c,click:a.Function.bind(function(a){e.log({action:"click",item:"menu_flag"}),e.reader.assistant.setFlag(a)},null,h)});return f}function o(){var b=this,c=b.module,d=c.folderData,e=d.flags||{},f={width:120,groups:[]},g=f.groups;if(c.isThread||g.push({items:[{text:"旗帜",menu:b.getFlagConf()}]}),"archive"!==c.area){if(!c.isThread){var h=(d.flags||{}).deferHandle&&d.defer;g.unshift({items:[{id:c.createId("toolbarSetDefer"),text:h?"设为完成":"设置待办",click:function(){c.log({action:"click",item:h?"menu_finish":"menu_defer"}),c.setDefer()}}]})}a.Ext.tag&&g.push({items:[{text:"标签",menu:{id:c.createId("toolBarTagMenu"),listeners:{render:function(){try{this.unlisten("render"),this.update(b.getTagConf())}catch(a){}}}}}]});var i=e&&e.top;g.push({items:[{id:c.createId("toolbarSetTop"),text:i?"取消置顶":"置顶邮件",click:function(){c.log({action:"click",item:i?"menu_top_clear":"menu_top"}),c.setTop()}}]})}return f}function p(b){var c=this;b=b||c.module.reader;for(var d,e={width:160,groups:[{items:[],checkType:"radio"}]},f=e.groups[0].items,g=a.READ_ENCODE,h=0,i=g.length;i>h;h+=1)d=g[h],f.push({text:d[0],checked:0===h,click:a.Function.bind(function(a){b.log({action:"click",item:"menu_charset"}),b.assistant.bodyFilter("encode",a)},null,d[1])});return e}function q(){for(var b,c,d,e,f=this,g=f.module,h={width:160,groups:[]},i=a.READ_FONT,j=[],k=h.groups,l=g.font||0,m=0,n=i.length;n>m;m+=1)b=i[m],c=b[0],d=b[1]||c,c='<span style="font-family: '+d+'">'+c+"</span>",e={text:c,checked:m===l,click:a.Function.bind(function(a){g.log({action:"click",item:"menu_font"}),g.reader.body.zoom("F",a)},null,d)},0===m&&(e.split=!0),j.push(e);return k.push({items:j,checkType:"radio"}),h}function r(){var d=this,e=d.module,f={groups:[{items:[{text:"打印邮件",click:function(){e.log({action:"click",item:"menu_printmail"}),e.reader.assistant.blankView(!0)}},{text:"查看信头",click:function(){e.log({action:"click",item:"menu_viewhead"}),e.reader.assistant.bodyFilter("header")}},{text:"查看邮件",click:function(){e.log({action:"click",item:"menu_viewmail"}),e.reader.assistant.bodyFilter("mail")}},{text:"导出邮件",click:function(){e.log({action:"click",item:"menu_download"}),e.reader.assistant.exportLetter()}},{text:"选择编码",menu:d.getCharsetConf()},{text:"选择字体",menu:d.getFontConf()}]},{items:[{text:"新窗口打开",click:function(){e.log({action:"click",item:"menu_newwin"}),e.reader.assistant.blankView()}},{text:"同主题查看",click:function(){e.log({action:"click",item:"menu_samesubject"}),e.reader.assistant.searchSameSubject()}},{text:"保存到网盘...",click:function(){e.log({action:"click",item:"menu_savetonf"}),e.reader.assistant.saveToNf()}},{text:"保存到有道云笔记...",click:function(){e.log({action:"click",item:"menu_savetonf"}),e.reader.assistant.saveToYNote()}},{text:"保存联系人...",click:function(){e.log({action:"click",item:"menu_savecontact"}),e.reader.assistant.saveContacts()}},{text:"邮件备注",click:function(){e.log({action:"click",item:"menu_memo"}),e.reader.assistant.editMemo()}}]},{items:[{text:"查词典...",click:function(){e.log({action:"click",item:"toolbar_dict"}),$E(["product.Translate"],function(a){a.change()})}}]}]},g=f.groups[1].items;return $S("isCorp")&&g.splice(2,2),a.Ext.scheduleRead&&g.push({text:"设置日程"+($S("isFree")?"管理":"提醒"),click:function(){e.log({action:"click",item:"menu_schedule"}),$E("product.Schedule",function(a){var b=e.mid,d=$S("schedule");d!==c&&d[b]?a.edit(b):a.add(b,e.folderData.subject)})}}),g=f.groups[2].items,a.Ext.readTran_enable&&3!==e.fid&&g.unshift({text:"全文翻译",click:function(){e.log({action:"click",item:"menu_trans"}),e.reader.translate({type:0})}}),$S("isFree")&&g.push({text:"人工翻译",click:function(){e.log({action:"click",item:"menu_trans_service"}),b.open(a.Uri.getUrl("trans_ad1",!0))}}),f}function s(){var b=this,d=b.module,e=d.fid,f={id:d.createId("folderMenu"),groups:[],type:"scroll"},g=f.groups,h=z.list(),i={custom:[],pop:[],system:[]};a.Array.each(h,function(a,b){if(e!==b.id){var f,g=b.flags;f=g.custom?"custom":g.pop?"pop":"system";var h=i[f];h[h.length]={text:b.name,click:function(){",2,3,4,18,7,5,15,".indexOf(","+b.id+",")?d.log({action:"click",item:"menu_move",value:b.id}):d.log({action:"click",item:"menu_move"}),d.moveTo({toFid:b.id})},icon:g.pop?{type:"folder",subtype:b.flags.iconSubtype,xtype:"icon"}:c}}});var j=[],k=!1;return a.Object.each(i,function(a,b){var c=b.length>0;k&&c&&j.push({type:"split"}),k=k||c;for(var d=0,e=b.length;e>d;d++)j.push(b[d])}),g[g.length]={items:j},g[g.length]={items:[{text:"新建文件夹并移动",click:function(){d.log("toolbar","move",2),$E("support.Folder",function(a){a.add({callback:function(a){d.log({action:"click",item:"menu_move_new"}),d.moveTo({toFid:a})}})})}}]},f}function t(){var b=this,c=b.module,d="2"===a.Ud.get({field:"ntes_option",flag:"sendershow"}),e="1"===a.Ud.get({field:"ntes_letter",flag:"read_head"}),f=0===$S("attrs").user.afterdel,g="1"===a.Ud.get({field:"ntes_option",flag:"readRange"}),h="1"!==a.Ud.get({field:"ntes_read",flag:"mail_service"}),i={extcls:"nui-settingMenu",delegateTo:"self",groups:[{items:[{text:"发/收件人显示",extText:{xtype:"checkgroup",checkType:"radio",name:"sendershow",checkedchange:function(a){c.log({action:"click",item:"menu_sendershow",value:a}),y.setAttr({field:"ntes_option",flag:"sendershow",value:a,module:"contact"})},items:[{id:c.createId("opt_send"),text:"发件人姓名",value:1,checked:!d,subclass:"btn"},{id:c.createId("opt_contact"),text:"通讯录昵称",value:2,checked:d,subclass:"btn"}]},doNotHide:!0},{text:"进行移动或删除邮件后",extText:{xtype:"checkgroup",checkType:"radio",name:"afterdel",checkedchange:function(a){c.log({action:"click",item:"menu_aftermove",value:a}),y.setAttr({field:"afterdel",value:a,module:"read"})},items:[{id:c.createId("opt_next"),text:"读下一封",value:1,checked:!f,subclass:"btn"},{id:c.createId("opt_back"),text:"返回列表",value:0,checked:f,subclass:"btn"}]},doNotHide:!0}]}]};return c.isThread||(i.groups[0].items.unshift({text:"默认显示完整/精简信息",extText:{xtype:"checkgroup",checkType:"radio",name:"read_head",checkedchange:function(a){c.log({action:"click",item:"menu_headershow",value:a}),y.setAttr({field:"ntes_letter",flag:"read_head",value:a,module:"read"})},items:[{id:c.createId("opt_fullInfo"),text:"完整信息",value:0,checked:!e,subclass:"btn"},{id:c.createId("opt_compactInfo"),text:"精简信息",value:1,checked:e,subclass:"btn"}]},doNotHide:!0}),a.Ext.read_mailService&&i.groups[0].items.push({text:"服务类邮件",extText:{xtype:"checkgroup",checkType:"radio",name:"mailservice",checkedchange:function(a){c.log({action:"click",item:"menu_range",value:a}),y.setAttr({field:"ntes_read",flag:"mail_service",value:a,module:"read"})},items:[{id:c.createId("opt_service_on"),text:"精简模式",value:0,checked:h,subclass:"btn"},{id:c.createId("opt_service_off"),text:"完整模式",value:1,checked:!h,subclass:"btn"}]},doNotHide:!0})),i.groups[0].items.push({text:"对选中内容进行转发或回复",extText:{xtype:"checkbox",name:"readRange",checked:g,subclass:"switch",text:"开启",unCheckText:"关闭",checkedchange:function(a){var b=a?1:0;
c.log({action:"click",item:"menu_range",value:b}),y.setAttr({field:"ntes_option",flag:"readRange",value:b,module:"read"})}},doNotHide:!0}),i.groups[0].items.push({gap:"before",text:"更多设置 >>",click:function(){c.log({action:"click",item:"menu_options"}),$E("interface.OptionInterface",function(a){a.entry({module:"options.BaseSetModule"})})}}),{items:[{id:c.createId("optionMenu"),xtype:"button",subclass:"roundBtn",icon:"setting",title:"快捷设置",menu:i,click:function(){c.log({action:"click",item:"toolbar_option"})}}],type:"ext"}}function u(b){var c,d=this.module,e=a.Uri.getEmails(b,"Email",!0),f=e.match;return c=f.length>0?f[0]:{name:b,address:""},("-"===c.name.substr(0,1)||"+"===c.name.substr(0,1))&&(c.defaultName=c.name=c.name.substr(1)),{email:c,popupRenderTo:this.module.container,listeners:{subAction:function(a){d.log({action:"click",item:"addr_"+a})}},hideVipIcon:!0}}var v,w,x,y,z;try{x=$L("support.Tag"),y=$L("support.OptionSupport")}catch(A){return A}z=$I("init.Folder"),w=$I("module.BaseView"),v=a.createClass($N("module.read.BaseReadView")),a.Object.mix(v,w,null,{initialize:d,getHtml:e,getToolbar:f,getToolbarConf:g,getContentHtml:h,getOuterHtml:i,getSiblingBtConf:j,getTagConf:k,getReplyConf:l,getForwardConf:m,getFlagConf:n,getMarkConf:o,getCharsetConf:p,getFontConf:q,getMoreConf:r,getFolderConf:s,getOptionConf:t,getContactConf:u})}($,window),function(a,b,c){function d(){var b,d=this,e=d.module,f=e.folderData,g=f.fid,h={groups:[]},i=h.groups,j="button";return i.push({items:[{xtype:j,text:'<span style="font-family:simsun"><< </span>返回',click:function(){e.log({action:"click",item:"toolbar_back"}),e.back(),a.Menu.hideAllMenu()}}]}),b=[{xtype:j,subclass:"splitBtn",extcls:"nui-imptBtn",text:"回复全部",menu:d.getReplyConf(),click:function(){e.log({action:"click",item:"toolbar_replyall"}),e.reader.assistant.fullReply()},arrclick:function(){e.log({action:"click",item:"toolbar_reply_arr"})}},{xtype:j,subclass:"splitBtn",text:"转 发",menu:d.getForwardConf(),click:function(){e.log({action:"click",item:"toolbar_forward"}),e.reader.assistant.forward()},arrclick:function(){e.log({action:"click",item:"toolbar_forward_arr"})}}],3===g?b.unshift({xtype:j,text:"再次编辑发送",click:function(){e.log({action:"click",item:"toolbar_sendagagin"}),$E("interface.ComposeInterface",function(a){a.edit({id:e.mid,body:{decryptPassword:"decryption"in e.reader?e.reader.decryption.pwd:c}})})}}):b.unshift({xtype:j,extcls:"nui-imptBtn",text:"回 复",click:function(){e.log({action:"click",item:"toolbar_reply"}),e.reader.assistant.reply()}}),i.push({items:b}),e.part?h:(b=[{xtype:j,text:4===g||15===g||18===g?"彻底删除":"删 除",click:function(){e.log({action:"click",item:"toolbar_del"}),e.moveTo({del:!0})}},{xtype:j,subclass:"dropdownBtn",text:"移动到",menu:d.getFolderConf(),click:function(){e.log({action:"click",item:"toolbar_move_arr"})}},{xtype:j,subclass:"dropdownBtn",text:"更 多",menu:d.getMoreConf(),click:function(){e.log({action:"click",item:"toolbar_more_arr"})}}],"archive"!==e.area&&(3===g?b.splice(3,0,{xtype:j,id:e.createId("recallBt"),text:"撤回邮件",hidden:!(a.Ext.letterRecall||a.Ext.letterRecall_vip),click:function(){e.log({action:"click",item:"toolbar_recall"}),e.reader.assistant.recall()}}):b.splice(1,0,{xtype:j,text:"举 报",click:function(){e.log({action:"click",item:"toolbar_report"}),e.report(!0)}},{xtype:j,subclass:"dropdownBtn",text:"标记为",menu:d.getMarkConf(),click:function(){e.log({action:"click",item:"toolbar_mark"})}}),",5,6,7,18,".indexOf(","+f.fid+",")>-1&&b.splice(1,0,{xtype:j,text:"信 任",click:function(){e.log({action:"click",item:"toolbar_trust"}),e.report(!1)}})),i.push({items:b}),a.Ext.yixin_in_read&&i.push({items:[{xtype:j,id:e.createId("yixin_content_favr"),subclass:"greenBtn",icon:"yixin-white",extcls:"wv0",text:"收藏",title:"收藏到易信",click:function(){e.reader.assistant.contentFavrToYiXin(),e.log({action:"click",item:"toolbar_yixin"})}}],type:"ext"}),i.push(d.getSiblingBtConf()),i.push(d.getOptionConf()),h)}function e(){var a=this,b=a.module,c=['<div class="tR0" role="list">',b.reader.view.getHtml(),"</div>",'<div class="frame-main-cont-body-mask"></div>'];return c.join("")}var f,g;try{g=$L("module.read.BaseReadView")}catch(h){return h}f=a.createClass($N("module.read.ReadView")),a.Object.mix(f,g,null,{getToolbarConf:d,getContentHtml:e})}($,window),function(a,b,c){function d(a){var b=this;return function(){b[a].apply(this.module,arguments)}}function e(){}function f(a){var b=this.reader,c=b.body.frame;a&&!c.contentWindow.document&&(c.src=c.src)}function g(){var a=this;if(!a.part)try{var b=a.view.getFolderConf();b.hidden=!0,$C(a.createId("folderMenu")).update(b)}catch(c){}}function h(){var a=this;a.part||"archive"===a.area||w.updateTagMenu.apply(a)}function i(a){var b=this;if(!b.part&&"archive"!==b.area){var c=b.folderData.tag||[];if(a)for(var d=0,e=c.length;e>d;d+=1)if(c[d]===a){c.splice(d,1);break}w.updateTagMenu.apply(b)}}function j(a){var b=this;if(!b.part){var d,e=a.list;if(e[b.tid||b.mid])x.syncData(a,b.folderData);else if("move"!==a.action)return;switch(a.action){case"flag":d=w.getHandler("setFlag");break;case"tag":"archive"!==b.area&&(d=w.getHandler("setTag"));break;case"top":d=w.getHandler("setTop");break;case"memo":d=w.getHandler("setMemo");break;case"defer":d=w.getHandler("setMemo");break;case"move":d=w.getHandler("folderMove")}d!==c&&d.apply({module:b},arguments)}}function k(){var a=this.reader,b=(a.folderData.label0||"")+"";a.isThread||(a.getDom("h1Subject").className="nui-fIBlock py0 nui-txt-flag"+b,$C(a.createId("flagHeadBt")).update(a.view.getSubjectHrefHtml("flag",!0)))}function l(){var a=this;w.updateTagMenu.apply(a)}function m(){var a=this,b=$C(a.createId("toolbarSetTop"));b!==c&&b.update({text:a.folderData.flags.top?"取消置顶":"置顶邮件"})}function n(b){var c=this.reader,d=b.action;if(c.assistant.editMemo(!0),"defer"===d&&($C(c.createId("deferHeadBt")).update(c.view.getSubjectHrefHtml("defer",!0)),!c.isThread)){var e=c.folderData,f=(e.flags||{}).deferHandle&&e.defer,g=$C(c.createId("toolbarSetDefer"));g&&g.update({text:f?"设为完成":"设置待办"});var h=c.getDom("mailService");if(h){var i=a.fly(h).find(".APP-service-hr .desc");i&&(i.doms[0].style.display=f?"none":"",i.doms[1].style.display=f?"":"none")}}}function o(a){var b=this,c=a.list,d=b.previousMail,e=b.nextMail;d&&c[d.folderData.id]||e&&c[e.folderData.id]?b.fixSibling():c[b.tid||b.mid]&&w.exitModule.apply(b)}function p(a,b,c,d,e){var f=this;!f.part&&e[f.tid||f.mid]&&w.exitModule.apply(f)}function q(a){var b=this;b.isHiddenMod&&b.fid===a&&x.syncData({action:"read",value:1},b.folderData)}function r(c){var d=this,e=d.reader,f=d.isThread;!c instanceof b.Array&&(c=[c]);for(var g,h,i,j=0,k=c.length;k>j;j+=1)if(g=c[j],h=g.flag||g.field,i=g.value,"read_head"!==h||f)if("readRange"===h)try{a.fly("#dvRangOptions").empty().remove()}catch(l){}else if("recall"!==h||f){if("mail_service"===h&&!f){var m=e.getDom("mailService");m&&e.mailServiceLoaded&&a.fly(m)["1"===i.toString()?"hide":"show"]()}}else 3===e.fid&&$C(e.createId("recallBt"))[i?"show":"hide"]();else{if(e.isThread)return;e.showHeader("1"===i.toString())}try{a.JS.displayModule===d||f||$C(d.createId("optionMenu")).update(d.view.getOptionConf().items[0])}catch(l){}}function s(b){for(var c=this,d=c.module,e=d.tid||d.mid,f=b.data.items,g=0,h=f.length;h>g;g+=1){var i=f[g],j=i.ids;if(a.Array.has(j,e)){d.moduleRemove();break}}}function t(){var a=this.reader;try{var b=a.body.frame.contentDocument,c=b.getElementById("ntes_link_color");null!==c&&(c.innerText=c.innerHTML="a: {color:#"+$G.user.color+"}")}catch(d){}}function u(){var b=this,c=b.view.getTagConf(),d=$C(b.createId("toolBarTagMenu")),e=$C(b.createId("subjectTagMenu"));c.hidden=!0,d&&d.update(c),e&&e.update(c),b.updateTag(),a.Component.setEvents()}function v(){var b=this,c=b.nextMail,d=a.JS.reqModule===b.name;0!==$S("attrs").user.afterdel&&c&&d?b.enterSibling("next"):d&&b.back(function(){b.remove()})}var w,x;try{x=$L("interface.MboxInterface")}catch(y){return y}w=a.createClass($N("module.read.ReadHandler")),a.Object.extend(w,{getHandler:d,resize:e,network:f,folder:g,tagModify:h,tagRemove:i,letterUpdate:j,setFlag:k,setTag:l,setTop:m,setMemo:n,folderMove:o,setSpam:p,setAllRead:q,options:r,rollback:s,skin:t,schedule:n,updateTagMenu:u,exitModule:v})}($,window),function(a){var b,c,d;try{d=$L("module.read.ReadHandler")}catch(e){return e}c=$I("module.BaseListener"),b=a.createClass($N("module.read.ReadListener")),a.Object.inherit(b,c,{_listeners:{"global:resize":{handler:d.getHandler("resize")},"global:network":{handler:d.getHandler("netWork")},"folder:add":{handler:d.getHandler("folder")},"folder:modify":{handler:d.getHandler("folder")},"folder:remove":{handler:d.getHandler("folder")},"tag:add":{handler:d.getHandler("tagModify")},"tag:modify":{handler:d.getHandler("tagModify")},"tag:remove":{handler:d.getHandler("tagRemove")},"letter:update":{handler:d.getHandler("letterUpdate")},"letter:setspam":{handler:d.getHandler("setSpam")},"letter:allread":{handler:d.getHandler("setAllRead")},"letter:rollback":{handler:d.getHandler("rollback")},"options:readModify":{handler:d.getHandler("options")},"options:skinChange":{handler:d.getHandler("skin")},"schedule:insert":{handler:d.getHandler("schedule")}}})}($,window),function(a,b,c){function d(a){var b=this;b.reader=a}function e(){var b,c=this,d=c.reader,e=d.folderData,f="1"===a.Ud.get({field:"ntes_letter",flag:"read_head"}),g="",h="",i=[' style="display:none"',""];d.module.resourcePreloaded?(h=c.getFullHeadHtml(),d.fullHeaderInited=!0,f&&(g=c.getCompactHeadHtml(),d.compactHeaderInited=!0,i.reverse())):f?(g=c.getTempCompactHeadHtml(),i.reverse()):h=c.getTempFullHeadHtml();var j="";e.composeExtra&&e.composeExtra.showOneRcpt&&(j=" fM1");var k=d.isServiceMail&&d.isMailServiceAvailable()?' style="display:none;"':"";return b=['<div id="'+d.createId("dvReadHeadInfo")+'" class="sI0 nui-bg-light'+(d.viewType?" jO0":"")+'">',d.isThread?"":c.getSubjectHtml(),'<div class="ow0'+j+'">','<ul id="'+d.createId("ulCompact")+'"'+i[0]+' role="listitem" tabindex="0">',g,"</ul>",'<ul id="'+d.createId("ulFull")+'"'+i[1]+' role="listitem" tabindex="0">',h,"</ul>","</div>",'<div id="'+d.createId("dvHeaderLinks")+'" class="oe0">',c.getHeaderLinkHtml(),d.isThread||d.viewType?a.Toolbar.html(c.getSimpleToolbarConf()):"","</div>","</div>",'<div class="nui-split nui-split-cDark sK0 lB0"></div>','<div id="'+d.createId("dvBlockInfo")+'" style="display:none" title="提示区" aria-label="提示区" role="listitem" tabindex="0"></div>','<div class="nu0">',c.getMailServiceHtml(),'<div id="'+d.createId("dvContent")+'" class="nui-fClear sR0"'+k+">",c.getFrameHtml(),"</div>","</div>",c.getAD(!0),'<div class="lY0">','<div id="'+d.createId("dvAttach_reply")+'" class="sz0 nui-bg-light nui-bdr-light">','<a name="'+d.createId("aAttachTag")+'"></a>',c.getAttachListHtml(),'<div class="sw0" id="'+d.createId("dvReply")+'" tabindex="0" title="快捷回复区" aria-label="快捷回复区" role="listitem">',c.getReplyHtml(),"</div>","</div>","</div>",c.getBottomAD()],d.isThread||d.module.isIE678||b.push('<div id="'+d.createId("dvZoom")+'" class="sF0"'+k+">",c.getZoomHtml(),"</div>"),b.join("")}function f(c){var d,e,f,g,h,i=this,j=i.reader,k=j.data,l=k.from,m=k.to||[],n=k.cc||[],o=[],p=c?" ":"&nbsp;",q=j.module.userLabels;for(m="string"==typeof m?[m]:m,n="string"==typeof n?[n]:n,h=m.concat(n),e=0,f=h.length;f>e;e+=1){var r=j.module.view.getContactConf(h[e].toString());r.extcls="nui-txt-cLink",r.id="compactLabel"+e,o.push(c?r.email.name||r.email.address:a.UserLabel.html(r)),q[r.id]=r.id}l=l instanceof b.Array?l[0]:l.toString();var s=p+"于"+p+i.getCompactDateStr()+p+"发给"+p+o.join("、");return c?l+s:(j.isThread&&(s="<p><span>"+s+"</span></p>"),g=j.module.view.getContactConf(l),g.id="compactLabelFrom",d=['<li class="ig0 dM0">','<div class="hX0">','<div class="cc1">','<strong class="nui-txt-suc">'+a.UserLabel.html(g)+"</strong>",s,"</div>",i.getAttachHtml(!0),"</div>","</li>"].join(""),q[g.id]=g.id,d)}function g(){var a=this;return[a.getMemoHtml(),a.getSenderHtml(),a.getReceiverHtml(),a.getDateHtml(),a.getAttachHtml()].join("")}function h(){var c=this,d=c.reader,e=d.folderData,f=e.from||"";return f=(f instanceof b.Array?f[0]:f).toString(),['<li class="ig0 dM0">','<div class="hX0">','<div class="cc1">','<strong class="nui-txt-suc">'+a.String.escapeHTML(V.getName(d.module.view.getContactConf(f).email))+"</strong>","&nbsp;于&nbsp;"+c.getCompactDateStr()+"&nbsp;发给&nbsp;"+a.String.escapeHTML(e.to||""),"</div>","</div>","</li>"].join("")}function i(){var c=this,d=c.reader,e=d.folderData,f=e.from||"";return f=(f instanceof b.Array?f[0]:f).toString(),['<li class="ig0 ew0">','<div class="iI0">发件人：</div>','<div class="hX0">',a.String.escapeHTML(d.module.view.getContactConf(f).email.toString()),"</div>","</li>",'<li class="ig0 fD0">','<div class="iI0">收件人：</div>','<div class="hX0">',a.String.escapeHTML(e.to||""),"</div>","</li>",c.getDateHtml()].join("")}function j(){var b=this,c=b.reader,d=c.module,e="";if(c.isServiceMail&&c.isMailServiceAvailable()){var f=c.folderData,g=(f.flags||{}).deferHandle&&f.defer;e=['<link href="http://mimg.127.net/xm/webmail/app-service/'+$G.environment.mailServiceVer+'/css/app_service.css" rel="stylesheet" type="text/css">','<div id="'+c.createId("mailService")+'" class="APP-service" style="display:none;">',"<div></div>",'<div class="APP-service-hr" style="display:none;">','<span class="desc" style="display:'+(g?"none":"")+'">','<a target="_blank" href="http://help.mail.163.com/feedback.do?m=add&categoryName=webmail%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%8C%96">意见反馈</a>','<span class="split">|</span>','<span class="alert"><i class="ico-clock"></i>',a.Link.html({text:"为此邮件设置待办提醒",cls:"nui-txt-link",click:function(){d.setDefer(),d.log({action:"click",item:"service_defer"})}}),"</span>",'<span class="split">|</span>','<span class="content">以下为原邮件</span>',"</span>",'<span class="desc" style="display:'+(g?"":"none")+'">以下为原邮件</span>',"</div>","</div>"].join("")}return e}function k(c){var d=this,e=d.reader,f="",g=400,h=e.locked;if(e.speed&&!h)d.mimFrameHeight=g;else if(h&&!c)f='<div style="height:'+g+'px;"></div>';else{var i,j=e.createId("frameBody"),k=e.getFrameUrl(),l=" onload=\"$S('readFraLd')('"+e.module.name+"', this"+(e.isThread?", '"+e.threadToken+"'":"")+');"';if(a.Browser.chrome())i=240;else try{i=(document.documentElement.clientHeight||document.body.clientHeight)-414,i=b.Math.max(i,400)}catch(m){i=400}d.mimFrameHeight=i,f='<iframe id="'+j+'" name="'+j+'" class="oD0"  frameborder="0" src="'+k+'" style="height:'+i+'px"'+l+"></iframe>"}return f}function l(a){var b,c=this,d=c.reader,e="",f="";return d.commonAttached&&(e=['<div id="'+d.createId("dvAttachHead")+'"  class="sa0"></div>','<div class="rY0" style="display:none;margin-bottom:15px">','<ul id="'+d.createId("ulCommonAttachItem")+'" class="qs0 nui-fClear"></ul>',"</div>"].join("")),d.cloudAttached&&(f=['<div id="'+d.createId("dvCloudAttachHead")+'" class="sa0"></div>','<div class="rY0" style="display:none;">','<ul class="qs0 nui-fClear" id="'+d.createId("ulCloudAttachItem")+'"></ul>',"</div>"].join("")),b=[e,f,'<div class="nui-split nui-split-cDark"></div>'].join(""),a?(d.getDom("dvAttachBody").innerHTML=b,void 0):['<div id="'+d.createId("dvAttachBody")+'" class="tn0" style="display:none;" tabindex="0">',b,"</div>"].join("")}function m(b,c){var d,e,f,g=this,h=g.reader,i='<div class="nui-split sK0"></div>';return c?(d="nui-ico-bigAtt",e="云附件",f=i):(d="nui-ico-att",e="附件",f=[b>1?"&nbsp;"+a.Link.html({id:h.createId("downloadAllLink"),text:"打包下载",title:"下载全部"+b+"个附件",link:a.Uri.getUrl("read_pack",!0)+"&mid="+h.mid+"&part="+h.attach.commonId.join("&part="),target:"downloadFrame",cls:"nui-txt-link jh0",listeners:{click:{handler:function(){h.log({action:"click",item:"attach_downloadall"})}}}}):"","</div>",'<div class="nui-split sK0"></div>',b>5?['<div class="rf0">','<div id="_mail_toolbar_1_300" class="js-component-toolbar nui-toolbar ">','<div class="nui-toolbar-item">',a.Link.html({id:h.createId("sortLink"),text:'附件排序(默认)<b class="nui-ico nui-ico-downArr">d</b>',cls:"nui-txt-link",click:function(){h.log({action:"click",item:"attach_sort"})},listeners:{render:function(){new a.Menu({groups:[{checkType:"radio",items:[{text:"按上传顺序排序(默认)",checked:!0,click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("",this.rawConfig.text)}},{text:"按附件类型排序",click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("type",this.rawConfig.text)}},{text:"按附件从小到大",click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("size",this.rawConfig.text)}},{text:"按附件从大到小",click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("size",this.rawConfig.text,!0)}},{text:"按附件名升序",click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("name",this.rawConfig.text)}},{text:"按附件名降序",click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("name",this.rawConfig.text,!0)}}]}],width:155}).attachTo({clickFrom:this.getEl(),renderTo:h.getDom("ScrollDiv"),reverse:!0})}}}),"</div>","</div>","</div>"].join(""):""].join("")),['<div class="ox0">','<b class="nui-ico '+d+'"></b>','<strong class="jU0">'+e+'<span class="nui-txt-s12 nui-txt-tips" style="font-weight:normal">&nbsp;('+b+")</span></strong>",f].join("")}function n(b){var c,d,e,f,g,h,i,j,k=this,l=k.reader,m=a.String.escapeHTML(b.filename),n=b.imagesrc,o=b.icon,p="string"==typeof n,q=a.Link,r="cK0",s=r+" bJ0",t='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 W0" /><br />下载',u='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 X0" /><br />打开',v='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 V0" /><br />预览',w='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 bv3" /><br />编辑',x='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 Z0" /><br />存网盘',y="",z='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 H1" /><br />收藏',A='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bD0 bb1" /><br />分享&nbsp;&nbsp;<b class="nui-ico bD0 bk2"></b>';j=p?'<img src="'+n+'" style="display:none" onload="$S(\'thumbnailHandler\')(this);" onerror="$S(\'thumbnailHandler\')(this, true, \''+a.String.escapeHTML(b.mime)+"');\" ></img>":a.Icon.html({type:"file75",subtype:o}),b.isCommon?(c=q.html({text:t,link:b.download,cls:r,target:"downloadFrame",listeners:{click:{handler:function(){l.log({action:"click",item:"attach_download"})}}}}),"9"===o&&b.eml?d=q.html({text:u,cls:r,click:function(){l.log({action:"click",item:"attach_open"}),a.fly(l.getDom(b.id)).removeClass("nui-bdr-item nui-bg-item fM0"),$E(["interface.ReadInterface"],function(a){l.module._frameCtrlNoDelete=!0,a.entry(b.eml)})}}):b.open&&(d=q.html({text:u,cls:r,link:b.open,target:"_blank",listeners:{click:{handler:function(){l.log({action:"click",item:"attach_open"})}}}})),b.localPreview&&(e=p?q.html({text:v,cls:r,click:function(){l.log({action:"click",item:"attach_preview"}),b.previewHandler(b.imageIndex)}}):q.html({text:v,cls:r,link:b.preview,target:"_blank",listeners:{click:{handler:function(){l.log({action:"click",item:"attach_preview"})}}}})),b.editHandler&&(f=q.html({text:w,cls:r,click:function(){l.log({action:"click",item:"attach_Edit"}),b.editHandler()}})),b.saveToNfHandler&&(g=q.html({text:x,cls:r,click:function(){l.log({action:"click",item:"attach_saveNF"}),b.saveToNfHandler()}})),a.Ext.yixin_in_read&&(p?(h=q.html({text:z,title:"将图片收藏到易信",cls:r+" bH1",disabled:!p,tabdisabled:"false",click:function(){l.assistant.imageFavrToYiXin(b.id),l.log({action:"click",item:"attach_favr"})}}),i=q.html({text:A,title:"将图片分享到易信",cls:r+" bH1",disabled:!p,tabdisabled:"false",click:function(){l.log({action:"click",item:"attach_share"})},listeners:{render:function(){var c=this.getEl(),d=new a.Menu(l.view.getImageShareMenu(b.id));d.attachTo({clickFrom:c,renderTo:c.findParent("li"),reverse:!0}),c.set("YXMenu",d)}}})):(h=q.html({text:z,cls:s+" bH1"}),i=q.html({text:A,cls:s+" bH1"})))):b.isCloud?(b.download&&(c=q.html({text:t,link:b.download,cls:r,target:"_blank"})),b.preview&&!$S("isCorp")&&(e=q.html({text:v,cls:r,link:b.preview,target:"_blank"})),y=['<div class="el0">','<span class="nui-txt-tips cy0">('+b.expireText+")</span>","</div>"].join(""),d=f=g=""):b.isDecrypt&&(c=q.html({text:t,cls:r,link:b.download,target:"ifrDownUrl"})),c=c||q.html({text:t,cls:s}),e=e||q.html({text:v,cls:s}),b.isCloud||(d=d||q.html({text:u,cls:s}),g=g||q.html({text:x,cls:s}),f=f||q.html({text:w,cls:s}));var B="";return a.Ext.yixin_in_read?B=a.Ext.attach_online_modify?" gN2":" fd1":a.Ext.attach_online_modify&&(B=" gO1"),['<li id="'+l.createId(b.id)+'" class="lh0 '+(b.isCloud?"gl0":"")+'" tabindex="0">',"<table>","<tbody>","<tr>",'<td class="eG0">','<div class="cf0">',j,"</div>","</td>","</tr>","<tr>",'<td class="gx0">','<strong class="dh0">'+m+"</strong>",'<span class="nui-txt-tips di0">'+b.size+"</span>",y||"",'<div class="ey0'+B+'">','<div class="dn0">','<div class="dw1 bR1"></div>','<div class="dw1 bC2"></div>','<div class="dw1 bI1"></div>',"</div>",'<div class="dp0 nui-fClear">','<div class="dw1 bR1"></div>','<div class="bU1">','<div class="cg0">'+m+"</div>",c,d,e,a.Ext.attach_online_modify?f:"",a.Ext.netfolder_enable?g:"",h,i,"</div>",'<div class="dw1 bI1"></div>','</div><div class="dj0"><div class="dw1 bR1"></div>','<div class="dw1 bC2"></div>','<div class="dw1 bI1"></div>',"</div></div></td></tr></tbody></table></li>"].join("")}function o(){var d=this,e=d.reader,f="快捷回复",g=f+"（按Ctrl+Enter键发送）",h={renderTo:e.createId("dvReplyBts"),id:e.createId("sendBt"),text:"&nbsp;&nbsp;发&nbsp;送&nbsp;&nbsp;",subclass:"mainBtn",click:function l(){e.log({action:"send",item:"body_reply"});var b=$C(e.createId("replyInput")),c=$C(e.createId("replyTip")),d=$C(e.createId("replyRetryLink")),f=$C(e.createId("sendBt")),g=$C(e.createId("cancelBt")),h=a.String.trim(b.getValue());return 0===h.length?(a.Msgbox.show({header:"系统提示",content:"回复内容为空，请重新输入后重试。",ok:function(){b.focus()}}),void 0):($C(e.createId("sendBt")).update({text:"发送中",icon:"loading",click:function(){}}),g.setDisabled(),e.assistant.reply({type:"simple",content:h,call:function(b){var h,i=e.getDom("dvReplyBts"),j=e.getDom("spanReplyNbsp"),k={renderTo:i,text:"再回一封邮件",cls:"lc0 nui-txt-link",click:function(){this.hide(),c.hide(),f.update({text:"&nbsp;&nbsp;发&nbsp;送&nbsp;&nbsp;",icon:null,click:l}),f.show(),g.setDisabled(!1),g.show(),j.style.display="",$C(e.createId("replyInput")).setValue(""),e.getDom("dvReplyInputs").style.display="",e.getDom("fullReplyLink").style.display=""}};j.style.display="none",b?(h={text:"邮件发送成功！",type:"suc",tabindex:"0",hidefocus:"hidefocus"},e.getDom("dvReplyInputs").style.display="none"):(h={text:"抱歉，邮件发送失败",type:"err",tabindex:"0",hidefocus:"hidefocus"},k.text="立即重试",k.click=function(){$C(e.createId("sendBt")).fire("click")}),f.hide(),g.hide(),e.getDom("fullReplyLink").style.display="none",c?(c.update(h),c.show(),c.getEl().dom.focus()):(h.renderTo=i,h.id=e.createId("replyTip"),h.subclass="normalTips",c=new a.Label(h),c.getEl().dom.focus()),d?(d.unlistenAll(),d.update(k),d.listen("click",k.click),d.show()):(k.id=e.createId("replyRetryLink"),d=new a.Link(k))}}),void 0)}},i={renderTo:e.createId("dvReplyBts"),id:e.createId("cancelBt"),text:"&nbsp;&nbsp;取&nbsp;消&nbsp;&nbsp;",click:function(){e.log({action:"cancel",item:"body_reply"});var a=$C(e.createId("replyInput"));a.setValue(""),a.getInputEl().attr("style",""),a.getEl().removeClass("fK0"),e.getDom("dvReplyBts").style.display="none",e.getDom("dvAttach_reply").parentNode.style.height="auto",a.showPlaceholder(),d.replyUnfold=!1,a=c}},j={text:"完整模式回复",cls:"nui-txt-link",click:function(){e.log({action:"click",item:"body_fullreply"}),e.assistant.fullReply({type:"fragment",content:a.String.trim($C(e.createId("replyInput")).getValue())})}},k={id:e.createId("replyInput"),subclass:"multiLineIpt",extcls:"nf0",placeholder:f,ariaLabel:g,title:g,focus:function(){if(!d.replyUnfold){var f=this;e.getDom("dvReplyBts").style.display="";try{e.getDom("fullReplyLink").style.display=""}catch(g){}if(!e.isThread){var k=e.getDom("dvAttach_reply").parentNode;k.style.height=k.offsetHeight+116+"px",e.getDom("ScrollDiv").scrollTop+=161,k=c}b.setTimeout(function(){f.getEl().addClass("fK0")},150);var l=$C(e.createId("sendBt")),m=$C(e.createId("cancelBt"));l?(l.show(),m.show()):(new a.Button(h),a.fly(e.getDom("dvReplyBts")).append('<span id="'+e.createId("spanReplyNbsp")+'">&nbsp;&nbsp;<span>'),new a.Button(i),a.fly(e.getDom("dvReplyBts")).append(['<div id="'+e.createId("fullReplyLink")+'" class="le0">','<div class="hl0">',a.Link.html(j),"</div>","</div>"].join(""))),f.hidePlaceholder(),d.replyUnfold=!0,e.log({action:"active",item:"body_reply"})}},enter:function(){var b,c=a.Event.getEvent();c&&c.ctrlKey&&(b=$C(e.createId("sendBt")),b&&b.fire("click"))},keyup:function(){var a=this.getInputEl().dom,b=a.scrollHeight,c=a.offsetHeight;if(b>c)if(400>=b){a.style.overflow="hidden",a.style.height=b+"px";var d=e.getDom("ScrollDiv");d.scrollTop+=b}else a.style.overflow="auto"}};return['<div id="'+e.createId("dvReplyInputs")+'" class="qB0">',a.Input.html(k),"</div>",'<div id="'+e.createId("dvReplyBts")+'" class="qG0" style="display:none"></div>'].join("")}function p(){var b=this,c=b.reader,d="roundBtn",e="-1",f=a.Button;return['<div id="'+c.createId("dvReadZoom")+'" class="sF0">','<div id="'+c.createId("backToTop")+'" class="qc0 qM0" style="display:none;">',f.html({subclass:d,icon:{type:"backToTop"},extcls:"oI0",title:"返回顶部",tabindex:e,click:function(){c.log({action:"click",item:"backtotop"}),c.getDom("ScrollDiv").scrollTop=0,this.getEl().dom.parentNode.style.display="none",c.log({action:"click",item:"body_top"})}}),"</div>",'<div id="'+c.createId("showZoomBt")+'" class="qc0 me0">',f.html({subclass:d,icon:{type:"zoomIn"},extcls:"nw0",title:"展开缩放工具",tabindex:e,click:function(){c.getDom("showZoomBt").style.display="none",c.getDom("zoomBts").style.display="",c.log({action:"click",item:"body_zoom",value:0})}}),"</div>",'<div id="'+c.createId("zoomBts")+'" class="qc0 nv0" style="display:none;">',f.html({subclass:d,icon:{type:"bigPlus"},extcls:"ke0",title:"放大显示正文文字",tabindex:e,click:function(){c.body.zoom("I"),c.log({action:"click",item:"body_zoom"})}}),f.html({subclass:d,icon:{type:"original"},extcls:"mM0",title:"还原显示正文文字",tabindex:e,click:function(){c.body.zoom("R"),c.log({action:"click",item:"body_zoom"})}}),f.html({subclass:d,icon:{type:"bigMinus"},extcls:"jA0",title:"缩小显示正文文字",tabindex:e,click:function(){c.body.zoom("O"),c.log({action:"click",item:"body_zoom"})}}),f.html({subclass:d,icon:{type:"bigClose"},extcls:"mN0",title:"隐藏缩放工具",tabindex:e,click:function(){c.getDom("showZoomBt").style.display="",c.getDom("zoomBts").style.display="none"}}),"</div>","</div>"].join("")}function q(){var b,c=this,d=c.reader,e=d.folderData,f=e.subject||"无主题",g=d.createId("h1Subject"),h=e.label0?" nui-txt-flag"+e.label0:"",i="archive"!==d.area,j='<h1 id="'+g+'" class="nui-fIBlock py0'+h+'" role="listitem" tabindex="0" title="邮件标题" aria-level="1">'+a.String.escapeHTML(f)+"</h1>",k="";return d.part?b=c.getSubjectHrefHtml("print"):(a.Ext.tag&&!d.isThread&&i&&(j+='<div id="'+d.createId("divTag")+'" class="nui-fIBlock lF0"></div>',k=c.getSubjectHrefHtml("tag")),b=[c.getSubjectHrefHtml("flag"),i?c.getSubjectHrefHtml("defer"):"",c.getSubjectHrefHtml("print")].join("")),['<div class="rB0">',j,'<div class="nui-fIBlock oB0" role="toolbar">',k,b,"</div>","</div>"].join("")}function r(){return['<li class="ig0 eu0">','<div class="iI0">时&nbsp;&nbsp;&nbsp;间：</div>','<div class="hX0">'+this.getDateStr()+"</div>","</li>"].join("")}function s(){var c,d,e=this,f=e.reader,g=f.folderData,h=g.from,i=f.data.headers,j=i["Resent-From"],k=i.Sender,l="";if(!h)return f.from=["发件人"],f.localSender=[],['<li class="ig0 ew0">','<div class="iI0">发件人：</div>','<div class="hX0">（无）</div>',"</li>"].join("");if(h=(h instanceof b.Array?h[0]:h).toString().replace(/^"[+|-]/,'"'),f.from=[h],c=f.module.view.getContactConf(h),d=c.email,f.localSender=[d],j instanceof b.Array&&j.length>0)l="由 "+a.String.escapeHTML(j.join(","))+" 转发";else{var m=g.ctrls&&"ntessale"===g.ctrls.RulesType||f.data.antispamInfo&&"ntessale"===f.data.antispamInfo.RulesType;if(!m&&k instanceof b.Array&&k.length>0&&h.length>0){var n=k[0];d.address!==a.Uri.getAddress(n)&&(l="由 "+a.String.encodeHTML(n)+" 代发&nbsp;,&nbsp;"+a.Link.html({link:"sender_help",text:"帮助",target:"_blank",cls:"txt-info"}))}}return l.length>0&&(l='<span class="cP0">('+l+")</span>"),['<li class="ig0 ew0">','<div class="iI0">发件人：</div>','<div class="hX0">',a.Addr.html(c),l,"</div>","</li>"].join("")
}function t(){var b=this,c=b.reader,d=c.data,e=c.folderData,f=c.fid,g=[],h={to:"收件人",cc:"抄送人"};3===f&&(h.bcc="密送人",e.composeExtra&&e.composeExtra.showOneRcpt&&(h.to="群发单显"));var i=c.localReceiver=[];return a.Object.each(h,function(b,e){var f=[],h="",j=d[b]||[];if(0!==j.length||"to"===b){j="string"==typeof j?[j]:j;var k=j.length;k>0&&(c[b]=j);for(var l=0;k>l;l+=1){var m=c.module.view.getContactConf(j[l]);l>4&&(m.hidden=!0),f.push(a.Addr.html(m)),i.push(m.email)}if(l>0&&"bcc"===b&&f.push('<span id="_mail_label_0_439" class="js-component-label nui-txt nui-txt-info  ">(密送人仅在已发送文件夹显示，对发件人可见。)</span>'),l>5){var n="nui-txt-link",o="dt0";h=[a.Link.html({id:c.createId("addrMoreLink"+b),text:"&darr;还有"+(k-5)+"个联系人",cls:n,spancls:o,click:function(){var d=a.fly(c.getDom("dvRead"+b)).find(".nui-addr").doms;this.hide(),$C(c.createId("addrLessLink"+b)).show();for(var e=5;k>e;e+=1)d[e].style.display=""}}),a.Link.html({id:c.createId("addrLessLink"+b),text:"&uarr;隐藏信息",cls:n,spancls:o,hidden:!0,click:function(){var d=a.fly(c.getDom("dvRead"+b)).find(".nui-addr").doms;this.hide(),$C(c.createId("addrMoreLink"+b)).show();for(var e=5;k>e;e+=1)d[e].style.display="none"}}),a.Link.html({text:"保存所有"+e,cls:n,spancls:o,click:function(){c.assistant.saveContacts(b)}})].join("")}g.push(['<li id="'+c.createId("liReadOut"+b)+'" class="ig0 fD0">','<div class="iI0">',e,"：</div>",'<div id="'+c.createId("dvRead"+b)+'" class="hX0">',f.join("")||"（无）",h,"</div>","</li>"].join(""))}}),g.join("")}function u(a){var b=this,c=b.reader;return c.attached||"fullSaveId"in c.folderData?(a?['<div id="'+c.createId("attachInfo_compact")+'" class="cF1">','<b class="nui-ico nui-ico-att"></b>&nbsp;',b.getAttachInfoHtml(a),"</div>"]:['<li class="ig0 fw0">','<div class="iI0">附&nbsp;&nbsp;&nbsp;件：</div>','<div id="'+c.createId("attachInfo_full")+'" class="hX0">',b.getAttachInfoHtml(a),"</div>","</li>"]).join(""):""}function v(b){var c=this,d=c.reader,e=d.cloudAttachments;if(d.cloudAttached&&!e&&!d.commonAttached&&!d.isDecrypted)return"";var f,g=d.folderData,h=(d.data.attachments||[]).concat(e||[]),i=h.length,j="";if(f=i,f>0){if(b)j=a.Link.html({text:(f?f+"个":"")+"附件",title:"点击查看附件",cls:"nui-txt-link",click:function(){d.log({action:"click",item:"head_attach"}),d.attach.skipToList()}});else{var k="",l="未命名附件",m="",n=0;for((i>1||d.commonAttached&&d.cloudAttached)&&(k="等");i>n;){if(l=a.String.trim(h[n].filename||""),l.length>0){l=l.split(String.fromCharCode(92)).pop();break}n+=1}var o=a.String.left(a.String.escapeHTML(l),50);m="共有"+o+k+f+"个附件，点击查看",j=['<span class="nui-txt-normal">'+f+"个 "+(g.fullSaveId?"云附件":"")+"</span>",'<span class="txt-info">',"(<span>",a.Icon.html({type:"file",subtype:X.getSubtype({type:"file",name:l})}),o,"</span> ",k,")</span>","<span> ",a.Link.html({text:"查看附件",title:m,cls:"nui-txt-link",click:function(){d.log({action:"click",item:"head_attach"}),d.attach.skipToList()}}),"</span>"].join("")}j=["<span >","</span>"].join(j)}return 3===g.fid&&"fullSaveId"in g&&(j+=c.getUnSavedInfo(b)),j}function w(){var a=this,b=a.reader,c=a.getBacklogHtml(),d=a.getMemoTextHtml(),e=c.length&&d.length?'<div class="dr0"></div>':"";return['<li id="'+b.createId("memo")+'" class="gS0 nui-assistBlock"'+(c.length||d.length?"":' style="display:none"')+">",'<div id="'+b.createId("backlog")+'"'+(c.length?"":' style="display:none"')+">",c,"</div>",e,'<div id="'+b.createId("memoText")+'" class="dJ0"'+(d.length?"":' style="display:none"')+">",d,"</div>",'<div id="'+b.createId("memoEditor")+'" class="dJ0" style="display:none"></div>',"</li>"].join("")}function x(){var b,d,e,f=this,g=f.reader,h=[],i=g.mid,j=g.folderData,k=j.flags||{},l=j.defer;return k.deferHandle&&l!==c?(d=$S("schedule"),e=a.Ext.scheduleMbox&&d!==c&&d[i],b=['<div id="'+g.createId("backlog_defer")+'" class="dJ0">','<div class="cm0"><b class="nui-ico nui-ico-todo nui-ico-todo-selected" title="待办邮件"></b></div>','<div class="bZ0">','<div class="er1">已设为待办邮件，'+a.Date.format(l,"yyyy年MM月dd日")+"处理&nbsp;",a.Link.html({text:"修改",cls:"nui-txt-link",click:function(){g.module.showDeferPanel({type:"modify"})}}),e||!a.Ext.scheduleRead?"":a.Link.html({text:"短信提醒我处理",cls:"nui-txt-link",click:function(){g.module.showDeferPanel({type:"modify",smsShow:!0})}}),"</div>",'<div class="ce0">',a.Button.html({text:"设为完成",subclass:"smallMainBtn",icon:{type:"done",subtype:"white"},subType:"white",click:function(){g.module.setDefer()}}),"</div>","</div>","</div>"],e&&(h=['<div class="dr0"></div>','<div id="'+g.createId("backlog_mag")+'" class="dJ0">','<div class="cm0"><b class="nui-ico nui-ico-smsRemind"></b></div>','<div class="bZ0">','<div class="er1">已设置短信提醒&nbsp;',a.Link.html({text:"修改",cls:"nui-txt-link",click:function(){$E("product.Schedule",function(a){a.edit(g.mid)})}}),"</div>","</div>","</div>"]),b.join("")+h.join("")):""}function y(b){var c=this,d=c.reader;return b=a.String.trim(b||d.folderData.memo||""),b.length>0?['<div class="cm0"><b class="nui-ico nui-ico-remark-xs" title="邮件备注"></b></div>','<div class="bZ0">','<div class="er1">',a.String.escapeHTML(b),"</div>",'<div class="dI0">',a.Link.html({text:"编辑",cls:"nui-txt-link",click:function(){d.assistant.editMemo()}}),"&nbsp;&nbsp;",a.Link.html({text:"删除",cls:"nui-txt-link",click:function(){a.Msgbox.show({type:"confirm",title:"删除确认",content:"您确定要删除该邮件的备注吗？",ok:function(){d.assistant.setMemo({del:!0,value:""})}})}}),"</div>","</div>"].join(""):b}function z(){var b=this,c=b.reader;return[a.Input.html({id:c.createId("memoInput"),subclass:"multiLineIpt",extcls:"bV0",inputClass:"K0",value:a.String.trim(c.folderData.memo||""),listeners:{keyup:function(){var b=a.String.trim(this.getValue()),d=b.length;c.getDom("memoInfo").innerHTML=d>100?"您已输入 <strong>"+d+'</strong> 字，<span class="nui-txt-err">请删除 <strong>'+(d-100)+"</strong> 字</span>":"您已输入 <strong>"+d+"</strong> 字，还能输入 <strong>"+(100-d)+"</strong> 字"}}}),'<div class="cd1">',a.Button.html({text:"确定",subclass:"mainBtn",extcls:"bt0",click:function(){var b=a.String.trim($C(c.createId("memoInput")).getValue()),d=b.length;return 0===d||d>100?(a.Msgbox.show({header:"系统提示",content:0===d?"请输入备注内容后重试。":"您输入的文字多于<strong>100</strong>个字符，请删除<strong>"+(d-100)+"</strong>个字符后重试。",ok:function(){$C(c.createId("memoInput")).focus()}}),void 0):b===c.folderData.memo?(c.assistant.editMemo(!0),void 0):(c.assistant.setMemo({type:"edit",value:b}),void 0)}}),"&nbsp;&nbsp;",a.Button.html({text:"取消",extcls:"bt0",click:function(){c.assistant.editMemo(!0)}}),'<span id="'+c.createId("memoInfo")+'" class="bv0"></span>',"</div>"].join("")}function A(b){var c=this,d=c.reader;if(b)return[a.Icon.html({type:"glasses"}),a.Link.html({cls:"nui-txt-link",text:"优化阅读",click:function(){try{a.fly("#dvOptimizedContent").remove(),a.fly("#read_mask").remove()}catch(b){}d.body.showOptimizedContent()}}),'&nbsp;<span style="color:#E5E5E5">|<span>&nbsp;'].join("");var e=a.Ud.get({field:"ntes_letter",flag:"read_head"}),f=d.isThread||"1"===e,g=[a.Link.html({id:d.createId("compactLink"),cls:"nui-txt-link",title:"点击使用精简显示模式",text:'精简信息<b class="nui-ico jS0">k</b>',hidden:f,click:function(){d.log({action:"click",item:"head_compact"}),d.showHeader(!0),this.hide(),$C(d.createId("fullLink")).show(),d.isThread||$E(["support.OptionSupport"],function(a){a.setAttr({field:"ntes_letter",flag:"read_head",value:1,module:"read"})}),a.Component.setEvents(50)}}),a.Link.html({id:d.createId("fullLink"),cls:"nui-txt-link",title:"点击使用完整显示模式",text:'完整信息<b class="nui-ico jS0">j</b>',hidden:!f,click:function(){d.log({action:"click",item:"head_compelete"}),d.showHeader(!1),this.hide(),$C(d.createId("compactLink")).show(),d.isThread||$E(["support.OptionSupport"],function(a){a.setAttr({field:"ntes_letter",flag:"read_head",value:0,module:"read"})}),a.Component.setEvents(50)}})].join("");return g}function B(b,d){var e,f=this,g=f.reader,h=g.folderData,i=g.createId(b+"HeadBt"),j="noBg",k="miniBtn",l="",m={mouseover:{handler:function(){a.fly(this).find("b").removeClass(l)}},mouseout:{handler:function(){a.fly(this).find("b").addClass(l)}}};switch(b){case"flag":var n,o=h.label0;n=o?{type:"flag",subtype:o+""}:{type:"flags",subtype:"transparent"},e={title:"设为红旗",subclass:k,type:j,icon:n},m.click=function(){g.log({action:"click",item:"icon_flag"}),g.assistant.setFlag(-1)};break;case"defer":var p;(h.flags||{}).deferHandle&&h.defer?(p="todo-selected",l="nui-ico-todo-selected-transparent",m.render=function(){var b=this.getEl(),d=38,e=b.offset().x-201;382-d-20>e&&(d=0),$E("support.Defer",function(f){var i,j=f.getMenu({data:h,left:d,top:10,complete:function(){g.module.setDefer()},modify:function(){g.module.showDeferPanel({type:"modify"})},modifySms:function(){g.module.showDeferPanel({type:"modify",smsShow:!0})},modifyMemo:function(){g.module.showDeferPanel({type:"modify",memoShow:!0})},"delete":function(){g.assistant.setMemo({del:!0,value:""})}});0===d&&(j.listeners={render:function(){a.fly(i.getEl().find(".nui-layer-arr").doms[0]).css({left:e+"px",right:"auto"})}}),i=new a.Menu(j),i.attachTo({clickFrom:b}),b=c})},m.click=function(){g.log({action:"click",item:"icon_defer"})}):(p="todo",l="nui-ico-todo-transparent",m.click=function(){g.log({action:"click",item:"icon_defer"}),$E("support.Defer",function(a){a.showMsgbox({type:"modify",data:{defer:h.defer,memo:h.memo,mid:g.mid},callback:function(a){g.module.setDefer(!0,{type:"modify",defer:a.defer,memo:a.memo,smsDate:a.smsDate,data:h})}})})}),e={title:"待办邮件",subclass:k,type:j,icon:{type:p,subtype:"transparent"}};break;case"print":e={title:"打印",subclass:k,type:j,icon:{type:"print",subtype:"transparent"}},l="nui-ico-print-transparent",m.click=function(){g.log({action:"click",item:"icon_print"}),g.assistant.blankView(!0)};break;case"tag":e={title:"邮件标签",subclass:k,type:j,icon:{type:"tags",subtype:"transparent"}},l="nui-ico-tags-transparent",m.click=function(){g.log({action:"click",item:"icon_tag"})},m.render=function(){var b=g.module.view.getTagConf("icon");b.id=g.createId("subjectTagMenu"),b.reverse=!1,new a.Menu(b).attachTo({clickFrom:this.getEl()})}}return e.id=i,e.listeners=m,d?e:a.Button.html(e)}function C(d,e){var f,g=this,h=g.reader,i=h.createId(d),j="sV0",k="assistBlock",l="nui-txt-link";switch(d){case"mailStatus":f={icon:e.icon,content:['<div class="qu0">','<p  class="nui-txt-normal">',e.msg,a.Link.html({id:h.createId("readCheckStatus"),text:"查看详情",cls:l,click:function(){var a=this,b=$C(h.createId("mailTable")),d=b===c;h.assistant.queryMailStatus("mail",i,d,function(){d||b.show(),a.hide(),$C(h.createId("readHideStatus")).show(),$C(h.createId("readRefreshStatus")).show()})}}),a.Link.html({id:h.createId("readHideStatus"),text:"隐藏详情",cls:l,hidden:!0,click:function(){$C(h.createId("mailTable")).hide(),this.hide(),$C(h.createId("readRefreshStatus")).hide(),$C(h.createId("readCheckStatus")).show()}}),a.Link.html({id:h.createId("readRefreshStatus"),text:"刷新",cls:l,hidden:!0,click:function(){$C(h.createId("mailTable")).destroy(),h.assistant.queryMailStatus("mail",i,!0)}}),"</p>","</div>"].join("")};break;case"sendStatus":var m,n=["","nui-txt-suc","nui-txt-err","nui-txt-impt"];if(e.info.ext&&(m=e.info.ext.type),m===c)return m;f={extcls:j+" qh0",icon:m+"State",content:['<div class="qu0">',"<p>",("recall"===m?"撤回状态":"发送状态")+'：<strong id="'+h.createId("sendStatusText")+'" class="'+n[e.info.ext.status]+'">'+e.info[1]+"</strong>",a.Link.html({id:h.createId("readCheckStatus"),text:"查看详情",cls:l,click:function(){var a=this,b=$C(h.createId(m+"Table")),d=b===c;h.assistant.queryMailStatus(m,i,d,function(){d||b.show(),a.hide(),$C(h.createId("readHideStatus")).show(),$C(h.createId("readRefreshStatus")).show()})}}),a.Link.html({id:h.createId("readHideStatus"),text:"隐藏详情",cls:l,hidden:!0,click:function(){$C(h.createId(m+"Table")).hide(),this.hide(),$C(h.createId("readRefreshStatus")).hide(),$C(h.createId("readCheckStatus")).show()}}),a.Link.html({id:h.createId("readRefreshStatus"),text:"刷新",cls:l,hidden:!0,click:function(){$C(h.createId(m+"Table")).destroy(),h.assistant.queryMailStatus(m,i,!0)}}),"</p>","</div>"].join("")};break;case"subscribe":f={content:['<div class="qu0">','<p id="'+h.createId(d)+'" class="nui-txt-normal">',"如果这封邮件不是您订阅的，请 ",a.Link.html({text:"举报",cls:l,click:function(){h.module.report(!0)}}),"；如果是分类错误的邮件，可以 ",a.Link.html({text:"添加到白名单",cls:l,click:function(){var b=h.localSender[0];return b===c?(a.Tips.show({type:"err",text:"发件人地址错误"}),void 0):($E("support.OptionSupport",function(a){a.addList({name:"safelist",value:b.address},function(a){a&&(h.getDom(d).innerHTML='<span class="nui-txt-suc">发件人已被加入白名单，该发件人今后发送的邮件将会进入收件箱</span>')})}),void 0)}}),"</p>","</div>"].join("")};break;case"spamFolder":f={icon:"alert",params:"hasClose",content:['<div class="qu0">','<p class="nui-txt-normal">','<span class="nui-txt-impt">请留意：此邮件在垃圾文件夹，如有提示您填写邮箱信息、中奖需汇款转账等信息，请谨防网络欺诈！</span>',a.Link.html({text:"查看详情",target:"_blank",noParam:!0,link:"read_yjzp"}),"</p>","</div>"].join("")};break;case"junkPic":f={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">',"该邮件中包含了图片，",a.Link.html({text:"点击这里显示图片",cls:l,click:function(){h.junkPic=!1,h.assistant.bodyFilter("mail"),$C(i).destroy()}}),"</p>","</div>"].join("")};break;case"decryptForm":f={icon:"encrypt32",extcls:j+" no0",content:['<div class="qu0">','<p class="nui-txt-normal">这是一封由 <strong class="nui-txt-suc">'+a.String.escapeHTML(h.localSender[0].defaultName)+"</strong> 从网易邮箱发出的加密邮件。",a.Link.html({link:"read_decrypt_help",title:"查看使用说明",text:"查看网易邮箱加密邮件的使用说明",target:"_blank"}),"</p>",'<p class="nui-txt-normal">输入发件人提供给您的密码，即可查阅完整邮件<span class="nui-txt-tips">(您可以通过电话、短信或其他方式向发件人索取密码)</span></p>','<div class="iG0 nui-txt-normal">输入密码：',a.Input.html({id:h.createId("decryptInput"),inputType:"password",placeholder:"在此输入密码",maxLength:6,listeners:{enter:function(){var b=this;b.fire("keydown"),h.decryption.decrypt({pwd:this.getValue(),call:function(d){return d.error!==c?(b.errorTips=new a.Tips({text:d.error,subclass:"normalTips",type:"err",renderTo:b.getEl().dom.parentNode}),void 0):($C(h.createId("decryptForm")).destroy(),h.addBlockInfo("decryptResult"),void 0)}})},keydown:function(){this.errorTips!==c&&this.errorTips.destroy()}}}),a.Button.html({text:"确定",title:"提交密码进行解密",subclass:"inputBtn",click:function(){$C(h.createId("decryptInput")).fire("enter")}}),"&nbsp;","</div>","</div>"].join("")};break;case"decryptSuc":f={params:"hasClose",icon:"decrypt32",content:['<div class="qu0">','<p class="nui-txt-suc">邮件已解密，以下是解密后的邮件内容：</p>',"</div>"].join("")};break;case"decryptPwd":f={params:"hasClose",extcls:j+" no0 nr0",icon:"encrypt",content:'<div class="qu0"><span class="nui-txt-normal">加密邮件的密码为：'+a.String.escapeHTML(e.pwd)+"</span></div>"};break;case"systemWarn":f={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">',"请注意：此邮件有可能存在仿冒，请不要轻易透露个人重要信息，提高警惕，谨防网络诈骗！",a.Link.html({text:"查看详情",link:"read_yjzp",target:"_blank"}),"</p>","</div>"].join("")};break;case"DAWarn":f={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">',"提示：最近某些骗子冒充公司的同事或领导，向您索要公司通讯录，或冒充网易宝或支付宝等官方名义实施欺诈，请您谨慎识别，提高警惕。",a.Link.html({text:"查看诈骗案例>>",link:"https://mail.163.com/html/notice/2017/0214.htm",target:"_blank"}),"</p>","</div>"].join("")};break;case"attachWrong":f={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">该邮件的附件格式不正确</p>',"</div>"].join("")};break;case"transCheck":f={icon:"translate",params:"hasClose",content:['<div class="qu0">','<p class="nui-txt-impt">',a.Link.html({text:"翻译成中文",cls:"nui-txt-link",click:function(){h.translate({type:1})}}),"</p>","</div>"].join("")};break;case"transLoading":f={icon:"loading",content:"正在翻译，请稍候..."};break;case"transMenu":f={icon:"translate",content:['<div class="qu0">',"<p>",a.Link.html({id:h.createId("tansOriginalLink"),cls:l,text:"只显示原文",click:function(){h.translator.switchContent(0)}}),'<span class="oH0 nui-txt-aside">|</span>',a.Link.html({id:h.createId("tansTranslationLink"),cls:l,text:"只显示译文",click:function(){h.translator.switchContent(1)}}),'<span class="oH0 nui-txt-aside">|</span>',a.Link.html({id:h.createId("tansComparisonLink"),cls:l,text:"对照显示",disabled:!0,click:function(){h.translator.switchContent(2)}}),a.Ext.human_trans?['<span class="oH0 nui-txt-aside">|</span>',"<span>您还可以选择"+a.Link.html({text:"网易专业翻译",cls:l,click:function(){$E("product.Translate",function(a){a.goHuman({mid:h.mid,vendor:"read"})}),h.log({action:"click",item:"trans_pro",value:"3"})}})+"，查看更精准的译文</span>"].join(""):"","</p>","</div>"].join(""),ext:$S("isFree")?a.Link.html({text:"最快的人工翻译，有道专业翻译",target:"_blank",noParam:!0,link:"trans_ad2"}):a.Link.html({text:"有道翻译",target:"_blank",noParam:!0,link:"read_trans_provide","left-bracket":"本服务由  ","right-bracket":" 提供"})};break;case"transRetry":f={icon:"translate",content:['<div class="qu0">',"<p>","在线翻译服务异常，请稍候&nbsp;",a.Link.html({text:"重试",click:function(){h.translate({type:2}),$C(i).destroy()}}),"</p>","</div>"].join("")};break;case"smartAd":f={extcls:j+" Ab0",subclass:k,content:e.content,closeclick:function(){this.destroy();var b=new Date;b.setTime(b.getTime()+12096e5),a.Cookie.set("js_read_smart_hint","1","/",$S("fullDomain"),b.toGMTString())}};break;case"internationalTel":f={extcls:j,subclass:k,icon:"yixin",content:['<div class="qu0">','<p  class="nui-txt-normal">',"使用易信可免费拨打国际漫游电话、国内电话及发短信，免费与国内外家人、朋友联络！&nbsp;",a.Link.html({text:"查看免费使用教程",cls:"nui-txt-link",link:a.Uri.getUrl("yixin_ad_roaming",!0),target:"_blank"}),"</p>","</div>"].join(""),closeclick:function(){this.destroy();var b=new Date;b.setTime(b.getTime()+12096e5),a.Cookie.set("yx_read_tip","1","/",$S("fullDomain"),b.toGMTString())}};break;case"yixinPub":f={extcls:j,subclass:k,icon:"yixin",content:['<div class="qu0">','<p  class="nui-txt-normal">',a.String.escapeHTML(e.promoteTxt),"&nbsp;",a.Link.html({text:"查看如何关注",cls:"nui-txt-link",link:a.Uri.getUrl("yixin_ad_pub",!0)+"&pubId="+e.publicId+"&pubName="+b.encodeURIComponent(e.publicName),target:"_blank"}),"</p>","</div>"].join(""),closeclick:function(){this.destroy();var b=new Date;b.setTime(b.getTime()+6048e5),a.Cookie.set("yx_read_tip","1","/",$S("fullDomain"),b.toGMTString())}}}return f.extcls=f.extcls||j,f.subclass=k,f.id=i,f}function D(b,d){function e(a){a===c||0===a.length?j.sendStatus=a:j.sendStatus||(j.sendStatus=a)}var f,g,h,i,j=this.reader,k=j.folderData,l="",m="撤回成功",n="";switch(b){case"mail":var o={};f=[],a.Array.each(d,function(a,b){o[b.msgid]?o[b.msgid].push(b):o[b.msgid]=[b]});for(var p in o){var q=o[p],r=[];a.Array.each(q,function(b,c){r.push(new a.Email(c.to,c.to_name))}),f.push({msgType:q[0].msgType,rectime:q[0].rectime||q[0].modtime,email:r})}d=f,g=[{text:"处理方式"},{text:"时间"},{text:"联系人"}],i="没有查到详情，系统仅保留7天内的回复、转发信息。";break;case"send":g=[{text:"收件人"},{text:"发送状态"},{text:"时间"}],i=a.Misc.getTime(0)-j.data.sentDate>6048e5?"邮件发送已经超过7天，查询不到详情":"没有查到详情，请稍后再试";break;case"recall":g=[{text:"收件人"},{text:"撤回状态"},{text:"时间"}],i="没有查到详情，请稍后再试"}a.Array.each(d,function(c,d){var f="",g="",h=0;if("mail"===b)switch(d.msgType){case 0:f="未知";break;case 1:f="新邮件";break;case 2:case 3:case 4:f="已回复",g="re";break;case 5:f="已自动回复",g="re";break;case 6:case 7:case 8:f="已转发",g="fw";break;case 9:f="已自动转发",g="fw"}else{var i=d.result,j=Math.round(i/100),o=i%100;if(1===j)switch(o){case 0:case 6:case 7:case 8:case 10:f="成功到达对方邮箱",h=1,e("发送成功");break;case 1:f="正在投递中",h=0;break;case 2:case 5:f="未到达对方邮箱",h=2,e(l);break;case 3:case 4:f="被对方退回",h=2,e(l);break;default:f="未知操作",h=3,e(l)}else if(2===j)switch(o){case 0:case 6:case 7:case 8:f="成功到达对方服务器",h=1,e("发送成功");break;case 1:f="对方服务器未响应,重新投递中";for(var p=["@163.com","@126.com","@188.com","@vip.188.com","@yeah.net","@vip.163.com","@vip.126.com"],q=0,r=p.length;r>q;q+=1)if(-1!==d.to.indexOf(p[q])){f="正在投递中";break}h=0,e(l);break;case 2:case 5:f="未到达对方服务器",h=2,e(l);break;case 3:case 4:f="被对方服务器退回",h=2,e(l);break;default:f="未知操作",h=3,e(l)}else if(3===j||4===j){switch(o){case 0:case 1:case 6:case 7:case 8:f="正在处理中",h=0;break;case 2:case 5:case 3:case 4:f="发送不成功，详细原因请查看退信",h=2;break;default:f="未知操作",h=3}e(l)}else if(5===j||7===j)switch(o){case 0:f="撤回成功",h=5,e(m);break;case 9:f="成功到达对方邮箱",h=1;break;default:f="未知操作",h=3,e(l)}else if(8===j)switch(o){case 0:f="撤回成功",h=5,e(m);break;case 9:f="成功到达对方服务器",h=1;break;default:f="未知操作",h=3,e(l)}else f="未知操作",h=3,e(l);if("recall"===b&&k.rclStatus&&1===h){var s=d.rclResult;0===s?(f="正在撤回邮件，请稍候。",h=s):(f="撤回失败，原因："+({4:"信件不存在，可能已经被用户删除",5:"信件存在但已经被读取过",6:"信件存在但已经被客户端收取",7:"信件存在但已经被推送出去",8:"信件已过期",9:"不支持撤回发往外域帐号的邮件"}[d.rclResult]||"其他原因"),h=6,e(n))}g=["doing","suc","err","other","doing","suc","err"][h],d.email=new a.Email(d.to,d.to_name)}d.icon=g,d.msg=f,d.status=h});var s=d.length;if(0===s)h=[[{colspan:3,text:i}]],e(l);else{h=[];for(var t,u,v,w=0;s>w;w+=1)t=d[w],u=a.Date.format(t.rectime||t.modtime,"yyyy年M月d日   HH:mm(星期w)"),"mail"===b?(v=[{text:'<span class="nui-txt-normal">'+t.msg+"</span>"},{text:'<span class="nui-txt-normal">'+u+"</span>"},{text:""}],a.Array.each(t.email,function(a,b){var c=b.name;c||(c=V.getName(b)),v[2].text+=(c?'<span title="'+b.address+'" class="nui-txt-normal">'+c+"</span>":'<span class="nui-txt-normal">'+b.address)+(a<t.email.length-1?"、":"")+"</span>"})):v=[{text:'<span class="nui-txt-normal">'+a.String.encodeHTML(t.email.toString())+"</span>"},{text:'<span class="nui-txt-'+t.icon+'">'+t.msg+"</span>"},{text:'<span class="nui-txt-normal">'+u+"</span>"}],h.push(v)}return{id:j.createId(b+"Table"),subclass:"simpleTable",headCells:g,bodyCells:h}}function E(){var b=this,d=b.reader,e={groups:[{items:[{xtype:"button",text:"回复全部",click:function(){d.log({action:"click",item:"letter_toolbar_replyAll"}),d.assistant.fullReply()}},{xtype:"button",subclass:"dropdownBtn",text:"更多",menu:{reverse:!0,groups:[{items:[{text:"删除",click:function(){d.log({action:"click",item:"letter_menu_del"}),d.module.moveTo({del:!0,threadItem:!0,folderData:d.folderData})}},{text:"回复",click:function(){d.log({action:"click",item:"letter_menu_reply"}),d.assistant.reply()}}].concat(d.module.view.getReplyConf(d).groups.pop().items,d.module.view.getForwardConf(d).groups.pop().items)},{items:[{text:"查看信头",click:function(){d.log({action:"click",item:"menu_viewhead"}),d.assistant.bodyFilter("header")}},{text:"查看邮件",click:function(){d.log({action:"click",item:"menu_viewmail"}),d.assistant.bodyFilter("mail")}},{text:"同主题查看",click:function(){d.log({action:"click",item:"menu_samesubject"}),d.assistant.searchSameSubject()}},{text:"保存到网盘...",click:function(){d.log({action:"click",item:"menu_savetonf"}),d.assistant.saveToNf()}},{text:"导出邮件",click:function(){d.log({action:"click",item:"menu_download"}),d.assistant.exportLetter()}},{text:"选择编码",menu:d.module.view.getCharsetConf(d)},{text:"选择字体",menu:d.module.view.getFontConf()},{text:"翻译邮件",click:function(){d.log({action:"click",item:"menu_trans"}),d.translate({type:0})}}]},{items:[{text:"新窗口打开",click:function(){d.log({action:"click",item:"menu_newwin"}),d.assistant.blankView()}},{text:"保存联系人...",click:function(){d.log({action:"click",item:"menu_savecontact"}),d.assistant.saveContacts()}},{text:"邮件备注",click:function(){d.log({action:"click",item:"menu_memo"}),d.assistant.editMemo()}}]}]},click:function(){d.log({action:"click",item:"letter_menu_more"})}}]}]};return 3===d.fid&&e.groups[0].items[1].menu.groups[0].items.unshift({text:"再次编辑发送",click:function(){d.log({action:"click",item:"toolbar_sendagagin"}),$E("interface.ComposeInterface",function(a){a.edit({id:d.mid,body:{decryptPassword:"decryption"in d?d.decryption.pwd:c}})})}}),a.Ext.scheduleRead&&e.groups[0].items[1].menu.groups[1].items.splice(5,0,{text:"设置日程"+($S("isFree")?"管理":"提醒"),click:function(){d.log({action:"click",item:"menu_schedule"}),$E("product.Schedule",function(a){var b=d.mid,e=$S("schedule");e!==c&&e[b]?a.edit(b):a.add(b,d.folderData.subject)})}}),!a.Ext.letterRecall&&!a.Ext.letterRecall_vip||3!==d.fid||d.isThread||e.groups[0].items[1].menu.groups.splice(1,0,{items:[{text:"撤回邮件",click:function(){d.log({action:"click",item:"menu_recall"}),d.assistant.recall()}}]}),e}function F(b,d,e){var f=this.reader;return b=b||f.folderData.sentDate||f.data.sentDate,e?b:b===c?"(未知时间)":a.Date.format(b,d||"yyyy年MM月dd日 HH:mm (星期w)")}function G(){var b,c=this.reader,d=c.folderData.sentDate||c.data.sentDate,e=a.Misc.getTime();if(d.getFullYear()===e.getFullYear()){var f=d.getMonth()===e.getMonth(),g=d.getDate(),h=e.getDate();b=f&&g===h?a.Date.format(d,"HH:mm"):f&&g===h+1?"昨天"+a.Date.format(d,"HH:mm"):a.Date.format(d,"MM月dd日 HH:mm")}else b=a.Date.format(d,"yyyy-MM-dd HH:mm");return b}function H(b){function c(){return a.Misc.getTime().getTime()-i.sentDate.getTime()<18e5}function d(){a.Msgbox.html({content:"抱歉，距邮件发出时间大于30分钟，附件无法保存。",icon:"err"});try{$C(g.createId("attachSaveLinkfull")).destroy(),a.fly(g.getDom("attachSaveLinkSplitfull")).remove()}catch(b){}try{$C(g.createId("attachSaveLinkcompact")).destroy(),a.fly(g.getDom("attachSaveLinkSplitcompact")).remove()}catch(b){}}var e,f=this,g=f.reader,h="",i=g.folderData,j=b?"compact":"full";return h=a.Icon.html({type:"alert"})+a.Label.html({text:"邮件大小超过1M，未保存普通附件",type:"info"})+"&nbsp;",e=c(),e&&(h+="("+a.Link.html({id:g.createId("attachSaveLink"+j),text:"马上保存",cls:"nui-txt-link",click:function(){return c()?(g.module.action.saveAttachMissed({fullSaveId:i.fullSaveId,mid:i.id,call:function(b){switch(b.code){case"S_OK":var c=function(){a.Listener.fire("read:wmsvrDelete",i),U.entry({fid:i.fid}),g.module.moduleRemove()};a.Msgbox.show({header:"系统提示",title:"附件保存成功",icon:"suc",ok:c,close:c});break;case"FA_MAIL_NOT_FOUND":d();break;case"FS_MS0259":d();break;default:a.Msgbox.html({content:"附件保存失败，错误码："+b.code,icon:"err"})}}}),void 0):(d(),void 0)}}),h+='<span id="'+g.createId("attachSaveLinkSplit"+j)+'">&nbsp;|&nbsp;</span>'),h+=(e?"":"(")+a.Link.html({text:"设置自动保存",cls:"nui-txt-link",click:function(){$E("interface.OptionInterface",function(a){a.entry({module:"BaseSetModule",inputName:"afterSendRule"})})}})+")"}function I(){for(var b=this,c=b.reader,d=[],e=c.localReceiver,f=c.localSender[0],g=e.length-1;g>-1;g-=1){var h=e[g];W.isSender(h.address)||d.push(V.getName(h))}return d.push(V.getName(f)),d.reverse(),"快捷回复给："+a.String.escapeHTML(a.String.trim(d.join("、")))}function J(){var b="dvRangOptions",d="#dvRangOptions";return['<div id="'+b+'" class="nui-msgbox pa0" style="display:none;">','<div class="nui-msgbox-bd">','<div class="nui-msgbox-wide">','<ul class="jw0">','<li class="ju0">',a.Link.html({text:"回复选中",cls:"jv0",click:function(){var b,e,f=$S("fGetActiveReaderBody");f!==c&&(b=f(),e=b.rangText,b.reader.assistant.reply({type:"fragment",content:e}),a.fly(d).hide())}}),"</li>",'<li class="gi0">|</li>','<li class="ju0">',a.Link.html({text:"转发选中",cls:"jv0",click:function(){var b,e,f=$S("fGetActiveReaderBody");f!==c&&(b=f(),e=b.rangText,b.reader.assistant.forward({type:"fragment",content:e}),a.fly(d).hide())}}),"</li>",'<li class="gi0">|</li>','<li class="ju0">',a.Link.html({text:"设置",cls:"jv0",click:function(){$E("interface.OptionInterface",function(a){a.entry({module:"BaseSetModule",inputName:"selectedcontent"})}),a.fly(d).hide()}}),"</li>",'<li class="gi0">|</li>','<li class="ju0">',a.Link.html({text:"关闭",cls:"jv0",click:function(){var b,e=$S("fGetActiveReaderBody");e!==c&&(b=e(),b.reader.body.removeRangEvent(),a.fly(d).hide())}}),"</li>","</ul>","</div>","</div>","</div>"].join("")}function K(a,b){return a?['<div id="dvRangOptions" class="nui-msgbox tM0 qF0" style="display:none;z-index:999" onclick="$.Event.cancelBubble();">','<div class="nui-msgbox-bd">','<div class="nui-msgbox-wide">','<div class="qz0 nui-txt-normal nui-scroll nui-scroll-hasShadow">',"</div>","</div>","</div>","</div>"].join(""):['<div class="hk0">','<strong class="jK1">'+b.returnPhrase+"</strong>",'<span class="iE1">',b.phoneticSymbol?"["+b.phoneticSymbol+"]":"","</span>","</div>",'<div class="hO1">',"<ul>",'<li class="lq0">',b.customTranslation.content.join('</li><li class="lq0">'),"</li>",'<li class="lq0"></li>',"</ul>","</div>"].join("")}function L(b){var c,d,e,f=this,g=f.reader,h=a.Element.getIframeDoc(g.body.frame),i=b.name||"",j=b.email||"",k=$S("isFree"),l=g.createId("mailCardAddLink");return k?(c=a.Ud.get({field:"ntes_compose",flag:"card"}),d="创建我的电子名片",e="name_card_new"):(d="创建我的个性名片",e="vcard"),['<div style="font-size:12px;margin-bottom:10px;background-color: #FFFFE1;border-top:1px solid #C5D2DA;padding:3px 5px">',"电子名片-此邮件包含"+i+"的电子名片。&nbsp;",a.Link.html({id:l,doc:h,text:"保存名片到通讯录",listeners:{click:{handler:function(){V.contactDialog({addr:{name:i,email:j,phone:b.phone},callback:function(){a.Tips.show({type:"suc",text:"名片保存成功"}),$C(l).destroy()}})}}}}),"&nbsp;",k&&("n"===c||"0"===c)||$S("isVip")?a.Link.html({doc:h,text:d,"left-bracket":"&nbsp",listeners:{click:{handler:function(){$E("interface.OutlinkInterface",function(a){a.goOutlink({key:e})})}}}}):"","</div>"].join("")}function M(b){var c="",d=[],e=b.maxMenu;return b.nfMenu&&d.push('<a href="javascript:void(0);" hidefocus="hidefocus" title="将图片保存到网盘" onclick="NTES_Events.saveToNF(\''+b.part+'\');return false;" style="vertical-align:bottom;display:inline-block;+display:inline;+zoom:1;position:relative;+zoom:1;background-image:url(http://mimg.127.net/ggimg/all/img18/140308_nui_btn.png);background-position:0 ; ;border:1px solid #999;border-top-left-radius:3px;border-bottom-left-radius:3px;'+(e?"":"border-top-right-radius:3px;border-bottom-right-radius:3px;")+'text-decoration:none;color:#555;height:26px;width:38px;line-height:0;font-size:0;"><img src="http://mimg.127.net/ggimg/all/img18/140312_wp_2x.png" style="position:absolute;left:10px;top:6px;border:0;" width="16" height="13" /></a>'),a.Ext.yixin_in_read&&d.unshift(['<a href="javascript:void(0);" hidefocus="hidefocus" title="将图片收藏到易信" onclick="NTES_Events.addFavrToYX(\''+b.part+"','"+b.src+'\');return false;" style="display:inline-block;+display:inline;+zoom:1;position:relative;+zoom:1;background-image:url(http://mimg.127.net/ggimg/all/img18/140308_nui_greenbtn.png);background-position:0 ; ;height:14px;border:1px solid #0E996E;border-left:0;border-right:0;text-decoration:none;color:#fff;padding:6px 14px 6px 31px;line-height:14px;border-radius:3px;margin-right:6px;"><img src="http://mimg.127.net/ggimg/all/img18/140308_nui_ico_yixin_white_2x.png" style="position:absolute;left:12px;top:6px;border:0;" width="14" height="14" />收藏到易信</a>','<a href="javascript:void(0);" hidefocus="hidefocus" title="将图片分享到易信" onclick="NTES_Events.toggleYXMenu(\''+b.part+"','"+b.src+'\', this);return false;" style="display:inline-block;+display:inline;+zoom:1;position:relative;+zoom:1;background-image:url(http://mimg.127.net/ggimg/all/img18/140308_nui_greenbtn.png);background-position:0 ; ;height:14px;border:1px solid #0E996E;border-left:0;border-right:0;text-decoration:none;color:#fff;padding:6px 23px 6px 31px;line-height:14px;border-radius:3px;margin-right:6px;"><img src="http://mimg.127.net/ggimg/all/img18/140308_nui_ico_yixinquan_white_2x.png" style="position:absolute;left:12px;top:6px;border:0;" width="14" height="14" />分享到易信<img src="http://mimg.127.net/ggimg/all/img18/140312_darr_2x.png" style="position:absolute;right:11px;top:11px;border:0;" width="7" height="4" /></a>'].join("")),e&&(d.push('<a href="javascript:void(0)" hidefocus="hidefocus" title="1比1查看原图" onclick="window.open(\''+b.src+"', 'pic_preview_"+b.index+'\');return false;" style="vertical-align:bottom;display:inline-block;+display:inline;+zoom:1;position:relative;+zoom:1;background-image:url(http://mimg.127.net/ggimg/all/img18/140308_nui_btn.png);background-position:0 ; ;border:1px solid #999;border-left:none;border-top-right-radius:3px;border-bottom-right-radius:3px;text-decoration:none;color:#555;height:26px;width:38px;line-height:0;font-size:0;"><img src="http://mimg.127.net/ggimg/all/img18/140312_origin.png" style="position:absolute;left:12px;top:8px;border:0;" width="13" height="10" /></a>'),c='<div style="display:inline-block;+display:inline;+zoom:1;font-size: 12px; font-weight: normal; border: 1px solid #ddd; background-color: #F4F4F4; line-height: 14px; padding: 5px;color:#999">(&nbsp;原尺寸为'+b.width+"×"+b.height+"&nbsp;)</div>"),['<div style="display:inline-block;+display:inline;+zoom:1;font-size: 12px; font-weight: normal;line-height: normal;margin-right:6px;">',d.join(""),"</div>",c].join("")
}function N(a){var b=this.reader;return a===c?['<a href="javascript:void(0);" style="font-size:12px;display:block;height:25px;line-height:25px;padding-left:31px;position:relative;+zoom;1;color:#666;text-decoration:none" onmousemove="this.style.backgroundColor=\'#ececec\';" onmouseout="this.style.backgroundColor=\'\';" onclick="NTES_Events.shareToYXFriend();this.parentNode.style.display=\'none\';return false;"><img src="http://mimg.127.net/ggimg/all/img18/140312_friend_2x.png" style="position:absolute;left:9px;top:5px;border:0;" width="14" height="14" />分享给易信好友</a>','<a href="javascript:void(0);" style="font-size:12px;display:block;height:25px;line-height:25px;padding-left:31px;position:relative;+zoom;1;color:#666;text-decoration:none;" onmousemove="this.style.backgroundColor=\'#ececec\';" onmouseout="this.style.backgroundColor=\'\';" onclick="NTES_Events.shareToYXGroups();this.parentNode.style.display=\'none\';return false;"><img src="http://mimg.127.net/ggimg/all/img18/140312_quan_2x.png" style="position:absolute;left:9px;top:5px;border:0;" width="14" height="14" />分享到易信朋友圈</a>'].join(""):{groups:[{items:[{text:"分享给易信好友",click:function(){b.log({action:"click",item:"attach_share_group"}),b.assistant.imageShareToYiXin(a+"",c,!0)}},{text:"分享到易信朋友圈",click:function(){b.log({action:"click",item:"attach_share_friend"}),b.assistant.imageShareToYiXin(a+"")}}]}],width:155}}function O(){var b=a.Uri.getUrl("savetonf_new");return $S("lastNetfolderFid")&&(b+="&fid="+$S("lastNetfolderFid")),['<div style="padding:10px">','<div style="zoom:1;padding:10px;height:230px;border-width:1px;border-style:solid" class="bdr-light">','<iframe id="ifrSaveToNf" src="'+b+'" height="228px" width="380px" frameborder="0"></iframe>',"</div>","</div>"].join("")}function P(a){return["<html>","<head>",'<base target="_blank" />','<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"<title>网易邮箱</title>",'<style type="text/css">',"html{word-wrap:break-word;}","body{font-size:14px;font-family:arial,verdana,sans-serif;line-height:1.666;padding:10px 8px;margin:0;overflow:auto}","pre {white-space: pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space: -o-pre-wrap;word-wrap: break-word;}","</style>","</head>","<body>","<div>",a||"","</div>","</body>","</html>"].join("")}function Q(){var b=this,d=b.reader;return['<div id="read_mask" class="nui-mask"></div>','<div id="dvOptimizedContent" class="mz1 nui-scroll">','<div class="xV0">','<div class="jh1">',a.Link.html({text:"增大",cls:"dV1",click:function(){var b=a.fly("#ifrmOptimizedContent").dom;$I("module.read.MailReaderBody").setFontSize(a.Element.getIframeDoc(b).body,!0,!0,!0),d.body.autoSize({frame:b,heightOnly:!0}),b=c}}),'<b class="ek2"></b>',a.Link.html({text:"缩小",cls:"dy1",click:function(){var b=a.fly("#ifrmOptimizedContent").dom;$I("module.read.MailReaderBody").setFontSize(a.Element.getIframeDoc(b).body,!1,!0,!0),d.body.autoSize({frame:b,heightOnly:!0}),b=c}}),"</div>",'<div class="nT1">','<h1 class="hk2">',a.String.escapeHTML(d.data.subject),"</h1>",'<p class="fH1">',"<span>发件人：",a.String.escapeHTML(V.getName(d.module.view.getContactConf(d.from[0]).email)),"</span>","&nbsp;&nbsp;&nbsp;&nbsp;","<span>时间：",b.getDateStr(),"</span>","</p>","</div>",'<div class="mE1">','<iframe id="ifrmOptimizedContent" src="about:_blank" class="fI3" frameborder="0" style="height:auto;display:none;"></iframe>',"</div>","</div>","</div>"].join("")}function R(a){var d=this.reader,e=b.gAd;if("ud"!==$S("ad").userType&&a){if(e===c)return"";var f;try{f=b.gAd.get("read")}catch(g){}return"string"==typeof f&&f.length>0?['<div id="'+d.createId("dvReadAd")+'" class="tI0 txt-info">','<div class="nui-split"></div>','<div class="rd0" tabindex="0" title="广告区" aria-label="广告区" role="listitem">',f,"</div>",'<div class="nui-split"></div>',"</div>"].join(""):""}return a?"":c}function S(){var c,d=$S("ad"),e=$S("isFree")&&!$S("closeAd")&&!(!d.show&&"ud"===d.userType);try{c=b.gAd.getReadBanner()}catch(f){}return e&&c?['<div style="margin:0 10px 60px 10px;position:relative;+zoom:1">',c,a.Link.html({text:"关闭",cls:"rt2",click:function(){$E("product.Privileges",function(a){a.showProduct("noAd")})}}),"</div>"].join(""):""}var T,U,V,W,X;try{U=$L("interface.MboxInterface"),V=$L("support.AddressSupport"),W=$L("init.SenderList"),X=$L("util.Icon")}catch(Y){return Y}T=a.createClass($N("module.read.MailReaderView")),a.Object.extend(T.prototype,{initialize:d,getHtml:e,getCompactHeadHtml:f,getFullHeadHtml:g,getTempCompactHeadHtml:h,getTempFullHeadHtml:i,getMailServiceHtml:j,getFrameHtml:k,getAttachListHtml:l,getAttachHeader:m,getAttachListItemHtml:n,getReplyHtml:o,getZoomHtml:p,getSubjectHtml:q,getDateHtml:r,getSenderHtml:s,getReceiverHtml:t,getAttachHtml:u,getAttachInfoHtml:v,getMemoHtml:w,getBacklogHtml:x,getMemoTextHtml:y,getMemoEditorHtml:z,getHeaderLinkHtml:A,getSubjectHrefHtml:B,getBlockConf:C,getMailStatusConf:D,getSimpleToolbarConf:E,getDateStr:F,getCompactDateStr:G,getUnSavedInfo:H,getReplyNotice:I,getRangeOptHtml:J,getTranlateTipHtml:K,getVCardTipsHtml:L,getImageOptHtml:M,getImageShareMenu:N,getNfListHtml:O,getTranslationHtml:P,getOptimizedContentHtml:Q,getAD:R,getBottomAD:S})}($,window),function(a,b,c){function d(b){var c=this;c.reader=b,c.modernIE=a.Browser.isIE(">8"),c.isIE=a.Browser.isIE(),c.isChrome=!!a.Browser.chrome(),c.contentType="mail"}function e(){var a=this,d=a.reader;a.frame=d.getDom("frameBody"),a.autoHeightCount=0,a.autoHeightTimer=b.setTimeout(function e(){return a.loadComplete||a.autoHeightCount>1?(a.autoHeightTimer=a.autoHeightCount=c,void 0):(a.autoSize({heightOnly:!0,ignoreIE:!0}),a.autoHeightCount+=1,a.autoHeightTimer=b.setTimeout(e,2e3),void 0)},1e3)}function f(a){var b=this;if(a){var d=b.reader;d.getDom("dvContent").innerHTML=d.view.getFrameHtml(a)}else{var e=b.frame;b.contentLoaded=b.loadComplete=!1,e.contentWindow.location.reload(),b.isChrome&&(e.style.height=b.normalHeight),e=c}}function g(b){var d=this,e=d.reader,f=d.frame||e.getDom("frameBody");if(f){try{a.Event.unlistenAll(f),a.Event.unlistenAll(a.Element.getIframeDoc(f))}catch(g){}b||a.fly(f.parentNode).empty()}f=null,e.contentType=c,d.rangInited=!1}function h(d){function e(){var e,n,o,p=200,q=0,r=0,s=0;if(e=a.Element.getIframeDoc(l)){if(n=e.documentElement,f.isIE&&!f.modernIE){o=e.body||n;try{p=o.scrollHeight,r=o.scrollWidth}catch(t){return}q=40}else{f.modernIE&&(l.style.width=d.half?"":"100%"),o=n;try{p=o.scrollHeight,r=o.scrollWidth}catch(t){return}q=20}if(n.scrollWidth-n.offsetWidth>10&&(p+=20),p=Math.max(p,200),p!==b.parseInt(l.style.height,10)&&(l.style.height=p+q+"px"),f.isIE&&!f.modernIE)try{r=o.scrollWidth}catch(t){return}else try{r=o.scrollWidth,s=e.body.scrollWidth}catch(t){return}r=Math.max(r,s),!f.isIE&&f.widthSet||g.isThread||(!d.heightOnly&&r>700&&r>l.offsetWidth?l.style.width=r+30+"px":f.isIE||r!==b.parseInt(l.style.width,10)||(f.widthSet=!0)),m&&k>0&&(h.scrollTop=Math.floor(b.parseInt(l.style.height,10)*(k/i))+j,h=c),l=c,g.isThread&&g.module.resetOrderNum()}}var f=this,g=f.reader;if(d=d||{},!g.isHidden){var h,i,j,k,l=d.frame||f.frame||g.getDom("frameBody"),m=d.setScrollPos;m&&(h=f.reader.getDom("ScrollDiv"),i=b.parseInt(f.frame.style.height,10),j=f.reader.getDom("dvReadHeadInfo").offsetHeight+1,k=h.scrollTop-j),d.chromeResize&&(l.style.height="auto"),f.isIE&&!d.ignoreIE?b.setTimeout(e,0):e()}}function i(d,e){function f(){var a=o.frame,c=p.view.mimFrameHeight,d=q.offsetHeight;u.innerHTML=r,q.style.display="none";try{a.style.height=b.Math.max(a.contentWindow.document.body.scrollHeight-d,c)+"px"}catch(e){o.autoSize()}}function g(a){try{var b=a.getAttribute("style");return(b.cssText||b).toLowerCase().replace(/[ \']/gi,"")}catch(c){}return""}function h(){try{var a="isReplyContent",b="BLOCKQUOTE",c=e.getElementById(a);if(null!==c){if(c.nodeName.toUpperCase()===b)return c;for(var d=e.getElementsByTagName(b),f=0;f<d.length;f+=1)if(c=d[f],c.id===a)return c}}catch(g){}return!1}function i(){try{for(var a,b,c=e.getElementsByTagName("DIV"),d=0;d<c.length;d+=1)if(a=c[d],"------------------&nbsp;原始邮件&nbsp;------------------"===a.innerHTML&&(b=a.parentNode,b.parentNode===e.body.childNodes[1]))return b}catch(f){}return!1}function j(){try{for(var a,b=e.getElementsByTagName("BLOCKQUOTE"),c=0;c<b.length;c+=1)if(a=b[c],"gmail_quote"===a.className)return a}catch(d){}return!1}function k(){try{var a=e.body.firstChild,b="font-family:timesnewroman,newyork,times,serif;font-size:12pt";return g(a)===b&&g(a.childNodes[1])===b&&g(a.childNodes[1].childNodes[1])===b?a.childNodes[1].childNodes[1]:!1}catch(c){}return!1}function l(){try{var a,b=e.getElementsByTagName("HR")[0];if(b&&"stopSpelling"===b.id)for(var c,d=e.body.childNodes,f=0,g=d.length;g>f;f+=1)c=d[f],c===b?(a=e.createElement("DIV"),b.parentNode.insertBefore(a,b),a.appendChild(c)):a&&a.appendChild(c);return a}catch(h){}return!1}function m(){try{var a,b=e.body.childNodes[1];if("font:10pttahoma"===g(b)&&"background:#f5f5f5"===g(b.childNodes[1])&&4===b.childNodes[1].childNodes.length)for(var c,d=e.body.childNodes,f=0,h=d.length;h>f;f+=1)c=d[f],c===b?(a=e.createElement("DIV"),b.parentNode.insertBefore(a,b),a.appendChild(c)):a&&a.appendChild(c);return a}catch(i){}return!1}function n(){try{var a=e.getElementsByTagName("BLOCKQUOTE")[0];if(a&&a.parentNode===e.body&&"cite"===a.type&&0===a.getAttribute("cite").indexOf("mid"))return a}catch(b){}return!1}var o=this,p=o.reader,q=h()||i()||j()||k()||l()||m()||n(),r="- 显示引用文字 -",s="- 隐藏引用文字 -";if("object"==typeof q){var t="0",u=e.createElement("A");"1"!==t&&f(),q.parentNode.insertBefore(a.fly(u).css({fontSize:"12px",display:"block",color:"#5c6efc",textDecoration:"none"}).attr({href:["javascript",":void(0);"].join(""),target:"_self"}).listen("click",function(){return u.innerHTML===r?(u.innerHTML=s,q.style.display="",o.autoSize()):f(),u.blur(),p.log({action:"click",item:"body_quote"}),!1}).html("1"===t?s:r).dom,q);var v=e.getElementById("blockquoteStyle");try{v.parentNode.removeChild(v)}catch(w){try{o.isIE?e.createStyleSheet().addRule("blockquote","display:inherit"):(v=e.createElement("style"),v.type="text/css",v.innerHTML="blockquote{display:inherit}",(e.body||e.documentElement).appendChild(v))}catch(x){}}v=c}try{a.fly(e.getElementById("blockquoteStyle")).remove()}catch(w){}d=e=c}function j(d){function e(b){var c,d={};try{if(b-=a.Misc.getTime(!1).getTime(),5e3>b)throw{};c=b/864e5,c>1?d.text=Math.ceil(c)+"天":(c=b/36e5,c>1?d.text=Math.ceil(c)+"分":(c=b/6e4,d.text=Math.floor(c)+"分")),d.text+="后到期",d.available=!0}catch(e){d={available:!1,text:"已过期"}}return d}var f,g=this,h=g.reader,i="divNeteaseBigAttach",j="divNeteaseBigAttach_bak",k=d.getElementById(i);if(h.cloudAttached){if(g.cloudAttachInited||null===k)return f=d.getElementById("divNeteaseDropbox"),null!==f&&h.cloudAttached&&(h.cloudAttached=!1,h.addInitCall(function(){try{if(a.fly(h.getDom("dvCloudAttachHead")).remove(),a.fly(h.getDom("ulCloudAttachItem").parentNode).remove(),h.commonAttached)h.attach.updateHeaderInfo();else{a.fly(h.getDom("dvAttachBody")).remove();try{a.fly(h.getDom("attachInfo_full").parentNode).remove()}catch(b){}try{a.fly(h.getDom("attachInfo_compact")).remove()}catch(b){}}}catch(b){}})),d=c,void 0;for(var l,m,n,o,p,q,r,s,t,u,v=[],w="http://fs.163.com/",x="http://fs.qiye.163.com/";k;)l=k,l.id=j,k=d.getElementById(i);l&&(k=l,k.id=i),m=k.getElementsByTagName("A");for(var y=0,z=m.length;z>y;y+=1)n=m[y],q=n.href,o=n.getAttribute("download"),!o||0!==o.indexOf(w)&&0!==o.indexOf(x)||(p=n.getAttribute("filename"),r=n.getAttribute("filesize")-0,t=b.parseInt(n.getAttribute("expiretime")),u=e(t),o=q,s=u.available?n.getAttribute("preview"):!1,v.push({id:"cloudAttach_"+y,cloud:!0,filename:p,contentLength:r,download:b.encodeURI(o),preview:b.encodeURI(s),expireText:u.text}));v.length>0?h.addInitCall(function(){h.attach.showCloudAttach(v)}):k.style.display="block",g.cloudAttachInited=!0,d=c}else if(null!==k){var A=d.getElementById("cloudAttachStyle");try{A.parentNode.removeChild(A)}catch(B){try{g.isIE?d.createStyleSheet().addRule("#divNeteaseBigAttach","display:block"):(A=d.createElement("style"),A.type="text/css",A.innerHTML="#divNeteaseBigAttach{display:block}",(d.body||d.documentElement).appendChild(A))}catch(C){}}}}function k(a){var b=this,d=b.reader;d.addInitCall(function(){try{"function"==typeof a.contentWindow.r_a_h&&b.reader.updateInlineAttach(a.contentWindow.r_a_h())}catch(d){}a=c})}function l(d){function e(e){var g=this,h=e.index,i=s+h+"",j=e.resized,k=g.get("timer"),l=d.getElementById(i);if(k!==c&&(b.clearTimeout(k),g.set("timer",c)),null!==l)l.style.display="";else{var m,n,o=g.dom.src,q=o.replace(/.+part=/,"");if(m=7===o.indexOf($S("host"))&&q.length>0,!m&&!j)return;n=g.offset(),l=a.Element.create("DIV",i,d).html(p.view.getImageOptHtml({nfMenu:m,maxMenu:j,width:e.width,height:e.height,part:e.part,src:o,index:h})),l.dom.style.cssText="position:absolute;left:"+n.x+"px;top:"+((n.y>29?n.y:30)-30)+"px",a(d.body).append(l.dom).destroy(),a(d.body.lastChild).listen("mouseover",function(){var a=g.get("timer");a!==c&&(b.clearTimeout(a),g.set("timer",c))}).listen("mouseout",function(){f.apply(g)}).destroy(),g.set("menuId",i),a.Component.setEvents()}g.set("menuActive",!0)}function f(){var e=this,f=e.get("menuActive");f&&e.set("timer",b.setTimeout(function(){var b=d.getElementById(e.get("menuId"));b.style.display="none",e.set("menuActive",!1),e.set("timer",c);try{a.fly(b).find("#"+p.createId("NTES_YX_menu")).hide().css({visibility:"hidden"})}catch(f){}},300))}var g,h,i,j,k,l,m,n,o=this,p=o.reader,q=d.getElementsByTagName("IMG"),r=q.length,s="ntes_read_img_menu_",t=$S("sid");if(0===r)return!1;if(!o.imgEventInited){var u=o.frame.contentWindow.NTES_Events={saveToNF:function(a){p.log({action:"click",item:"content_nf"}),p.assistant.saveToNf(a+"")}};a.Ext.yixin_in_read&&(u.addFavrToYX=function(a,b){p.log({action:"click",item:"content_favr"}),p.assistant.imageFavrToYiXin(a+"",b)},u.shareToYXGroups=function(){p.log({action:"click",item:"content_share_group"});var a=this.menuParam;p.assistant.imageShareToYiXin(a.part+"",a.src)},u.shareToYXFriend=function(){p.log({action:"click",item:"content_share_friend"});var a=this.menuParam;p.assistant.imageShareToYiXin(a.part+"",a.src,!0)},u.toggleYXMenu=function(b,e,f){var g=p.createId("NTES_YX_menu"),h=a(d.getElementById(g));if(h===c)h=a.Element.create("div",g,d),h.dom.style.cssText="position: absolute; left: 211px; top: 128px;border:1px solid #999;background:#fff;border-radius:3px;box-shadow:0px 0px 3px 0px RGBA(0,0,0,.4);color:#666;width:178px;padding:7px 0;",h.html(p.view.getImageShareMenu());else if(a.Element.inside(h,f.parentNode)&&"none"!==h.dom.style.display)return h.hide(),h.css({visibility:"hidden"}),h.destroy(),void 0;this.menuParam={part:b,src:e},h.appendTo(f.parentNode),h.css({left:"115px",top:"34px",visibility:"visible"}).show()}),o.imgEventInited=!0}p.junkPic&&(p.tipsComplete?p.addBlockInfo("junkPic"):p.junkPicTip=!0),g=p.isThread?o.isIE?62:52:0;for(var v=0;r>v;v+=1){h=q[v],k=h.width,l=h.height,j=h.src;var w=!1;o._getUrlParam(j,"sid")===t&&l&&l>50&&(k&&k>760&&(m=(b.innerWidth||document.body.clientWidth)-201-34-g,k>m&&(m=Math.max(760,m),h.style.width=m+"px",h.style.height=Math.floor(m/k*l)+"px"),n=w=!0),i=a(h),i.listen("mouseover",a.Function.bind(e,i,{resized:w,part:o._getUrlParam(j,"part"),index:v,width:k,height:l})).listen("mouseout",a.Function.bind(f,i)))}return n}function m(d){function e(e){var g;try{g=f.frame.contentWindow.event||e}catch(h){g=e}g=a.Event.get(g),$S("fGetActiveReaderBody",function(){return f});try{a.fly("#dvRangOptions").hide()}catch(h){}f.rangTimer!==c?(b.clearTimeout(f.rangTimer),f.rangTimer=c):f.rangTimer=b.setTimeout(function(){f.showRangeOpt(d,g),f.rangTimer=c},500),a.Event.fire(document,"mouseup")}var f=this;d=d||a.Element.getIframeDoc(f.frame),a.Event.listen(d,"mouseup",e),a.Event.listen(d,"dblclick",e)}function n(){var b=this,c=a.Element.getIframeDoc(b.frame);a.Event.unlisten(c,"mouseup"),a.Event.unlisten(c,"dblclick")}function o(b,d){var e,f,g=this,h=g.reader,i=g.rangText=g.getRangText(b),j="0"===a.Ud.get({field:"ntes_option",flag:"readRange"});if((!j||"mouseup"!==d.type)&&i){if(e=a("#dvRangOptions"),e===c&&(f=j?h.view.getTranlateTipHtml(!0):h.view.getRangeOptHtml(),e=a(a.fly(document.body).append(f).dom.lastChild),a.Component.setEvents()),j){if(!/^[a-z]*$/.test(i))return;$E("product.Translate",function(b){b.request(i,function(b,c){c=a.Eval.get("("+c+")"),0!==c.customTranslation.content.length&&(a.fly("#dvRangOptions").show().dom.firstChild.firstChild.firstChild.innerHTML=h.view.getTranlateTipHtml(!1,c),h.log({action:"show",item:"body_trans"}))})})}var k,l,m=d.pageX,n=d.pageY,o=a.fly(g.frame).offset(),p=0;n-=h.module.getDom("ScrollDiv").scrollTop,p=g.isIE?b.body?b.body.offsetWidth:b.documentElement.offsetWidth:b.documentElement.offsetWidth,k=m+o[0]+40,l=m+280,l>p&&!h.translating?e.css({left:"auto",right:"0px"}):e.css({left:k+"px",right:"auto"}),g.isIE&&(n-=document.documentElement.scrollTop),e.css({top:n+o[1]+20+"px"}),j||e.show(),e.destroy(),a.fly(document.body).one("mouseup",function(){try{a.fly("#dvRangOptions").hide()}catch(b){}})}}function p(c){var d="";return"getSelection"in b?d=this.frame.contentWindow.getSelection():"selection"in c&&(d=c.selection.createRange().text),a.String.trim(d.toString())}function q(b){var d=this,e=d.reader,f=b.getElementById("divNeteaseMailCard"),g={};if(null!==f&&0!==f.childNodes.length){for(var h,i,j,k,l,m,n,o,p,q,r=f.getElementsByTagName("STRONG"),s=0,t=r.length;t>s;s+=1)n=r[s],o=n.getAttribute("func"),"name"===o?g.name=a.String.trim(n.innerHTML):"key2"===o&&(h=(m=n.getElementsByTagName("A")).length>0?a.String.trim(m[0].innerHTML):a.String.trim(n.innerHTML),k=a.Uri.matchEmail(h),k?g.email=k.address:/^(1[3|5|8])\d{9}$/.test(h)&&(i=h));if(!g.email||!a.SenderList.isSender(g.email)){for(p=f.getElementsByTagName("SPAN"),s=0,t=p.length;t>s;s+=1)q=p[s],q.getAttribute("func")&&(l=a.String.trim(q.innerHTML),l.indexOf("手机")>-1?(m=l.replace("：",":").split(":"),i=a.String.trim(m[m.length-1])):l.indexOf("电话")>-1?(m=l.replace("：",":").split(":"),j=a.String.trim(m[m.length-1])):/^(1[3|5|8])\d{9}$/.test(l)?i=l:/^\d{3,4}-\d{7,8}(-\d{3,4})?$/.test(l)&&(j=l));g.phone=i||j,(0!==r.length||0!==p.length)&&(g.email||g.name||g.phone)&&a.fly(f).before(a.Element.create("DIV",c,b).html(e.view.getVCardTipsHtml(g)).dom)}}}function r(d){var e=this,f=e.reader,g=f.notFocus;if(!g){var h=d.getElementsByTagName("player"),i=h.length;if(i>0){var j={},k=f.data.attachments;if(k===c||0===k.length)return;a.Array.each(k,function(a,b){j[b.filename]=b});var l=e.mediaPlayers=[],m=i-1;h=a.Object.toArray(h),a.Array.each(h,function(a,d){var g=d.getAttribute("param"),i=d.getAttribute("media"),k=j[g];k&&(e.mediaContent=!0,$E(["product.AvMail"],function(g){var j="NTES_MAIL_READ_FlashPlayer"+k.id;d.parentNode.innerHTML=(new g).getPlayHtml(f.attach.getOptionUrl("download",k),i,j),l.push(j),h[a]=d=c,a===m&&b.setTimeout(function(){e.autoSize({heightOnly:!0})},200)}))})}}var n=d.getElementById("cards_read");null!==n&&(e.greetingCardContent=!0,g&&e.destroy(!0))}function s(d){var e,f,g=this,h=d.getElementById("courseassist");null!==h&&(e=h.href,f=a.Uri.getUrl("read_courseassist",!0)+"?uid="+$S("uid")+"&url="+b.encodeURIComponent(e),a.Ajax.jsonp(f,function(b){if(200===b.code)a.Event.listen(h,"click",function(b){a.Msgbox.show({contentType:"wide",header:"课程中心：提交作业",width:484,noFooter:!0,content:'<iframe src="'+e+'" frameborder="0" style="width:100%;height:175px;border:0;"></iframe>'}),a.Event.stop(b)});else{h.style.backgroundColor="#CCC",h.style.borderColor="#DDD",h.href=["javascript",":void(0);"].join("");var f=d.createElement("P");f.innerHTML="非本人无法提交作业",a.fly(f).css({textAlign:"center",color:"red",fontSize:"12px"}),h.parentNode.appendChild(f),g.autoSize({heightOnly:!0})}d=h=c}))}function t(){function c(a,d){g=a.slice(0,d-1),j.test(g)?(e.addBlockInfo("internationalTel"),e.log({action:"click",item:"tip_yixin_phone"})):a.length>d&&b.setTimeout(function(){a=a.slice(d),c(a,d)},50)}var d=this,e=d.reader;if(!d.InternationalNumChecked&&1!==a.Cookie.get("yx_read_tip")-0){var f=d.getBodySize();if(!(f>51200||0===f)){var g,h=d.getBodyText(),i=500,j=/(?:(?:[0\+-]?\d{1,3}[ -])|(?:\(\+?\d{1,5}\)[ -]?))(?:(?:\d{7,11})|(?:\d{1,4}-(?:(?:\d{1,4}-\d{1,5})|(?:\d{3,10}))))\D?/g;c(h,i),d.InternationalNumChecked=!0}}}function u(){var b=this,c=a.Element.getIframeDoc(b.frame);a.Array.each(b.mediaPlayers,function(a,b){try{c.getElementById(b).stop()}catch(d){}})}function v(b,d){var e=this,f=a.Element.getIframeDoc(e.frame),g=!0,h=e.isChrome;h&&e.normalHeight===c&&(e.normalHeight=e.frame.offsetHeight+"px");try{switch(b){case"I":H.setFontSize(f.body,!0);break;case"O":H.setFontSize(f.body,!1);break;case"R":g=!1,e.reload();break;case"F":H.setFontFamily(f.body,d)}}catch(i){}g&&e.autoSize({chromeResize:h,setScrollPos:!0}),f=c}function w(d){var e=this,f=e.reader;e.contentLoaded=!0;var g,h;return d=d||e.frame,e.frame=d,g=a.Element.getIframeDoc(d),e.autoHeightTimer!==c&&(b.clearTimeout(e.autoHeightTimer),e.autoHeightTimer=e.autoHeightCount=c,0===e.autoHeightCount&&e.autoHeightCount({heightOnly:!0,ignoreIE:!0})),"mail"!==e.contentType?(e.autoSize(),void 0):(e.setReplyQuote(d,g),e.digAttach(g),e.resetInlineAttach(d),e.detectVCard(g),h=e.fixLargeImage(g),e.detectMediaPlayer(g),e.autoSize({chromeResize:h}),e.setRangEvent(g),a.Event.listen(g,"click",a.Function.bind(e.onClickHandler,e)),e.loadComplete=!0,e.checkCountAssist(g),!a.Ext.yixin_in_read||f.isServiceMail&&f.isMailServiceAvailable()||f.addInitCall(function(){a.Ext.read_smart_tag?f.assistant.querySmartMailTags():f.assistant.checkYixinPubAccount()},500),a.Component.setEvents(50),g=c,e.optimizationChecked||f.isThread||(b.setTimeout(function(){e.checkContentOptimizable()},1500),e.optimizationChecked=!0),void 0)}function x(c){function d(){if(i&&0===i.indexOf("http://count.mail.163.com/")){var b=i.indexOf("?")>-1?"&":"?";i+=b+"frmjs=true",i.indexOf("uid=")<0&&(i+="&uid="+$S("uid")),i.indexOf("domain=")<0&&(i+="&domain="+$S("domain")),a.Ajax.request({requestType:a.Ajax.IFRAME,rnd:!0,url:i})}else{var c=g.getAttribute("log"),d=g.getAttribute("logid");"1"===c&&d&&a.Ajax.request({requestType:a.Ajax.IFRAME,rnd:!0,url:"http://jslog.mail.126.com/count/c.htm?product=mailclick&uid="+$S("uid")+"&domain="+$S("domain")+"&logid="+d})}}var e=this,f=e.reader;a.Event.fire(document,"click");var g=a.fly(a.Event.getTarget(c)).findParent("A",!0,!0);if(g){g=g.dom;var h=g.id,i=(g.href||"").toLowerCase();if("1"===g.getAttribute("sys")){var j=g.getAttribute("interface");if(j){var k=g.getAttribute("logkey");k&&f.log({action:"click",item:"direct_mail_"+a.String.escapeHTML(k)}),a.Nav.entry(j,g.getAttribute("param"),g.getAttribute("method"))}else if(h){var l;switch(h){case"dock_start":$I("init.Dock").showDock();break;case"mobile_reply":if($S("isFree")){var m=g.getAttribute("tauid_sig"),n=g.getAttribute("key");l=a.Uri.getUrl(h),m&&(l+="&tauid_sig="+m),n&&(l+="&key="+n),a.Ajax.jsonp(l,function(c){c&&"200"===c.res?a.Msgbox.show({type:c.type,header:c.title,content:c.memo,okText:c.okText,ok:function(){switch(c.action){case"newwin":b.open(c.url);break;case"link":$E(["interface.OutlinkInterface"],function(a){a.goOutlink({key:c.key,param:c.param})});break;case"interface":a.Nav.entry(c["interface"],c.param,c.method)}}}):c&&c.memo&&a.Msgbox.show({content:c.memo})})}break;case"courseassist":break;case"noschedule":a.Ud.set({field:"ntes_option",flag:"schedule_notify",value:1}),a.Tips.show({type:"suc",text:"您发送的定时邮件到达时将不再用邮件方式通知，您可以进入操作习惯设置再次设定发送通知邮件"});break;case"cards_read":break;case"ntes_cloudmusic":break;default:var o={};if(l=a.Uri.getUrl(h),l&&l.indexOf("http")>-1){var p=i.split("?");if(2===p.length){var q=p[1];if(q.length>0){p=q.split("&");for(var r=0,s=p.length;s>r;r+=1){var t=p[r].split("=");t[1]&&(o[t[0]]=t[1])}}}}if("_blank"===g.getAttribute("sys_target"))b.open(l);else switch(h){case"file_center":case"nf_center":case"fj_center":case"bj_center":case"photo_center":$E("product.FileCenter",function(a){a.entry(h)});break;case"cards_read":case"read_postcard":$E("interface.OutlinkInterface",function(a){a.goOutlink({key:h,param:{to:f.from[0]}})});break;default:$E("interface.OutlinkInterface",function(a){a.goOutlink({key:h,param:o})})}}}d(),a.Event.cancel(c)}else if(0===i.indexOf("mailto:")){var u=a.Uri.getEmails(a.String.trim(b.decodeURI(i.replace(/^mailto:|\?.*$/gi,"")))).match;u.length>0&&(a.Array.each(u,function(a,b){u[a]=b.name?b.name+"<"+b.address+">":b.address}),$E("interface.ComposeInterface",function(a){a.entry({info:{to:u}})})),a.Event.cancel(c)}g.target=0===i.indexOf("#")||0===i.indexOf(["java","script:"].join(""))?"_self":"_blank"}}function y(){var a=this.reader,b=a.data,d=(b.html||b.text||{}).contentLength;return d===c||d>51200?void 0:d===c?0:d}function z(){var b,c,d=this,e=d.frame,f="";return e?(b=a.Element.getIframeDoc(e),b&&b.body?(c=b.body,f=d._getInnerTEXT(c),f.replace(/([\n\r]\s*) {3,}/g,"\n")):f):f}function A(b){function c(a){var b,d,e,f="",g=0,h=a.nodeType;if(h){if(d=a.nodeName||"",e=/(STYLE)|(SCRIPT)/.test(d),1===h&&!e||9===h||11===h){if("BR"===d)return" ";if(a.childNodes.length>0)for(a=a.firstChild;a;a=a.nextSibling)f+=c(a);else if("string"==typeof a.textContent)return a.textContent}else if(3===h||4===h)return a.nodeValue}else for(;b=a[g];g++)f+=c(b);return f}var d=this,e="";if(d.modernIE||a.Browser.firefox())try{e=c(b.childNodes)}catch(f){}else e=b.innerText||b.textContent||e;return e}function B(a,c){var d=a.match(new RegExp("(^|&)"+c+"=([^&]*)(&|$)"));return null===d?null:b.decodeURIComponent(d[2])}function C(d,e,f,g){var h=this;if(1===d.nodeType){var i=H.getFontSize("currentStyle"in d?d.currentStyle.fontSize:b.getComputedStyle(d,null).getPropertyValue("font-size"),e);i!==c&&(d.style.fontSize=i),f||(d.style.lineHeight="1.66")}g&&"content"!==d.className||a.Array.each(d.childNodes,function(a,b){h.setFontSize(b,e)}),d=c}function D(a,c){var d,e,f=this,g=b.parseFloat(a);if(d=a.indexOf("px")>-1?3:a.indexOf("em")>-1?0:a.indexOf("%")>-1?1:a.indexOf("pt")>-1?2:3,e=f.fontUnit[d],c){if(g+=e,g>f.fontLimit[d][1])return}else if(g-=e,g<f.fontLimit[d][0])return;return g+f.fontSymbol[d]}function E(b,d){var e,f=this;1===b.nodeType&&(e=b.rawFontFamily,"inherit"===d?b.style.fontFamily=e||d:(e=b.style.fontFamily,e&&b.rawFontFamily===c&&(b.rawFontFamily=e),b.style.fontFamily=d)),a.Array.each(b.childNodes,function(a,b){f.setFontFamily(b,d)}),b=c}function F(){var b=this,c=b.reader,d=a.Element.getIframeDoc(b.frame);if(!(b.getBodySize()<1536)){for(var e,f=!0,g=["table","map","thead","tbody","tfoot","th","tr","td","select","input","button","form","area","caption ","canvas","frame","frameset","iframe","audio","video","embed","object","dialog","summary","applet"],h=0,i=g.length;i>h;h+=1)if(e=g[h],d.getElementsByTagName(e).length>0){f=!1;break}var j=d.getElementsByTagName("a");if(i=j.length,i>0)for(var k=0;i>k;k+=1)if(j[k].getAttribute("sys")){f=!1;break}if(f){var l=c.view.getHeaderLinkHtml(!0);a.fly(c.getDom("dvHeaderLinks")).prepend(l)}}}function G(){function b(){var b=a.Element.getIframeDoc(i.dom),c=b.getElementsByTagName("style");a.Array.each(c,function(a,b){if(a>1)try{b.parentNode.removeChild(b)}catch(c){}}),d(b.body.firstChild),b.body.firstChild.className="content",a.Array.each(b.getElementsByTagName("br"),function(b,c){if(b>0)for(var d=c.previousSibling;d;){if(d&&3===d.nodeType){if(a.String.trim(d.nodeValue).length>0)return}else if(1===d.nodeType){var e=d.nodeName.toLowerCase();return("br"===e||"div"===e||"p"===e)&&(c.style.display="none"),void 0}d=d.previousSibling}});var g=i.dom.parentNode.offsetWidth-80;a.Array.each(b.getElementsByTagName("img"),function(a,b){var c=b.width;c>g&&(b.style.width=g+"px")}),e(b.getElementsByTagName("div")),e(b.getElementsByTagName("p")),i.show(),f.autoSize({frame:i.dom,heightOnly:!0})}function d(a){if(1===a.nodeType){var b=a.id;if("divNeteaseBigAttach"!==b&&"divNeteaseMailCard"!==b){a.removeAttribute("class"),a.removeAttribute("style"),a.removeAttribute("alink"),a.removeAttribute("link"),a.removeAttribute("text"),a.removeAttribute("vlink"),a.removeAttribute("face"),a.removeAttribute("size"),a.removeAttribute("align"),a.removeAttribute("border"),a.removeAttribute("height"),a.removeAttribute("width"),a.removeAttribute("hspace"),a.removeAttribute("vspace"),a.removeAttribute("background"),a.removeAttribute("color"),a.removeAttribute("bgcolor");for(var e=a.childNodes,f=0,g=e.length;g>f;f+=1)d(e[f]);a=c}}}function e(b){a.Array.each(b,function(b,c){try{0===c.getElementsByTagName("img").length&&0===a.String.trim(f._getInnerTEXT(c)).length&&(c.style.display="none")}catch(d){}})}var f=this,g=f.reader;a.Support.loadStyleSheet("gread_reader.css");var h=g.view.getOptimizedContentHtml();a.fly(document.body).append(h);var i=a("#ifrmOptimizedContent");i.listen("load",b),i.dom.src=g.getFrameUrl().replace("/readhtml","/readhtml_optimized");var j=a("#dvOptimizedContent");j.listen("click",function(){a.Event.getTarget()===j.dom&&(i.remove().destroy(),j.empty().remove().destroy(),a("#read_mask").empty().remove().destroy())})}var H,I;try{I=$L("support.AddressSupport")}catch(J){return J}H=a.createClass($N("module.read.MailReaderBody")),a.Object.extend(H,{fontSymbol:["em","%","pt","px"],fontUnit:[.1,10,2,2],fontLimit:[[.8,4.3],[80,430],[10,50],[12,60]],setFontSize:C,getFontSize:D,setFontFamily:E}),a.Object.extend(H.prototype,{initialize:d,init:e,reload:f,destroy:g,autoSize:h,setReplyQuote:i,digAttach:j,resetInlineAttach:k,fixLargeImage:l,setRangEvent:m,removeRangEvent:n,showRangeOpt:o,getRangText:p,detectVCard:q,detectMediaPlayer:r,checkCountAssist:s,checkInternationalNum:t,stopAllMedia:u,zoom:v,onLoadHandler:w,onClickHandler:x,getBodySize:y,getBodyText:z,checkContentOptimizable:F,showOptimizedContent:G,_getInnerTEXT:A,_getUrlParam:B})}($,window,void 0),function(a,b,c){function d(b){var d=this;d.reader=b,d.baseUrl=a.Uri.getUrl("read_data",!0)+"&mid="+b.mid,d.imageItems=[],d.sortType="",$S("thumbnailHandler")===c&&$S("thumbnailHandler",s.thumbnailHandler);for(var e=b.data,f=e.attachments,g=a.Ext.newAttach,h=[],i=[],j=0,k=f.length;k>j;j+=1){var l=f[j],m=l.id,n=l.filename,o=n.indexOf(".")>-1?n.split(".").pop().toLowerCase():" ";if(l.filename=(n||m).split(String.fromCharCode(92)).pop(),l.mimeType=o,"cmecypt"===o)b.isEncrypted=!0,l.inlined=!1;else if(g&&l.inlined){d.inlineAttachFound=!0;continue}h.push(m),i.push(l)}d.commonId=h,e.attachments=i,0===i.length&&b.resetAttachFlag(!1)}function e(){for(var c,d=this,e=d.reader,f=e.data.attachments,g=[],h=0,i=f.length;i>h;h+=1)g.push(e.view.getAttachListItemHtml(d.create(f[h],"common")));i>0&&(e.getDom("dvAttachHead").innerHTML=e.view.getAttachHeader(i),c=e.getDom("ulCommonAttachItem"),c.parentNode.style.display="",c.innerHTML=g.join(""),b.setTimeout(function(){d._setAttachEvent(),a.Ext.attach_online_modify&&$E(["product.FileEdit"],function(a){a.loginO365()})},200))}function f(c,d){var e,f,g,h=this,i=h.reader,j=s.mimeMap,k=j.pic,l=j.iconImg,m=j.preview,n=c.id,o=c.filename,p=c.mimeType,q=c.contentLength,r={id:n,mid:i.mid,filename:o,mime:c.mimeType,size:q>0?a.Number.convert("base64"===c.encoding?3*q/4:q):""};switch(d){case"common":r.isCommon=e=!0,i.isEncrypted||(r.saveToNfHandler=a.Function.bind(h.saveToNf,h,n));break;case"cloud":r.isCloud=f=!0,r.expireText=c.expireText;break;case"decrypt":r.isDecrypt=g=!0}f?(r.download=c.download,r.preview=c.preview):(r.download=h.getOptionUrl("download",c),r.preview=h.getOptionUrl("preview",c));var u=t.getSubtype({type:"file",name:o});if(u&&(r.icon=u,!f)){if(k[u]){var v=h.imageItems;r.open=h.getOptionUrl("pic",c),r.previewHandler=a.Function.bind(h.previewImages,h),l[u]&&(r.imagesrc=h.getOptionUrl("src",c)),r.imageIndex=v.length,v.push({id:n,original:h.getOptionUrl("original",c),title:o,downloadLink:r.download})}else"17"===u&&(r.open=h.getOptionUrl("open",c));
a.Ext.prev&&m[p]&&(r.localPreview=!0),a.Ext.attach_online_modify&&(r.editHandler=function(){var a=h.getOptionUrl("edit",c);b.open(a)})}return c.isMsg&&"message/rfc822"===c.contentType.toLowerCase()&&(r.eml={fid:i.fid,mid:i.mid,group:i.module.getGroup(),part:n}),r}function g(c){function d(){var d=a.Uri.getUrl("savetonf_new"),g=$S("lastNfid");g&&(d+="&fid="+g);var h=['<div style="padding:10px">','<div style="zoom:1;padding:10px;height:230px;border-width:1px;border-style:solid" class="bdr-light">','<iframe id="ifrSaveToNf" src="'+d+'" height="228px" width="380px" frameborder="0"></iframe>',"</div>","</div>"].join("");a.Msgbox.show({type:"confirm",contentType:"normal",title:"保存到网盘",content:h,ok:function(){var d=a.fly("#ifrSaveToNf").dom.contentWindow.fid;if($S("lastNfid",d),d){var g=a.Uri.getUrl("savetonf_sub")+("&mid="+b.encodeURIComponent(f.reader.mid)+"&dirId="+d);c&&(g+="&part="+c),a.Ajax.jsonp(g,e)}}})}function e(b){var c=b.code;if(200===c||c===a.S_OK)a.Tips.show({text:"成功保存到网盘",type:"suc"});else{var d={800:"网盘容量超出限制",801:"网盘文件总数超出限制",802:"流量超出限制",803:"登录超时，重新登录",500:"未知错误"},e=b.msg||d[c]||"错误码"+c;e="保存到网盘失败，"+e,a.Tips.show({text:e,type:"err"})}}var f=this,g=$S("advLock");g.authenticated2||g.disabled||!g.nf?d():a.AdvLock.show(d)}function h(d){var e=this,f=e.reader,g=$S("ImgPreviewObj");if(g===c)return a.Ajax.request({requestType:a.Ajax.SCRIPT,url:"http://mimg.127.net/xm/all2/preview/preview-"+($G.environment.isDebug?"develop":"1.5.min")+".js",call:function(){b.Preview!==c&&($S("ImgPreviewObj",b.Preview),e.previewImages(d))}}),void 0;if(e.imageItems.length>0){var h={index:d,data:e.imageItems,downloadAble:!0,composeFunc:function(a){$E(["interface.ComposeInterface"],function(b){b.entry({info:{attachments:[{type:"internal",_mid:e.reader.module.mid,_part:a}]}})})}};a.Ext.yixin_in_read&&(h.yixinShoucang=function(a){return f.log({action:"click",item:"attach_pre_favr"}),f.assistant.imageFavrToYiXin(a+""),!1},h.yixinShare=function(a){return f.log({action:"click",item:"attach_pre_share_group"}),f.assistant.imageShareToYiXin(a+""),!1}),g.init(h)}}function i(a){for(var c,d,e=this,f=e.reader,g=[],h=0,i=a.length;i>h;h+=1)d=a[h],g.push(f.view.getAttachListItemHtml(e.create(d,"cloud")));f.cloudAttachments=a,c=f.getDom("ulCloudAttachItem"),f.getDom("dvCloudAttachHead").innerHTML=f.view.getAttachHeader(i,!0),c.innerHTML=g.join(""),c.parentNode.style.display="",e.updateHeaderInfo(),b.setTimeout(function(){e._setAttachEvent(!0)},200)}function j(){var a=this,b=a.reader;b.fullHeaderInited&&(b.getDom("attachInfo_full").innerHTML=b.view.getAttachInfoHtml()),b.compactHeaderInited&&(b.getDom("attachInfo_compact").innerHTML=b.view.getAttachInfoHtml(!0))}function k(b,c,d){var e=this,f=e.reader,g=b+(d?"_desc":"");if(e.sortType!==g){var h,i,j=f.data.attachments;switch(b){case"size":h=function(a,b){var c=a.contentLength,e=b.contentLength,f=["base64"===a.encoding?3*c/4:c,"base64"===b.encoding?3*e/4:e];return d&&f.reverse(),f[0]-f[1]};break;case"type":h=function(a,b){var c=a.filename.replace(/(.|\n)*\./,"").toLowerCase(),d=b.filename.replace(/(.|\n)*\./,"").toLowerCase();return c>d?1:d>c?-1:0};break;case"name":h=function(a,b){var c=[a.filename.toLowerCase(),b.filename.toLowerCase()];return d&&c.reverse(),c[0]>c[1]?1:c[0]<c[1]?-1:0};break;default:h=function(a,b){return a.id-b.id}}j.sort(h),i=f.getDom("ulCommonAttachItem").childNodes,a.Array.each(j,function(a,b){var c=b.id,d=i[a];d.id!==f.createId(c)&&d.parentNode.insertBefore(f.getDom(c),d)}),$C(f.createId("sortLink")).getEl().html(c+'<b class="nui-ico nui-ico-downArr">d</b>'),e.sortType=g}}function l(d,e){var f,g=this,h=g.reader.mid,i=e.id;switch(d){case"original":f=g.baseUrl+"&part="+i+"&mode=inline";break;case"download":f=g.baseUrl+"&part="+i+"&mode=download&l=read&action=download_attach";break;case"open":f=g.baseUrl+"&part="+i+"&mode=inline&l=read&action=open_attach";break;case"pic":f=a.Uri.getUrl("read_pic",!0)+"&mid="+h+"&part="+i+"&mode=inline&l=read&action=open_attach";break;case"rawPic":f="/js6/s?func=mbox:getMessageData&sid="+$S("sid")+"&mid="+h+"&part="+i;break;case"preview":f=a.Uri.getUrl("previewattach")+"&mid="+h+"&part="+i+"&keyfrom=wm"+$S("domain");break;case"edit":f=a.Uri.getUrl("idp_qiye_edit")+"&mid="+h+"&part="+i+"&rnd="+(new Date).getTime();break;case"src":var j=g.baseUrl+"&mode=inline&part="+e.id;if($S("isCorp"))f=j;else if(a.Ext.readNewPic)f=[a.Uri.getUrl("read_thumbnail",!0),"mid="+b.encodeURIComponent(h),"part="+e.id,"contenttype="+b.encodeURIComponent(e.contentType),"sWidth="+(e.width||-1),"sHeight="+(e.height||-1),"width=100&height=100"].join("&");else{var k=g._getThumbnailSize(e,200),l=k[0],m=k[1],n=e.width,o=e.height;n&&o&&(l>=n||m>=o)?f=j:e.contentOffset!==c&&(f=["http://pic."+($S("is188")?"mail.188.com":$S("fullDomain"))+"/coremail/fcg/imgapp?funcid=thumbnail","sid="+$S("sid"),"mid="+b.encodeURIComponent(h),"off="+e.contentOffset,"len="+e.contentLength,"enc="+e.encoding,"conttype="+e.contentType,"width="+l,"height="+m,"needoriginal=1"].join("&"))}}return f}function m(){var c=this,d=c.reader,e=a(d.getDom("dvAttachBody").firstChild),f="lr0",g="qf0",h=location.hash;if(location.hash=d.createId("aAttachTag"),b.setTimeout(function(){location.hash=h},300),a.Browser.chrome()||a.Browser.safari())e.addClass(f),b.setTimeout(function(){e.setClass("sa0"),e.destroy()},1e3);else var i=0,j=b.setInterval(function(){return i>8?(b.clearInterval(j),e.removeClass(g),e.destroy(),void 0):(i&!1?e.removeClass(g):e.addClass(g),i+=1,void 0)},100)}function n(b){for(var c=this,d=c.reader,e=d.getDom(b?"ulCloudAttachItem":"ulCommonAttachItem").childNodes,f=navigator.userAgent.toLocaleLowerCase().indexOf("touch")>-1&&a.Browser.ie()>9,g=0,h=e.length;h>g;g+=1){var i=e[g];a.Event.listen(i,"mouseover",function(a){c._mouseEventHandler(a,this)}),a.Event.listen(i,"mouseout",function(a){c._mouseEventHandler(a,this)}),a.Event.listen(i,"focus",function(a){c._mouseEventHandler(a,this)}),f&&a.Event.listen(i,"click",function(a){c._clickEventHandler(a,this)})}}function o(d,e){var f=this,g="nui-bdr-item nui-bg-item fM0",h=" gh0",i=" gp0",j=a(e),k=d.type;if("mouseover"===k||"focus"===k){var l=j.dom.parentNode.parentNode,m=j.offset().x,n=a.fly(l).offset().x,o=m+j.dom.offsetWidth,p=n+l.offsetWidth;j.addClass(20>m-n?g+h:100>p-o?g+i:g);try{b.clearTimeout(j.get("menuTimer")),"focus"===k&&f.lastHover&&f.lastHover!==j.dom.id&&a.fly("#"+f.lastHover).removeClass(g+h+i)}catch(q){}f.lastHover=j.dom.id}else{var r=j.find(".js-component-menu");j.removeClass(g+h+i),r!==c&&j.set("menuTimer",b.setTimeout(function(){r&&a.Component.getItem(r.doms[0]).hide()},400))}j.destroy()}function p(b,d){var e=this,f=e.activeAttach;f&&a.Event.fire(f,"mouseout"),d!==f?(a.Event.fire(d,"mouseover"),e.activeAttach=d):e.activeAttach=c}function q(a,b){var c,d=400,e=600,f=a.width,g=a.height;if("number"!=typeof f||"number"!=typeof g)c=[b,b];else if(b>=f||b>=g||d>f&&e>g||d>g&&e>f)c=[f,g];else{var h=f/g;c=g>f?[b,Math.round(b/h)]:[Math.round(b*h),b]}return c}function r(b,c,d){if(c)b.parentNode.innerHTML=a.Icon.html({type:"file75",subtype:t.getSubtype({type:"file",name:d})});else{b.style.display="";var e,f,g=b.clientWidth,h=b.clientHeight,i=100;if(i>=g&&i>=h)return;g>h?(e=h,f="height"):(e=g,f="width"),e>i&&(b.style[f]=i+"px")}b=null}var s,t;t=$I("util.Icon"),s=a.createClass($N("module.read.MailReaderAttach")),a.Object.extend(s,{mimeMap:{pic:{31:!0,32:!0,33:!0,34:!0,36:!0,37:!0,38:!0},iconImg:{31:!0,32:!0,33:!0,34:!0},preview:{doc:!0,docx:!0,ppt:!0,pptx:!0,xls:!0,xlsx:!0,pdf:!0,zip:!0,rar:!0,htm:!0,html:!0,xml:!0,txt:!0,java:!0,jsp:!0,js:!0,c:!0,cpp:!0,py:!0,h:!0,hpp:!0,cs:!0,sh:!0,css:!0,jpg:!0,jpeg:!0,gif:!0,png:!0,bmp:!0,shtml:!0,xhtml:!0,mht:!0,asp:!0,aspx:!0,ini:!0,inf:!0,dib:!0,wpt:!0,dot:!0,dotm:!0,dotx:!0,docm:!0,pot:!0,potm:!0,potx:!0,pps:!0,ppsx:!0,pptm:!0,dpt:!0,xlsm:!0,xlt:!0,xltx:!0,xltm:!0,ett:!0,war:!0,ear:!0,"7z":!0,tar:!0,gz:!0,tgz:!0,taz:!0,cpgz:!0,z:!0,bz:!0,bz2:!0,tbz:!0,tbz2:!0,cpio:!0,ar:!0,crx:!0,sext:!0,wps:!0,rtf:!0,et:!0,dps:!0,jar:!0,flv:!0,mp3:!0,wma:!0,eml:!0,psd:!0}},thumbnailHandler:r}),a.Object.extend(s.prototype,{initialize:d,init:e,create:f,saveToNf:g,previewImages:h,showCloudAttach:i,updateHeaderInfo:j,sort:k,getOptionUrl:l,skipToList:m,_setAttachEvent:n,_mouseEventHandler:o,_clickEventHandler:p,_getThumbnailSize:q})}($,window),function(a,b,c){function d(a){this.reader=a}function e(b){var c=this,d=c.reader;if(b=b||{},!c._checkReplyTo(a.Function.bind(c.reply,c,b))){var e,f,g={withAttachments:b.withAttachments},h="reply";switch(b.type){case"simple":g={toAll:!0,content:b.content},h="quickReply";break;case"all":g.toAll=!0;break;case"new":e={param:{info:{to:d.from.concat(d.to||[]),cc:d.cc,bcc:d.bcc}}},h="entry";break;case"fragment":g={fragment:!0,toAll:!0,content:b.content};break;default:g.content=b.content}e=e||{id:d.mid,body:c._getReplyBody(g),callback:function(c){b.call&&b.call(c.code===a.S_OK)}},e.lang=d.lang,J[h](e,f)}}function f(b){var d=this,e=d.reader;if(!d._checkReplyTo(a.Function.bind(d.fullReply,d,b))){b=b||{};var f=!0,g=e.localSender.concat(e.localReceiver),h=$S("uid");3===e.fid||0===g.length?f=!1:a.Array.each(g,function(b,c){var d=c.address;return d===h||I.isSender(d)||d.indexOf("groups.163.com")>-1||d.indexOf("g.qq.com")>-1||d.indexOf("googlegroups.com")>-1?(f=!1,a.BREAK):void 0}),b.type=b.type||"all",f?a.Msgbox.show({header:"温馨提示",content:"您不在此邮件的收件人名单中，如回复全部，则其他收件人会知道您收到了此邮件！是否要回复全部收件人？",buttons:[{xtype:"button",text:"回复发件人",subclass:"mainBtn",click:function(){b.type=c,d.reply(b),a.Msgbox.msgbox.close()}},{xtype:"button",text:"回复全部",click:function(){d.reply(b),a.Msgbox.msgbox.close()}},{xtype:"button",text:"取消",click:function(){a.Msgbox.msgbox.close()}}]}):d.reply(b)}}function g(a){var b,c,d=this,e=d.reader;b={id:e.mid,body:d._getForwardBody(a||{}),lang:e.lang},J.forward(b,c)}function h(){function c(b,c){var d=c.name,e=c.email;return b=a.String.trim(b),b&&(d.indexOf(b)>-1||e.indexOf(b)>-1)?d?'"'+d+'"<'+e+">":e:void 0}function d(c){if(c=a.String.trim(c),0===c.length)return"请填写转发地址。";var d=a.Uri.getEmails(c);if(d.wrong.length>0)return"请填写正确的转发地址。";if(d.match.length>1)return"只能输入一个转发地址。";var f={mode:"transmit",attrs:{bcc:c}};h.part&&(f.part=b.parseInt(h.part)),J.quickForward({id:h.mid,body:f,callback:e})}function e(b){b.code===a.S_OK&&a.Msgbox.show({header:"原信转发",title:"转发成功 "})}var f,g=this,h=g.reader;try{f=$L("util.AutoComplete")}catch(i){return i}var j,k=a.Msgbox.show({contentType:"normal",type:"prompt",header:"原信转发",inputLabel:"收件人：",inputPlaceholder:"请输入转发地址",footer:"提示：原信转发邮件不能撤回",autoFocus:!0,okText:"发 送",ok:d,close:function(){try{j._remove()}catch(a){}}}).find("input")[0];a.fly(k.getEl().dom.parentNode).append("<div>"+a.Label.html({type:"tips",text:"(如：zhangsan@example.com)"})+"</div>"),k.unlisten("enter"),j=new f({isTop:!0,input:k.getInputEl(),inputDiv:k.getEl(),match:c})}function i(a){var b=this,c=b.reader,d=c.folderData;K.setFlag({flag:-1===a?d.label0?0:1:a,moduleName:c.module.listModule,data:d,area:c.area})}function j(b){var c=this,d=c.reader;return b?(a.fly(d.getDom("memo")).empty().replace(d.view.getMemoHtml()),a.Component.setEvents(),void 0):(d.showHeader(),d.getDom("memoText").style.display="none",a.fly(d.getDom("memoEditor")).html(d.view.getMemoEditorHtml()).show().dom.parentNode.style.display="",a.Component.setEvents(),$C(d.createId("memoInput")).fire("keyup"),void 0)}function k(a){var b=this,c=b.reader,d={moduleName:c.listModule,memo:a.value,data:c.folderData};K.setMemo(d)}function l(){var b=this,d=b.reader;if(!d.isHidden&&!d.receiptSended){var e=a.Ud.get({field:"op_readreceipt"}).toString(),f=d.data;f!==c&&f.requestReadReceipt&&("0"===e?a.Msgbox.show({type:"confirm",header:"已读回执",title:a.String.escapeHTML(d.localSender[0].toString())+"要求发送“已读回执”，是否发送？",okText:"发送",cancelText:"不发送",ok:function(){$C("readReceiptAways").getChecked()&&a.Ud.set({field:"op_readreceipt",value:"2"}),d.module.action.sendReceipt(d.mid)},cancel:function(){$C("readReceiptAways").getChecked()&&a.Ud.set({field:"op_readreceipt",value:"1"})},content:a.Checkbox.html({id:"readReceiptAways",text:"以后都按这次操作，不再提示"})}):"2"===e&&d.module.action.sendReceipt(d.mid)),d.receiptSended=!0}}function m(c){function d(){var c="正在撤回中...",d=j.rclStatus?"正在查询撤回状态...":c,g=h.localReceiver,i=[],m={};a.Array.each(g,function(a,b){var d=b.address;d in m||(m[d]=!0,i.push([{text:d},{text:c}]))}),f=new a.Msgbox({type:"confirm",contentType:"wide",title:'<b class="nui-ico nui-ico-loading">e</b>'+d,icon:"loading",extcls:k,content:a.Table.html({subclass:"simpleTable",headCells:l,bodyCells:i})}),f.buttons.cancel.hide(),h.module.action.recallMessage({mid:h.mid,callback:e}),($S("isFree")||$S("isVip"))&&a.Ajax.jsonp(a.Uri.getUrl("read_recall_notary",!0)+"&mid="+b.encodeURIComponent(h.mid),function(){})}function e(b){var c=b.code,d=b["var"],e=d.recallresult,g="已执行撤回操作，结果如下",i="撤回失败",n={0:"撤回中，请稍后查看详情",1:"撤回中，请稍后查看详情",2:"成功撤回",3:"成功撤回",4:i,5:i,6:i,7:i,8:i,9:i,14:i,15:i};if("FA_UNSUPPORT_RECALL"===c)return a.Msgbox.show({cls:k,title:"这封邮件无法撤回！"}),void 0;if("FA_MAIL_EXPIRED"===c)return a.Msgbox.show({header:"系统提示",title:"很抱歉，该邮件不能被撤回",content:"<p>此邮件距发送时已超过"+m+"天，无法撤回。</p>"}),void 0;j.recalled=!0,j.rclStatus&&(g="撤回查询已经完成！");var o=[-1,-1,-1],p=[];a.Object.each(e,function(a,b){1===b?(-1===o[0]&&(o[0]=1),o[0]=o[0]&&!0):2===b||3===b?(-1===o[1]&&(o[1]=1),o[1]=o[1]&&!0):(-1===o[2]&&(o[2]=1),o[2]=o[2]&&!0),p.push([{text:a},{text:'<span class="'+(1===b?"nui-txt-normal":2===b||3===b?"nui-txt-suc":"nui-txt-err")+'">'+n[b]+"</span>"}])}),j.rclStatus=o[0]&&-1!==o[0]?1:o[1]&&-1!==o[1]?o[2]&&-1!==o[2]?5:3:4;var q="",r="";j.rclStatus&&j.rclStatus>0&&(j.rclStatus<3?q="邮件撤回中":3===j.rclStatus?(q="撤回成功",r="nui-txt-suc "):4===j.rclStatus?(q="撤回不成功",r="nui-txt-err "):5===j.rclStatus&&(q="部分成功",r="nui-txt-impt "));var s=$C(h.createId("sendStatus"));s&&s.update(h.view.getBlockConf("sendStatus",{info:K.getSendInfo(h.folderData)})),f.update({title:g,content:a.Table.html({subclass:"simpleTable",headCells:l,bodyCells:p})}),f.buttons.cancel.hide(),f.buttons.ok.update({text:"查看详情"}),f.listen("ok",function(){try{$C(h.createId("readCheckStatus")).fire("click")}catch(a){}}),a.Listener.fire("read:recall",h.mid)}var f,g=this,h=g.reader,i=h.data,j=h.folderData,k="jy0",l=[{text:"已发送邮箱地址"},{text:"状态"}],m=$G.user.allowRecallBeforeDays||15,n=a.Misc.getTime(0)-(h.folderData.sentDate||i.sentDate);return m&&n>1e3*3600*24*m?(a.Msgbox.show({header:"系统提示",title:"很抱歉，该邮件不能被撤回",content:"<p>此邮件距发送时已超过"+m+"天，无法撤回。</p>"}),void 0):j.recallable?(j.recalled||j.rclStatus?a.Msgbox.show({title:"该邮件已经被执行撤回，如需查看撤回结果，请点击“查看详情”。"}):a.Msgbox.show({type:"confirm",title:"您确定要撤回此邮件吗？",cls:k,content:['<p class="nui-item-spc1x">邮件撤回详细说明：</p>','<p class="nui-item-spc1x">1. 撤回功能开通后发送的邮件才支持撤回；</p>','<p class="nui-item-spc1x">2. 邮件发送未超过'+m+"天，在对方未读(或显示未读状态)，未被对方从邮件客户端(比如Outlook，Foxmail)收取过，才支持撤回；</p>",'<p class="nui-item-spc1x">3. 撤回成功后，对方看到的邮件将被清除，撤回的结果将通过系统邮件通知您。</p>'].join(""),ok:d}),void 0):(3e5>n&&!c?K.getLetterData({moduleName:h.listModule,mid:h.mid,refersh:!0,callback:function(a){a&&(h.module.folderData=h.folderData=a,g.recall(!0))}}):g.whyRecallDisabled(),void 0)}function n(){function b(b,c){for(var h=c["var"]||[],i=a.Misc.getTime(0)-(d.folderData.sentDate||e.sentDate),j=!1,k=a.Uri.getUrl("read_recall_help",!0),l=0,m=h.length;m>l;l+=1){var n,o=null;h[l].recallable?(d.module.folderData.recallable||K.getLetterData({moduleName:d.listModule,mid:d.mid,refersh:!0,callback:function(a){a&&(d.module.folderData=d.folderData=a)}}),n=18e4>i,o=g[h[l].rclResult],!o&&n&&(o="邮件正在发送中，请稍后尝试撤回")):(n=6e4>i,o=n?"系统处理中，请稍后尝试撤回":"撤回功能开通后发送的邮件才支持撤回，目前仅尝试撤回发往网易163、126、yeah.net、vip163、vip126和188的邮件。更详细的撤回条件可 $help$"),o||(j=!0),o&&(f[o]||(f[o]=!0))}j&&(f["其他原因邮件不支持撤回。"]=!0);var p=[];for(var q in f)p.push(q);var r='<h4 class="g-dialogBox-title">很抱歉，该邮件不能被撤回</h4>';p.length>0&&(r+='<p class="txt-info g-dialogBox-item">原因如下：'+p.join("<br>").replace("$help$",a.Link.html({link:k,text:"查看帮助",target:"_blank"}))+"</p>"),a.Msgbox.show({title:"撤回邮件",content:r})}var c=this,d=c.reader,e=d.data,f={},g={5:"信件存在但已经被读取过。",6:"信件存在但已经被客户端收取过。",7:"信件存在但已经被推送出去。"},h={type:"recall",mid:d.mid,callback:b};d.module.action.listDeliveryHistory(h)}function o(c){function d(){a.Msgbox.show({contentType:"normal",title:"保存到网盘",content:f.view.getNfListHtml(),ok:function(){var d,e=a.fly("#ifrSaveToNf").dom.contentWindow.fid;$S("lastNetfolderFid",e),e&&(d=a.Uri.getUrl("savetonf_sub"),d+="&mid="+b.encodeURIComponent(f.mid)+"&dirId="+e,c&&(d+="&part="+c),a.Ajax.jsonp(d,function(b){var c=b.code;return 200===c||c===a.S_OK?(a.Tips.show({text:"成功保存到网盘",type:"suc"}),void 0):(a.Tips.show({text:"保存到网盘失败，"+(b.msg||H.netFolderError[c]||"错误码"+c),type:"err"}),void 0)}))},cancel:function(){}})}var e=this,f=e.reader,g=$S("advLock");g.authenticated2||g.disabled||!g.nf?d():a.AdvLock.show(function(){d()})}function p(){var b,d=this,e=d.reader,f=e.decryption;return f!==c&&(b=f.pwd)===c?(a.Msgbox.html({title:"本邮件是加密邮件，请解密后重试。",icon:"err",ok:function(){$C(e.createId("decryptInput")).focus()}}),void 0):(e.module.action.saveToYNote({mid:e.mid,pwd:b,call:function(){a.Msgbox.html({title:"邮件已成功保存到有道云笔记",icon:"suc"})},error:function(b){var c,d,e=b.code;if("S_PARTIAL_OK"===e)try{c=[],d=b["var"].fails,a.Array.each(d,function(b,d){c.push(a.String.escapeHTML(d.resource))}),a.Msgbox.html({title:"邮件部分保存成功！以下附件因类型受限，无法保存",content:c.join("<br />")+e,icon:"err"})}catch(f){}else a.Msgbox.html({title:"保存失败，错误码："+e,icon:"err"})}}),void 0)}function q(c){var d,e=this,f=e.reader,g=f.view.getDateStr(null,null,!0);d=a.Ext.read_noSsidRead?"read/viewmail.jsp?mid="+f.mid:$G.environment.readUrl.replace("readhtml","viewmail")+"&mid="+f.mid,f.isDecrypted&&(d+="&decryptMsg=true"),f.part&&(d+="&part="+f.part),c&&(d+="&type=1"),g&&(d+="&t="+g.getTime()),b.open(d,f.module.moduleName+(f.threadToken||""))}function r(b){var c=this,d=c.reader,e=d.data,f=[];f=b?e[b]||[]:(e.from||[]).concat(e.to||[]).concat(e.cc||[]),L.contactListDialog({data:f,callback:function(b){b.code===a.S_OK?a.Tips.show({text:"联系人保存成功",succ:!0}):a.Tips.show({text:"联系人保存失败",err:!0})}})}function s(){var b=this.reader,c=a.Uri.getUrl("read_data",!0)+"&mid="+b.mid+"&mode=download&l=read&action=download_eml";b.part&&(c+="&part="+b.part),a.fly("#downloadFrame").dom.src=c}function t(b,d){var e,f=this.reader,g=f.body.frame;switch(b){case"header":if("header"===f.contentType)return;e=a.Uri.getUrl("read_head",!0)+"&mid="+f.mid+"&l=read&action=read_head",f.part&&(e+="&part="+f.part),f.contentType="header";break;case"mail":if("mail"===f.contentType)return;f.contentType="mail";break;case"encode":f.bodyEncoding=d}e=e||f.getFrameUrl(),f.body.destroy(!0),g.src=e,g=c}function u(){var b="Re:",c=this.reader.folderData.subject.replace(/(re|reply|回复|答复|fw|forward|转发)[:|：]/gi,b),d=c.lastIndexOf(b);d>-1&&(c=a.String.trim(c.substr(d+3))),$E("interface.MboxInterface",function(a){a.title(c)})}function v(d){function e(){g.getDom("dvContent").style.display="",g.getDom("dvZoom").style.display=""}var f=this,g=f.reader,h=g.folderData,i=b.setTimeout(function(){e(),i=c},3e4);g.module.action.getMailServiceData({uid:$S("orgUid"),sender:g.localSender[0].address,time:(g.view.getDateStr(null,null,!0)||new Date).getTime(),hmid:h.hmid,call:function(f){i!==c&&(b.clearTimeout(i),i=c);var j;try{j=a.JSON.parse(f.responseText)}catch(k){return e(),void 0}if(j.code===a.S_OK){var l=g.getDom("mailService"),m=j["var"];l.firstChild.innerHTML=m.html;var n=a.fly(l.firstChild).find("a");n&&n.each(function(c,d){"1"===d.getAttribute("data-open-with-alert")&&a.fly(d).listen("click",function(c){var e=d.href,f=d.title,g=b.parseInt(d.getAttribute("data-width")||500),i=b.parseInt(d.getAttribute("data-height")||480);return"1"!==d.getAttribute("data-without-user-info")&&(e+=(e.indexOf("?")>-1?"&":"?")+"uid="+$S("orgUid")+"&hmid="+b.encodeURIComponent(h.hmid)+"&t="+(new Date).getTime().toString()+"&host="+$S("host")),a.Msgbox.show({header:f,content:'<iframe frameborder="0" style="width:100%;height:'+i+'px" src='+e+"></iframe>",width:g+"px",contentType:"wide",noFooter:!0}),a.Event.cancel(c),!1});var e=d.getAttribute("data-log-url");e&&a.fly(d).listen("click",function(){return a.Ajax.jsonp(e),!1})}),l.style.display="",(1===m["switch"]||1===j["switch"])&&(l.lastChild.style.display="",e()),d&&d()}else e()}})}function w(){var d=this,e=d.reader,f=e.folderData;if(!d.InternationalNumChecked&&"ud"!==$S("ad").userType&&1!==a.Cookie.get("js_read_smart_hint")-0){var g,h=e.data.headers.Sender;g=h instanceof b.Array&&h.length>0?h[0]:f.from;var i,j=f.tag;j&&j.length>0&&(i=j.join(",")),e.module.action.getSmartTag({mid:f.id,subject:f.subject,sender:g,tag:i,call:function(a){var d,f=JSON.parse(a.responseText),g=f.error;if(g===c){try{d=b.gAd.parseLetterFlag(f)}catch(h){return}"string"==typeof d&&d.length>0&&e.addBlockInfo("smartAd",null,{content:d})}}})}}function x(b,d,e,f){function g(b,e){h.isLoadingMailStatus=!1;var g=e["var"];if(e.code!==a.S_OK)return a.Msgbox.html({header:"系统提示",content:"抱歉，系统繁忙，请稍候再试。"}),void 0;new a.Table(i.view.getMailStatusConf(b,g)).render($C(d).getEl());var j=i.sendStatus;j&&(i.getDom("sendStatusText").innerHTML=j,"suc"===g[0].icon&&(i.getDom("sendStatusText").className="nui-txt-suc"),i.sendStatus=c),f!==c&&f(),a.Component.setEvents(),"send"===b&&a.Listener.fire("read:mailStatusUpdate",i.mid,g[0])}var h=this,i=h.reader;return e?(h.isLoadingMailStatus||(h.isLoadingMailStatus=!0,i.module.action.listDeliveryHistory({type:b,mid:i.mid,callback:g})),void 0):(f!==c&&f(),void 0)}function y(){var b=this,d=b.reader;if(1!==a.Cookie.get("yx_read_tip")-0){var e,f=new a.Uri(d.folderData.from||"");e=f.domain||"",$E("product.Yixin",function(a){var b,f=a.publicAccount,g=f.corp[e];if(g===c){try{b=d.data.antispamInfo.RulesType.split("_")[0]}catch(h){b=""}g=f.league[b]}g===c?d.body.checkInternationalNum():(d.addBlockInfo("yixinPub",null,g),d.log({action:"click",item:"tip_yixin_pub"}))})}}function z(){var b=this,d=b.reader;return d.body.contentLoaded?(d.textContent===c&&(d.textContent=a.String.trim(d.body.getBodyText())),$E("support.YixinSupport",function(b){b.entry({type:"textFavr",title:a.String.trim(d.data.subject),info:d.view.getCompactHeadHtml(!0),content:d.textContent,remark:"提示：收藏内容未包括图片和附件",getPostContent:function(){var a=this;return["标题："+a.title,a.info+"\n",a.content].join("\n")}})}),void 0):(a.Msgbox.show({header:"系统提示",title:"邮件尚在加载，请稍候再试。",icon:"info"}),void 0)}function A(a,b){var d=this.reader;$E("support.YixinSupport",function(e){if(b===c)try{b=d.attach.getOptionUrl("rawPic",{id:a})}catch(f){}e.entry({type:"imageFavr",attachInfo:{mid:d.mid,part:a},imgType:"wmsvr",preview:b,call:function(){}})})}function B(a,b,d){var e=this.reader;$E("support.YixinSupport",function(f){if(b===c)try{b=e.attach.getOptionUrl("rawPic",{id:a})}catch(g){}f.entry({type:"imageShare",toFriend:d,attachInfo:{mid:e.mid,part:a},imgType:"wmsvr",preview:b,call:function(){}})})}function C(c){var d=this,e=d.reader,f=e.data,g={id:e.mid,decryptPassword:(e.decryption||{}).pwd,attrs:{subject:(H.replyTitleText[$S("attrs").user.replyf]||H.replyTitleText[0])+f.subject,isHtml:!!f.html}};c.toAll&&(g.dontCcDelegatedAddress=g.toAll=!0),c.withAttachments&&(g.withAttachments=!0),e.part&&(g.part=b.parseInt(e.part));var h=a.String.escapeHTML(c.content||"").replace(/\n/g,"<br/>"),i=e.from.join(""),j=a.Date.format(e.folderData.sentDate||f.sentDate),k=H.replyBodyText[d._getLanguage()];if(f.html){var l=[k[0],j,k[2],a.String.encodeHTML(i),k[1],'<br/> <blockquote id="isReplyContent" style="PADDING-LEFT: 1ex; MARGIN: 0px 0px 0px 0.8ex; BORDER-LEFT: #ccc 1px solid">'].join(""),m="</blockquote>";h&&(c.fragment?g.defaultContent=h:l=h+"<br/><br/>"+l),g.quoteHTMLStart=l,g.quoteHTMLEnd=m}else{var n=[k[0],j,k[2],i,k[1],"\n"].join("");h?c.fragment?(g.attrs.content=n+"\n"+h,h=""):g.quoteTextStart=h+"\n"+n:g.quoteTextStart=n,g.quoteTextEnd="",g.quoteTextLinePrefix=">",g.defaultContent=h}var o=d._getSender();return o&&(g.attrs.account=o.toString()),g}function D(d){var e,f,g,h=this,i=h.reader,j=i.data,k=d.asAttachment,l={mode:k?"attach":"quote",attrs:{subject:(H.forwardTitleText[a.Ud.get({field:"ntes_option",flag:"forward"})]||H.forwardTitleText[0])+j.subject,isHtml:!!j.html}},m=d.content;if(i.part&&(l.part=b.parseInt(i.part)),"fragment"===d.type&&(m=a.String.escapeHTML(m)),j.html?(g="quoteHTMLStart",k?l.attrs.content="":(f="<br/>",l.quoteHTMLStart='<DIV id="isForwardContent">',l.quoteHTMLEnd="</DIV>"),l.attrs.isHtml=!0):(g="quoteTextStart",k?l.attrs.content="":(f="\n",l.quoteTextStart=f,l.quoteTextEnd="")),!k){e=H.forwardBodyText[h._getLanguage()];var n=(i.from||[]).join(","),o=(i.to||[]).join(","),p=(i.cc||[]).join(","),q=j.subject;j.html&&(n=a.String.escapeHTML(n),o=a.String.escapeHTML(o),p=a.String.escapeHTML(p),q=a.String.escapeHTML(q)),l[g]+=[e[5],e[0]+n,e[1]+a.Date.format(j.sentDate||i.folderData.sentDate),e[2]+o,(i.cc?e[3]+p+f:"")+e[4]+q,m||""].join(f)}m!==c&&(l.attrs.content=(l.quoteHTMLStart||l.quoteTextStart)+(l.quoteHTMLEnd||l.quoteTextEnd));var r=h._getSender();return r&&(l.attrs.account=r.toString()),l}function E(){var a,b=this,c=b.reader;if(c.fid>19){var d=$I("init.Folder").getPopInfo(c.fid);d.isPop&&d.username&&(a=I.isSender(d.username))}return a}function F(){var b,d,e=this,f=e.reader,g="";if(e.language!==c)return e.language;if("west"===f.lang)d=1;else{try{b=e.reader.body.frame.contentWindow.document.body,g=a.String.trim((b.innerText||b.textContent||"").replace(/<[^>]+>/g,"")).substr(0,500)}catch(h){}d=0===g.length||g.match(/[^\x00-\x80]/g)?0:1}return e.language=d,d}function G(b){var d=this,e=d.reader,f=e.data,g=e.localSender[0].address||"",h=a.Uri.getAddress(g),i=f.headers["Reply-To"],j=i?i.join(","):!1,k=!1;if(j){var l=a.Uri.getEmails(j).match;l.length>0&&a.Array.each(l,function(d,e){return e.address!==h?(a.Msgbox.show({header:"风险提示",title:"您回复的地址和原邮件发送地址不一致，请注意识别。",content:"发送地址："+a.String.escapeHTML(g)+"<br />回复地址："+a.String.escapeHTML(j),okText:"继续回复",ok:function(){f.headers["Reply-To"]=c,b()},cancel:function(){}}),k=!0,a.BREAK):void 0})}return k}var H,I,J,K,L;try{I=$L("init.SenderList"),J=$L("interface.ComposeInterface"),K=$L("interface.MboxInterface"),L=$L("support.AddressSupport")}catch(M){return M}H=a.createClass($N("module.read.MailReaderAssistant")),a.Object.extend(H,{replyTitleText:["Re:","Reply:","回复:","答复:"],forwardTitleText:["Fw:","Forward:","转发:"],replyBodyText:[["在 "," 写道：","，"],["At "," wrote:",", "]],forwardBodyText:[["发件人：","发送日期：","收件人：","抄送人：","主题：","-------- 转发邮件信息 --------"],["From: ","Date: ","To:  ","Cc:  ","Subject: ","-------- Forwarding messages --------"]],netFolderError:{800:"网盘容量超出限制",801:"网盘文件总数超出限制",802:"流量超出限制",803:"登录超时，重新登录",500:"未知错误"}}),a.Object.extend(H.prototype,{initialize:d,reply:e,fullReply:f,forward:g,originalForward:h,setFlag:i,editMemo:j,setMemo:k,sendReceipt:l,recall:m,whyRecallDisabled:n,saveToNf:o,saveToYNote:p,blankView:q,saveContacts:r,exportLetter:s,bodyFilter:t,searchSameSubject:u,loadMailServiceContent:v,querySmartMailTags:w,queryMailStatus:x,checkYixinPubAccount:y,contentFavrToYiXin:z,imageFavrToYiXin:A,imageShareToYiXin:B,_getReplyBody:C,_getForwardBody:D,_getSender:E,_getLanguage:F,_checkReplyTo:G})}($,window,void 0),function(a,b,c){function d(a){this.reader=a}function e(b){var c=this,d=c.reader,e=b.pwd;return 0===e.length?(b.call({error:"请输入密码"}),void 0):(d.module.action.decrypt({param:{mid:d.mid,pwd:e},call:a.Function.bind(c.showDecryptResult,c,b)}),void 0)}function f(b,c){var d=this,e=d.reader,f=c.code,g=c["var"];if(f===a.S_OK){d.pwd=b.pwd,e.isDecrypted=$S("decryptedMid")[e.mid]=!0;var h=g.attachments||[];return e.data.attachments=h,e.commonAttached=h.length>0,e.attached=e.commonAttached||e.cloudAttached,d.updateContent(g),document.cookie=e.mid+"="+d.pwd+";path=/",void 0}b.call({error:i.ERROR_INFO[f]})}function g(d){var e=this,f=e.reader,g=f.body.frame,h=$C(f.createId("decryptForm"));1===h.getEl().dom.parentNode.childNodes.length&&(h.getEl().dom.parentNode.style.display="none"),h.destroy(),f.addBlockInfo("decryptSuc");try{f.body.destroy(!0),g.contentWindow.document.body.innerHTML=(d.html||d.text||{content:"<div>邮件正文不存在</div>"}).content,b.setTimeout(function(){f.body.onLoadHandler(g)},a.Browser.isIE()?2e3:1e3)}catch(i){}g=c,f.attach.baseUrl=a.Uri.getUrl("read_decrypt_data",!0)+"&mid="+f.mid;var j=f.getDom("dvAttachBody");a.fly(j).empty().replace(f.view.getAttachListHtml()),f.showAttach();var k=f.getDom("attachInfo_compact"),l=f.getDom("attachInfo_full");f.attached?(null!==k&&a.fly(k).empty().replace(f.view.getAttachHtml(!0)),null!==l&&a.fly(l.parentNode).empty().replace(f.view.getAttachHtml())):(null!==k&&a.fly(k).empty().remove(),null!==l&&a.fly(l.parentNode).empty().remove())}function h(a){var b=$S("decryptedMid");return b?a in b:($S("decryptedMid",{}),!1)}var i;i=a.createClass($N("module.read.MailReaderDecryption")),a.Object.extend(i,{ERROR_INFO:{FA_MAIL_NOT_FOUND:"信件不存在",FA_PART_NOT_FOUND:"附件不存在",FA_INVALID_PART:"信件Part不是嵌套信",FA_EMPTY_PASSWORD:"没有传递密码参数",FA_INVALID_PASSWORD:"密码错误，请重新输入",FA_INVALID_ENCRYPTED_DATA:"数据错误"},isDecrypted:h}),a.Object.extend(i.prototype,{initialize:d,decrypt:e,showDecryptResult:f,updateContent:g})}($,window),function(a,b,c){function d(a){this.reader=a}function e(){var b=this,c=b.reader;a.Ajax.request({requestType:a.Ajax.SCRIPT,url:a.Uri.getUrl("read_trans",!0)+"&a=get&mid="+c.mid,rnd:!0,paddingFunc:function(a){var b;try{b=a.result.fanyi}catch(d){return}b&&"west"===b.lang&&(c.lang=b.lang,c.addBlockInfo("transCheck"),c.log({action:"show",item:"trans_tip"}))}})}function f(b){var d=this,e=d.reader;if(!d.requested){var f,g=e.decryption,h=g!==c,i="";if(h&&g.pwd===c)return a.Msgbox.html({header:"系统提示",content:"抱歉，本邮件是加密邮件，请先进行解密。",ok:function(){$C(e.createId("decryptInput")).focus()}}),void 0;try{$C(e.createId("transCheck")).destroy()}catch(j){}switch(e.addBlockInfo("transLoading"),b){case 0:i="_btn";break;case 1:i="_tip";break;case 2:i="_rty"}f=a.Uri.getUrl("read_trans",!0)+"&a=fanyi&mid="+e.mid+"&keyform=wm"+$S("domain")+i,"hz"===$G.environment.svr&&(f+="&svr=hz"),h&&(f+="&decryptMsg=1"),$S("isCorp")?a.Ajax.request({requestType:a.Ajax.XMLHTTP,url:f,rnd:!0,head:[{name:"Accept",value:"application/json"}],call:function(b){try{b=a.Eval.get(b.responseText)}catch(c){try{b=a.JSON.parse(b.responseText)}catch(e){}}d.response(b)}}):a.Ajax.request({requestType:a.Ajax.SCRIPT,url:f,rnd:!0,paddingFunc:function(a){d.response(a)}}),d.requested=!0}}function g(a){var b=this,d=b.reader,e=(a||{}).result,f=$C(d.createId("transLoading"));return f!==c&&f.destroy(),e!==c&&e.error?(d.addBlockInfo("transRetry"),b.requested=!1,void 0):(b.translation=e.fanyi||e,d.addBlockInfo("transMenu"),b.switchContent(2),void 0)}function h(d){var e=this,f=e.reader;if(e.showType!==d){e.showType=d;var g=e.translation,h=a.String.escapeHTML(g.title||"无主题"),i=a(f.module.getDom("h1Subject")),j=a(f.getDom("dvContent")),k=$C(f.createId("tansOriginalLink")),l=$C(f.createId("tansTranslationLink")),m=$C(f.createId("tansComparisonLink")),n=a(f.body.frame),o=a(f.getDom("translationFrame"));switch(d){case 2:if(o===c){o=a.Element.create("IFRAME",f.createId("translationFrame")),o.setClass("oD0 eP0"),o.css({height:f.view.mimFrameHeight+"px"}),o.attr({frameBorder:"0"}),j.append(o.dom),o.listen("load",function(d){b.setTimeout(function(){e.autoSize()},200);for(var f=a.Element.getIframeDoc(a.Event.getTarget(d)),g=f.getElementsByTagName("A"),h=0,i=g.length;i>h;h+=1)g[h].target="_blank";a.Event.listen(f,"click",function(){a.Event.fire(document,"click")}),f=c});var p=a.Element.getIframeDoc(o.dom);p.open("text/html","replace"),p.write(f.view.getTranslationHtml(g.content)),p.close(),p=c,o.destroy()}j.setClass("nui-fClear sR0 kV0"),i.html(h),n.show(),o.show(),k.setDisabled(!1),l.setDisabled(!1),m.setDisabled(),f.body.autoSize({half:!0});break;case 1:j.setClass("nui-fClear sR0 eX0"),i.html(h),n.hide(),o.show(),k.setDisabled(!1),l.setDisabled(),m.setDisabled(!1);break;case 0:j.setClass("nui-fClear sR0"),i.html(a.String.escapeHTML(f.folderData.subject||"无主题")),n.show(),o.hide(),k.setDisabled(),l.setDisabled(!1),m.setDisabled(!1),f.body.autoSize()
}i.destroy(),j.destroy(),n.destroy(),o.destroy()}}function i(){var b=this.reader.getDom("translationFrame"),c=a.Element.getIframeDoc(b),d=this.reader.view.mimFrameHeight,e=a.Browser.isIE()?c.body.scrollHeight+150:c.documentElement.scrollHeight+30;b.style.height=(d>e?d:e)+"px",c=null}var j;j=a.createClass($N("module.read.MailReaderTranslator")),a.Object.extend(j.prototype,{initialize:d,check:e,translate:f,response:g,switchContent:h,autoSize:i})}($,window),function(a,b,c){function d(b){var d,e=this;a.Object.extend(e,b);var f=e.folderData,g=$S("attrs").user.junkpic||0;e.junkPic=2===g||1===g&&5===e.fid,d=e.module||e.threadItem.module,e.baseUrl=a.Ext.read_noSsidRead?"read/readhtml.jsp?mid="+e.mid:$G.environment.readUrl+"&mid="+e.mid,e.view=new z(e),e.body=new A(e),e.assistant=new C(e),e.isDecrypted=D.isDecrypted(e.mid),(3===e.fid||f===c||(f.flags||{}).read)&&(e.receiptSended=!0),e.isThread?(e.createId=function(a){return d.createId(e.threadToken+a)},e.getDom=function(a){return d.getDom(e.threadToken+a)}):(e.createId=a.Function.bind(d.createId,d),e.getDom=a.Function.bind(d.getDom,d))}function e(){var c=this;if(!c.module.resourcePreloaded){c.setAttachObj();var d=c.isThread||"1"===a.Ud.get({field:"ntes_letter",flag:"read_head"});c.showHeader(d),d&&c.showHeader(!d,d)}if(c.initMailService(),c.initBody(),c.showAttach(),c.isServiceMail&&c.isMailServiceAvailable()||c.showTips(),c.fillReplyInput(),c.inited=!0,c.exeInitCall(),a.Component.setEvents(50),b.setTimeout(function(){c.assistant.sendReceipt()},1e3),!y.downloadFramInited){var e="downloadFrame",f=a.Element.create("iframe",e).attr({name:e,frameborder:"0",src:"about:blank"}).css({display:"none"});document.body.appendChild(f.dom),y.downloadFramInited=!0,f.destroy()}}function f(){return"1"!==a.Ud.get({field:"ntes_read",flag:"mail_service"})}function g(){var a=this;a.isServiceMail&&a.isMailServiceAvailable()&&a.assistant.loadMailServiceContent(function(){a.mailServiceLoaded=!0})}function h(){var a=this;a.body.init()}function i(){var b=this,c=b.data.attachments||[];b.commonAttached&&0===c.length?b.resetAttachFlag(!1):!b.commonAttached&&c.length>0&&a.Array.each(c,function(c,d){return d.inlined?void 0:(b.attached=b.commonAttached=!0,a.BREAK)}),b.attached&&(b.attach=new B(b))}function j(a,b){var c=this,d=c.getDom("ulCompact"),e=c.getDom("ulFull");a?(b||(e.style.display="none",d.style.display=""),c.compactHeaderInited||(d.innerHTML=c.view.getCompactHeadHtml(),c.compactHeaderInited=!0,c.module.updateUserLabel())):(b||(d.style.display="none",e.style.display=""),c.fullHeaderInited||(e.innerHTML=c.view.getFullHeadHtml(),c.fullHeaderInited=!0))}function k(){var b=this,c=b.folderData;if(c.composeExtra&&c.composeExtra.showOneRcpt){var d=b.getDom("liReadOutto");null!==d&&(d.firstChild.innerHTML="群发单显:",a.fly(d.parentNode.parentNode).addClass("fM1"))}}function l(a){var b=this,d=this.module,e=b.folderData.flags||{};d.commonAttached=b.commonAttached=!(!e.attached||e.inlineAttached&&!e.realAttached||a!==c&&!a),d.cloudAttached=b.cloudAttached=!!e.linkAttached,d.attached=b.attached=b.commonAttached||b.cloudAttached}function m(){var a=this,b="";a.attached?(a.commonAttached&&!a.getDom("dvAttachHead")&&a.view.getAttachListHtml(!0),a.attach.init()):b="none",a.getDom("dvAttachBody").style.display=b}function n(b){var c=this;if(c.commonAttached&&!c.attach.inlineAttachFound&&!c.inlineChecked){var d=b.length;if(d>0){for(var e,f,g=!1,h=[],i=0;d>i;i+=1){f=b[i],f.id=f.id+"";var j=f.filename,k=j.indexOf(".")>-1?j.split(".").pop().toLowerCase():" ";if(f.inlined&&"cmecypt"!==k){var l=c.getDom(f.id+"");l&&(e=l.parentNode.parentNode,a.fly(l).remove()),g=!0}else h.push(f)}if(g)if(c.data.attachments=h,c.resetAttachFlag(h.length>0),0===h.length)if(c.cloudAttached)c.attach.updateHeaderInfo(),a.fly(c.getDom("dvAttachHead")).remove(),a.fly(e).remove();else{a.fly(c.getDom("dvAttachBody")).remove(),a.fly(c.getDom("attachInfo_full").parentNode).remove();try{a.fly(c.getDom("attachInfo_compact")).remove()}catch(m){}}else c.getDom("dvAttachHead").innerHTML=c.view.getAttachHeader(h.length),c.attach.updateHeaderInfo();c.inlineChecked=!0}}}function o(){var a=this,b=$C(a.createId("replyInput")),c=a.view.getReplyNotice(),d=c+"（按Ctrl+Enter键发送）";b.showPlaceholder(c),b.getEl().attr({title:d,"aria-label":d})}function p(){var b=this,d=b.data,e=b.folderData,f=e.flags||{},g=e.tag||[],h=b.fid,i=[];if(a.Array.has(g,"%st_sys_fake%"))i.push(b.addBlockInfo("DAWarn",!0));else{var j=!1;if(d.antispamInfo!==c){var k=a.String.trim((d.antispamInfo.RulesType+"").toLowerCase());(0===k.indexOf("fake")||0===k.indexOf("ntesfake"))&&(i.push(b.addBlockInfo("systemWarn",!0)),j=!0)}5!==h||j||i.push(b.addBlockInfo("spamFolder",!0))}if(f.realAttached&&!b.part){var l=d.attachments||[];0===l.length&&i.push(b.addBlockInfo("attachWrong",!0))}if(18===h&&f.read&&i.push(b.addBlockInfo("subscribe",!0)),3===h||-1===h&&3===e.fid){var m=F.getSendInfo(e);m&&i.push(b.addBlockInfo("sendStatus",!0,{info:m}))}else{var n,o,p=[];f.replied&&(p.push("回复"),o="re"),f.forwarded&&(p.push("转发"),o=o===c?"fw":"refw"),n=p.join("且"),n.length>0&&i.push(b.addBlockInfo("mailStatus",!0,{msg:"邮件已被"+n+"&nbsp;&nbsp;",icon:o}))}b.isEncrypted&&(b.decryption=new D(b),i.push(b.addBlockInfo("decryptForm",!0))),3===h&&f.encrypted&&e.encpwd&&i.push(b.addBlockInfo("decryptPwd",!0,{pwd:e.encpwd})),b.junkPicTip&&(i.push(b.addBlockInfo("junkPic",!0)),delete b.junkPicTip),i.length>0&&a.fly(b.getDom("dvBlockInfo")).show().html(i.join("")),b.tipsComplete=!0}function q(b,d,e){var f,g=this,h=g.view.getBlockConf(b,e);if(h!==c){if(d)return a.Block.html(h);if($C(g.createId(b))!==c)return;f=g.getDom("dvBlockInfo"),f.style.display="",new a.Block(h).render(f),f=c}}function r(b){var d=this;if(d.locked)return 0===b.type&&a.Msgbox.show({title:"抱歉，已加锁邮件暂不支持全文翻译。",header:"系统提示"}),void 0;if(d.translator===c&&(d.translator=new E(d)),b.check){if(d.isServiceMail&&d.isMailServiceAvailable())return;var e,f,g,h=/^[A-Za-z\s`~!@#\$%\^\-\&\*\(\)_\+<>\?:"\{\},\.\\\/;'\[\]]+$/,i=/\b[A-Za-z]+\s/gi;if(!h.test(d.folderData.subject)){if(e=d.body.getBodySize(),e>51200||0===e)return;if(f=d.body.getBodyText().slice(0,499),g=f.match(i)||[],g.length<20)return}return d.translator.check(),void 0}d.translator.translate(b.type),d.log({action:"click",item:"trans_tip"})}function s(){var a=this,b=a.baseUrl;return a.junkPic&&(b+="&filterImages=on"),a.isHidden&&(b+="&preventSetRead=on"),a.part&&(b+="&part="+a.part),document.body.className.indexOf("ua-noYaHei")<0&&(b+="&font=15"),a.bodyEncoding!==c&&(b+="&encoding="+a.bodyEncoding),b+="&color="+$G.user.color}function t(a,d){var e=this,f=d===c?a:function(){b.setTimeout(a,d)};if(e.inited)return f(),void 0;var g=e.initCalls;g===c&&(e.initCalls=g=[]),g.push(f)}function u(){var a=this,b=a.initCalls;if(b!==c){for(;b.length>0;)try{b.shift()()}catch(d){}delete a.initCalls}}function v(){var a=this.module;a.log.apply(a,arguments)}function w(){try{this.getDom("h1Subject").focus()}catch(a){}}function x(){return!0}var y,z,A,B,C,D,E,F;try{z=$L("module.read.MailReaderView"),A=$L("module.read.MailReaderBody"),B=$L("module.read.MailReaderAttach"),C=$L("module.read.MailReaderAssistant"),D=$L("module.read.MailReaderDecryption"),E=$L("module.read.MailReaderTranslator"),F=$L("interface.MboxInterface")}catch(G){return G}y=a.createClass($N("module.read.MailReader")),a.Object.extend(y.prototype,{initialize:d,init:e,isMailServiceAvailable:f,initMailService:g,initBody:h,setAttachObj:i,showHeader:j,resetReceiverText:k,resetAttachFlag:l,showAttach:m,updateInlineAttach:n,fillReplyInput:o,showTips:p,addBlockInfo:q,translate:r,getFrameUrl:s,addInitCall:t,exeInitCall:u,focusSubject:w,log:v,destroy:x})}($,window),function(a,b,c){function d(a){var b=this,d=a.level,e=a.param;b.action===c&&(b.action=new i),d>0&&b.loadMailData(e),d>1&&b.loadFrame(e)}function e(a){var b=this,d=a.mid,e=a.call,f=b.dataCache[d];return f===c?f:f.loading?(f.call=e,"loading"):(e(f.data),"complete")}function f(a){var d,e,f=this,g=a.mid,h=f.frameCache[g],i=h.frame;h!==c&&(d=a.createId("frameBody"),e=a.reader.body,i.attr({id:d,name:d}),f.frameHandler!==c&&b.clearTimeout(f.frameHandler),a.getDom("dvContent").appendChild(i.dom),i.show(),h.loaded&&(e.frame=i.dom,e.onLoadHandler(),i.destroy()),i.listen("load",function(){e.onLoadHandler(this),i.destroy()}),f.frameCache[g]=c)}function g(b){function d(b){if(b.code!==a.S_OK)return h[g]=c,void 0;var d=h[g];d.loading=!1,d.data=b,d.call!==c&&(d.call(b),d.call=c)}var e,f=this,g=b.id,h=f.dataCache;h[g]===c&&(e={id:g,header:!0,returnImageInfo:!0,returnAntispamInfo:!0,autoName:!0,returnHeaders:{"Resent-From":"A",Sender:"A","List-Unsubscribe":"A","Reply-To":"A"},supportTNEF:!0},b.part&&(e.part=b.part),b.markRead&&(e.markRead=!0),"archive"===b.area&&(e.mboxa="2"),h[g]={loading:!0},f.action.wmsvr({func:"mbox:readMessage",body:e,call:function(a){d(a)},log:{l:"read",action:"read"},cacheFlag:3,hideWait:!0}))}function h(d){var e,f,g=this,h=d.id,i=g.frameCache;i[h]===c&&(e=a.Element.create("IFRAME"),f=l+"&mid="+h+"&color="+$G.user.color,(2===k||1===k&&5===d.fid)&&(f+="&filterImages=on"),document.body.className.indexOf("ua-noYaHei")<0&&(f+="&font=15"),e.attr({frameBorder:"0",scrolling:"no",src:f}),e.setClass("oD0"),e.css({height:"400px",display:"none"}),i[h]={frame:e,loaded:!1},a.Event.one(e.dom,"load",function(){i[h]!==c&&(i[h].loaded=!0)}),g.frameHandler=b.setTimeout(function(){g.frameHandler=c,document.body.appendChild(e.dom)},0))}var i,j;i=$I("module.BaseAction"),j=a.createClass($N("module.read.Turbo"));var k=$S("attrs").user.junkpic||0,l=a.Ext.read_noSsidRead?"read/readhtml.jsp?preventSetRead=true":$G.environment.readUrl+"&preventSetRead=true";a.Object.extend(j,{frameCache:{},dataCache:{},start:d,getMailData:e,getFrame:f,loadMailData:g,loadFrame:h})}($,window),function(a,b,c){function d(a,b){var d,e=this;e.constructor.superClass.initialize.apply(e,arguments),a&&(e.mid=a.id||a.mid,e.part=a.part,e.speed=b.speed,e.locked=a.locked,d=a.action),e.reader=new s({module:e,mid:e.mid,fid:e.fid,folderData:e.folderData,isThread:e.isThread,isHidden:e.isHiddenMod,viewType:e.viewType,part:e.part,area:e.area,speed:e.speed,locked:e.locked}),e.checkServiceMail(),d!==c&&e.reader.addInitCall(function(){switch(d){case"reply":e.reader.assistant.reply();break;case"replyAll":e.reader.assistant.reply({type:"all"});break;case"forward":e.reader.assistant.forward()}})}function e(b){function d(a){function g(a){a!==c&&(e.data=f.data=a["var"]),e.part&&(e.folderData=e.reader.folderData={subject:e.data.subject,flags:{},from:e.data.from},"textCall"in e&&(e.textCall(e.getText()),delete e.textCall),h()),e._subInit()}var h=function(){a||b()},i=e.locked;if(i&&!a)return $E("product.MailUnlock",function(a){a.unlockMail(function(){f.body.reload(!0),d(!0)},function(){e.remove()})}),h(),void 0;var j;if(f.resetReceiverText(),f.resetAttachFlag(),!e.part&&!f.isDecrypted){if(j=t.getMailData({mid:e.mid,call:function(a){a!==c&&(e.data=f.data=a["var"]),f.setAttachObj(),e.resourcePreloaded===c&&(e.resourcePreloaded=!0,h()),e._subInit()}}),"complete"===j)return;if("loading"===j)return e.resourcePreloaded=!1,h(),void 0}e.part||h();var k={param:{area:e.area,mid:e.mid,part:e.part,markRead:!(e.folderData.flags||{}).read&&!e.isHiddenMod,password:e.token},call:g,cacheFlag:f.isDecrypted?0:3,isHidden:e.isHiddenMod};e.action.readMessage(k)}var e=this,f=e.reader,g=e.folderData;g===c?v.getLetterData({moduleName:e.listModule,mid:e.mid,callback:function(b,c){b&&(e.folderData=f.folderData=g=b,e.fid=f.fid=b.fid,e.checkServiceMail(),"textCall"in e&&!e.part&&(e.textCall(e.getText()),delete e.textCall),d()),c&&c.code===a.S_PARTIAL_OK&&a.Msgbox.show({header:"读信异常",content:"抱歉，该封信件不存在。",ok:function(){e.remove()}})}}):d()}function f(){var a=this;a.constructor.superClass.init.apply(a),a.isHiddenMod||b.setTimeout(function(){try{a.getDom("h1Subject").focus()}catch(b){}},500),a.log({action:"init",item:"mod"})}function g(){var a=this,c=a.reader;a.isHiddenMod&&(a.isHiddenMod=c.isHidden=!1,c.body.autoSize(),b.setTimeout(function(){a.getDom("h1Subject").focus(),c.assistant.sendReceipt()},0)),a.constructor.superClass.cache.apply(a,arguments)}function h(){var a=this;a.speed&&!a.reader.locked&&t.getFrame(a)}function i(){var a=this.reader;a.focusSubject()}function j(){var b=this,d=b.folderData;if(d!==c){var e=d.tag;b.isServiceMail=b.reader.isServiceMail=a.Ext.read_mailService&&!b.isThread&&e instanceof Array&&a.Array.has(e,"%st_p_extr%")}}function k(){var c=this;c.reader.init();var d,e=(c.data.antispamInfo||{}).RulesType,f=c.fid;e&&"ntessale"!==e&&5!==f&&7!==f&&(e=a.String.trim(e.toLowerCase()),e&&0!==e.indexOf("fake")&&0!==e.indexOf("ntesfake")&&(d=c.getDom("h1Subject"),d.innerHTML='<img src="http://mimg.127.net/p/js4/lib/img/integrity/cx_0.gif" class="kF0" alt="网易诚信邮件联盟认证邮件" title="网易诚信邮件联盟认证邮件"/>'+d.innerHTML)),b.setTimeout(function(){c.reader.translate({check:!0})},500)}function l(){var d=this,e=a.Event.getTarget(),f=d.scrollTimer;f!==c&&(b.clearTimeout(f),d.scrollTimer=c),d.scrollTimer=b.setTimeout(function(){d.getDom("backToTop").style.display=e.scrollTop>0?"":"none",d.scrollTimer=c,e=c},500)}function m(){var a=this;a.reader.destroy(),a.constructor.superClass.moduleRemove.call(a)}var n,o,p,q,r,s,t,u,v;try{o=$L("module.read.BaseReadModule"),p=$L("module.read.ReadAction"),q=$L("module.read.ReadView"),r=$L("module.read.ReadListener"),s=$L("module.read.MailReader"),t=$L("module.read.Turbo"),u=$L("interface.ReadInterface"),v=$L("interface.MboxInterface")}catch(w){return w}n=a.createClass($N("module.read.ReadModule")),a.Object.mix(n,o,{"interface":u,Action:p,View:q,Listener:r,cls:"tR0",ariaLabel:"读信"},{css:"",logPrefix:"read",initialize:d,getData:e,init:f,cache:g,onAfterRender:h,onFocus:i,checkServiceMail:j,_subInit:k,_scrollHandler:l,remove:m})}($,window),function(a){function b(b){var c;try{c=$I("util.Misc").getTime(0)}catch(d){c=new Date}var e=["c",c.valueOf()].join(":");b=b||{};var f=b.type||"compose";if("compose"!=f){var g=b.param;if(g){if("string"==typeof g.id&&(e=g.id),"reply"==f){var h=g.body;h&&(h.toAll&&(f+="_all"),h.withAttachments&&(f+="_ach"))}if("forward"==f){var h=g.body;h&&"attach"==h.mode&&(f+="_ach")}}else f="compose",b={}}var i=!1;if("compose"==f){var j=a.JS.modules["compose.ComposeModule"];k.each(j,function(c,d){return-1!=c.indexOf('"type":"compose"')&&d.empty()?(a.JS.go(d),m.resetModule(d,b.param),i=!0,a.BREAK):void 0})}if("draft"==f){var j=a.JS.modules["compose.ComposeModule"];k.each(j,function(b,c){var d=c.info.get({did:!0});return d&&d==e?(a.JS.go(c),i=!0,a.BREAK):void 0})}if(!i){var n="student"==$G.mailPattern.currentPattern?!1:!0,o={type:f,fullScreen:n,cid:e},p="";"0"==l.get({field:"ntes_global",flag:"compose_showContacts"})&&(p="l-r");var q={module:"compose.ComposeModule",param:o,extend:b,viewType:p,hasChildMod:!0,noDragbar:!0};a.JS.go(q)}}function c(a,b){var c=a.base,d=a.data,e=a.sign;b&&b.info&&c.fillContent(b.info),d.set({status:"initSign",value:!1}),d.set({status:"useSign",value:null}),e.load(),c.autoSave(),c.autoKeep()}function d(b){var c="";switch(b.code){case"FA_FORBIDDEN":c="发信附加功能权限不足！";break;case"FA_OVERFLOW":if(b.overflowReason)switch(c=b.overflowReason){case"pref_smtp_max_mail_count":c="信件封数超过限制！";break;case"pref_smtp_max_num_rcpts":c="收件人个数超过限制！";break;case"pref_smtp_max_send_mail_size":c="信件大小超过限制！";break;case"pref_flow_limit":c="信件流量超过限制！";break;case"pref_quota":c="存草稿或定时发信时邮箱容量超过限制，请尽快清理邮箱。"}else c="",c+="1、收件人个数超过限制　　　　　&nbsp;<br>",c+="2、信件大小或流量超过限制　　　&nbsp;<br>",c+="3、存草稿或定时发信容量超过限制&nbsp;";break;case"FA_NO_RECEIPT":c="发信时缺少收件人！";break;case"FA_WRONG_RECEIPT":c="收件人地址格式错误！",b.badAddress&&(c+="("+a.String.escapeHTML(b.badAddress)+")");break;case"FA_INVALID_ACCOUNT":c="发件人地址格式错误！",b.badAddress&&(c+="("+a.String.escapeHTML(b.badAddress)+")");break;case"FA_INVALID_DATE":c="定时发信设置时间错误！";break;case"FR_INVALID_REQUEST":c="发信内容格式错误！";break;case"FA_MTA_USER_BLACK_LIST":c="黑名单用户不允许发信！";break;case"FA_MTA_TOO_MANY_RCPTS":c="发送人数超过限制！";break;case"FA_MTA_RCPT_ERROR":c="FA_MTA_RCPT_ERROR";break;case"FA_MTA_REJECTED":if(b.mtaCode)switch(b.mtaCode){case 5510:c="IP地址异常，请求被拒绝！";break;case 5511:c="对不起，您的帐号目前被系统禁止发信"+($S("isCorp")?"。":'，请<a href="http://feedback.mail.126.com/antispam/complain.php?user='+$S("uid")+'" target="_blank">点击这里申诉</a>。');break;case 5520:c="对不起，您今天发送邮件数量超过限制，请明日再试！";break;case 5521:c="短时间发信过多，请稍后再试！";break;case 5530:c="对不起，您今天发送对象过多，请明日再试！";break;case 5531:c="短时间发送对象过多，请稍候尝试！";break;case 5522:c="操作过于频繁，请求被拒绝！";break;case 4512:case 5540:case 5910:c="邮件含敏感内容，请求被拒绝！";break;case 5911:c="对不起，您只能发送邮件给系统管理员！";break;case 5532:c="对不起，您本次群发的收件人数量超过限制，请减少后重发！";break;case 5550:c="5550"}c||(c="对不起，未知原因导致服务器拒绝发送！",b.mtaCode&&(c+="(错误码:"+b.mtaCode+")"))}return c}function e(b,c,d){var e={need:"非常抱歉，系统认为您需要输入验证码才能继续完成发信，如有不便，敬请体谅！",invalid:"验证码不正确，请重新输入！"},f=e[b],g="s?func=user:generateVerifyCodeImage&sid="+$S("sid")+"&time="+(new Date).valueOf(),h="<p>"+f+"</p>"+'<img id="imgMsgBoxVerify" src="'+g+'" alt="验证码图片" >'+'<p><a id="aMsgBoxVerify" href="javascript:void(0)" class="nui-txt-link">看不清楚？换一个</a></p>';a.Msgbox.show({type:"prompt",header:"发信验证",title:"填写验证码",content:h,inputWidth:"300px",ok:function(b){var d=a.String.trim(b);return d?(c&&c(d),void 0):"验证码不能为空"},cancel:function(){d&&d()}});var i=a("#aMsgBoxVerify"),j=a("#imgMsgBoxVerify");i.listen("click",function(){var a=j.dom.src,b=new RegExp("&time=.*|$","i");return a=a.replace(b,"&time="+(new Date).valueOf()),j.dom.src=a,!1})}function f(a){var b,c=$I("init.SenderList");if(b=a.attrs?a.attrs:a.attrs={},"string"!=typeof b.account)try{b.account=c.getDefault().toString()}catch(d){}return"boolean"!=typeof b.saveSentCopy&&$S("attrs").user.save_sent<2&&(b.saveSentCopy=!0),"boolean"!=typeof b.requestReadReceipt&&"1"==l.get({field:"ntes_option",flag:"requirereceipt"})&&(b.requestReadReceipt=!0),"string"!=typeof b.charset&&"1"==l.get({field:"ntes_option",flag:"mailencode"})&&(b.charset="UTF-8"),a.returnInfo=!1,a.action="deliver",0===$S("attrs").user.save_sent&&(a.saveTextThreshold=1048576),a}function g(b){try{var c=$L("module.compose.ComposeAction",this)}catch(d){return d}var e=this,f=b.id,g=b.body;g.id=f,b.flag="replied",c.prototype.replyMessage({body:e.quickBuild(g),log:{action:"fastreply"},error:a.Function.bind(e.quickError,e,b,e.quickReply),callback:a.Function.bind(e.quickSuccess,e,b)}),a.Tips.show("正在回复邮件...")}function h(b){try{var c=$L("module.compose.ComposeAction",this)}catch(d){return d}var e=this,f=b.id,g=b.body;g.ids=[f],b.flag="forwarded",c.prototype.forwardMessages({body:e.quickBuild(g),log:{action:"quickForward"},error:a.Function.bind(e.quickError,e,b,e.quickForward),callback:a.Function.bind(e.quickSuccess,e,b)}),a.Tips.show("正在转发邮件...")}function i(a,b){a.callback&&a.callback({code:b.code})}function j(b,c,d){var e=this,f=b.callback||a.EMPTYFUNC(),g=e.error(d);if(g)return f({code:"S_ERROR"}),g;switch(d.code){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var h=d.code.split("_")[1].toLowerCase();return e.verify(h,function(a){b.body.verifyCode=a,c.call(e,b)},function(){f({code:"S_ERROR"})}),!0}return f({code:"S_ERROR"}),!1}var k=a.Object,l=a.Ud,m=a.createClass($N("module.compose.ComposeManager"));k.extend(m,{entry:b,resetModule:c,error:d,verify:e,quickBuild:f,quickReply:g,quickForward:h,quickSuccess:i,quickError:j})}($,window),function(a){function b(a){var b=this;b.module=a,b["class"]=a["class"]}function c(){var b=this,c=b.module;a.Array.each(b.names,function(a,d){try{b[d]=c[d]}catch(e){}})}function d(){var b=this;a.Object.each(b,function(a,c){c&&(b[a]=null),delete b[a]})}var e=a.createClass($N("module.compose.Compose")),f=["action","assist","attach","base","data","editor","event","form","info","view","sign","stationery","success"];a.Array.each(f,function(a,b){e.prototype[b]=null}),a.Object.extend(e.prototype,{param:null,"class":null,module:null,names:f,initialize:b,init:c,clear:d})}($,window),function(a){function b(a){var b=this,c={func:"mbox:compose",log:v.extend({l:"compose"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function c(a){var b=this,c={func:"mbox:compose",body:{},call:a.callback};b.wmsvr(c)}function d(a){var b=this,c={func:"mbox:getComposeInfo",body:{id:b.info.get({cid:!0})},call:a.callback};b.wmsvr(c)}function e(a){var b=this,c={func:"mbox:cancelComposes",body:{ids:[b.info.get({cid:!0})]},call:a.callback};a.deleteDraft&&(c.body.deleteDraft=!0),b.wmsvr(c)}function f(a){var b=this,c={func:"mbox:restoreDraft",body:a.body,call:a.callback};b.wmsvr(c)}function g(a){var b=this,c={func:"mbox:replyMessage",log:v.extend({l:"read"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function h(a){var b=this,c={func:"mbox:forwardMessages",log:v.extend({l:"read"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function i(a){var b=this,c={func:"mbox:editMessage",body:a.body,call:a.callback};b.wmsvr(c)}function j(a){var b=this,c={func:"mbox:saveSent",body:{id:a.mid},ignoreError:!0,call:a.callback};b.wmsvr(c)}function k(a){var b=this,c={func:"global:sequential",body:{items:[{func:"mbox:saveSent","var":{id:a.saveMid}},{func:"mbox:deleteMessages","var":{id:a.delMid}}]},ignoreError:!0,call:a.callback};b.wmsvr(c)}function l(a){var b=this,c={func:"mbox:compose",body:{id:b.info.get({cid:!0}),action:"continue",returnInfo:!0,attrs:{attachments:a.attachments}},call:a.callback};b.wmsvr(c)}function m(b){var c=this,d=b.sid,e=null;if(d){e="object"==typeof d&&d.length?d:[d];var f=[];a.Array.each(e,function(a,b){f.push({id:b,deleted:!0})});var g={func:"mbox:compose",body:{id:c.info.get({cid:!0}),action:"continue",attrs:{attachments:f}},call:b.callback};c.wmsvr(g)}}function n(a){var b=this,c={func:"ntes:mbox:ynote",body:{action:"saveEmail",mid:a.mid},call:a.callback,error:a.error};b.data.get({status:"showEncrypt"})&&(c.body.password=b.encrypt.get()),b.wmsvr(c)}function o(a){var b=this,c={func:"mbox:cancelDeliver",body:{tinfo:a.tinfo},call:a.callback,error:a.error};b.wmsvr(c)}function p(a){var b=this,c={func:"upload:getTasks",body:{composeId:a.cid},call:a.callback,error:a.error};b.wmsvr(c)}function q(b){var c="http://"+$S("host")+"/rcmd/rcmd?format=json&uid="+$S("uid")+"&sid="+$S("sid")+"&product=webmail&cmd=wrongContact",d=JSON.stringify(b["var"]),e={"var":d};a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,url:c,rnd:!1,body:e,call:b.callback})}function r(a){var b=this,c={func:"ntes:mbox:getSubject",body:{url:a.url},call:a.callback,error:a.error};b.wmsvr(c)}try{var s=$L("module.BaseAction"),t=$L("module.compose.Compose")}catch(u){return u}var v=a.Object,w=a.createClass($N("module.compose.ComposeAction"));v.mix(w,s,null,{}),v.extend(w.prototype,t.prototype),v.extend(w.prototype,{send:b,getId:c,getInfo:d,cancelId:e,restoreDraft:f,replyMessage:g,forwardMessages:h,editMessage:i,saveSent:j,saveSentAndDel:k,syncAttach:l,deleteAttach:m,save2YNote:n,cancelDeliver:o,getTasks:p,contactCorrect:q,getSubject:r})}($,window),function(a,b){function c(a){var b=this;Q.extend(b,{assist:{request:null,capture:null},status:{captureDialog:!1,captureIndex:0,dragSupport:"",dragTarget:"",dragEffect:""}}),T.superClass.initialize.call(b,a)}function d(){var a=this;T.superClass.init.call(a)}function e(){var a=this;a.assist.request=null,a.assist.capture=null,T.superClass.clear.call(a)}function f(a){var b=this;return"string"==typeof a.status?b.status[a.status]:"string"==typeof a.assist?b.assist[a.assist]:void 0}function g(a){var b=this,c=a.value;"string"==typeof a.status?b.status[a.status]=c:"string"==typeof a.assist&&(b.assist[a.assist]=c)}function h(a,b){var c=this;if(!T.has()&&!b)return c.setup(),null;if(!T.hasNewVersion()&&!b)return c.setup("upload"),null;switch(a){case"request":a="beta.httprequest";break;case"capture":a="ntes.screencapture";break;case"blob":a="beta.blobbuilder";break;case"desktop":a="beta.desktop";break;case"digest":a="ntes.blobdigest"}var d=T.createFactory(a);return d?d:(c.setup("update"),null)}function i(b){var c=this,d=c.base,e="安装",f="安 装";"upload"==b&&(e="升级",f="升 级");var g=T.support();if(g){var h="2G";$S("cloud")&&(h=a.Number.convert($S("cloud").capacity));var i="<div>"+e+"后您可以："+"<ol>"+"<li>1. 发送"+h+"超大附件</li>"+"<li>2. 截屏功能</li>"+"<li>3. 直接拖曳文件到写信窗口成为附件</li>"+"<li>4. 复制粘贴文件成为附件</li>"+"<li>5. 在邮件正文中插入本地图片</li>"+"</ol>"+"★ 安装过程可能会离开本页面，当前如有信件内容将被保存到草稿箱"+"</div>",j=null;j=a.Msgbox.show({type:"confirm",title:"使用此功能，需要先"+e+"网易邮箱插件",content:i,okText:f,ok:function(){if(d.empty())c.install(j);else{var a=R.getVersion()||[0,0];R.chrome()&&a[0]>=21?c.install(j,d):d.send({action:"force",call:function(){c.install(j)}})}return!0}})}else{var k=R.getInfo(),i="";"windows"==k.os?i="<b>当前浏览器不支持安装本功能插件，请使用以下浏览器</b><br />1. Internet Explorer<br />2. IE内核模式浏览器，如360浏览器，世界之窗等<br />3. 火狐浏览器(Mozilla Firefox)<br />4. 谷歌浏览器(Google Chrome)<p>★上述浏览器插件目前只限于Windows操作系统支持</p>":"macintosh"==k.os&&(i="<b>当前浏览器不支持安装本功能插件，请使用以下浏览器</b><br />1. Safari<br />2. 火狐浏览器(Mozilla Firefox)<br />3. 谷歌浏览器(Google Chrome)"),a.Msgbox.show({title:"邮箱插件提示",content:i})}}function j(a,b){T.install({close:function(){a.close()}},b)}function k(){var a=this;a.captureDestroy()}function l(){var a=this,b=a.get({assist:"request"});return b&&"undefined"==typeof b.send&&a.set({assist:"request",value:b=null}),b||(b=a.create("request")),b?(a.set({assist:"request",value:b}),b):null}function m(){var a=this,b=a.get({assist:"capture"});return b&&"undefined"==typeof b.captureScreen&&a.set({assist:"capture",value:b=null}),b||(b=a.create("capture")),b?(a.set({assist:"capture",value:b}),b):null}function n(){var a=this;if(R.chrome())a.nativeCapture(function(b){var c=[],d=a.get({status:"captureIndex"})+1;a.set({status:"captureIndex",value:d});var e="截图"+d+".png";b.name=e,b.inlined=!0,c.push(b),a["native"].nativeSelect(c)});else{var b=a.captureGet();b&&(a.get({status:"captureDialog"})?b.focusCaptureDialog():(a.set({status:"captureDialog",value:!0}),b.captureScreen(function(b){a.set({status:"captureDialog",value:!1}),a.captureResult(b)})))}}function o(a){var b=this;a&&1==a.count&&b.captureUpload(a.files[0])}function p(a){var b=this,c=b.get({status:"captureIndex"})+1;b.set({status:"captureIndex",value:c});var d="截图"+c+".png";a.name=d,a.inlined=!0,b.attach.pluginSelect([a])}function q(){var a=this,b=a.get({assist:"capture"});if(b){if(a.get({status:"captureDialog"})){try{b.closeCaptureDialog()}catch(c){}a.set({status:"captureDialog",value:!1})}a.set({assist:"capture",value:b=null})}}function r(){var c=this;if(T.has()){b.composeClip||a(b.document).listen("keydown",function(){b.composeClip&&b.composeClip.apply(null,arguments)}),b.composeClip=function(b){var c=a.Context.module;"compose.ComposeModule"==c.mtype&&c.assist.clipKey(b,"globe")};var d=a(c.editor.getWindow()),e=a(d.dom.document),f=a(e.dom.body),g=e;e.listen("keydown",function(a){c.clipKey(a,"editor")}),R.ie()&&(g=f,e.listen("contextmenu",a.Function.bind(c.clipMenu,c))),g.listen("paste",a.Function.bind(c.clipImage,c))}else if(R.chrome()){var d=a(c.editor.getWindow()),e=a(d.dom.document);e.listen("paste",function(a){c.nativeClipImage(a,"editor")})}}function s(a){var b=this;if(R.ie()){var c=b.create("desktop");if(c)try{c.highLightPasteMenu(a)}catch(d){}}}function t(a,b){var c=this;(a.ctrlKey||a.metaKey)&&86==a.keyCode&&c.clipPaste(a,b)}function u(b,c){var d=this,e=d.create("desktop",!0);if(e){var f=null;try{f=e.getClipboardData(b)}catch(g){}if(f&&f.count>=1){var h=Q.toArray(f.files);d.base.addTimer("clippaste",function(){d.attach.pluginSelect(h)},200),a.Event.stop(b)}else"editor"==c&&d.clipImage(b)}}function v(b){var c=this,d=c.create("desktop",!0);if(d){var e=null,f=null;try{e=d.getClipboardDataType()}catch(g){}if(e){if(e.files)return;if(e.html)return;if(e.text){if(!e.bitmap||!R.firefox())return;var h="";try{h=d.getClipboardText("text")}catch(g){}if(h)return c.editor.insert({text:h}),a.Event.stop(b),void 0}e.bitmap}try{f=d.getClipboardImage(b)}catch(g){}if(f&&1==f.count){var i=f.files[0];c.base.addTimer("clipimage",function(){c.captureUpload(i)},200),a.Event.stop(b)}}}function w(a){var b=this,c=a.clipboardData;if(c&&c.items&&1==c.items.length){var d=[],e=c.items[0];if("file"==e.kind&&-1!=e.type.indexOf("image")){var f=b.get({status:"captureIndex"})+1;b.set({status:"captureIndex",value:f});var g="截图"+f+".png",h=e.getAsFile();h.name=g,h.inlined=!0,d.push(h)}b["native"].nativeSelect(d)}}function x(c){function d(){chrome.runtime.sendMessage(g,{action:"capture",openUrl:"http://1.163.com"},function(a){if(null!=a){var d=a.dataUrl;if(d){var g=f.dataUrlToBlob(d);c(g)}}else b.gChromeExtensionMailCaptureCheck&&(b.gChromeExtensionMailCaptureCheck=!1,e())})}function e(){a.Msgbox.show({type:"confirm",title:"截图插件提示",content:"进入Chrome应用商店安装截图插件,安装成功后可使用截图功能！",okText:"立即安装",ok:function(){b.gChromeExtensionMailCaptureCheck=!0,b.open(a.Uri.getUrl("compose_attach_chrome_capture",!0))}})}var f=this;if(!b.gChromeExtensionMailCaptureInstall&&!b.gChromeExtensionMailCaptureCheck)return e(),void 0;var g="jmhbgmmcnagjjihogbfmghlfegaidcfj";d()}function y(a){var b=atob(a.split(",")[1]);a.split(",")[0].split(":")[1].split(";")[0];for(var c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);var f=new Blob([c]);return f}function z(){try{var c=$L("module.compose.ComposeNative",this)}catch(d){return d}var e=this;e.base;var f=e.data,g=e.editor,h="";if(R.firefox()||R.chrome()?"undefined"!=typeof FileReader&&(h="native"):R.safari()&&"undefined"!=typeof FileList&&(h="native"),h||T.has()&&(h="plugin"),h){if(e["native"]=e.attach,"native"==h&&T.has()){var i=e.module,j=new c(i);j.init(),e["native"]=j}if(e.set({status:"dragSupport",value:h}),!b.composeDrag){var k=a(b);R.ie()&&(k=a(k.dom.document.body),k.listen("dragenter",function(b){a.Event.stop(b)})),k.listen("dragover",function(){b.composeDrag.apply(null,arguments)}),b.composeDrag=function(b){var c=a.Context.module;"compose.ComposeModule"==c.mtype&&c.assist.dragOver(b,"globe")}}if(R.ie())a(g.getWindow().document.body).listen("dragover",function(a){e.dragOver(a,"editor")});else{var l=a(g.getWindow());l.listen("dragover",function(a){e.dragOver(a,"editor")}),R.firefox()&&l.listen("drop",function(a){e.dragDrop(a,"editor")},!0),l.listen("drop",function(a){e.dragDrop(a,"editor")})}var m=f.get({moduleId:"attachDrag"}),n=f.get({moduleId:"attachDragClose"});m.listen("dragover",function(a){e.dragOver(a,"area")}),m.listen("drop",function(a){e.dragDrop(a,"area")}),m.listen("click",function(b){a.Event.stop(b)}),n.listen("click",function(){e.event.setDragArea({hide:!0,force:!0})})}}function A(b){var c=this,d=c.get({status:"dragSupport"}),e=!1;if("native"==d){var f=b.dataTransfer;f.files&&f.files.length?e=!0:f.types&&a.Array.each(Q.toArray(f.types),function(b,c){return"text/html"==c?a.BREAK:"Files"==c?(e=!0,a.BREAK):void 0})}else if("plugin"==d){var g=c.create("desktop");if(g)try{var h=g.getDragData(b,"application/x-gears-files");h.count>0&&(e=!0)}catch(i){-2146827287==i.number&&(e=!0)}}return e}function B(a,b){var c=this,d=c.get({status:"dragSupport"});if(c.dragHas(a)){var e=!1;if("editor"==b){var f=0;if("native"==d){var g=a.dataTransfer;"number"==typeof g.mozItemCount?f=g.mozItemCount:g.files&&(f=g.files.length>0?g.files.length:1)}else if("plugin"==d){var h=c.create("desktop"),i=null;try{i=h.getDragData(a,"application/x-gears-files")}catch(j){}if(i&&1==i.count){var k=String(i.mimeTypes).toLowerCase();0===k.indexOf("image/")&&(f=1)}}1==f&&(e=!0)}"area"==b&&(e=!0),("globe"==b||"editor"==b)&&c.event.setDragArea({show:!0}),c.set({status:"dragEffect",value:e?"copy":"none"})}}function C(b,c){var d=this;d.get({status:"dragTarget"})!=c&&(d.set({status:"dragTarget",value:c}),d.dragCheck(b,c));var e=d.get({status:"dragEffect"});if(e){var f=b.dataTransfer;R.ie()?f.dropEffect="copy":(f.effectAllowed=e,f.dropEffect=e),d.base.addTimer("dragstop",function(){d.set({status:"dragTarget",value:""}),d.set({status:"dragEffect",value:""}),d.event.setDragArea({hide:!0})},200),a.Event.stop(b)}else d.base.addTimer("dragstop",function(){d.set({status:"dragTarget",value:""})},200)}function D(b,c){var d=this;if(d.get({status:"dragEffect"})){d.event.setDragArea({hide:!0,force:!0}),a.Event.stop(b);var e=d.get({status:"dragSupport"}),f=null,g=null;
if("native"==e){var h=b.dataTransfer;f=h.files}else if("plugin"==e){var i=d.create("desktop");if(i)try{g=i.getDragData(b,"application/x-gears-files"),f=g.files}catch(j){}}if(f&&f.length>=1&&(f=Q.toArray(f),"area"==c&&("native"==e?d["native"].nativeSelect(f):"plugin"==e&&d.attach.pluginSelect(f)),"editor"==c)){if(1!=f.length)return;var k=f[0],l="";if("native"==e?l=k.type:"plugin"==e&&(l=g.mimeTypes),l&&(l=String(l).toLowerCase()),0===l.indexOf("image/"))k.inlined=!0,"native"==e?d["native"].nativeSelect([k]):"plugin"==e&&d.attach.pluginSelect([k]);else if("text/html"==l||"text/plain"==l){var m="";if(k.getAsBinary&&k.getAsText){var n=k.size||k.fileSize||0;if(!(n>0&&102400>=n))return;var o="",p=k.getAsBinary(),q=p.substr(0,3);q==String.fromCharCode(239,187,191)||q.substr(0,2)==String.fromCharCode(255,254)||q.substr(0,2)==String.fromCharCode(254,255)||(o="GBK"),m=k.getAsText(o)}else;m&&("text/html"==l?d.editor.set({html:m}):d.editor.set({text:m}))}}}}function E(){var a=null,b=null;if("undefined"!=typeof MailAssistFactory)a=new MailAssistFactory;else try{a=new ActiveXObject("MailAssist.Factory"),b=a.create("ntes.updateservice")}catch(c){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-mailassist"]&&(a=document.createElement("object"),a.style.position="absolute",a.width=0,a.height=0,a.type="application/x-mailassist",document.body.appendChild(a),a&&"undefined"==typeof a.create&&(a=null))}a?(T.factory=a,T.updater=b?b:!1):T.factory=!1}function F(a){if(T.has())try{return T.factory.create(a)}catch(b){}return null}function G(){if(null===T.factory&&T.initFactory(),T.factory){if("undefined"!=typeof T.factory.create)return!0;T.factory=null}return!1}function H(){if(T.has()){var a=T.getVersion();if(2==a[0]&&a[1]>=1||a[0]>=3)return!0}return!1}function I(){var a=null;if(T.has()){var b=T.factory.version;b&&(a=b.split("."))}return a}function J(a){if(T.has()&&T.updater)try{return T.updater.StartUpdate(a),!0}catch(b){}return!1}function K(){var a=!1,b=R.getInfo();return"windows"==b.os&&(R.ie()||R.firefox())?(a=!0,b.shell?("360"==b.shell||"theworld"==b.shell||"sogou"==b.shell)&&(a=!0):a=!0):"macintosh"==b.os&&(R.safari()||R.firefox())&&(a=!0),a}function L(a,b){a=a||{};var c=R.getInfo();"windows"==c.os?T.installWindows(a,b):"macintosh"==c.os&&T.installMac(a,b)}function M(c,d){function e(){}function f(a){function b(){var a=$I("util.Misc");a.redirect(S.getUrl("compose_attach_chrome21_setup"))}a?a.send({action:"force",call:function(){b()}}):b()}var g=R.getInfo(),h=c.close||a.EMPTYFUNC();if(R.ie()){var i=$I("util.Misc");i.redirect(S.getUrl("compose_attach_setup"))}else if(R.firefox())try{var j="compose_attach_plugin",k=R.getVersion()||[0,0];if(k[0]>=5&&(j="compose_attach_firefox"),"undefined"!=typeof InstallTrigger)InstallTrigger.install({NetEaseMailPlugin:S.getUrl(j,!0)});else{h();var l=a.Msgbox.show({title:"邮箱插件提示",content:"请按照浏览器顶部安装栏提示，按“允许”安装插件。<br><br>安装成功后选择立即重启浏览器即可使用该功能！",ok:function(){T.install({close:function(){l.close()}})}});if(!a("#ifrDownUrl")){var m=a.Element.create("IFRAME");m.attr({id:"ifrDownUrl"}),m.css({display:"none"}),document.body.appendChild(m.dom)}a("ifrDownUrl").attr({src:S.getUrl(j,!0)})}}catch(n){}else if(R.chrome()){h();var k=R.getVersion()||[0,0];if(k[0]>=21&&!g.__shell)if("163.com"==$S("domain"))try{var o=S.getUrl("compose_attach_chrome21",!0),p=document.createElement("LINK");p.rel="chrome-webstore-item",p.href=o;var q=document.getElementsByTagName("HEAD")[0];q.appendChild(p),chrome.webstore.install(o,function(){b.setTimeout(e,1e3)},function(){f(d)})}catch(n){f(d)}else f(d);else{if(a.Msgbox.show({title:"邮箱插件提示",content:"请按照浏览器底部下载栏提示，按“继续”安装插件。<br><br>安装成功后可马上使用新功能！",ok:function(){b.setTimeout(e,1e3)}}),!a("#ifrDownUrl")){var m=a.Element.create("IFRAME");m.attr({id:"ifrDownUrl"}),m.css({display:"none"}),document.body.appendChild(m.dom)}a("#ifrDownUrl").attr({src:S.getUrl("compose_attach_chrome",!0)})}}}function N(c){var d=c.close||a.EMPTYFUNC();if(d(),R.safari()||R.chrome()){var e=S.getUrl("compose_attach_mac_plugin");b.open(e)}else if(R.firefox())try{var e=S.getUrl("compose_attach_mac_firefox");b.open(e);var f=a.Msgbox.show({title:"邮箱插件提示",content:"请按照浏览器顶部安装栏提示，按“允许”安装插件。<br><br>安装成功后选择立即重启浏览器即可使用该功能！",ok:function(){T.install({close:function(){f.close()}})}});if(!a("#ifrDownUrl")){var g=a.Element.create("IFRAME");g.attr({id:"ifrDownUrl"}),g.css({display:"none"}),document.body.appendChild(g.dom)}a("#ifrDownUrl").attr({src:e})}catch(h){}}try{var O=$L("module.compose.Compose")}catch(P){return P}var Q=a.Object,R=a.Browser,S=a.Uri,T=a.createClass($N("module.compose.ComposeAssist"));Q.inherit(T,O),Q.extend(T.prototype,{initialize:c,init:d,clear:e,get:f,set:g,create:h,setup:i,install:j,destroy:k,requestGet:l,captureGet:m,captureStart:n,captureResult:o,captureUpload:p,captureDestroy:q,clipInit:r,clipMenu:s,clipKey:t,clipPaste:u,clipImage:v,nativeClipImage:w,nativeCapture:x,dataUrlToBlob:y,dragInit:z,dragHas:A,dragCheck:B,dragOver:C,dragDrop:D}),Q.extend(T,{factory:null,updater:null,initFactory:E,createFactory:F,has:G,hasNewVersion:H,getVersion:I,startUpdate:J,support:K,install:L,installWindows:M,installMac:N})}($,window),function(a,b){function c(a){var b=this;yc.superClass.initialize.call(b,a)}function d(){var a=this;yc.superClass.init.call(a)}function e(){var a=this;yc.superClass.clear.call(a)}function f(){var b=this;b.postStop&&b.postStop();var c=b.fileGet();a.Array.each(c,function(c,d){"function"==typeof d["delete"]&&d["delete"](),d.cloud&&"upload"==d.state&&d.ret&&d.ret.oid&&a.Ajax.jsonp(b.getUploadProxy({type:"script",file:d,cancel:!0}),function(){})})}function g(a){var b=this,c=b.data;if(b.initUploadHost(),"super"==c.get({status:"uploadMode"})&&$E("support.CloudSupport",function(a){a.init()}),"plugin"!=a){var d=b.sourceGet("element");d.browser.listen("mouseover",function(){d.link.addClass("nui-txt-link-hover")}),d.browser.listen("mouseout",function(){d.link.removeClass("nui-txt-link-hover")}),$S("isCorp")&&(d.browserCloud.listen("mouseover",function(){d.linkCloud.addClass("nui-txt-link-hover")}),d.browserCloud.listen("mouseout",function(){d.linkCloud.removeClass("nui-txt-link-hover")}))}}function h(){var b=this,c=b.data,d=b.sourceGet("element");d.link=c.get({moduleId:"attachAdd"}),d.browser=c.get({moduleId:"attachBrowser"}),d.operate=c.get({moduleId:"attachOperate"}),d.area=c.get({moduleId:"attachArea"}),d.content=c.get({moduleId:"attachContent"}),d.progress=c.get({moduleId:"attachProgress"}),d.linkCloud=c.get({moduleId:"attachAddCloud"}),d.browserCloud=c.get({moduleId:"attachBrowserCloud"});var e=c.get({moduleId:"attachDashi"});e&&e.listen("click",function(){uc.cache({cl_dashi:1},a.EMPTYFUNC)})}function i(){if(!$S("uploadProxy")){var b=a.Cookie.get("mail_upx",!0);if($S("isCorp")&&(b=a.Cookie.get("qiye_mail_upx",!0)),b=a.String.trim(b)){var c=b.split("|");c.length&&$S("uploadProxy",c)}}}function j(a){return this.data.attachments[a]}function k(){var b=this,c=b.sourceGet("element"),d=b.sourceGet("layout"),e=c.operate,f=c.content,g=e.dom.clientWidth-10;if(!d.baseWidth||d.baseWidth!=g){d.baseWidth=g;var h=g+12,i=g+d.spaceWidth;f.css({width:h+"px"});var j=d.attachWidth+d.spaceWidth,k=Math.floor(i/j)||1,l=i%j,m=Math.floor(l/k),n=d.attachWidth+m;d.blockWidth=n;var o=b.fileGet();a.Array.each(o,function(a,b){var c=b.ui.container;c.css({width:n+"px"})})}}function l(b){var c=this;if($S("isCorp"))return c.corpFilterCheck(b);var d=c.data,e=b.files,f=b.submit,g=b.cancel,h=1024*1024*$S("attachSize");$S("isVip")&&(h=52428800);var i=c.fileSize();$S("isCorp")&&(i=c.fileSize({cloud:!1}));var j=c.fileSize({context:!0}),k=0,l=h-i,m=0,n=0,o=0,p=0,q=0,r=!0,s=!0,t=!1,u=!1;if($S("cloud")&&c.getUploadHost()&&(m=$S("cloud").fileSizeLimit,n=$S("cloud").capacity,o=n-$S("cloud").spaceUsed,p=$S("cloud").duration),a.Array.each(e,function(a,b){if(b.err||(b.extLimit?b.err="extension":0===b.size?b.err="empty":m>0&&b.size>m?b.err="limitBig":o>0&&b.size+q>o?b.err="quotaBig":c.cloudTrigger()||(b.size>l?b.err="limit":b.size+q>l&&(b.err="quota"))),b.err&&("limit"==b.err||"quota"==b.err))if(c.cloudStatus())b.err="",t=!0;else{try{var d=$S("cloud")?"1":"0",e=c.getUploadHost()?"1":"0",f={code:"CLOUD_ERROR",cloud:d,host:e};uc.record("attach",f)}catch(g){}$E("support.CloudSupport",function(a){a.init()})}b.err?r=!1:(s=!1,q+=b.size,b.inlined&&(k+=b.size))}),j+k>h)return a.Msgbox.show({header:"附件上传提示",icon:"err",title:"添加的图片总大小不能超过"+a.Number.convert(h)}),void 0;if(t)return c.cloudTrigger(!0),c.movePrepare(q),c.cloudAutoTips(),c.prompt({cloud:!0}),c.filterCheck(b),void 0;if(c.cloudTrigger());else if($S("isCorp"));else{var v=q+i-j-k;if(c.cloudStatus()&&v>20971520){var w=wc.get({field:"ntes_compose",flag:"upload_mode"}),x=parseInt(w,10),y=!1;if("0"==w){c.base;var z=c.form,A=[],B=[];if(d.get({status:"useSeparate"})?B[0]="separate":B=["to","cc","bcc"],a.Array.each(B,function(a,b){var c=z.getContact("suc",b);A=A.concat(c)}),0===A.length)y=!0;else{var C=["qq.com","vip.qq.com","163.com","126.com","yeah.net","vip.163.com","vip.126.com","188.com","vip.188.com"];a.Array.each(A,function(b,c){var d=c.domain.toLowerCase();return a.Array.has(C,d)?void 0:(y=!0,a.BREAK)})}y||(x=2)}else"1"==w&&(y=!0);y&&(c.cloudTrigger(!0),c.movePrepare(q),c.filterCheck(b),c.prompt({cloud:!0}),u=!0)}}u||(r?f({ignore:null,select:e}):s?(c.filterFail(e),g()):c.filterSelect(e,f,g,q,l))}function m(b){var c=this;c.data;var d=b.files,e=b.submit,f=b.cancel,g=1024*1024*$S("attachSize"),h=c.fileSize({cloud:!1}),i=g-h,j=c.fileSize({cloud:!0}),k=0,l=0,m=0,n=0,o=0,p=!0,q=!0;$S("cloud")&&c.getUploadHost()&&(k=$S("cloud").fileSizeLimit,l=$S("cloud").capacity,m=l-$S("cloud").spaceUsed-j,n=$S("cloud").duration),a.Array.each(d,function(a,b){b.err||(b.extLimit?b.err="extension":0===b.size?b.err="empty":b.cloud?0===k||0===m?b.err="errorBig":b.size>k?b.err="limitBig":b.size+o>m&&(b.err="quotaBig"):b.size>i?b.err="limit":b.size+o>i&&(b.err="quota")),b.err?p=!1:(q=!1,o+=b.size)}),p?e({ignore:null,select:d}):q?(c.filterFail(d),f()):c.filterSelect(d,e,f,o,i)}function n(b){var c="<h4>您选择的文件不能上传，原因如下：</h4>";a.Array.each(b,function(b,d){var e=d.name;a.String.len(e)>22&&(e=a.String.left(e,18));var f=d.err;yc.errDescription[f]&&(f=yc.errDescription[f],"limitBig"==d.err&&(f="云附件单个文件大小超过"+a.Number.convert($S("cloud").fileSizeLimit)+"限制")),c+='<p><span title="'+d.name+'">'+e+"</span>"+'<span class="nui-txt-impt">('+f+")</span>"+"</p>"}),a.Msgbox.show({header:"附件上传提示",icon:"err",content:c})}function o(b,c,d,e,f){var g=this,h=[],i=[],j=!1;g.cloudStatus()&&(f=$S("cloud").capacity-$S("cloud").spaceUsed),b=b.sort(function(a,b){return b.size-a.size}),a.Array.each(b,function(b,c){var d=c.name;if(a.String.len(d)>28&&(d=a.String.left(d,24)),("limit"==c.err||"quota"==c.err||"limitBig"==c.err||"quotaBig"==c.err)&&(j=!0,("quota"==c.err||"quotaBig"==c.err)&&(c.err="",e+=c.size)),c.err){var f=c.err;yc.errDescription[f]&&(f=yc.errDescription[f]),i[i.length]='<tr class="nui-table-row nui-table-row-disabled"><td class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input disabled="disabled" class="nui-chk-symbol" type="checkbox"/></label></td><td class="nui-table-cell P0"><b class="nui-ico nui-ico-att"></b></td><td class="nui-table-cell t0"><span title="'+c.name+'">'+d+"</span>"+'<span class="nui-txt-impt" title="'+f+'">('+f+")</span>"+"</td>"+'<td class="nui-table-cell I0">'+a.Number.convert(c.size)+"</td>"+"</tr>"}else h[h.length]='<tr class="nui-table-row nui-table-row-selected"><td class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input value="'+b+'" checked="checked" class="nui-chk-symbol" type="checkbox"/></label></td>'+'<td class="nui-table-cell P0"><b class="nui-ico nui-ico-att"></</td>'+'<td class="nui-table-cell t0">'+'<span title="'+c.name+'">'+c.name+"</span>"+"</td>"+'<td class="nui-table-cell I0">'+a.Number.convert(c.size)+"</td>"+"</tr>"});var k="您选择的部分附件由于以下原因，不能上传";j&&(k="本次选择的附件大小不能超过"+a.Number.convert(f));var l='<div class="nui-simpleTable nui-table bc0"><table><thead class="nui-table-head"><tr class="nui-table-row"><th class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input id="objMsgSelectAll" class="nui-chk-symbol" type="checkbox"/></label></th><th class="nui-table-cell s0">文件名</th><th class="nui-table-cell C0">大小</th></tr></thead></table></div><div class="bm0" style="overflow-y:scroll"><div class="nui-simpleTable nui-table bn0"><table id="tabMsgSelectList"><tbody class="nui-table-body">'+i.join("")+h.join("")+"</tbody>"+"</table>"+"</div>"+"</div>"+'<div id="divMsgSelectTips" class="nui-normalTips nui-tips be0"></div>',m=function(){var b,c=a("#divMsgSelectTips");c.removeClass("g-tips-popup-err"),c.removeClass("g-tips-popup-succ"),e>f?(b='<b class="nui-ico nui-ico-err"></b>已选择了'+a.Number.convert(e)+"，超出"+a.Number.convert(e-f),c.addClass("g-tips-popup-err")):(b='<b class="nui-ico nui-ico-suc"></b>已选择了'+a.Number.convert(e)+"，可以上传",c.addClass("g-tips-popup-succ")),i.length&&(b+='<span class="txt-tips">(有<strong>'+i.length+"</strong>个不能选择)</span>"),c.html(b)},n=a.Msgbox.show({type:"confirm",header:"附件上传提示",content:l,contentType:"wide",ok:function(){var d=[],e=[];a.Array.each(b,function(a,b){b.err?d.push(b):e.push(b)}),c({ignore:d,select:e})},cancel:d,close:d});m(),e>f&&n.buttons.ok.setDisabled(!0);var o=[],p=a("#objMsgSelectAll");p.listen("click",function(){var b=p.dom.checked;a.Array.each(o,function(a,c){c.dom.checked!=b&&c.dom.click()})}),a("#tabMsgSelectList").find("tr").each(function(c,d){d=a(d);var g=d.find("input");g.dom.disabled||(o.push(g),g.listen("click",function(){var a=parseInt(g.dom.value,10),c=b[a];g.dom.checked?(c.err="",e+=c.size,d.addClass("nui-table-row-selected")):(c.err="cancel",e-=c.size,d.removeClass("nui-table-row-selected")),m(),n.buttons.ok.setDisabled(e>f)}),d.listen("mouseover",function(){-1==d.dom.className.indexOf("nui-table-row-selected")&&d.addClass("nui-table-row-hover")}),d.listen("mouseout",function(){d.removeClass("nui-table-row-hover")}),d.listen("click",function(b){var c=a.Event.getTarget(b);c&&"string"==typeof c.type&&"checkbox"==c.type.toLowerCase()||g.dom.click()}))})}function p(b){var c=this,d=c.sourceGet("element"),e=c.sourceGet("tips"),f=$S("cloud"),g="";if(b.capacity&&f){var h,i=f.spaceUsed,j=f.capacity;if(h=0===j?0:Math.floor(100*(i/j)),h>=90){if(!e.capacity){var k=a.Element.create("DIV");k.html('<div class="nui-tips nui-normalTips nui-normalTips-err">云附件容量已满，请先 <a href="javascript:void(0)">清理云附件</a> 再继续上传文件。</div>'),e.capacity=k,d.content.after(k.dom),k.find("A").listen("click",function(){c.cloudManage()})}e.capacity.show()}else e.capacity&&e.capacity.hide()}if(b.plugin&&!e.plugin&&!oc.has()&&oc.support()){g=b.text||"想更快速闪电上传多个附件，推荐";var k=a.Element.create("DIV");k.setClass("M0"),k.html(g),d.content.after(k.dom),e.plugin=k,new a.Link({text:"安装插件",renderTo:k,click:function(){c.assist.setup("new")}}),new a.Link({cls:"nui-ico nui-ico-x",renderTo:k,icon:"close",click:function(){e.plugin.remove(),e.plugin=null,c.setAuto({type:"auto"})}}),d.area.show()}if(b.cloud&&!e.cloud){var l=$S("cloud").duration;g=b.text||"附件将作为云附件上传，<span class='nui-txt-impt'>"+l+"天</span>内有效，若被删除或过期，收件人将无法下载。";var k=a.Element.create("DIV");k.setClass("M0"),k.html(g),d.content.after(k.dom),e.cloud=k,new a.Link({text:"修改设置",cls:"nui-txt-link",renderTo:k,click:function(){$E(["interface.OptionInterface"],function(a){a.entry({module:"BaseSetModule",inputName:"uploadmode"})})}}),new a.Link({cls:"nui-ico nui-ico-x",renderTo:k,click:function(){e.cloud.remove(),e.cloud=null,c.setAuto({type:"auto"})}}),d.area.show()}b.remove&&(b.keys?a.Array.each(b.keys,function(a,b){e[b]&&(e[b].remove(),e[b]=null)}):rc.each(e,function(a,b){b&&(b.remove(),e[a]=null)}))}function q(a){a=a||{};var b=this,c=a.value;"string"==typeof a.status?b.sourceGet("status")[a.status]=c:"string"==typeof a.element&&(b.sourceGet("element")[a.element]=c)}function r(b,c,d){var e=this;if(b.state=c,b.ui){var f=!1,g=!1,h=!1,i="",j=null,k=a.Number.convert(b.size)+" ";if(b.cloud)switch(b.state){case"select":i="待扫描，请稍候...";break;case"hash":i=-1==b.percent?"扫描中，请稍候...":"扫描中，已完成"+b.percent+"%";break;case"hashover":i="扫描完毕，开始上传";break;case"wait":i=""===b.fid?"待上传，请稍候...":"待续传，请稍候...";break;case"upload":if(-1==b.bytesLoaded)i=""===b.fid?"正在上传...":"正在续传...",e.cloudRename(b);else{c="percent";var l=b.speed,m=yc.getSize(b.bytesLoaded,2),n=yc.getSize(l.second,2)+"/S",o=yc.getRemain(l.remain);j={uploaded:m,speed:n,remain:o}}break;case"pause":break;case"error":f=!0,i=d||b.err;break;case"success":f=!0,g=!0,h=!0,e.cloudRename(b),i=k+"上传完成";break;case"link":switch(b.fileExist){case 1:i=k+'<span class="nui-txt-suc">续传完成</span>';break;case 2:i=k+'<span class="nui-txt-suc">已存在此文件，快速上传完成</span>';break;default:i=k+'<span class="nui-txt-suc">上传完成</span>'}break;default:return}else switch(c){case"link":i=k+"上传完成";break;case"error":f=!0,i=d||b.err;break;case"success":f=!0,g=!0,i=k+'<span class="nui-txt-suc">上传完成</span>';break;case"select":case"wait":i="待上传，请稍候...","form"==b.type&&(i="您选择的附件将在点击发送后进行上传");break;case"upload":if(-1==b.bytesLoaded)i="正在上传...";else{c="percent";var l=b.speed,m=yc.getSize(b.bytesLoaded,2),n=yc.getSize(l.second,2)+"/S",o=yc.getRemain(l.remain);j={uploaded:m,speed:n,remain:o}}break;case"hash":i=b.percent&&-1==b.percent?"扫描中，请稍候...":"扫描中，已完成"+b.percent+"%";break;case"fast":i="快速上传中...";break;default:return}e.setInfo(b,c,i,j),"error"==c&&e.setTotalProgress(),g&&"function"==typeof b["delete"]&&b["delete"](),f&&e.fileAutoUpload(),h&&e.cloudConvert(b)}}function s(b,c,d,e){c=c||"text";var f=b.ui;if(f){var g=f.info,h=f.tips,i=b.ui.container,j="q0";if("percent"==c){var k=b.percent+"%",l=k,m="";if(e&&e.remain){l+=",剩余时间:"+e.remain;var n=a.Number.convert(b.size),o=a.String.escapeHTML(b.name);m=o+", 文件大小:"+n+", 已上传"+e.uploaded+", 上传速度:"+e.speed}var p='<div class="nui-progress"><span class="nui-progress-bar"><span class="nui-progress-bar-inner" style="width:'+k+';"></span>'+"</span>"+'<span class="nui-progress-text">'+l+"</span>"+"</div>";k&&g.html(p),m&&h.html(m)}else"error"==c?(i.addClass(j),d&&g.html(d),e&&e.text?h.html(e.text):(h.html(""),h.hide())):"resum"==c?i.removeClass(j):(d&&g.html(d),"success"==c&&(h.html(""),h.hide()))}}function t(a){var b=this;0===a.offset&&b.setProgress(a,0)}function u(a){var b=this,c=!1;0===a.length?c=!0:a.offset+a.length==a.size&&(c=!0),c&&(b.setLock(a,!0),b.setProgress(a,99))}function v(b,c){var d=this;if(b)if("boolean"==typeof b.lock)b.lock=c;else{var e=b;a.Array.each(d.fileGet(e),function(a,b){d.setLock(b,c)})}}function w(a,b,c){var d,e=this,f=a.size,g=b;0===a.length?c>f&&(d=Math.floor(100*(b/c)),g=Math.floor(f*(d/100))):g+=a.offset,a.bytesLoaded=g,d=Math.floor(100*(g/f)),d>98&&(d=98),e.setProgress(a,d)}function x(a,b,c){var d=this;if(a.bytesHashed=b,c)"-1"!=c&&(a.md5=c.toLowerCase()),a.percent=-1,d.setState(a,"wait"),d.fileAutoUpload();else{var e=Math.floor(100*(b/a.size));if(a.percent==e)return;a.percent=e,d.setState(a,"hash")}}function y(a){var b=(new Date).valueOf(),c=a.speed;if(c){var d=b-c.time;if(d>0){var e=a.bytesLoaded;if(e>0){var f=Math.round((e-c.bytes)/(d/1e3));f>0&&(c.bytes=e,c.second=f,c.remain=parseInt((a.size-e)/f,10)+1)}}}else c=a.speed={bytes:0,second:0,remain:-1};c.time=b}function z(a,b){var c=this;if(a.percent==b){var d=a.speed;if(!d)return;if((new Date).valueOf()-d.time<=1e3)return}else a.percent=b;switch(c.setSpeed(a),b){case 0:c.setState(a,"upload");break;case 100:c.setState(a,"success");break;default:c.setState(a,"upload")}sc.newAttach&&a.inlined?c.inlinedProgress():c.setTotalProgress()}function A(){var b=this,c=b.sourceGet("element"),d=c.progress,e=b.fileProgress(),f=e.percent,g=e.bytesLoaded,h=e.bytesTotal;if(b.get({status:"totalBytes"})==h&&b.get({status:"totalPercent"})==f);else{if(f){var i="("+f+"%,已上传"+a.Number.convert(g)+",总文件大小"+a.Number.convert(h)+")";d.show(),d.html(i)}else d.hide();b.set({status:"totalBytes",value:h}),b.set({status:"totalPercent",value:f})}}function B(a){a=a||{};var b=this;return"string"==typeof a.status?b.sourceGet("status")[a.status]:"string"==typeof a.element?b.sourceGet("element")[a.element]:a.count?b.fileCount():a.file?b.fileGet(a.file):void 0}function C(a){var b=this,c=!1;return b.getUploadHost()&&(a.inlined||(a.cloud?(a.md5?b.setInfo(a,"","正在尝试速传，请稍候..."):b.setInfo(a,"","正在检查容量，请稍候..."),c=!0):a.md5?(b.setState(a,"fast"),c=!0):a.sid&&(c=!0))),c&&(b.setLock(a,!0),b.setState(a,"upload")),c}function D(){var a=this,b=a.data,c="";if(b.get({status:"useWmsvr"}))return c;var d=$S("uploadProxy");return d&&d.length&&(c=d[0]),c}function E(c){var d=this,e=c.type,f=xc.getUrl("compose_upload_url",!0);if(f+="&composeId="+d.info.get({cid:!0}),f+="&type="+e,"flash"==e){var g=a.Cookie.get("Coremail",!0);g=encodeURIComponent?encodeURIComponent(g):b.escape(g),f+="&Cookie.Coremail="+g}return f}function F(b){var c=this,d=b.type,e=b.file,f="get";b.options&&(f=b.options);var g={},h=c.getUploadHost();""===h&&(h=$S("orgHost"));var i="http://"+h;if(i+="/upxmail/upload",i+="?sid="+$S("sid"),i+="&uid="+$S("orgUid"),i+="&cid="+c.info.get({cid:!0}),i+="&host="+$S("orgHost"),i+="&ver=js6",i+="&agent="+d,"script"==d||(g.cmc=a.Cookie.get("Coremail",!0),g.urs=$S("isCorp")?a.Cookie.get("QIYE_SESS"):$S("ursCookie")),e)if(g.type=e.cloud?1:0,g.name=e.name,g.size=e.size,e.path&&(g.path=e.path),e.md5&&(g.md5=e.md5),e.modtime&&(g.modtime=e.modtime),e.ret&&rc.each(e.ret,function(a,b){g[a]=b}),b.check)if(e.cloud){i+="&chk=true";var j=c.moveSize();j>0&&(g.xsize=j)}else i+="&qry=true";else b.cancel?i+="&cal=true":(e.offset&&(g.offset=e.offset),e.length&&(g.length=e.length),e.inlined);else b.move&&(i+="&mov=true"),b.aid&&(g.aid=b.aid.join("|")),"number"==typeof b.size&&(g.size=b.size);switch(rc.each(g,function(a,b){"string"!=typeof b&&(g[a]=String(b).valueOf())}),f){case"body":var k="",l=[];rc.each(g,function(a,b){l.push(a+"="+encodeURIComponent(b))}),l.length&&(k=l.join("&")),e.options=k;break;case"form":e.options=g;break;case"header":var m={};rc.each(g,function(a,b){m["Mail-Upload-"+a]=encodeURIComponent(b)}),e.options=m;break;default:rc.each(g,function(a,b){i+=["&",a,"=",encodeURIComponent(b)].join("")}),"script"==d||(i+="&t="+(new Date).valueOf()),e&&(e.options=null)}return i}function G(){var b=this,c=[];return a.Array.each(b.fileGet(),function(a,b){if("success"==b.state||"link"==b.state){var d={name:b.name,icon:b.icon};c.push(d)}}),c}function H(){var a=$S("uploadProxy");a&&a.length&&a.shift()}function I(a){a=a||{};var b=this,c={},d=a.type,e=a.path,f=a.name,g=a.mime,h=a.size,i=a.sid,j=a.eid;if(rc.extend(c,yc.file),d&&(c.type=d),e?(c.path=e,f||(f=e.replace(new RegExp(".*"+yc.symbol),"")),b.fileGet({path:e}).length>=1&&(c.pathExist=!0)):f&&(f=f.replace(new RegExp(".*"+yc.symbol),"")),f){c.name=f,c.icon=pc.getSubtype({type:"file32",name:f});var k=f.split(".");if(k.length>1){var l=k.pop();l&&(l=l.toLowerCase(),c.ext=l,-1!=tc.indexOf("."+l+".")&&(c.extLimit=!0))}}return g&&(c.mime=g),"number"==typeof h&&(c.size=h,"storage"==d&&(c.bytesLoaded=h)),i&&(c.sid=i),j&&(c.eid=j),a.cloud&&(c.cloud=a.cloud),c}function J(a){var b=this;return a?b.fileGet(a).length:rc.count(b.sourceGet("files"))}function K(a){a=a||{};var b=this,c=[],d=b.sourceGet("files");return rc.each(d,function(b,d){var e=!0;rc.each(a,function(a,b){d[a]!=b&&(e=!1)}),e&&c.push(d)}),c}function L(a){var b=this,c=b.get({status:"fileIndex"}),d=b.sourceGet("files");a.cid="order_"+c++,b.set({status:"fileIndex",value:c}),d[a.cid]=a}function M(a,b){var c=this,d="";"string"==typeof a?d=a:"object"==typeof a&&(d=a.cid);var b=c.sourceGet("files");return d&&b[d]?(delete b[d],!0):!1}function N(a){var b=this,c=!1;return b.fileCount(a)>0&&(c=!0),c}function O(b){var c=this,d=0,e=c.fileGet(b);return a.Array.each(e,function(a,b){b.size>0&&(d+=b.size)}),d}function P(a){var b=this,c=b.base,d=null,e=!0;a||(d=b.fileGet({state:"upload"}),0===d.length&&(d=b.fileGet({state:"wait"}),0===d.length&&c.runSequence("attachMove"))),d=b.fileGet({type:"flash",state:"upload"},a),0===d.length?(d=b.fileGet({type:"flash",state:"wait"},a),d.length&&(b.flashCheckFile(d[0]),e=!1)):e=!1,d=b.fileGet({type:"plugin",state:"upload"},a),0===d.length?(d=b.fileGet({type:"plugin",state:"wait"},a),d.length&&(b.pluginCheck(d[0]),e=!1)):e=!1,d=b.fileGet({type:"native",state:"upload"},a),0===d.length?(d=b.fileGet({type:"native",state:"wait"},a),d.length&&(b.nativeCheck(d[0]),e=!1)):e=!1,b.fileAutoHash(a)&&(e=!1);var f=!e;return f||e&&c&&c.runSequence("uploadResult",0),f}function Q(a){var b=this,c=null,d=!1;return c=b.fileGet({type:"plugin",state:"hash"},a),0===c.length?(c=b.fileGet({type:"plugin",state:"select"},a),c.length&&(b.pluginHash(c[0]),d=!0)):d=!0,d}function R(b){var c=this,d=0,e=0,f=0;return b=b||(sc.newAttach?{inlined:!1}:null),a.Array.each(c.fileGet(b),function(a,b){e+=b.size,"error"==b.state||-1!=b.bytesLoaded&&(f+=-1==b.percent?b.bytesLoaded:Math.floor(b.size*(b.percent/100)))}),0===e?f=0:d=Math.round(100*(f/e)),{percent:d,bytesLoaded:f,bytesTotal:e}}function S(b,c){var d,e=this;e.setLock(b,!1);try{d=a.Eval.get("("+c+")")}catch(f){d={code:"JS_EVAL"}}var g={code:d.code};if(d.code==vc){if("number"==typeof d.type){if(b.length){if(b.offset+=b.length,b.offset!=b.size)return b.ret=d.ret||b.ret,0===d.type&&b.ret&&b.ret.aid&&(b.sid=b.ret.aid),g["continue"]=!0,g;b.length=0}var h=d["var"];switch(d.type){case 0:b.sid=h.attachmentId;break;case 1:b.fid=h.fid,h.dupname&&(b.nameExist=!0,b.name=h.fileName),b.link=h}}else b.sid=d.attachId;e.setBytes(b,b.size,b.size),e.setProgress(b,100),b.inlined?e.inlineInsert(b):!b.cloud&&a.Array.has(["31","32","33"],b.icon)&&a.Array.has(["31","32","33"],b.icon)&&e.setInsert(b),b.retry=0}else{var i=d.overflowReason||"";e.error(b,d.code,i)&&(g.retry=!0)}return g}function T(){var a=this;return a.fileHas({state:"upload"})||a.fileHas({state:"hash"})}function U(){var a=this,b=!1;return a.fileGet({type:"form",state:"wait"}).length>=1&&(b=!0),b}function V(){var a=this;return sc.newAttach?a.fileHas({state:"error",inlined:!1}):a.fileHas({state:"error"})}function W(b){var c=this,d=c.data,e=c.sourceGet("status");e.layoutInit||(c.layout(),e.layoutInit=!0);var f=c.sourceGet("layout");if(c.cloudTrigger()){switch(b.type){case"flash":case"plugin":case"native":b.context||b.inlined?b.context=!0:b.cloud=!0}c.prompt({capacity:!0})}var g,h,i,j,k,l=c.base,m=b.name;if(g=a.Element.create("DIV"),g.setClass("G0"),b.mixed||b.inlined&&sc.newAttach&&g.css({display:"none"}),f.blockWidth){var n=f.blockWidth+"px";g.css({width:n})}new a.Icon({renderTo:g,type:"file32",subtype:b.icon}),h=a.Element.create("DIV"),h.setClass("o0"),h.html(a.String.escapeHTML(m)),b.path?h.attr({title:b.path}):h.attr({title:m}),i=a.Element.create("DIV"),i.setClass("j0"),k=a.Element.create("DIV"),k.setClass("m0"),function(){var d=a.Element.create("A");d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html("删除"),d.listen("click",function(d){c.remove(b),c.netCheckClear(),a.Event.cancel(d)}),k.append(d.dom)}(),b.download&&function(){h.css({width:"170px"});var c=a.Element.create("SPAN");c.html("|"),k.append(c.dom);var d=a.Element.create("A");d.attr({target:"_blank",href:b.download}),d.addClass("nui-txt-link"),d.html("下载"),a.Browser.chrome()&&b.mime&&d.listen("dragstart",function(a){var c=[b.mime,m,b.download].join(":");try{a.dataTransfer.setData("DownloadURL",c)}catch(d){}}),k.append(d.dom)}(),j=a.Element.create("DIV"),j.setClass("n0"),j.css({display:"none"}),g.append(h.dom),g.append(k.dom),g.append(i.dom),g.append(j.dom),b.ui={container:g,name:h,info:i,tips:j,ctrl:k},"form"==b.type?c.setState(b,"wait"):"storage"==b.type?(c.setState(b,"success"),b.cloud||b.url||!a.Array.has(["31","32","33"],b.icon)||a.Array.has(["31","32","33"],b.icon)&&c.setInsert(b)):"link"==b.type?c.setState(b,"link"):"plugin"==b.type&&b.path?c.setState(b,"select"):c.setState(b,"wait"),d.get({status:"confirmSubject"})&&""===l.form.getSubject()&&(!b.url||"名片.vcf"!=m&&"信纸.jpg"!=m)&&(function(){var a;if(b.media)a=$I("init.SenderList").getName()+"录制的音视频邮件";else{var c=m.split(".");c.length>1&&c.pop(),a=c.join(".")}l.form.setSubject(a)}(),d.set({status:"confirmSubject",value:!1})),c.fileAdd(b),c.setAuto({type:"add",element:g}),c.setTips(b)}function X(b){var c=this;if(sc.newAttach&&b.inlined)c.inlinedError(b);else{var d=b.ui,e=d.name,f=d.ctrl;!function(){if(!b.ui.resum){e.css({width:"170px"});var d=a.Element.create("SPAN");d.html("|"),f.append(d.dom);var g=a.Element.create("A");g.attr({href:"javascript:void(0)"}),g.addClass("nui-txt-link"),g.html("续传"),g.listen("click",function(e){c.setInfo(b,"resum"),d.remove(),g.remove(),b.ui.resum=null,b.retry=0,c.setState(b,"wait"),c.fileAutoUpload(),a.Event.cancel(e)}),f.append(g.dom),b.ui.resum=g}}()}}function Y(b,c){var d=this,e=arguments;if(!b.lock){if(b.sid)return d.action.deleteAttach({sid:b.sid,callback:function(a){a.code==vc&&(d.inlineRemove(b),b.sid="",d.remove.apply(d,e))}}),void 0;if("function"==typeof b["delete"]&&b["delete"](),b.cid&&d.fileDelete(b),b.ui){var f=b.ui,g=f.container;b.ui=null,d.setAuto({type:"remove",element:g})}b.cloud&&"upload"==b.state&&b.ret&&b.ret.oid&&a.Ajax.jsonp(d.getUploadProxy({type:"script",file:b,cancel:!0}),function(){}),d.cancelAutoSend("您已删除上传的附件，自动发送取消"),d.fileAutoUpload(),"function"==typeof c&&c()}}function Z(a){var b=this,c=b.sourceGet("element"),d=a.type,e=a.element,f=b.fileCount();if("add"==d?c.content.append(e.dom):"remove"==d&&e.remove(),f>0)c.area.show();else{c.area.hide(),b.prompt({remove:!0,keys:[]});try{var g=b.sourceGet("tips");g.plugin&&(g.plugin.remove(),g.plugin=null)}catch(h){}}("add"==d||"remove"==d)&&b.setTotalProgress()}function $(b){var c=this,d=b.ui,e=d.ctrl,f=a.Element.create("A");f.attr({href:"javascript:void(0)"}),f.addClass("nui-txt-link"),f.html("插入正文"),f.listen("click",function(d){var e=c.fileSize({context:!0}),f=1024*1024*$S("attachSize");return e+b.size>f?(a.Msgbox.show({title:"附件上传提示",icon:"err",content:"添加的图片总大小不能超过"+a.Number.convert(f)}),void 0):(sc.newAttach?b.mixed=!0:b.inlined=!0,b.context=!0,c.inlineInsert(b),a.Event.cancel(d),void 0)}),e.prepend(f.dom),d.name.css({width:"148px"})}function _(b){var c=b.ui,d=c.container,e=!1,f=a.Browser.getVersion()||[0,0];a.Browser.ie()&&6==f[0]&&(e=!0),d.listen("mouseover",function(){c.tips.html()&&(c.tips.show(),e&&d.css({zIndex:"100"}))}),d.listen("mouseout",function(){c.tips.hide(),e&&d.css({zIndex:"1"})})}function ab(a){var b=this;if(a.inlined||a.mixed){var c=xc.getUrl("compose_get_data",!0);c+="&composeId="+b.info.get({cid:!0}),c+="&attachId="+a.sid,c+="&rnd="+Math.random(),b.editor.insert({image:c})}}function bb(a){var b=this;if(a.inlined||a.context){var c=new RegExp("&sid="+$S("sid")+"&composeId="+b.info.get({cid:!0})+"&attachId="+a.sid,"i");b.editor.remove({tag:"img",reg:c}),a.inlined=a.context=!1}}function cb(){var b=this,c=[],d=b.fileGet({type:"storage",inlined:!0});return a.Array.each(d,function(a,b){b.sid&&c.push({id:b.sid,inlined:!1})}),c}function db(){var b=this,c=[],d=b.fileGet({inlined:!0});a.Array.each(d,function(a,b){b.sid&&c.push({id:b.sid,inlined:!0})});var d=b.fileGet({mixed:!0});return a.Array.each(d,function(a,b){b.sid&&c.push({id:b.sid,mixed:!0})}),c}function eb(){var b=this,c=b.base,d=b.fileProgress({inlined:!0}),e=d.percent;
d.bytesLoaded,d.bytesTotal;var f="",g=b.fileCount({inlined:!0}),h=b.fileCount({inlined:!0,state:"success"}),i=b.get({status:"inlinedExist"}),j=g-i,k=h-i;e&&(100==e?(c.tips(f),b.set({status:"inlinedExist",value:h})):(f="图片上传中"+(k+"/"+j)+"..."+e+"%",a.Tips.moduleTips?a.Tips.moduleTips.setText(f):c.tips(f)))}function fb(b){var c=this;c.data;var d=c.base;d.tips("");var e=c.sourceGet("tips"),f=e.inlined;if(f)f.show();else{f=a.Element.create("DIV"),f.setClass("M0 nui-tipsLayer nui-tipsLayer-arrDown nui-layer nui-layer-arrDown");var g=c.sourceGet("element");g.area.after(f.dom),e.inlined=f,f.html('<b class="nui-layer-arr" style="left:268px;"></b><div class="nui-layer-normal"><ul></ul></div>')}var h,i,j=f.dom.getElementsByTagName("UL")[0],k=b.name;h=a.Element.create("LI"),i=a.Element.create("SPAN"),i.html(a.String.escapeHTML(k)+'&nbsp;<span class="nui-txt-err">上传失败</span>&nbsp;&nbsp;'),h.append(i.dom),function(){var d=a.Element.create("A");d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html("续传"),d.listen("click",function(d){c.setInfo(b,"resum"),b.retry=0,c.setState(b,"wait"),c.fileAutoUpload(),h.remove(),0===c.fileCount({inlined:!0,state:"error"})&&f.hide(),a.Event.cancel(d)}),h.append(d.dom)}(),function(){var d=a.Element.create("A");d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html("删除"),d.listen("click",function(d){c.remove(b),c.netCheckClear(),h.remove(),0===f.dom.getElementsByTagName("LI").length&&f.hide(),a.Event.cancel(d)}),h.append(d.dom)}(),j.appendChild(h.dom),b.ui2={container:h,name:i}}function gb(b,c){var d=this;d.base;var e=d.data,f=e.get({status:"fromEntry"});if(rc.isArray(b)){var g="";if(c){if("compose"==f)return d.action.syncAttach({attachments:b,callback:function(b){b.code==vc&&a.Array.each(b["var"].attachments,function(a,b){d.storageAdd(b)})}}),void 0;"draft"==f&&(g=xc.getUrl("compose_get_data",!0)+"&mode=download&composeId="+d.info.get({cid:!0}))}return a.Array.each(b,function(a,b){g&&(b.download=g+"&attachId="+b.id),d.storageAdd(b)}),void 0}if(!b.deleted){var h=b.type,i=b.name||b.fileName;b.displayName&&(i=b.displayName);var j=b.contentType;if(!i&&j)switch(j.toLowerCase()){case"message/disposition-notification":i="已读回执";break;case"message/delivery-status":i="信息碎片";break;case"message/rfc822":i="邮件正文.txt";break;default:i="No name";var k=j.split("/");k[1]&&(j=k[1].toLowerCase(),"gif"==j||"png"==j?i+="."+j:("jpg"==j||"jpeg"==j)&&(i+=".jpg"))}var l=b.id||b.attachmentId,m=d.fileCreate({type:"storage",name:i,mime:j,size:b.size,sid:l});"url"==h&&(m.url=b.name),b._mid&&(m.mid=b._mid),b.inlined&&(m.inlined=!0,m.context=!0),b.mixed&&(m.mixed=!0,m.context=!0),b.media&&(m.media=b.media,m.context=!0),b.download&&(m.download=b.download),d.add(m)}}function hb(){var b=this,c=b.fileGet({state:"error"}),d="";a.Array.each(c,function(a,b){d+=b.name+"<br/>"});var e="以下附件尚未上传完成，请先删除或者续传附件：";a.Msgbox.show({title:e,icon:"err",content:d})}function ib(b){var c=this,d=c.info.get({cid:!0});c.action.syncAttach({cid:d,callback:function(d){var e={state:"success",cloud:!1},f=c.fileGet(e),g=d["var"].attachments,h=[];a.Array.each(g,function(b,c){var d=!1;a.Array.each(f,function(b,e){return c.id==e.sid?(d=!0,a.BREAK):void 0}),d||h.push(c.id)}),h.length>0?c.action.deleteAttach({sid:h,callback:function(a){a.code==vc&&c.base.send({action:"deliver"})}}):c.base.send({action:b})}})}function jb(b,c){var d,e=this;e.setLock(b,!1);try{d=a.Eval.get("("+c+")")}catch(f){d={code:"JS_EVAL"}}if(!b.cid)return!1;var g=d.type,h=d.ext;if(h&&("number"==typeof h.spaceused&&($S("cloud").spaceUsed=h.spaceused),"number"==typeof h.capacity&&($S("cloud").capacity=h.capacity),"number"==typeof h.sizelimit&&($S("cloud").fileSizeLimit=h.sizelimit),h.dupname&&h.filename&&(b.nameExist=!0,b.name=h.filename)),d.code==vc){var i=d["var"];if(1==g){if($S("cloud").spaceUsed+=b.size,b.ret=d.ret||null,i){if(i.exist)return b.fileExist=2,e.complete(b,c),!1;b.fileExist=1,b.fid=i.fid,i.dupname&&(b.nameExist=!0,b.name=i.filename),b.offset=i.existlen,$S("cloud").spaceUsed-=b.size}}else if(0===g&&i)if(i.actualSize){if(i.actualSize==i.size)return e.complete(b,c),!1;b.offset=i.actualSize}else b.sid=i.attachmentId;return!0}if("UX_FILE_NOT_FOUND"==d.code)return!0;var j=e.error(b,d.code,"","check");return j&&e.resum(b),!1}function kb(b,c,d,e){var f=this;"TIMEOUT"==c&&f.fileBreak(b);var g="未知错误",h="，请重试",i=!0,j=!1;switch(c){case"JS_EVAL":g="服务器返回格式错误"+h;break;case"JS_PLUGIN":g="插件版本过低，请使用标准添加附件方式选择大文件";break;case"NS_402":case"FA_INVALID_SESSION":g="登录超时，请重新登录邮箱",$I("init.Support").relogin();break;case"NS_415":g="云附件服务器因网络问题已暂停上传，请手动重试";break;case"NS_514":g="系统不支持多次同时重复上传同一个文件";break;case"NS_515":case"FA_OVERFLOW":case"FA_UPLOAD_SIZE_EXCEEDED":g="pref_smtp_max_send_mail_size"==d?"附件大小超过限制":"pref_flow_limit"==d?"附件流量超过限制":"附件大小或流量超过限制",b&&b.cloud&&(g="超过云附件空间上限，请您先删除已上传文件"),i=!1;break;case"NS_700":case"NS_701":case"NS_705":case"NS_710":g="此文件存在不良信息，禁止上传";break;case"FA_SECURITY":g="浏览器信息丢失，请重新登录邮箱";break;case"WX_DATA_ERROR":g="浏览器错误"+h,b.skipSplit=!0;break;case"JS_HTTP":case"AS_HTTP":g=0===d?"服务器连接错误":"服务器"+d+"错误",g+=h;break;case"AS_ERROR":if(-1!=d.indexOf("Error #"))try{d=d.split("#")[1],d=d.split(":")[0],g="2038"==d?"文件可能被其他程序占用":"2049"==d?"服务器响应错误":"2032"==d?"网络错误":"错误码"+d,g+=h}catch(k){}break;case"TIMEOUT":g="上传超时"+h,f.prompt({speed:!0});break;case"FLASH_VERIFY_TIMEOUT":g="附件扫描超时";break;default:g="上传失败，错误码"+c+h}if(b.err=g,b){if(f.setLock(b,!1),"JS_HTTP"==c||"AS_HTTP"==c||"AS_ERROR"==c||"WX_DATA_ERROR"==c){if(b.retry>=3);else if(j=!0,"check"==e?f.skipUploadHost():f.cloudTrigger()||"WX_DATA_ERROR"!=c&&0===b.retry&&f.skipUploadHost(),2==b.retry&&0===b.offset){var l=f.fileSize();20971520>l&&f.data.set({status:"useWmsvr",value:!0})}b.retry++}j||(f.setState(b,"error",g),i&&f.prompt({plugin:!0,text:"附件上传失败，推荐你使用邮箱助手上传附件，稳定快速并支持断点续传，立即"}))}else a.Msgbox.show({icon:"err",title:g});try{var m=encodeURIComponent(b.name),n={code:c,reason:d,size:b.size,retry:b.retry,agent:b.type,name:m};uc.record("attach",n)}catch(k){}return j||f.cancelAutoSend("附件上传失败，已为你取消了自动发送"),j}function lb(a){var b=this,c=b.base,d=yc.sliceTime;c.addTimer("netCheck",function(){b.netCheckFire(a)},d)}function mb(a){var b=this;if("upload"==a.state&&a.useSplit){if(0===a.offset||a.offset==a.lastOffset)return a.cloud||b.set({status:"validServer",value:!0}),b.error(a,"TIMEOUT")?b.fileRetry(a,{code:"TIMEOUT"}):b.resum(a),void 0;a.lastOffset=a.offset,b.netCheckSet(a)}}function nb(){var a=this,b=a.base;b.clearTimer("netCheck")}function ob(a){var c=this,d=c.base,e=c.data;e.sequence.uploadResult&&(delete e.sequence.uploadResult,a?(d.tips(a),b.setTimeout(function(){d.tips("")},5e3)):d.tips(""))}function pb(){var b=this,c=[],d={state:"success",inlined:!1,media:!1,url:""},e=b.fileGet(d);return a.Array.each(e,function(a,b){b.sid&&c.push(b)}),c}function qb(a){var b=this,c=b.base;c.setSequence("attachMove",function(){var c=b.moveGet();c.length&&b.moveCloud(c,a)})}function rb(b,c){var d=this,e=d.base,f=d.data,g=[],h=0;a.Array.each(b,function(a,b){g.push(b.sid),h+=b.size}),a.Ajax.jsonp(d.getUploadProxy({type:"script",move:!0,aid:g,size:c}),function(a){e.tips(""),f.set({status:"uploadParam",value:null}),d.moveComplete(a)}),f.set({status:"uploadParam",value:{action:"move",size:c,xsize:h}}),e.tips("正在移动附件...")}function sb(b){var c=this;if(b.code==vc){var d=b.move;d&&d.length&&c.moveReplace(d)}else{var e="";switch(b.code){case"FA_OVERFLOW":e="云附件容量超过"+a.Number.convert($S("cloud").capacity)+"的限制！";break;default:e="云附件系统繁忙，错误码"+b.code}a.Msgbox.show({icon:"err",title:e})}}function tb(b){var c=this,d=[];a.Array.each(b,function(a,b){d.push(b.attachmentId)}),c.action.deleteAttach({sid:d,callback:function(d){d.code==vc&&a.Array.each(b,function(a,b){var d=c.fileGet({sid:b.attachmentId})[0];d&&(d.sid="",c.cloudConvert(d,b))})}})}function ub(){var a=this;a.base;var b=a.data,c=0,d=b.get({status:"uploadParam"});return d&&"move"==d.action&&d.xsize>0&&(c=d.xsize),c}function vb(a){var b=this;return a&&b.cloudStatus()&&b.set({status:"cloudTrigger",value:!0}),b.cloudStatus()?b.get({status:"cloudTrigger"}):!1}function wb(){var a=this;return a.getUploadHost()&&$S("cloud")?!0:!1}function xb(b){var c=b.ui;b.nameExist&&c&&(c.name.html(a.String.escapeHTML(b.name)),c.tips.html("你已上传过同名文件，本文件已自动改名以避免覆盖旧文件"))}function yb(b,c){var d=this;if(rc.isArray(b))return a.Array.each(b,function(a,b){d.cloudConvert(b)}),void 0;"object"!=typeof b.link||c||(c=b.link);var e={type:"bigattach",url:$S("cloud").displayUrl+c.url,name:c.fileName,id:c.id,size:c.existlen,time:c.expireTime};c.preview&&(e.preview=$S("cloud").previewUrl+c.url),b.type="link";var f="";e.id&&-1!=e.id&&(f=[e.type,e.id].join(":")),b.eid=f,b.url=e.url,b.link=e,e.size&&(b.size=b.bytesLoaded=e.size),d.setState(b,"link")}function zb(){var b=this,c=b.module;b.base;var d=b.data,e=wc.get({field:"ntes_letter",flag:"autoSendTips"});if("0"==e){var f=d.get({component:"toolbar"}),g=f.find("button")[0];if(g){var h=new a.Layer({icon:{type:"info",size:"m"},width:"230px",items:[{html:"<span>附件正在上传，点击发送按钮，即可在<br/>上传完成后自动发送。 </span>"},{xtype:"link",text:"不再提示",cls:"nui-txt-link",click:function(){wc.set({field:"ntes_letter",flag:"autoSendTips",value:"1"}),this.ownerCt.destroy()}}],params:"hasArr arrUp hasClose",doNotHide:!0,renderTo:c.container});h.pointTo(g.getEl(),a.fly(c.container)),d.set({component:"autoSendTips",value:h})}}}function Ab(){$E(["product.FileCenter"],function(a){a.entry("bj_center")})}function Bb(b){try{var c=$L("product.attach.BaseAttach",this)}catch(d){return d}var e=this,f=e.module,g={module:f,attach:e,type:b};(new c).entry(g),uc.cache({cl_attachmsg:""+b},a.EMPTYFUNC)}function Cb(){try{var a=$L("product.attach.DropboxAttach",this)}catch(b){return b}var c=this,d=c.module,e={module:d,attach:c};(new a).entry(e)}function Db(){}function Eb(b){var c=this,d=c.base;if(b&&b.length){var e=[];a.Array.each(b,function(a,b){b&&b.checked&&0===c.fileGet({type:"storage",mid:b.mid}).length&&e.push(c.netfolderStructure(b))}),e.length&&c.action.syncAttach({attachments:e,callback:function(b){if(b.code==vc){var d=[],f=b["var"].attachments;a.Array.each(f,function(b,c){a.Array.each(e,function(a,b){c._mid==b._mid&&d.push(c)})}),c.storageAdd(d)}}})}d.setPage("compose")}function Fb(a){var b={};return b.type="netfolder",b.id=-1,b._mid=a.mid,b.name=a.name,b.contentType=a.type,"string"==typeof a.size&&(a.size=parseInt(a.size,10)),b.size=a.size,b}function Gb(b){var c=this;if(rc.isArray(b))return a.Array.each(rc.toArray(b),function(a,b){c.linkAdd(b)}),void 0;var d="";if(b.id&&-1!=b.id){if(d=[b.type,b.id].join(":"),c.fileGet({type:"link",eid:d}).length)return}else if(c.fileGet({type:"link",url:b.url}).length)return;var e=c.fileCreate({type:"link",name:b.name,eid:d,cloud:b.cloud});e.url=b.url,e.link=b,b.size&&(e.size=e.bytesLoaded=b.size),c.add(e)}function Hb(){var b=this,c=b.data,d=c.get({status:"fromEntry"}),e=!1,f=!1;if("draft"==d||"timeset"==d)e=!0;else if("compose"==d)return;for(var g,h=[];;){if(g=b.editor.get({id:"divEditorAttachLink"}),!g)break;var i=g.dom;e&&(e=!1,a.Array.each(rc.toArray(i.childNodes),function(a,b){try{var c=b.innerHTML,d=JSON.parse(c);"bigattach"==d.type&&(f=!0),d.cloud=!0,h.push(d)}catch(e){}})),g.remove()}f&&b.cloudTrigger(!0),b.linkAdd(h)}function Ib(b){var c=this,d="",e=c.fileGet({type:"link"});if(e.length){var f=b.action,g=b.subject;g=encodeURIComponent(g);var h=!0;("deliver"==f||"schedule"==f)&&(h=!1);var i=[],j={};a.Array.each(e,function(b,d){var e=d.link;if(h)i[i.length]="<xmp>"+JSON.stringify(e)+"</xmp>";else{var f=d.url,k=d.name,l=e.type,m=j[l];m||(m=j[l]=[]);var n="",o=c.linkIcon(d);if("bigattach"==l){var p=e.preview||"",q=new Date(e.time),r=a.Date.format(q,"yyyy年M月d日 H:mm");f=a.String.uriAddParam(f,"title="+g),p&&(p=a.String.uriAddParam(p,"title="+g)),n='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+f+'"><img border="0" src="'+o+'" /></a>'+"</div>"+"<div>"+'<div style="padding:0px;font-size:12px;line-height:14px">'+'<a href="'+f+'" download="'+f+'" preview="'+p+'" fileid="'+e.id+'" filename="'+k+'" filesize="'+e.size+'" expiretime="'+e.time+'" target="_blank" style="color:#000;text-decoration:none">'+k+"</a>"+'<span style="color:#bbb"> ('+a.Number.convert(e.size)+", "+r+" 到期)</span>"+"</div>"+'<div style="padding:4px 0px;font-size:12px;line-height:14px">'+(p?'<a href="'+p+'">在线预览</a> | ':"")+'<a href="'+f+'">下载</a>'+"</div>"+"</div>"+"</div>"}else"netfolder"==l?n='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+f+'"><img border="0" src="'+o+'" /></a>'+"</div>"+"<div>"+'<div style="padding:0px;font-size:12px;line-height:14px">'+'<a href="'+f+'" download="'+f+'" fileid="'+e.id+'" filename="'+k+'" filesize="'+e.size+'" target="_blank" style="color:#000;text-decoration:none">'+k+"</a>"+'<span style="color:#bbb"> ('+a.Number.convert(e.size)+")</span>"+"</div>"+'<div style="padding:4px 0px;font-size:12px;line-height:14px">'+'<a href="'+f+'">下载</a>'+"</div>"+"</div>"+"</div>":"dropbox"==l&&(n='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+f+'"><img border="0" src="'+o+'" /></a>'+"</div>"+"<div>"+'<div style="padding:0px;font-size:12px;line-height:14px">'+'<a href="'+f+'" download="'+f+'" fileid="'+e._mid+'" filename="'+k+'" filesize="'+e.size+'" target="_blank" style="color:#000;text-decoration:none">'+k+"</a>"+'<span style="color:#bbb"> ('+a.Number.convert(e.size)+")</span>"+"</div>"+'<div style="padding:4px 0px;font-size:12px;line-height:14px">'+'<a href="'+f+'">下载</a>'+"</div>"+"</div>"+"</div>");m.push(n)}}),h?d='<div id="divEditorAttachLink" style="display:none">'+i.join("")+"</div>":rc.each(j,function(a,b){var c,e;"netfolder"==a?(c="divNeteaseNetfolder",e="文件"):"bigattach"==a?(c="divNeteaseBigAttach",e="云附件"):"dropbox"==a&&(c="divNeteaseDropbox",e="Dropbox文件"),d+='<div id="'+c+'" style="clear:both;margin-top:10px;margin-bottom:15px;background:#DEE8F2;padding:4px;font-family:verdana,Arial,Helvetica,sans-serif">'+'<div style="font-size:14px;padding:4px 8px 8px 8px;line-height:16px">'+"<b>从网易"+$S("product")+"邮箱发来的"+e+"</b>"+"</div>"+'<div style="background:#fff;padding:4px">'+b.join("")+"</div>"+"</div>"})}return d}function Jb(a){var b=xc.getUrl("compose_attach_icon",!0),c=[b,"1",".gif"],d=a.ext;return d&&pc.icoFileIndex[d]&&(c[1]=pc.icoFileIndex[d]),c.join("")}function Kb(b){var c=this;if(b&&b.length){var d=[];a.Array.each(b,function(b,e){var f=e.name;f=f.split("&")[0];var g=c.fileGet({type:"storage",size:e.size});a.Array.each(g,function(b,c){return c.url&&0===c.url.indexOf(f)?(e=null,a.BREAK):void 0}),e&&d.push(e)}),d.length&&c.action.syncAttach({attachments:d,callback:function(b){if(b.code==vc){var e=[],f=b["var"].attachments;a.Array.each(f,function(b,c){a.Array.each(d,function(a,b){c.name==b.name&&e.push(c)})}),c.storageAdd(e)}}})}}function Lb(b){var c=this;b&&b.length&&c.action.syncAttach({attachments:b,callback:function(d){if(d.code==vc){var e=[],f=d["var"].attachments;a.Array.each(b,function(b,c){a.Array.each(f,function(b,d){if("internal"==d.type&&!d.deleted&&d.name==c.name){var f=d._mid,g=c._mid;-1!=f.indexOf(":")&&(f=f.split(":")[1]),-1!=g.indexOf(":")&&(g=g.split(":")[1]);var h=Math.abs(d.size-c.size);if(f==g&&100>h)return e.push(d),a.BREAK}})}),c.storageAdd(e)}}})}function Mb(b){var c=this;if(b&&b.length){var d=[];a.Array.each(b,function(a,b){b.code==vc&&d.push(b["var"])}),c.storageAdd(d)}}function Nb(b){var c=this,d=c.editor;a.Array.each(b,function(b,e){c.storageAdd(e);var f=e.fileName,g=e.attachmentId,h=e.mediaType,i=e.totalTime,j="";"video"==h?(uc.cache({cl_video:1},a.EMPTYFUNC),j='<div><img data-media="'+g+'" border="0" src="http://mimg.127.net/p/js5/lib/img/ico_video.gif" style="vertical-align: middle;"/>'+'<player id="cmd:voice" param="'+f+'" media="video"></player>'+'<span style="padding : 3px 5px">'+i+"</span>"+'<span style="line-height: 1.7; color: rgb(128, 128, 128);">(如果您看不到视频，请下载附件)</span>'+"</div>"):"audio"==h&&(uc.cache({cl_audio:1},a.EMPTYFUNC),j='<div><img data-media="'+g+'"  border="0" src="http://mimg.127.net/p/js5/lib/img/ico_audio.gif" style="vertical-align: middle;"/>'+'<player id="cmd:voice" param="'+f+'" media="audio"></player>'+'<span style="padding : 3px 5px">'+i+"</span>"+'<span style="line-height: 1.7; color: rgb(128, 128, 128);">(如果您看不到音频，请下载附件)</span>'+"</div>"),j&&(j="<div>这个是我刚才录制的哇，你看看呀～～</div>"+j+"<br/><div>&nbsp;&nbsp;</div>",d.insert({html:j}))})}function Ob(){var a=this,b=!1;return a.fileGet({type:"storage",name:"信纸.jpg"}).length>=1&&(b=!0),b}function Pb(){var a=this,b=null,c=a.get({status:"stationeryUrl"});return c&&(b=a.fileGet({type:"storage",url:c})[0]),b}function Qb(a){var b=this,c=b.stationeryGet();return c?(b.remove(c,function(){b.set({status:"stationeryUrl",value:""}),a&&a()}),void 0):void 0}function Rb(b,c){var d=this,e=d.stationeryGet();if(e)return d.stationeryClear(function(){d.stationerySync(b,c)}),void 0;var f=d.stationeryStruct(b);d.set({status:"stationeryUrl",value:f.name}),d.action.syncAttach({attachments:[f],callback:function(b){if(b.code==vc){var e=[];if(a.Array.each(b["var"].attachments,function(a,b){b.name==f.name&&(b.deleted||e.push(b))}),e.length>=1){var g=e.pop();return g.inlined="true",d.storageAdd(g),c(g.name)}}return c(null)}})}function Sb(a){var b={};return b.id=-1,b.type="url",b.mode="copy",b.name=a.imageUrl,b.displayName="信纸.jpg",b.contentType=a.contentType,b.size=a.size,b}function Tb(){var a=this,b=a.base;b.setPage("photo")}function Ub(b){var c=this,d=c.base;d.setPage("compose");var e=c.editor;if(a.String.trim(b)){var f=b.split(";"),g="";a.Array.each(f,function(a,b){var c=b.split("+");g+='<a href="'+c[1]+'" target="_blank"><img border="0" src="'+c[0]+'"></a><br>'}),e.insert({html:g})}}function Vb(){var a=this,b=xc.getUrl("compose_photo",!0),c=xc.getUrl("compose_attach",!0),d=a.base.getCallName(function(){a.photoCallBack.apply(a,arguments)},!0);return c+="&call=window.parent."+d,b+="&backurl="+encodeURIComponent(c)}function Wb(){var a=this,b=!1;return a.fileGet({type:"storage",name:"名片.vcf"}).length>=1&&(b=!0),b}function Xb(){var a=this,b=null,c=a.get({status:"cardUrl"});return c&&(b=a.fileGet({type:"storage",url:c})[0]),b}function Yb(b){var c=this,d=c.cardGet();if(d)return c.remove(d,function(){c.set({status:"cardUrl",value:""}),c.cardSync(b)}),void 0;var e=c.cardStructure(b);c.set({status:"cardUrl",value:e.name}),c.action.syncAttach({attachments:[e],callback:function(b){if(b.code==vc){var d=[];a.Array.each(b["var"].attachments,function(a,b){b.name==e.name&&(b.deleted||d.push(b))}),d.length>=1&&c.storageAdd(d.pop())}}})}function Zb(a){var b={};return b.id=-1,b.type="url",b.mode="copy",b.name=a.ecardVCFUrl,b.displayName="名片.vcf",b.contentType="text/x-vCard",b.size=a.ecardVCFFileSize,b}function $b(a){var b=this;b.mobileUrl=a?"http://config.mail.163.com:8080":xc.getUrl("compose_attach_mobile",!0),b.mobileCheckInst()}function _b(){var a=this;if(yc.appInstall)return a.mobileShowUpload(),void 0;var b={url:"/msgdispatcher/prestage/web/checkinst.do",callback:function(b){200==b.code&&("on"==b.data.inst?(a.mobileShowUpload(),yc.appInstall=!0):"off"==b.data.inst&&a.mobileShowORCode())}};a.mobileRequest(b)}function ac(){var a=this,b={url:"/msgdispatcher/prestage/web/checkstatus.do",callback:function(b){if(200==b.code){var c=b.data.status;"-1"==c||"0"==c||"1"==c||"2"==c&&a.mobileShowUpload()}}};a.mobileRequest(b)}function bc(){var b=this,c=b.module,d=b.mobileUrl+"/msgdispatcher/prestage/web/getqrcode.do",e=a.String.uriAddParam(d,"sid="+$S("sid"))+("&uid="+$S("orgUid")),f=a.SenderList.getMobile();f&&(e+="&alias="+f.address),e+="&uidinuse="+$S("uid"),e+="&host="+$S("host"),e+="&cid="+b.info.get({cid:!0});var g=xc.getUrl("compose_attach_mobile_mailmaster",!0),h=xc.getUrl("compose_attach_mobile_help1",!0),i='<div id="'+c.createId("dvAttachMobile")+'" class="APP-editor-insertPic-mobile">'+'<div style="text-align:center;width:100%;height:auto;padding-bottom:10px"><img src="'+e+'"/></div>'+'<div class="APP-editor-insertPic-mobile-intro">从手机上传图片，此功能需要先安装并登录网易邮箱大师使用，<br />请先扫描二维码下载安装。</div>'+'<div class="APP-editor-insertPic-mobile-link">'+'<a href="'+g+'" target="_blank" class="nui-txt-link">或者手动下载邮箱大师 </a> &nbsp;'+'<a href="'+h+'" target="_blank" class="nui-txt-link">帮助</a>'+"</div>"+"</div>",j=null;j=a.Msgbox.show({header:"从手机上传图片",content:i,extcls:"APP-editor-insertPic",contentType:"normal",noFooter:!0,autoFocus:!1,close:function(){b.mobileCheckStatus()}})}function cc(){var a=this;a.module;var b=a.data,c=xc.getUrl("compose_attach_mobile_mailmaster",!0),d='<div style="text-align:center;width:100%;height:auto;padding-bottom:10px"><img src="http://mimg.127.net/xm/webmail/img/ecode_done.jpg"/></div><div class="APP-editor-insertPic-mobile-intro">扫描成功！建议您马上下载邮箱大师并登录，<br/>打开手机中接收到的消息提醒，选择要上传的图片。</div><div class="APP-editor-insertPic-mobile-link"><a href="'+c+'" target="_blank" class="nui-txt-link">或者手动下载邮箱大师</a></div>',e=b.get({moduleId:"dvAttachMobile"});e.html(d)}function dc(){var b=this,c=b.module,d=xc.getUrl("compose_attach_mobile_help2",!0),e='<div id="'+c.createId("dvAttachMobile")+'" class="APP-editor-insertPic-mobile">'+'<div style="text-align:center;width:100%;height:auto;padding-bottom:10px"><img src="http://mimg.127.net/xm/webmail/img/mob.jpg"/></div>'+'<div class="APP-editor-insertPic-mobile-intro">请打开手机中接收到的消息提醒，选择要上传的图片<br/>如果长时间没有收到提醒，请手动开启手机中的邮箱大师。</div>'+'<div class="APP-editor-insertPic-mobile-link">'+'<a id="'+c.createId("mobileRetry")+'" href="javascript:void(0)" class="nui-txt-link">未收到提醒？请重试</a>'+'  &nbsp; <a href="'+d+'" class="nui-txt-link" target="_blank">帮助&gt;&gt;</a></div>'+"</div>",f=null;f=a.Msgbox.show({header:"从手机上传图片",content:e,extcls:"APP-editor-insertPic",contentType:"normal",noFooter:!0,autoFocus:!1,close:function(){return b.mobileClose(this)},listeners:{afterRender:function(){b.mobileStart(),a("#"+c.createId("mobileRetry")).listen("click",function(){b.mobileStart()})}}})}function ec(){var a=this,b=1024*1024*$S("attachSize"),c=a.fileSize(),d=b-c,e={func:"start",url:"/msgdispatcher/upload/web/startupload.do",param:{remainspace:d},callback:function(b){200==b.code&&a.info.set({tid:b.data.taskid})}};a.mobileRequest(e)}function fc(){var a=this,b=a.info.get({tid:!0});if(b){var c={func:"cancel",url:"/msgdispatcher/upload/web/cancel.do",param:{taskid:a.info.get({tid:!0})},callback:function(b){if(200==b.code){var c=b.data;a.mobileFinish(c),a.info.set({tid:""})}}};a.mobileRequest(c),a.set({status:"validServer",value:!0})}}function gc(a){var b=this,c=a.action;switch(c){case"downloaded":b.mobileShowDownload();break;case"loggedin":b.mobileShowUpload();break;case"upload":4==a.status&&b.mobileUpload(a),(5==a.status||6==a.status)&&b.mobileFinish(a);break;case"":}}function hc(){var a=this,b=a.info.get({tid:!0});b&&a.mobileCancel()}function ic(b){var c=this;c.module;var d=c.data;b.uploadedaid;var e=b.nextupaid,f=b.overallmap;if(-1!=e){var g=f[e];if(g){var h=a.String.escapeHTML(g.name),i=pc.getSubtype({type:"file",name:h}),j='<div class="APP-editor-insertPic-mobile-fileIco">'+new a.Icon({type:"file75",subtype:i}).html()+"</div>"+'<div class="APP-editor-insertPic-mobile-fileName">'+h+"</div>"+'<div class="APP-editor-insertPic-mobile-loading"></div>'+'<div class="APP-editor-insertPic-mobile-intro">正在从手机上传图片中，请稍候</div>',k=d.get({moduleId:"dvAttachMobile"});k.html(j)}}}function jc(b){var c=this,d=c.action,e=b.uploaded;b.remain,b.failed,d.getInfo({callback:function(b){var d=[],f=b["var"].attachments;a.Array.each(f,function(b,c){a.Array.each(e,function(a,b){c.id==b&&d.push(c)})}),c.storageAdd(d),c.info.set({tid:""}),a.Msgbox.msgbox.close()}})}function kc(b){var c=this,d=c.mobileUrl,e=d+b.url,f=a.String.uriAddParam(e,"sid="+$S("sid"))+("&uid="+$S("orgUid")),g=a.SenderList.getMobile();g&&(f+="&alias="+g.address),f+="&uidinuse="+$S("uid"),f+="&host="+$S("host"),f+="&cid="+c.info.get({cid:!0}),b.param&&rc.each(b.param,function(a,b){var c="&"+[a,b].join("=");f+=c}),a.Ajax.jsonp(f,b.callback)}function lc(b,c){b=b||0,"number"==typeof c?0>c&&(c=0):c=2;var d=Math.pow(10,c),e=[],f=0,g=0,h=["","B","K","M","G","T"];return 0===b||(1024>b?(g=1,f=b):b<Math.pow(1024,2)?(g=2,f=Math.round(b/1024*d)/d):b<Math.pow(1024,3)?(g=3,f=Math.round(b/Math.pow(1024,2)*d)/d):(g=4,f=Math.round(b/Math.pow(1024,3)*d)/d)),e.push(String(f)),-1==e[0].indexOf(".")?c&&(e.push("."),a.Array.each(new Array(c),function(){e.push("0")})):(e=e[0].split("."),function(){var b=c-e[1].length;b>0&&a.Array.each(new Array(b),function(){e[1]+="0"})}(),e=[e.join(".")]),e.push(h[g]),e.join("")}function mc(b){var c="";if(-1==b)c="??:??:??";else if(b>86400)c="23:59:59";else{var d=new Array(3);d[2]=b%60,b-=d[2],b/=60,d[1]=b%60,b-=d[1],b/=60,d[0]=b,a.Array.each(d,function(a,b){10>b&&(c+="0"),c+=b,2>a&&(c+=":")})}return c}try{var nc=$L("module.compose.Compose"),oc=$L("module.compose.ComposeAssist"),pc=$L("util.Icon")}catch(qc){return qc}var rc=a.Object;a.Browser;var sc=a.Ext,tc=a.EXTLIMIT,uc=a.Log,vc=a.S_OK,wc=a.Ud,xc=a.Uri,yc=a.createClass($N("module.compose.ComposeAttach"));rc.inherit(yc,nc),rc.extend(yc.prototype,nc.prototype),rc.extend(yc,{file:{cid:"",sid:"",fid:"",eid:"",icon:"",cloud:!1,context:!1,type:"",mime:"",url:"",download:"",link:null,size:0,path:"",md5:"",modtime:null,useSplit:!1,skipSplit:!1,offset:0,lastOffset:0,length:0,fileExist:0,pathExist:!1,name:"",nameExist:!1,percent:-1,bytesHashed:-1,bytesLoaded:-1,retry:0,ext:"",extLimit:!1,state:"",err:"",blob:null,digest:null,speed:null,inlined:!1,mixed:!1,media:!1,lock:!1,ret:null,options:null,"delete":null,ui:null},errDescription:{extension:"文件类型受限",empty:"文件内容为空",limit:"文件大小超过限制",quota:"文件大小超过总限制",limitBig:"文件大小超过云附件单个文件限制",quotaBig:"文件大小超过云附件总限制",errorBig:"云附件服务异常",2038:"文件I/O错误"},filter:[{description:"所有文件 (*.*)",extension:"*.*","default":!0},{description:"图片文件 (*.jpg;*.gif;*.png;*.bmp)",extension:"*.jpg;*.gif;*.png;*.bmp"},{description:"文档文件 (*.pdf;*.doc;*.xls;*.txt)",extension:"*.pdf;*.doc;*.xls;*.txt"},{description:"网页文件 (*.mht;*.htm;*.html)",extension:"*.mht;*.htm;*.html"}],filterImage:[{description:"图片文件 (*.jpg;*.gif;*.png;*.bmp)",extension:"*.jpg;*.gif;*.png;*.bmp","default":!0}],sliceLength:196608,sliceTime:12e4,symbol:String.fromCharCode(92)+String.fromCharCode(92),appInstall:!1,getSize:lc,getRemain:mc}),rc.extend(yc.prototype,{initialize:c,init:d,clear:e,destroy:f,initProcess:g,initElement:h,initUploadHost:i,sourceGet:j,layout:k,filterCheck:l,corpFilterCheck:m,filterFail:n,filterSelect:o,prompt:p,set:q,setState:r,setInfo:s,setStart:t,setFinish:u,setLock:v,setBytes:w,setHash:x,setSpeed:y,setProgress:z,setTotalProgress:A,get:B,getCheck:C,getUploadHost:D,getUploadUrl:E,getUploadProxy:F,getPreview:G,skipUploadHost:H,fileCreate:I,fileCount:J,fileGet:K,fileAdd:L,fileDelete:M,fileHas:N,fileSize:O,fileAutoUpload:P,fileAutoHash:Q,fileProgress:R,complete:S,fileIsUpload:T,fileIsPost:U,fileIsError:V,add:W,resum:X,remove:Y,setAuto:Z,setInsert:$,setTips:_,inlineInsert:ab,inlineRemove:bb,inlineGet:cb,inlineSync:db,inlinedProgress:eb,inlinedError:fb,storageAdd:gb,validLocal:hb,validServer:ib,check:jb,error:kb,netCheckSet:lb,netCheckFire:mb,netCheckClear:nb,cancelAutoSend:ob,moveGet:pb,movePrepare:qb,moveCloud:rb,moveComplete:sb,moveReplace:tb,moveSize:ub,cloudTrigger:vb,cloudStatus:wb,cloudRename:xb,cloudManage:Ab,cloudConvert:yb,cloudAutoTips:zb,msg:Bb,dropboxMsg:Cb,bigMsg:Db,netfolderAdd:Kb,internalAdd:Lb,ynoteAdd:Mb,avMailAdd:Nb,netfolderStructure:Fb,netfolderCallBack:Eb,linkAdd:Gb,linkParse:Hb,linkHtml:Ib,linkIcon:Jb,stationeryHas:Ob,stationeryGet:Pb,stationeryClear:Qb,stationerySync:Rb,stationeryStruct:Sb,photoOpen:Tb,photoCallBack:Ub,photoGetUrl:Vb,cardHas:Wb,cardGet:Xb,cardSync:Yb,cardStructure:Zb,mobileMsg:gc,mobileClose:hc,mobileInit:$b,mobileCheckInst:_b,mobileCheckStatus:ac,mobileShowORCode:bc,mobileShowDownload:cc,mobileShowUpload:dc,mobileStart:ec,mobileUpload:ic,mobileCancel:fc,mobileFinish:jc,mobileRequest:kc})}($,window),function(a,b){function c(a){var b=this;fb.superClass.initialize.call(b,a)}function d(){var a=this;fb.superClass.init.call(a)}function e(){var a=this,b=a.editor;a.element(),a.defined(),b.create(),a.module.scroll("main"),a.addTimer("delay",function(){a.startDelay()})}function f(){var b=this,c=b.module,d=b.data,e=b.attach;if(d.get({status:"startDelay"})===!0)return!0;if(b.userDataResume(),e.initProcess(),b.focus(),b.autoSave(),b.autoKeep(),b.assist.dragInit(),b.assist.clipInit(),d.set({status:"startDelay",value:!0}),ab.notary&&a.Ud.getProxy({field:"product.notary.userpro",call:function(a){var c=a["product.notary.userpro"];1==c&&b.initNotary()}}),"1"!=db.get({field:"ntes_compose",flag:"ext92"})){var f=new a.Layer({width:"180px",items:[{html:"<span>一次可发送2000张照片，600首MP3，一部高清电影 </span>"},{xtype:"link",text:"不再提示",cls:"nui-txt-link",click:function(){db.set({field:"ntes_compose",flag:"ext92",value:"1"}),this.ownerCt.destroy()}}],params:"hasArr arrUp hasClose",doNotHide:!0,renderTo:c.container});f.pointTo(a("#"+c.createId("attachAdd")),a.fly(c.container)),d.set({component:"attachLayer",value:f})}}function g(b){var c=this,d=c.module,e=c.data;if(b.timer)return c.addTimer("layout",function(){b.timer=!1,c.layoutAdjust(b)},10),void 0;var f=e.layout;if(f&&f.baseHeight){var g=d.getModuleClass();g!=f.containerCls&&(a(d.container).replaceClass(f.containerCls,g),f.containerCls=g);var h=!1,i=!1,j=$S("clientHeight");if((j!=f.baseHeight||b.force)&&(d.layoutInit(),h=!0),h){var k=c.editor;if(k.setSize({height:f.editorHeight+"px"}),$S("isCorp")){var l=d._child;l&&l.resize()}}if(i&&c.success.resize(),b.attach){var m=c.attach;m.layout()}}}function h(){var b=this,c=b.module,d=b.data,e=b.event,f=b.form;"0"==db.get({field:"ntes_global",flag:"compose_showContacts"})&&(a.SM.go({module:"address.AddressModule",noDragbar:!0,cacheModule:!0,cacheDom:!0,reset:!1,parent:c}),d.set({status:"showSide",value:!0})),"1"==db.get({field:"ntes_compose",flag:"separate_default"})&&"compose"==d.get({status:"fromEntry"})&&e.setSeparate({show:!0});var g=$S("attrs").user.ntes_htmlbar;"number"==typeof g&&2==g&&d.set({status:"showHtmlbar",value:!1}),"3"!=db.get({field:"ntes_compose",flag:"upload_mode"})&&d.set({status:"uploadMode",value:"super"}),"1"==db.get({field:"ntes_option",flag:"requirereceipt"})&&f.setCheckbox("receipt",!0)}function i(){var b=this,c=b.module,d=b.data,e=b.form,f=["to","subject","main","succ","toolbar","ext","notary","encrypt","schedule"];a.Array.each(f,function(a,b){d.set({moduleId:b,value:b})}),a.Array.each(["to","subject"],function(a,b){e.addHoverEvent(b)}),c.attach.initElement()}function j(a,b){var c=this,d=c.module,e=c.attach,f=c.data,g=c.editor,h=c.form,i=c.event,j=c.info;a=a||j.get({obj:!0});var k=a.account;k&&h.setSender(k);var l=!1,m=f.get({status:"fromEntry"});"reply"==m&&(l="2"==db.get({field:"ntes_option",flag:"sendershow"}));var n=a.to;n&&h.setContact(n,"to",l);var o=a.cc;o&&(h.setContact(o,"cc",l),o.length&&i.setCc({show:!0,separate:!0}));var p=a.bcc;p&&(h.setContact(p,"bcc",l),p.length&&i.setBcc({show:!0,separate:!0}));var q=a.showOneRcpt;q&&i.setSeparate({show:!0});var r=a.subject;"string"==typeof r&&h.setSubject(r);var s=a.priority;1==s&&h.setCheckbox("priority",!0);var t=a.requestReadReceipt;t&&h.setCheckbox("receipt",!0);var u=a.scheduleDate;if(u&&(h.setCheckbox("schedule",!0),d.schedule.set(u)),!b){var v=a.content||"",w="html";if("boolean"==typeof a.isHtml&&!a.isHtml){w="text";var m=f.get({status:"fromEntry"});("edit"==m||"draft"==m||"timeset"==m)&&h.setCheckbox("text",!0)}g.setOriginal(v,w);var x=a.attachments;x&&e.storageAdd(x,!0);var y=a.link;y?e.linkAdd(y):e.linkParse(),"number"==typeof a.card&&c.sign.fillData({card:a.card}),c.changeSync()}}function k(b){var c=this,d=c.module,e=c.attach,f=c.data,g=c.info;if(c.sendCheck(b)&&"success"!=f.get({status:"curPage"})){if(f.get({component:"autoSendTips"}))try{f.get({component:"autoSendTips"}).hide()}catch(h){}if(f.get({component:"attachLayer"}))try{f.get({component:"attachLayer"}).hide()}catch(h){}var i={},j={action:b.action},k=g.get({cid:!0});if(k&&(i.id=k),"verify"==b.action)i.verifyCode=b.code;else{var l=i.attrs=c.sendBuild(b);c.info.set({obj:l}),c.info.set({con:[].concat(l.to,l.cc,l.bcc)})
}i.returnInfo="deliver"==b.action||"schedule"==b.action||"verify"==b.action?!1:!0;var m=b.action;if("auto"==b.action||"force"==b.action?m="save":"verify"==b.action&&(m="deliver",f.get({status:"showSchedule"})&&(b.action=m="schedule")),i.action=m,c.attach.fileHas({type:"link"})&&(i.flagLinkAttached=!0),"deliver"==b.action&&0===$S("attrs").user.save_sent){var n=e.fileGet({context:!0});n&&n.length||(i.saveTextThreshold=f.saveTextThreshold)}if("deliver"==b.action&&1==$S("attrs").user.aftersend_saveaddr)try{a.Array.each(c.info.get({con:!0}),function(b,c){var d=c.replace(/^.*<|>$/g,"").toLowerCase();return X.data.extDataMap.email[d]?void 0:(i.autosaveRcptsMode="add",a.BREAK)})}catch(h){}if("schedule"==b.action&&"0"==db.get({field:"ntes_option",flag:"schedule_notify"})&&(i.notifyEML=!0),"deliver"==b.action&&f.get({status:"showEncrypt"})&&(i.encryptPassword=d.encrypt.get(),d.encrypt.get({save:!0})&&(i.savePassword=!0,i.attrs.saveSentCopy=!0,delete i.saveTextThreshold)),ab.ynote&&c.form.getCheckbox("ynote")&&(f.set({status:"save2YNote",value:!0}),i.attrs.saveSentCopy=!0,delete i.saveTextThreshold,bb.cache({cl_ynote:"1"},a.EMPTYFUNC)),ab.notary&&f.get({status:"showNotary"})&&(0===d.notary.userpro&&(i.attrs.saveSentCopy=!0),d.notary.status.useSign&&(i.attrs.content+='<div style="height:42px;line-height:42px;font-size:16px;text-align:center"><div style="font-family:\'楷体\', \'楷体_GB2312\'"><span style="color:#CC0000">★</span> 此邮件已被 <a href="http://gzy.mail.163.com/?from=mailread" style="text-decoration:none" target="_blank"><strong style="color:#CC0000">网易公正邮</strong></a> 保全存证，发件人承诺与您诚信沟通！ <span style="color:#CC0000">★</span></div></div>')),"deliver"==b.action&&"1"==db.get({field:"ntes_compose",flag:"undo_send"})&&(i.delayTime=f.delayTime),"deliver"==b.action||"schedule"==b.action){$.extend(j,c.log),f.get({status:"useSign"})&&(j.sign="1"),f.get({status:"showEncrypt"})&&(j.encrypt="1");var o=f.get({status:"fromEntry"});"compose"!=o&&(j.from=o),"shortcut"==b.source&&(j.cl_st=1)}b.body=i,f.set({status:"sendParam",value:b}),c.action.send({body:i,log:j,callback:a.Function.bind(c.sendSuccess,c),error:a.Function.bind(c.sendError,c)});var p="";switch(b.action){case"deliver":p="正在发送邮件...";break;case"schedule":p="正在保存定时发信...";break;case"save":p="正在保存邮件...";break;case"auto":case"force":p="正在自动保存草稿...";break;case"verify":p="正在进行验证码核对并发送邮件..."}p&&c.tips(p)}}function l(b){var c=this,d=c.module,e=c.data,f=c.editor,g=c.form,h=c.attach,i=b.action;if("verify"==i)return!0;if("auto"==i){var j=f.getFinal();if(""===j)return!1}if("auto"!=i&&"force"!=i&&!c.checkRepeatSend())return!1;if("force"!=i){var k=e.get({status:"fromEntry"});if(("edit"==k||"draft"==k||"timeset"==k||"reply"==k||"forward"==k)&&""===c.info.get({cid:!0}))return"auto"==i||a.Msgbox.show({title:"您的信件正在加载中，请稍候！"}),!1}if(("deliver"==i||"save"==i)&&e.get({status:"showSchedule"})){if(!c.module.schedule.verify())return!1;i=b.action="schedule"}if("deliver"==i||"schedule"==i){if(!c.checkSenderName(b))return!1;if(!c.checkRev(b))return!1;if(!c.checkSubject(b))return!1;if(e.get({status:"showEncrypt"})&&!d.encrypt.verify())return!1;if(!c.checkAttachText(b))return!1;if(g.getCheckbox("chargesms"))try{var d=c.module,l=d.smsNotify,m=l.checkData();if(!m)return!1;e.set({status:"chargeSmsData",value:m})}catch(n){}}if("deliver"==i||"schedule"==i||"verify"==i||"save"==i){if(h.fileIsPost())return c.setSequence("postResult",function(){c.send(b)}),h.postUpload(),!1;if(h.fileIsUpload()){if(c.setSequence("uploadResult",function(){c.send(b)}),"save"==i)c.tips("正在上传附件，上传完成后将自动保存到草稿箱");else{var o={items:[{html:"<span>正在上传附件，上传完成后将自动发送 </span>"},{xtype:"link",bracket:!0,text:"取消自动发送",click:function(){delete e.sequence.uploadResult,this.destroy(),c.tips()}}]};c.tips(o)}return!1}if(h.fileIsError())return h.validLocal(),c.tips(""),!1;if(h.get({status:"validServer"}))return h.set({status:"validServer",value:!1}),h.validServer(i),!1}return!0}function m(b){b=b||{};var c=this,d=c.data,e=c.form,f=c.editor,g=c.attach,h={},i=e.getSender();h.account=i.toString(),i.smtp&&(h.accountSettings={smtpHost:"@",popWebId:i.popId}),d.get({status:"useSeparate"})?(h.showOneRcpt=!0,h.to=e.getContact("build","separate"),h.cc=h.bcc=[]):(h.showOneRcpt=!1,h.to=e.getContact("build","to"),h.cc=e.getContact("build","cc"),h.bcc=e.getContact("build","bcc"));var j=e.getSubject();if(""===a.String.trim(j)&&"auto"==b.action){var k=$I("util.Misc").getTime(0);j=a.Date.format(k,"yyyy年M月d日 H:mm:ss 自动保存草稿")}h.subject=j;var l=f.getFinal();if(e.getCheckbox("text"))h.isHtml=!1;else if(h.isHtml=!0,"deliver"==b.action){var m=a.Browser.getVersion()||[0,0];a.Browser.ie()&&m[0]<=8&&(l=f.getFinal(!0)),l=l.replace(new RegExp('id="*(spnEditorSign|divEditorGraphSign)"*',"ig"),"")}var n=g.linkHtml({action:b.action,subject:j});n&&(h.isHtml||(h.isHtml=!0,l=f.getFinal("html")),l+=n),h.content=l,h.priority=e.getCheckbox("priority")?1:3,1==h.priority&&bb.cache({cl_priority:"1"},a.EMPTYFUNC),h.requestReadReceipt=e.getCheckbox("receipt"),1==h.requestReadReceipt&&bb.cache({cl_receipt:"1"},a.EMPTYFUNC),h.saveSentCopy=$S("attrs").user.save_sent<2,"schedule"==b.action&&(h.scheduleDate=c.module.schedule.get());var o=g.inlineSync();o&&o.length&&(h.attachments=o);var p="GBK";return"1"==db.get({field:"ntes_option",flag:"mailencode"})&&(p="UTF-8"),h.charset=p,h}function n(b){var c=this,d=c.data,e=c.info;c.tips("");var f=d.get({status:"sendParam"});if("save"==f.action||"auto"==f.action||"force"==f.action||"continue"==f.action){e.set({obj:b["var"]}),b.draftId&&e.set({did:b.draftId}),("save"==f.action||"force"==f.action)&&d.set({status:"existActiveDraft",value:!0}),c.changeSync();var g=$I("util.Misc").getTime(0);("auto"==f.action||"save"==f.action)&&(a.Tips.show({succ:!0,expire:0,text:a.Date.format(g,"邮件已于H:mm成功保存到草稿箱")}),c.trans({action:"check"})),"function"==typeof f.call&&c.addTimer("force",function(){f.call()})}else{c.clearTimer();var h=e.get({cid:!0});e.set({cid:""}),"verify"==f.action&&(f.action="deliver"),c.success.render(b,h)}c.userDataRemove();try{var i=[2];"deliver"==f.action&&i.push(3),a.Listener.fire("compose:send",i),$I("init.Sync").request(["Folder"])}catch(j){}d.set({status:"sendParam",value:null})}function o(b){var c=this,d=c.data,e=c.info,f=c.attach;c.tips("");var g=d.get({status:"sendParam"});if(d.set({status:"sendParam",value:null}),"auto"==g.action)return!0;var h=b.code,i=b["var"];h==cb&&("string"==typeof i?e.set({cid:i}):"object"==typeof b["var"]&&e.set({obj:i}));var j=W.error(b);if(j){if("FA_MTA_RCPT_ERROR"==j){var k,l=[];if(function(){var a,c=b.errorRcpts,d="",e=[];for(d in c)if("string"==typeof d&&-1!=d.indexOf("@")){if(c[d])switch(c[d]){case"MTA5104":a="帐号被停用";break;case"MTA5107":a="帐号不存在";break;case"MTA5101":a="由于管理员限制，您没有权限发送邮件给企业外的邮件地址";break;default:a="帐号被禁止"}else a="系统不允许";a='<label title="'+a+'">'+d+"</label>",e.push(a),l.push(d)}k=e.join("<br>")}(),k){var m="以下邮箱地址无效，将无法成功收到邮件",n='<div class="nui-split" style="margin:12px 0"></div><div class="nui-txt-tips">如果知道对方手机号码，可直接发送到他的手机号码@163.com</div>';$S("isCorp")&&(n="",m="邮箱地址无效或发信受限，以下地址将无法成功收到邮件"),a.Msgbox.show({title:m,content:k+n,okText:"发送邮件，忽略无效地址",cancelText:"返回编辑",ok:function(){c.sendFixMta(l,!0)},cancel:function(){c.sendFixMta(l)}})}else a.Msgbox.show({title:"对不起，存在部分收件人无法收到信件！"});return!0}return j}switch(h){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var o=h.split("_")[1].toLowerCase();W.verify(o,function(a){c.send({action:"verify",code:a})});break;case"FA_ATTACH_NOT_COMPLETED":case"FA_ATTACH_CRC_FAILED":var p=b.badAttachment;if(p){var q=p.name||"";q=a.String.encodeHTML(q);var r="附件"+q+"上传不完整，部分文件丢失，是否删除？";a.Msgbox.show({type:"confirm",header:"附件校验出错",title:r,ok:function(){c.action.deleteAttach({sid:p.id,callback:function(b){b.code==cb||a.Msgbox.show({title:"删除失败，请保存草稿后重新打开。"})}})}})}break;default:var s=f.fileGet({state:"success"});return s&&s.length?!1:(e.set({cid:""}),!1)}return!0}function p(b,c){var d=this,e=d.form;c?(a.Array.each(["to","cc","bcc","separate"],function(a,c){e.removeContact(b,c)}),d.send({action:"deliver"})):a.Array.each(["to","cc","bcc","separate"],function(a,c){e.modifyContact(b,c,!1)})}function q(){var b=this,c=b.data;b.form;var d=c.get({status:"sendCheckCount"});if(d>=0){var e=c.get({status:"sendParam"}),f=c.get({status:"uploadParam"});if(e||f){if(e)if("save"==e.action||"auto"==e.action)a.Msgbox.show({title:"您的信件正在保存中，请稍候！"});else{var g=a.Msgbox.show({title:"您的信件正在发送中，请稍候！"});c.set({component:"sendMsgBox",value:g})}else"form"==f.action?a.Msgbox.show({title:"您的附件正在上传中，请稍候！"}):"move"==f.action&&a.Msgbox.show({title:"您的附件正在移动中，请稍候！"});return d++,d>=2&&(d=-1),c.set({status:"sendCheckCount",value:d}),!1}}return c.set({status:"sendCheckCount",value:0}),!0}function r(b){function c(c){db.set({field:"ntes_compose",flag:"senderName",value:"1"});var e="用户名";"mobile"==c&&(e="手机号");var g="收件人只能看到您的"+e+"，可能没法知道是您的邮件。<br />为方便对方确认，请填写您的姓名：";return a.Msgbox.show({type:"prompt",title:"您还没设置姓名！",content:g,okText:"保存并发送",inputWidth:"300px",ok:function(c){var e=a.String.trim(c);return e?(a.Tips.show({succ:!0,text:"发件人姓名设置成功"}),d.form.setSender(new _(f.address,e)),d.addTimer("sendCheck",function(){d.send(b)},10),db.set({field:"true_name",value:e}),a.Listener.fire("options:personalModify",[{field:"true_name",value:e}]),void 0):"姓名不能为空"}}),!1}var d=this,e=d.form;if("0"==db.get({field:"ntes_compose",flag:"senderName"})){var f=e.getSender(),g=f.address.split("@");if($S("domain")==g[1]&&f.name==g[0]){if(_.checkMobile(f.name))return c("mobile");if(""===$S("attrs").user.true_name){var h=$S("attrs").user.displaysender;if(0===h)return c("account");if(1==h&&""===$S("attrs").user.nick_name)return c("account")}}}return!0}function s(b){function c(c){var h,i=function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close()},j=function(){i(),d.addTimer("sendCheck",function(){d.send(b)},10)},k=function(){i(),f.focus(c)},l=f.getContact("object",c);if(l.fail&&l.fail.length)return h="",a.Array.each(l.fail,function(a,b){h+=b.address+"\n"}),h=a.String.encodeHTML(h),h=h.replace(/\n/g,"<br>"),a.Msgbox.show({title:"以下邮箱地址无效，将无法成功收到邮件",content:h,okText:"发送邮件，忽略无效地址",ok:function(){f.removeContact(l.fail,c),j()},cancelText:"返回编辑",cancel:k}),!1;var m=[];if(a.Array.each(l.suc,function(a,b){Y.isRefuse(b)&&(e.blackList[b.address.toLowerCase()]||m.push(b))}),m.length){h="以下地址已经在您的黑名单中，您将无法收到他们的回信，是否不给他们发信？<br/>",h='<strong class="nui-txt-impt">';for(var n=0;n<m.length;n++)h+=a.String.encodeHTML(m[n].toString())+"<br/>";return h+="</strong>",a.Msgbox.show({title:"以下地址已在您的黑名单中，将无法收到回信",content:h,buttons:[{xtype:"button",text:"发信（但不给他们）",type:"impt",click:function(){f.removeContact(m,c),j()}},{xtype:"button",text:"继续给他们写信",click:function(){a.Array.each(m,function(a,b){e.blackList[b.address.toLowerCase()]=!0}),j()}},{xtype:"button",text:"返回编辑",click:k}]}),!1}return g+=l.suc.length,!0}var d=this,e=d.data,f=d.form,g=0;if(e.get({status:"useSeparate"})){if(!c("separate"))return!1}else if(!(c("to")&&c("cc")&&c("bcc")))return!1;if(0===g)return d.tips({text:"请填写收件人地址后再发送",expires:6e3}),f.focus(),!1;var h=$S("attrs").cos.pref_smtp_max_num_rcpts||0;return g>h?(function(){var b="您选择的发件人总数为"+g+"人，超过"+h+"人的限制！";if($S("isFree"))b+='<br><a href="'+eb.getUrl("compose_update_vip",!0)+'" target="_blank">单次群发400封(VIP特权)，立即升级>></a>';else{var c;5==h?(c={"vip.163.com":"http://reg.vip.163.com/pay.m?b10ele1","vip.126.com":"http://reg.vip.126.com/pay.m?b66ele1","188.com":"http://pay.mail.188.com/html/pay/list.jsp?b11ele1"},b='邮箱尚未开通，发送人数不可超过5人！<br>开通VIP邮箱，最高可群发400人！<a href="'+c[$S("domain")]+'" target="_blank">马上开通&gt;&gt;</a>'):100==h&&(c={"vip.163.com":"b10dye5","vip.126.com":"b66dye5","188.com":"b11dye5"},b+="<br>"+a.Link.html({text:"升级400封单次群发",click:function(){$E("interface.OutlinkInterface",function(a){a.goOutlink({url:eb.getUrl("option_viptype",!0)+"?"+c[$S("domain")],key:"option_viptype"})}),a.Msgbox.msgbox.close()}}))}a.Msgbox.show({title:b,ok:function(){f.focus()}}),a.Component.setEvents()}(),!1):!0}function t(c){function d(){a.Msgbox.show({type:"confirm",title:"确定真的不需要写主题吗？",ok:function(){var a=$I("init.SenderList");f.setSubject("来自"+(a.getName()||$S("orgUid"))+"的邮件"),e.addTimer("sendCheck",function(){e.send(c)},10)},cancel:function(){e.addTimer("sendCheck",function(){f.focus("subject")},10)}})}var e=this,f=e.form;return""===a.String.trim(f.getSubject())?("shortcut"==c.source?b.setTimeout(d,300):d(),!1):!0}function u(b){var c=this,d=c.data,e=c.attach;if(d.get({status:"confirmAttach"})){d.set({status:"confirmAttach",value:!1});var f=e.get({count:!0});if(e.cardGet()&&f--,e.stationeryGet()&&f--,0===f){var g=c.editor.get({html2text:!0});if(-1!=g.indexOf("附件"))return a.Msgbox.show({type:"confirm",title:"邮件中显示您可能希望发送附件，但实际没有任何附件，您确认继续发送吗？",okText:"继续发送",cancelText:"返 回",ok:function(){c.addTimer("sendCheck",function(){c.send(b)},10)}}),!1}}return!0}function v(){var a=this,b=a.attach,c=a.data,d=c.change,e=!1;if(d.composeInfo){var f=b.get({count:!0});if(b.cardGet()&&f--,b.stationeryGet()&&f--,f!=d.attachCount&&(e=!0),!e){var g=a.sendBuild();$.isEqual(g,d.composeInfo)||(e=!0)}}return e}function w(){var a=this,b=a.data,c=a.attach,d=b.change;d.composeInfo=a.sendBuild();var e=c.get({count:!0});c.cardGet()&&e--,c.stationeryGet()&&e--,d.attachCount=e}function x(){var b=this,c=b.data,d=b.form,e=b.editor,f="to";c.get({status:"useSeparate"})&&(f="separate");var g=c.get({status:"fromEntry"});d.getContact("empty",f)&&"reply"!=g?d.focus(f):(a.String.trim(d.getSubject())?e.focus(!1):d.focus("subject"),d.removeFocusCls("to"))}function y(){var b=this,c=b.data,d=b.editor,e=b.form,f=b.attach,g=!0;return"success"==c.get({status:"curPage"})?g:("compose"==c.get({status:"fromEntry"})?e.getContact("empty","to")?e.getContact("empty","cc")?e.getContact("empty","bcc")?e.getContact("empty","separate")?""!==a.String.trim(e.getSubject())?g=!1:f.get({count:!0})>0?g=!1:d.get({empty:!0})?c.get({status:"empty"})||(g=!1):g=!1:g=!1:g=!1:g=!1:g=!1:g=!1,g)}function z(){var a=this,b=a.data,c=a.attach;a.addTimer("save",function(){"compose"==b.get({status:"curPage"})&&(b.get({status:"sendParam"})||b.get({status:"uploadParam"})||c.fileIsUpload()||!a.changeCheck()||(2==b.get({status:"autoSaveTime"})&&b.set({status:"autoSaveTime",value:5}),a.send({action:"auto"}))),a.autoSave()},6e4*b.get({status:"autoSaveTime"}))}function A(){var a=this;a.addTimer("keep",function(){a.info.get({cid:!0})&&a.action.getInfo({callback:function(){}}),a.autoKeep()},15e5)}function B(){var a=this,b=a.data,c="",d=b.get({status:"sendParam"}),e=b.get({status:"uploadParam"});return d?c=d.action:e&&(c=e.action),c}function C(a,c,d){d=d||0;var e=this,f=e.data;if(f){var g=f.timer;e.clearTimer(a),g[a]=b.setTimeout(function(){delete g[a],c()},d)}}function D(a){var c=this,d=c.data,e=d.timer;e&&(a?"number"==typeof e[a]&&(b.clearTimeout(e[a]),delete e[a]):$.each(e,function(a){c.clearTimer(a)}))}function E(){var c=this,d=c.form,e=$S("uid").replace("@","."),f=d.getContact("build","to"),g=d.getSubject(),h=c.editor.get(),i={to:f,subject:g,content:h};a.Storage.set(e,JSON.stringify(i)),b.composeResume=!1}function F(){var b=$S("uid").replace("@",".");try{a.Storage.remove(b)}catch(c){}}function G(){var c=this,d=c.data;if("compose"==d.get({status:"fromEntry"})&&!b.composeResume){b.composeResume=!0;var e=$S("uid").replace("@","."),f="";try{f=a.Storage.get(e)}catch(g){}if(f){c.userDataRemove();var h=null;try{h=JSON.parse(f)}catch(g){}h&&c.fillContent(h)}}}function H(){var b=this;b.empty()||a.Msgbox.show({type:"confirm",title:"网络连接已断开，是否将信件内容保存到本地电脑？<br>（提示：下次登录邮箱，写信时内容将自动恢复）",ok:a.Function.bind(b.userDataSave,b)})}function I(){var b=this;b.empty()||a.Msgbox.show({type:"confirm",title:"登录状态已生效，是否将信件内容保存到本地电脑？<br>（提示：登录邮箱后，写信时内容将自动恢复）",ok:function(){b.userDataSave(),b.data.set({status:"confirmExit",value:!1}),a.Support.relogin()}})}function J(a,b){var c=this,d=c.data;d.sequence[a]=b}function K(a,b){var c=this,d=c.data,e=d.sequence[a];return"function"==typeof e?"number"==typeof b?(c.addTimer("sequence"+a,function(){c.runSequence(a)},b),!0):(delete d.sequence[a],e(),!0):!1}function L(a,c){var d=this,e=d.module,f="ComposeCall"+e.createId("c");"object"!=typeof b[f]&&(b[f]={});var g="f"+$I("util.Misc").getTime(0).valueOf();return"undefined"!=typeof b[f][g]&&(g+="x"),b[f][g]=function(){return c&&delete b[f][g],a?a.apply(null,arguments):void 0},f+"."+g}function M(){var a=this,c=a.module,d="ComposeCall"+c.createId("c");"object"==typeof b[d]&&$.each(b[d],function(a){b[d][a]=null,delete b[d][a]})}function N(b){var c,d,e=this,f=e.module,g=e.data,h=g.get({element:"main"}),i=g.get({element:"succ"}),j={},k=g.get({element:"toolbar"});if(g.get({status:"curPage"})!=b){if("compose"==b)j.hide(),d=j.find("iframe"),d.attr({src:"about:blank"}),h.show(),k.show();else if("success"==b){i.show(),h.hide(),k.hide();var l=f._child;l&&a(l.container).hide()}else"photo"==b&&(c=j.find("form"),c.empty(),j.setStyle({height:h.dom.offsetHeight+"px"}),j.show(),c.attr({action:e.attach.photoGetUrl()}),c.dom.submit(),h.hide(),k.hide());g.set({status:"curPage",value:b})}}function O(b,c){var d=this;if(b){b.module="compose",b.noFire=!0,Y.setAttr(b),"boolean"!=typeof c&&(c=!1),d.fireOption([b],!c);var e=b.flag?b.flag:b.field,f=b.value,g={};g[e]=f,bb.cache(g,a.EMPTYFUNC)}}function P(b,c){var d=this,e=d.data,f=d.event,g=d.form;if(a.Array.each(b,function(b,h){var i="",j=h.flag?h.flag:h.field,k=h.value;switch(j){case"ntes_htmlbar":var l=2!=k?!0:!1;d.editor.setHtmlbar({show:l,hide:!l});break;case"compose_nav":f.switchNav(k);break;case"compose_showContacts":var m="1"!=k?!0:!1;f.switchSide({show:m});break;case"remindShow":ab.contactCorrect="0"==k?!0:!1;break;case"requirereceipt":var n="1"==k?!0:!1;g.setCheckbox("receipt",n);break;case"true_name":case"nick_name":case"displaysender":var o=e.get({component:"sender"}),p={type:"sender",tabindex:"2",raiaLabel:"发件人地址，点击可以设置发件人"},q=[];try{var r=$I("util.Icon"),s=$I("init.SenderList"),t=s.getList(),u=s.getDefault();a.Array.each(t,function(b,c){var d=a.String.encodeHTML(c.toString()),e=r.getSubtype({type:"folder",domain:c.domain});"dft"==e&&(e="other"),q.push({text:d,icon:{type:"folder",subtype:e},click:function(){o.setValue(c)}})}),p.email=u;var v={xtype:"menu",groups:[{items:q},{items:[{text:"设置默认发件人与昵称",click:function(){$E(["interface.OptionInterface"],function(a){a.entry("SenderModule")})}}]}]};p.menu=v,o.update(p)}catch(w){}break;case"flashupload":case"replySign":case"forwardSign":case"signPosition":case"upload_mode":i="设置成功，下次进入写信生效",e.set({status:"empty",value:!1});break;case"signUpdate":case"cache":d.set({status:"empty",value:!1})}c&&i&&a.Tips.show(i)}),!c)try{var h=e.get({component:"toolbar"}),i=d.view.getOption();h.find("button")[5].menu.update(i)}catch(j){}}function Q(){var b=this,c=eb.getUrl("compose_preview"),d=b.getCallName(function(){var c=b.data,d=b.form,e={};e.sender=d.getSender(),c.get({status:"useSeparate"})?e.separate=d.getContact("suc","separate"):(e.to=d.getContact("suc","to"),e.cc=d.getContact("suc","cc"),e.bcc=d.getContact("suc","bcc"));var f=d.getSubject();return f=f?a.String.escapeHTML(f):"(无主题)",e.subject=f,e.editor=b.editor.getPreview(),e.attach=b.attach.getPreview(),e});c+="&call=window.opener."+d;var e=document.createElement("FORM");e.action=c,e.method="POST",e.target="_blank";var f=document.createElement("INPUT");f.type="hidden",f.name="content",f.value=b.editor.getFinal(),e.appendChild(f),document.body.appendChild(e),e.submit()}function R(b){try{var c;"student"==$G.mailPattern.currentPattern&&(c="0px"),a.Tips.module(b,c)}catch(d){}}function S(b){if(ab.human_trans){var c=this,d=c.module,e=c.data,f=c.editor,g=c.info,h=d.createId("ext"),i=b.action;if("goHuman"==i){try{var j=$L("product.Translate",c)}catch(k){return k}var g=c.info,l=g.get({did:!0})||g.get({mid:!0});return j.goHuman({mid:l,vendor:b.vendor}),void 0}if("0"===db.get({field:"huodong_option",flag:"humanTrans"})&&!e.get({status:"humanTransTips"}))switch(i){case"check":var m=f.get({html2text:!0});m.length>20&&(m=m.substr(0,300),m=a.String.trim(m),null===m.match(/[^\x00-\x80]/g)&&c.trans({action:"dict"}));break;case"dict":e.set({status:"humanTransTips",value:!0});var n=[{html:"<span><span class='nui-block-icon'><b class='nui-ico nui-ico-translate'></b></span><span style='padding-left:20px;'>您正在进行英文编辑，如有需要可使用 </span></span>"},{xtype:"link",text:"查词典",click:function(){try{var b=$L("product.Translate")}catch(c){return c}b.change(),bb.cache({cl_trans:"2"},a.EMPTYFUNC)}},{html:"<span> 功能 </span>"},{xtype:"link",text:"不再提醒",click:function(){db.set({field:"huodong_option",flag:"humanTrans",value:"1"}),this.ownerCt.destroy()}}],o={renderTo:h,renderBy:"before",extcls:"wn1",subclass:"assistBlock",params:"hasClose",items:n};new a.Block(o),bb.cache({cl_transshow:"2"},a.EMPTYFUNC);break;case"replyTrans":e.get({moduleId:"ext"});var n=[{html:"<span><span class='nui-block-icon'><b class='nui-ico nui-ico-translate'></b></span><span style='padding-left:20px;'>试试用中文写邮件，</span></span>"},{xtype:"link",text:"网易专业翻译",click:function(){try{$L("product.Translate",c)}catch(b){return b}c.send({action:"auto",call:function(){c.trans({action:"goHuman",vendor:"reply"})}}),bb.cache({cl_trans:"3"},a.EMPTYFUNC)}},{html:"<span>帮您完成翻译。 </span>"},{xtype:"link",text:"不再提醒",click:function(){db.set({field:"huodong_option",flag:"humanTrans",value:"1"}),this.ownerCt.destroy()}}],o={renderTo:h,renderBy:"before",extcls:"wn1",subclass:"assistBlock",params:"hasClose",items:n};new a.Block(o),bb.cache({cl_transshow:"3"},a.EMPTYFUNC)}}}function T(){var a=this,b=a.module;if(!b.notary){try{var c=$L("module.compose.ComposeNotary",this)}catch(d){return d}var e=new c(b);e.init(),b.notary=e,e.checkSign()}}function U(){var b=this,c=b.data;if(b.info.get({cid:!0})){var d=!1;c.get({status:"confirmDeleteDraft"})||!c.get({status:"existActiveDraft"})&&b.info.get({did:!0})&&(d=!0),b.action.cancelId({deleteDraft:d,callback:null}),b.info.set({cid:""})}b.clearTimer(),b.attach.destroy(),b.assist.destroy(),c.set({status:"curPage",value:"destroy"}),b.tips(""),a.Tips.show({hidden:!0}),b.removeCallName();var e=b.module;a.Array.each(e.names,function(a,b){e[b].clear()}),a.Array.each(["param","class","module","names","stationery"],function(a,b){e[b]=null,delete e[b]})}try{var V=$L("module.compose.Compose"),W=$L("module.compose.ComposeManager"),X=$L("support.AddressSupport"),Y=$L("support.OptionSupport")}catch(Z){return Z}var $=a.Object,_=a.Email,ab=a.Ext,bb=a.Log,cb=a.S_OK,db=a.Ud,eb=a.Uri,fb=a.createClass($N("module.compose.ComposeBase"));$.inherit(fb,V),$.extend(fb.prototype,{initialize:c,init:d,start:e,startDelay:f,layoutAdjust:g,defined:h,element:i,fillContent:j,send:k,sendCheck:l,sendBuild:m,sendSuccess:n,sendError:o,sendFixMta:p,checkRepeatSend:q,checkSenderName:r,checkRev:s,checkSubject:t,checkAttachText:u,changeCheck:v,changeSync:w,focus:x,empty:y,addTimer:C,clearTimer:D,autoSave:z,autoKeep:A,getAction:B,userDataSave:E,userDataRemove:F,userDataResume:G,connectBreak:H,sessionBreak:I,setSequence:J,runSequence:K,getCallName:L,removeCallName:M,setPage:N,setOption:O,fireOption:P,preview:Q,tips:R,trans:S,initNotary:T,destroy:U})}($,window),function(a){function b(a){var b=this;h.extend(b,{index:0,delayTime:33,saveTextThreshold:1048576,timer:{},sequence:{},change:{},layout:{},element:{},component:{},letterpaper:{},log:{},blackList:{},status:{fromEntry:"",curPage:"compose",inputChoose:"to",sendParam:null,defaultContent:"",uploadParam:null,uploadMode:null,flashReady:!1,moduleOut:!1,empty:!0,fullScreen:!1,paramBody:null,autoSaveTime:2,existActiveDraft:!1,sendCheckCount:0,initTimer:!1,initSign:!1,initAddress:!1,initStationery:!1,chargeSmsData:null,useSms:null,useSign:null,useSeparate:null,showTo:!0,showCc:!1,showBcc:!1,showSide:!1,showSchedule:!1,showEncrypt:!1,save2YNote:!1,showHtmlbar:!0,confirmDeleteDraft:!0,confirmAttach:!0,confirmSubject:!0,confirmExit:!0,saveContact:!0,useWmsvr:!1,humanTransTips:!1},attachments:{files:{},element:{link:null,browseContainer:null,input:null,formContainer:null,formIframe:null,flash:null,flashContainer:null,nativeRequest:null,area:null,info:null,content:null,ulContainer:null,progress:null},tips:{},layout:{attachWidth:278,spaceWidth:8},status:{validServer:!1,layoutInit:!1,confirmSize:!1,cloudTrigger:!1,flashTimer:!1,cardUrl:"",totalPercent:-1,totalBytes:-1,flashIndex:0,fileIndex:1,inputIndex:1,inlinedExist:0}}}),i.superClass.initialize.call(b,a)}function c(){var a=this;i.superClass.init.call(a)}function d(b){var c=this,d=c.module,e=b.value;if("string"==typeof b.status)return c.status[b.status]=e,void 0;if("string"==typeof b.element)return c.element[b.element]=e,void 0;if("string"==typeof b.component)return c.component[b.component]=e,void 0;if("string"==typeof b.moduleId){var f=a("#"+d.createId(e));return c.element[b.moduleId]=f,void 0}}function e(b){var c=this,d=c.module;if("string"==typeof b.status)return c.status[b.status];if("string"==typeof b.element)return c.element[b.element];if("string"==typeof b.component)return c.component[b.component];if("string"==typeof b.moduleId){var e=a("#"+d.createId(b.moduleId));return e}}try{var f=$L("module.compose.Compose")}catch(g){return g}var h=a.Object,i=a.createClass($N("module.compose.ComposeData"));h.inherit(i,f),h.extend(i.prototype,{initialize:b,init:c,set:d,get:e})}($,window),function(a,b){function c(a){var b=this;W.extend(b,{component:{sign:null,portrait:null,stationery:null},mode:null,editorCmpt:null}),_.superClass.initialize.call(b,a)}function d(){var a=this;a.element,_.superClass.init.call(a)}function e(){var a=this;_.superClass.clear.call(a.component),_.superClass.clear.call(a)}function f(){var a=this,b=a.base;try{a.render()}catch(c){b.addTimer("editor",function(){try{a.render()}catch(b){}},100)}}function g(){var a=this;a.module;var b=a.data,c=b.layout;c.editorHeight;var d=U.mode.BASIC;1==$.get({field:"ntes_letter",flag:"editorToolbar"})&&(d=U.mode.FULL),2==$.get({field:"ntes_htmlbar"})&&(a.mode=d);var e=b.get({component:"editor"});a.editorCmpt=e,e.composeEditor=a,a.custom(),a.bindEvent(),"0"==$.get({field:"ntes_compose",flag:"editor_notary_tips"})&&(1==$.get({field:"ntes_letter",flag:"editorToolbar"})||2==$.get({field:"ntes_htmlbar"})||setTimeout(function(){a.showLayer()},1e3))}function h(){var b=this,c=b.editorCmpt;if(!_.initPlugin){_.initPlugin=!0;var d=["Av","Capture","Image","Portrait","Microphone","Sign","Stationery","Basic","Translate","Notary","Full","FullScreen"];a.Array.each(d,function(a,d){c.plugin[d]={},c.plugin[d].selected=b["btn"+d]})}}function i(){var b=this,c=b.event,d=b.editorCmpt;d.listen("iframeClick",a.Function.bind(c.hideFloat,c)),d.listen("iframeKeydown",a.Function.bind(b.keyPress,b)),d.listen("modeChanged",a.Function.bind(b.modeChange,b));var e=a(b.getWindow()),f=a(e.dom.document),g=a(f.dom.body),h=a.Browser.ie()?g:f;h.listen("paste",a.Function.bind(b.pasteAction,b))}function j(a){var b=this,c=b.editorCmpt;return"string"==typeof a.html?c.setContent(a.html,U.mode.BASIC):"string"==typeof a.text?c.setContent(a.text,U.mode.TEXT):c.setContent(a)}function k(a){var b=this;b.editorCmpt.changeMode(a)}function l(a){var b=this;b.editorCmpt.setSize(a)}function m(b,c){var d=this,e=d.data,f=e.get({status:"fromEntry"}),g=e.get({status:"paramBody"});if(-1!=b.indexOf("附件")&&e.set({status:"confirmAttach",value:!1}),"text"==c&&("edit"==f||"draft"==f||"timeset"==f||(c="html",b=a.String.encodeHTML(b),b=["<pre>","<br>",b,"</pre>"].join(""))),"html"==c&&("reply"==f||"forward"==f)){b=b.replace(new RegExp('id="*(spnEditorSign|divEditorGraphSign|divNeteaseMailCard)"*',"ig"),"");var h="0";try{h=$.get({field:"ntes_option",flag:"signPosition"})}catch(i){}if("0"==h){var j=g.defaultContent||"";if(j+=d.getBreakLine(5),j+='<div id="spnEditorSign" style="position:relative;zoom:1"></div>',$S("isFree"))j+='<div id="divNeteaseMailCard"></div>';else if($S("isVip"))j+='<div id="divEditorGraphSign"></div>';else if($S("isCorp")){var k=$G.attrs.letterAngle;if(k&&1==k.langle_apply){var l=k.langle_position,m='<div id="dvLetterAngle"></div>';0===l?j=d.getBreakLine(5)+m+'<div id="spnEditorSign" style="position:relative;zoom:1"></div>':j+=m}}j+=d.getBreakLine(1),b=j+b}else{var n=g.defaultContent||"";n+=d.getBreakLine(5),b=n+b}}if("html"==c){if(b){d.set({html:b});var o=X.getInfo();switch(o.os){case"ipad":case"ipod":case"iphone":case"android":d.switchText({text:!0,force:!0})}}}else d.set({text:b});d.sign.load(),d.checkTips()}function n(a){a=a||{};var b=this;b.base;var c=b.data,d=c.get({status:"showHtmlbar"});if(a.show==d)return!1;var e=b.editorCmpt;if(e.editMode==U.mode.TEXT);else if(d)b.mode=e.editMode,b.setMode(U.mode.HIDE);else{var f=b.mode||U.mode.BASIC;b.setMode(f)}return c.set({status:"showHtmlbar",value:!d}),!0}function o(a){a=a||{};var b=this,c=b.data,d=b.editorCmpt;if(a.empty){var e=c.get({status:"defaultContent"});return b.isEmpty(e)}return"string"==typeof a.id?d.getIframeEl("#"+a.id):"string"==typeof a.tag?d.getIframeEl(a.tag):a.html?d.getContent(U.mode.BASIC,"html"):a.html2text?d.getContent(U.mode.BASIC,"text"):a.text?d.getContent(U.mode.TEXT,"text"):d.getContent()}function p(){var a=this;return a.editorCmpt.getPreviewContent()}function q(a){var b=this,c=b.editorCmpt,d=c.editMode,e=d==U.mode.TEXT?"text":"html",f="";try{return f=c.getFinalContent(d,e),a&&(f=c.filterDisplayNone(f)),f}catch(g){return""}}function r(){var a=this,b=a.editorCmpt;return b.win}function s(a){var b=this,c=b.editorCmpt;return c.getBreakLine(a)}function t(b){var c=this,d=c.editorCmpt,e=d.getContent();return/img/i.test(e)?!1:e==b?!0:(e=a.String.trim(d.getContent(d.editMode,"text")),e?!1:!0)}function u(a){var b=this;b.editorCmpt,b.editorCmpt.del(a)}function v(a){var b=this,c=b.editorCmpt;c.focus(a)}function w(a){var b=this,c=b.editorCmpt;a.html&&c.insertHtml(a.html),a.image&&c.insertImage(a.image)}function x(b){b=b||{};var c=this,d=c.editorCmpt,e=c.data,f=e.get({status:"showHtmlbar"}),g=b.text,h="text"==d.editMode;if(g==h)return!1;if(g)b.force?(f&&(c.mode=d.editMode),c.setMode(U.mode.TEXT),c.form.setCheckbox("text",!0,!0)):c.get({empty:!0})?c.switchText({text:!0,force:!0}):a.Msgbox.show({type:"confirm",title:"将此邮件转换为纯文本将会遗失某些格式，您确定要继续吗？",ok:function(){c.switchText({text:!0,force:!0})}});else{var i=f?c.mode:U.mode.HIDE;c.setMode(i),c.form.setCheckbox("text",!1,!0)}}function y(a){var b=this,c=b.base;if(Y.shortcut&&(a.ctrlKey||a.metaKey)){var d=a.keyCode;83==d&&(c.getAction()||(X.chrome()?c.addTimer("save",function(){try{c.send({action:"save"})}catch(a){}},500):c.send({action:"save"})))}27==a.keyCode&&setTimeout(function(){b.data.get({moduleId:"editor"}).dom.nextSibling.focus()},0)}function z(){var a=this,b=a.data,c=b.get({status:"fullScrren"}),d=a.editorCmpt,e=d.toolbarDv.find("a.APP-editor-switchFullScreen-toFull")||d.toolbarDv.find("a.APP-editor-switchFullScreen-toMini");e&&(c?(e.html('<b class="ico ico-editor ico-editor-toMiniScr"></b>取消全屏'),e.setClass("APP-editor-commond-btn APP-editor-switchFullScreen-toMini nui-txt-link-focus")):(e.html('<b class="ico ico-editor ico-editor-toFullScr"></b>'),e.setClass("APP-editor-commond-btn APP-editor-switchFullScreen-toFull")))}function A(a){var b=this,c=b.editorCmpt,d=b.component;d.portrait.hide(),c.insertPortrait(a)}function B(){var c=this,d=c.form,e=c.data,f=X.getInfo();if("macintosh"==f.os&&X.safari()&&setTimeout(function(){for(var d=c.editorCmpt.doc,e=d.getElementsByTagName("IMG"),f=0;f<e.length;f++){var g=e[f];0===g.src.indexOf("webkit-fake-url")&&(g.url=g.src,g.src="http://mimg.127.net/xm/webmail/img/local.png",g.unselectable="on",g.style.cursor="pointer",a(g).listen("click",function(){var c=a.Uri.getUrl("compose_attach_fakeurl",!0)+"&url="+encodeURIComponent(g.url);b.open(c)}))}},15),e.get({status:"confirmSubject"})&&""===d.getSubject()){var g=c.get({html2text:!0});setTimeout(function(){var a=c.get({html2text:!0}),b=g.length,d=a.length,e=3e3;if(!(b>e||d>e)){for(var f=0;b>f&&d>f&&g.charAt(b-f-1)==a.charAt(d-f-1);f++);for(var h=b-f,i=d-f,f=0;b>f&&d>f&&g.charAt(f)==a.charAt(f);f++);h>f&&(h=f);var j=(h==i?a:a.substring(h,i)).replace(/[\r\n]/gi,"");0===j.indexOf("http://")&&c.getSubject(j)}},15)}}function C(b){var c=this,d=c.data;c.base,c.action.getSubject({url:b,callback:a.Function.bind(c.fillSubject,c),error:function(){return!0
}}),d.set({status:"confirmSubject",value:!1})}function D(b){var c=this,d=c.form;""===d.getSubject()&&b.code==a.S_OK&&d.setSubject(b["var"].title)}function E(){if(Y.editor_tips&&!_.loadTips){var b=this,c=a.Uri.getUrl("letterpaper_tips");a.Ajax.jsonp(c,function(a){b.showTips(a)},"jsonp")}}function F(c){if(200==c.code&&(_.loadTips=!0,c.visible)){var d=this,e=d.module,f=d.stationery,g=d.data;d.component;var h=d.editorCmpt,i=h.editDv.dom,j=c.letter,k=j.name,l=j.iconUrl,m=a(h.toolbarDv.find(".APP-editor-commond-stationery").dom).offset(),n=m.x-97-d.getPadding()+"px",o="33px",p='<b class="nui-layer-arr"></b><div class="jn1">新信纸</div><div id="'+e.createId("stationeryTips")+'" class="jo1">'+'<a class="hr1" href="#">'+'<img class="ih1" src="'+l+'" alt="'+k+'">'+"</a>"+"</div>"+'<div class="jr1">'+k+"</div>",q=new a.Layer({renderTo:i,extcls:"mJ1",left:n,top:o,hasClose:!1,content:p});Z.cache({sh_stationery_tips:j.id},a.EMPTYFUNC);var r=g.get({moduleId:"stationeryTips"});r.listen("click",function(){f.select({item:j}),q.hide(),Z.cache({cl_stationery_tips:j.id},a.EMPTYFUNC),Z.cache({cl_stationery_paper:j.id},a.EMPTYFUNC)}),b.setTimeout(function(){q.hide()},15e3)}}function G(){$S("clientWidth")||$S("clientWidth",document.documentElement.clientWidth);var a=0,b=$S("clientWidth");return 1680>=b||(a=1920>=b?52:2560>=b?104:156),"student"==$G.mailPattern.currentPattern&&(a+=160),a}function H(){try{var b=$L("product.AvMail",this)}catch(c){return c}var d=this,e=d.composeEditor,f=e.module;(new b).init(f),Z.cache({cl_av:1},a.EMPTYFUNC)}function I(){var b=this,c=b.composeEditor;"3"!=$.get({field:"ntes_compose",flag:"upload_mode"})?c.assist.captureStart():a.Msgbox.show({title:"普通附件上传模式不支持截图，请切换到高级上传模式"}),Z.cache({cl_capture:"1"},a.EMPTYFUNC)}function J(){var b=$I("module.compose.ComposeAssist"),c=this,d=c.composeEditor,e='<div class="nui-normalTabs nui-tabs"><div id="dvMsgBoxTab1" class="nui-tabs-item nui-tabs-item-selected">我的电脑</div><div id="dvMsgBoxTab2" class="nui-tabs-item nui-tabs-item-hover">网址URL</div></div><ul class="APP-editor-insertPic-panel"><li id="liMsgBoxPanel1" class="APP-editor-insertPic-panel-item"><div class="APP-editor-insertPic-remark">点击“浏览”，在您电脑中选择要上传的图片，每张图片上传完毕后将会自动添加到正文中</div></li><li id="liMsgBoxPanel2" class="APP-editor-insertPic-panel-item" style="display:none"></li></ul>',f=null;f=a.Msgbox.show({header:"添加图片",content:e,extcls:"APP-editor-insertPic",contentType:"normal",autoFocus:!1,listeners:{afterRender:function(){new a.Button({renderTo:a("#liMsgBoxPanel1").dom.firstChild,text:"浏览",subclass:"mainBtn",click:function(){if("3"!=$.get({field:"ntes_compose",flag:"upload_mode"})){if(b.has())b.hasNewVersion()?d.attach.pluginBrowse({type:"image",title:"选择要上传的图片",call:function(b){b.length&&(a.Array.each(b,function(a,b){b.inlined=!0}),d.attach.pluginSelect(b))}}):d.assist.setup("upload");else if(d.attach.nativeClick){var c=d.attach,e=a("#inputFileImage");e||(e=a.Element.create("input"),e.css({visibility:"hidden"}),e.attr({id:"inputFileImage",type:"file",size:"1",multiple:!0,accept:"image/*"}),document.body.appendChild(e.dom)),e.one("change",function(){var b=e.dom.files;if(b.length){b=a.Object.toArray(b),a.Array.each(b,function(a,b){b.inlined=!0}),c.nativeSelect(b);try{e.dom.value=""}catch(d){}}}),e.dom.click()}else d.assist.setup();f.close()}else a.Msgbox.show({title:"普通附件上传模式不支持本地图片上传，请切换到高级上传模式"})}}),new a.Button({renderTo:a("#liMsgBoxPanel1").dom.firstChild,text:"取消",click:function(){f.close()}}),new a.Component({html:"<span></span>",renderTo:"liMsgBoxPanel2",items:[{xtype:"input"},{xtype:"button",text:"添加",subclass:"mainBtn",click:function(){var a=this.ownerCt.find("input")[0],b=a.getValue();b&&"http://"!=b?(d.insert({image:b}),f.close()):a.showTips("请输入合法的地址","err")}},{xtype:"button",text:"取消",click:function(){f.close()}},{html:'<p class="APP-editor-insertPic-remark">请在输入框里面填上要添加图片的URL</p>'}]}),this.buttons.ok.hide()}}});var g=a("#dvMsgBoxTab1","#dvMsgBoxTab2"),h=a("#liMsgBoxPanel1","#liMsgBoxPanel2");g.listen("click",function(b){var c=0,d=1,e=a.Event.getTarget(b);"dvMsgBoxTab2"==e.id&&(c=1,d=0);var f="nui-tabs-item-selected";-1==g.doms[c].className.indexOf(f)&&(a(g.doms[d]).setClass("nui-tabs-item nui-tabs-item-hover"),a(h.doms[d]).hide(),a(g.doms[c]).setClass("nui-tabs-item nui-tabs-item-selected"),a(h.doms[c]).show())}),Z.cache({cl_image:"1"},a.EMPTYFUNC)}function K(){var c=this,d=c.composeEditor;a.Browser.getVersion()||[0,0];var e=b.SpeechRecognition||b.webkitSpeechRecognition;if(e){var f='<div class="APP-editor-speech"><div class="nui-multiLineIpt nui-ipt"><textarea id="textAreaComposeVoice" class="nui-ipt-input"></textarea></div><div class="APP-editor-speech-tips nui-txt-tips nui-txt-s12"><span class="APP-editor-speech-tipsLeft">请点击图标</span><button id="voiceButton" style="display:inline-block;padding:0;overflow:hidden;border:none;outline:none;" class="APP-editor-speech-iptOuter"><img alt="Start" id="start_img" src="http://mimg.126.net/p/js6/lib/img/mic/mic.gif" style="width: 100%;height: 100%;"></button><span class="APP-editor-speech-tipsRight">开始语音输入</span></div></div>';a.Msgbox.show({type:"confirm",contentType:"wide",header:"语音输入",content:f,ok:function(){var b=a("#textAreaComposeVoice").dom.value;d.insert({html:b})}});var e=e||webkitSpeechRecognition,g=new e;g.lang="zh-CN",g.interimResults=!1,g.maxAlternatives=1,g.onresult=function(b){var c=b.results[0][0].transcript;a("#textAreaComposeVoice").dom.value+=c},g.onstart=function(){a("#voiceButton").find("img").dom.src="http://mimg.126.net/p/js6/lib/img/mic/mic-animate.gif"},g.onspeechstart=function(){},g.onspeechend=function(){a("#voiceButton").find("img").dom.src="http://mimg.126.net/p/js6/lib/img/mic/mic.gif",g.stop()},g.onerror=function(){},a("#voiceButton").listen("click",function(){g.start()})}else{var h="您的浏览器不支持语音输入功能，建议您选择<br/>Google Chrome浏览器进行体验，";a.Browser.chrome()&&(h="您的Chrome浏览器版本过低，建议您升级到新版本进行体验，");var f=h+'<a href="http://codown.youdao.com/163chrome/b/output/ChromeSetup/ChromeSetup.exe" target="_blank">立即下载</a>。<br/>点击此处<a href="http://chrome.163.com" target="_blank">了解详情</a>。';a.Msgbox.show({title:f})}}function L(a,b,c){var d=this,e="basic"==c?"0":"1";$.set({field:"ntes_letter",flag:"editorToolbar",value:e}),d.changeMode(c)}function M(b,c,d){var e=this,f=e.composeEditor;f.module;var g=f.component;if(g[d])return g[d].show(),void 0;var h=e.editDv.dom,i=c.offset(),j=i.x-47-f.getPadding()+"px",k="29px",l=f.base.getCallName(a.Function.bind(f.portraitAdd,f)),m=a.Uri.getUrl("compose_portrait",!0)+"?call=window.parent."+l,n={width:"392px",left:j,top:k,extcls:"APP-editor-menuNoBorder APP-editor-menuNoBorder-insertFace",renderTo:h,groups:[{content:'<iframe class="APP-editor-menu-iframe" allowtransparency="allowtransparency" src="'+m+'" frameborder="0" scrolling="no"></iframe>'}]};Z.cache({cl_portrait:"1"},a.EMPTYFUNC),g[d]=new a.Menu(n)}function N(b,c,d){var e=this,f=e.composeEditor,g=f.sign,h=e.editDv.dom;e.plugin[d];var i=[],j={},k=c.offset(),l=k.x-47-f.getPadding()+"px",m=(k.x<500?"55":"33")+"px",n={renderTo:h,left:l,top:m,groups:[j]};if($S("isVip")){n.width="409px",n.height="226px";var o=f.base.getCallName(function(a,b,c){switch(a){case"get":return g.get({text:!0});case"set":0===b?$E(["interface.OutlinkInterface"],function(a){a.goOutlink({key:"vcard"})}):1==b?$E(["interface.OptionInterface"],function(a){a.entry("SignModule")}):2==b&&$E(["interface.OutlinkInterface"],function(a){a.goOutlink({key:"shangdao"})});break;case"select":0===b?g.fillGraph(c):1==b&&g.fillText(c)}}),p=a.String.uriAddParam(a.Uri.getUrl("compose_vip_sign"),"call=window.parent."+o);j.content='<iframe src="'+p+'" style="display:block;width:401px;height:240px" scrolling="no" frameborder="0"></iframe>'}else g.each({text:!0,call:function(b,c){c&&i.push({text:a.String.escapeHTML(c.name),click:function(){g.select({text:!0,id:c.id})}})}}),g.each({card:!0,call:function(b,c){0===b&&i.length&&i.push({type:"split"}),i.push({text:a.String.escapeHTML(c.cardName),click:function(){Z.cache({cl_sign_select:"1"},a.EMPTYFUNC),g.select({card:!0,id:c.id})}})}}),Y.linkedin&&(i.length&&i.push({type:"split"}),i.push({text:"linkedIn签名",click:function(){Z.cache({cl_sign_linkedin:"1"},a.EMPTYFUNC),g.select({linkedin:!0,id:1})||a.Msgbox.show({type:"confirm",title:"你还未设置linkedIn签名，是否立即设置？",ok:function(){$E(["interface.OptionInterface"],function(b){Z.cache({cl_sign_set:"1"},a.EMPTYFUNC),b.entry({module:"SignModule",exit:!1})})}})}})),i.length&&i.push({type:"split"}),i.push({text:"个性签名",click:function(){Z.cache({cl_sign_custom:"1"},a.EMPTYFUNC),g.showCustom()}}),i.push({text:"设置签名",click:function(){$E(["interface.OptionInterface"],function(b){Z.cache({cl_sign_set:"1"},a.EMPTYFUNC),b.entry({module:"SignModule",exit:!1})})}}),($S("isFree")||$S("isCorp"))&&i.push({text:"设置电子名片",click:function(){Z.cache({cl_sign_ecard:"1"},a.EMPTYFUNC),$E(["interface.OutlinkInterface"],function(a){a.goOutlink({key:"compose_ecard_entry",group:"ecard"})})}}),j.items=i;new a.Menu(n)}function O(b,c){var d=this,e=d.composeEditor,f=e.module,g=f.data,h=f.base,i=g.get({moduleId:"header"}),j=a(f.container),k=g.get({status:"showSide"}),l=g.get({status:"fullScrren"});g.set({status:"fullScrren",value:!l});var m=g.get({component:"toolbar"}),n=m.getEl().find(".nui-toolbar-ext").hide();l?(i.removeClass("nA2"),j.removeClass("frame-main-noTop"),k&&a.Frame.setViewType("l-r",f),h.layoutAdjust({force:!0,timer:!0}),c.html('<b class="ico ico-editor ico-editor-toFullScr"></b>'),c.setClass("APP-editor-commond-btn APP-editor-switchFullScreen-toFull"),n.show()):(i.addClass("nA2"),j.addClass("frame-main-noTop"),k&&a.Frame.setViewType("normal"),h.layoutAdjust({force:!0,timer:!0}),c.html('<b class="ico ico-editor ico-editor-toMiniScr"></b>取消全屏'),c.setClass("APP-editor-commond-btn APP-editor-switchFullScreen-toMini nui-txt-link-focus"),n.hide())}function P(b,c,d){var e=this,f=e.composeEditor,g=f.module,h=f.component;if(h[d])return h[d].show(),void 0;var i=e.editDv.dom,j=c.offset(),k=j.x-89-f.getPadding()+"px",l="33px",m='<b class="nui-layer-arr"></b><div id="'+g.createId("paperContent")+'">'+'<div id="'+g.createId("paperBtn")+'" class="hf0"></div>'+'<div class="cM0">'+'<ul id="'+g.createId("paperList")+'" class="fB0"></ul>'+"</div>"+'<div id="'+g.createId("paperPage")+'" class="he0"></div>'+"</div>";h[d]=new a.Layer({renderTo:i,extcls:"kv0",left:k,top:l,hasClose:!0,content:m}),f.stationery.load()}function Q(){Z.cache({cl_trans:"1"},a.EMPTYFUNC);var b=this,c=b.composeEditor,d=c.base;d.send({action:"auto",call:function(){d.trans({action:"goHuman",vendor:"write"})}})}function R(){Z.cache({cl_notary_editor:"1"},a.EMPTYFUNC);var b=this,c=b.composeEditor;c.module;var d=c.event,e=c.data;if(e.get({status:"initExt"})!==!0)d.extActive();else{var f=e.get({element:"ext"});"none"==f.dom.style.display&&d.extActive()}var g=e.get({component:"notary"});g.getChecked()!==!0&&g.setChecked(!0)}function S(){var b=this;b.module,b.stationery,b.component;var c=b.editorCmpt;if(!c.rendered)return c.listen("afterRender",function(){b.showLayer()}),void 0;$.set({field:"ntes_compose",flag:"editor_notary_tips",value:"1"});var d=c.editDv.dom,e=a(c.toolbarDv.find(".APP-editor-commond-notary").dom).offset(),f=e.x-84-b.getPadding()+"px",g="36px",h='<strong>新功能提醒</strong><div>邮件存证，让电子邮件变“铁证”<a href="javascript:void(0)" onclick="window.open(\'http://gzy.mail.163.com/?from=toolbar\');" class="nui-txt-link" >了解详情</a></div>';new a.Layer({renderTo:d,params:"hasArr arrTop hasClose",doNotHide:!0,extcls:"nui-tipsLayer",width:"160px",left:f,top:g,content:h})}try{var T=$L("module.compose.Compose"),U=$L("component.editor.Editor")}catch(V){return V}var W=a.Object;a.Function;var X=a.Browser,Y=a.Ext,Z=a.Log,$=a.Ud,_=a.createClass($N("module.compose.ComposeEditor"));W.inherit(_,T),W.extend(_.prototype,{initialize:c,init:d,clear:e,create:f,render:g,custom:h,bindEvent:i,set:j,setMode:k,setSize:l,setOriginal:m,setHtmlbar:n,get:o,getPreview:p,getFinal:q,getWindow:r,getBreakLine:s,isEmpty:t,remove:u,focus:v,insert:w,switchText:x,keyPress:y,modeChange:z,portraitAdd:A,pasteAction:B,getSubject:C,fillSubject:D,checkTips:E,showTips:F,showLayer:S,getPadding:G,btnAv:H,btnCapture:I,btnImage:J,btnMicrophone:K,btnMode:L,btnFull:L,btnBasic:L,btnPortrait:M,btnSign:N,btnFullScreen:O,btnStationery:P,btnTranslate:Q,btnNotary:R})}($,window),function(a,b){function c(a){var b=this;y.superClass.initialize.call(b,a)}function d(){var a=this;y.superClass.init.call(a)}function e(c){c=c||{};var d=this,e=d.base,f=c.func,g="bottom"==c.pos?"2":"1";switch(f){case"deliver":v.cache({cl_send:g},a.EMPTYFUNC),e.send({action:"deliver"});break;case"save":v.cache({cl_save:g},a.EMPTYFUNC),e.send({action:"save"});break;case"preview":v.cache({cl_preview:g},a.EMPTYFUNC),e.preview();break;case"cancel":v.cache({cl_cancel:g},a.EMPTYFUNC),a.MultiTab.remove(a.Context.module);break;case"dict":v.cache({cl_dict:g},a.EMPTYFUNC);try{var h=$L("product.Translate")}catch(i){return i}h.change();break;case"scene":var j=x.getUrl("compose_scene",!0);b.open(j);break;case"card":$I("init.CustomAppManager").startApp({name:"cards_read",appId:4,text:"邮箱贺卡",url:x.getUrl("cards_read")});break;case"postcard":$I("init.CustomAppManager").startApp({name:"read_postcard",appId:3,text:"明信片",url:x.getUrl("read_postcard")})}}function f(a){a=a||{};var b=this;b.base,b.form;var c=b.data,d=c.get({status:"showTo"}),e=c.get({element:"to"}),f=a.toggle;if(a.show){if(d)return;f=!0}if(a.hide){if(!d)return;f=!0}f&&(d?e.hide():e.show(),c.set({status:"showTo",value:!d}))}function g(b){b=b||{};var c=this;c.base;var d=c.form,e=c.data,f=e.get({status:"showCc"}),g=c.getLink("cc"),h=e.get({element:"cc"});h||(h=c.createRev("cc"));var i=b.toggle;if(b.show){if(f)return;i=!0}if(b.hide){if(!f)return;i=!0}if(i){if(f){if(b.separate);else if(!d.getContact("empty","cc"))return new a.Msgbox({type:"confirm",title:"要删除已经存在的所有抄送地址吗？",ok:function(){d.setContact(null,"cc"),c.setCc({hide:!0})}}),void 0;g.setText("抄送"),h.hide(),b.separate||"cc"==e.get({status:"inputChoose"})&&d.focus("to")}else g.setText("删除抄送"),h.show(),b.separate||d.focus("cc");e.set({status:"showCc",value:!f})}}function h(b){b=b||{};var c=this;c.base;var d=c.form,e=c.data,f=e.get({status:"showBcc"}),g=c.getLink("bcc"),h=e.get({element:"bcc"});h||(h=c.createRev("bcc"));var i=b.toggle;if(b.show){if(f)return;i=!0}if(b.hide){if(!f)return;i=!0}if(i){if(f){if(b.separate);else if(!d.getContact("empty","bcc"))return new a.Msgbox({type:"confirm",title:"要删除已经存在的所有密送地址吗？",ok:function(){d.setContact(null,"bcc"),c.setBcc({hide:!0})}}),void 0;g.setText("密送"),h.hide(),b.separate||"bcc"==e.get({status:"inputChoose"})&&d.focus("to")}else g.setText("删除密送"),h.show(),b.separate||d.focus("bcc");e.set({status:"showBcc",value:!f})}}function i(b){b=b||{};var c=this;c.base;var d=c.form,e=c.data,f=e.get({status:"useSeparate"}),g=c.getLink("all"),h=g[0],i=g[1],j=g[2],k=e.get({element:"separate"});k||(k=c.createRev("separate"));var l=b.toggle;if(b.show){if(f)return;l=!0}if(b.hide){if(!f)return;l=!0}if(l){if(f){h.show(),i.show(),j.setText("群发单显"),k.hide();var m=d.getContact("suc","separate"),n=m.length,o={};a.Array.each(m,function(a,b){o[b.address.toLowerCase()]=1});var p=function(b){var c=[];n&&a.Array.each(d.getContact("suc",b),function(a,b){var d=b.address.toLowerCase();o[d]&&(o[d]++,c.push(b))}),c.length?d.setContact(c,b):d.setContact(null,b)};if(f.showTo&&(p("to"),c.setTo({show:!0,separate:!0})),f.showCc&&(p("cc"),c.setCc({show:!0,separate:!0})),f.showBcc&&(p("bcc"),c.setBcc({show:!0,separate:!0})),n){var q=[];a.Array.each(m,function(a,b){o[b.address.toLowerCase()]>1||q.push(b)}),d.addContact(q,"to")}d.setContact(null,"separate"),d.focus(f.inputChoose),f=null}else f={},f.inputChoose=e.get({status:"inputChoose"}),h.hide(),i.hide(),j.setText("取消群发单显"),k.show(),e.get({status:"showTo"})&&(d.addContact(d.getContact("suc","to"),"separate"),c.setTo({hide:!0,separate:!0}),f.showTo=!0),e.get({status:"showCc"})&&(d.addContact(d.getContact("suc","cc"),"separate"),c.setCc({hide:!0,separate:!0}),f.showCc=!0),e.get({status:"showBcc"})&&(d.addContact(d.getContact("suc","bcc"),"separate"),c.setBcc({hide:!0,separate:!0}),f.showBcc=!0),d.focus("separate");e.set({status:"useSeparate",value:f})}}function j(b){var c=this;c.module;var d=c.form,e=c.data,f="",g={xtype:"emailcontainer",key:b,containerfocus:function(){d.choose(b),d.addFocusCls(b)},containerblur:function(){d.removeFocusCls(b),a.Ext.contactCorrect&&d.remindValid(b)},domain:"163.com"};w.contactCorrect&&(g.itemwarnremove=function(a){d.remindRemove(b,a)});var h="地址输入框，请输入邮件地址，多人时地址请以分号隔开",i={cc:{tabIndex:1,title:"同时将这封邮件发给其他联系人",inputLable:"抄送"+h},bcc:{tabIndex:1,title:"该地址对于其他收件人是不可见的",inputLable:"密送"+h},separate:{tabIndex:1,tips:{text:"群发的邮件，采用一对一单独发送，每个收件人只看到自己的地址"},title:"会对多个人一对一的发送， 每个人将单独收到发给他/她的邮件",inputLable:"群发单显"+h}};u.extend(g,i[b]);var j={cc:"抄送人",bcc:"密送人",separate:"群发单显"},k=j[b],l={text:k,cls:"nui-txt-link",title:"点击添加"+k,click:function(){v.cache({cl_rev:b},a.EMPTYFUNC),d.showContact(b)}},m=k;try{var n=new a.Link(l);m=n.html();var o=$I("component.emailinput.EmailContainer"),p=new o(g);f=p.html(),e.set({component:b,value:p})}catch(q){}var r=a.Element.create("DIV");r.setClass("kZ0 jL0"+b);var s=e.get({element:"to"});if("bcc"==b){var t=e.get({element:"cc"}),x=t||s;x.after(r.dom)}else s.after(r.dom);m+="separate"==b?'<span style="margin-left:-4px">：</span>':"：";var y='<label class="fn0">'+m+"</label>"+'<div class="dG0">'+'<div class="bz0">'+f+"</div>"+"</div>"+'<div class="gH1"></div>';return r.html(y),a.Component.setEvents(),e.set({element:b,value:r}),d.addHoverEvent(b),r}function k(a){var b=this,c=b.data,d=c.get({component:"toolbar"}),e=d.find("link");switch(a){case"cc":return e[2];case"bcc":return e[3];case"all":return[e[2],e[3],e[4]]}}function l(){var b=this;b.module;var c=b.base,d=b.data;d.get({status:"initExt"})!==!0&&(b.extCreate(),d.set({status:"initExt",value:!0}));var e=d.get({element:"ext"}),f=d.get({component:"extLink"});if("none"==e.dom.style.display){v.cache({cl_more_s:"1"},a.EMPTYFUNC),f.setText('隐藏选项 <b class="nui-ico">k</b>');try{var g=d.layout,h=b.editor;h.setSize({height:g.editorHeight-34+"px"})}catch(i){}}else v.cache({cl_more_h:"2"},a.EMPTYFUNC),f.setText('更多选项 <b class="nui-ico">j</b>');e.toggle(),c.layoutAdjust({timer:!0,force:!0})}function m(){var b=this,c=b.module,d=b.data,e=b.editor,f=d.get({element:"ext"}),g=new a.Checkbox({text:"紧急",title:"设置邮件投递优先级"});d.set({component:"priority",value:g});var h=new a.Checkbox({text:"已读回执",title:"启用回执功能，您可以了解收件人是否阅读了您发送的邮件"});d.set({component:"receipt",value:h});var i="";if(w.notary){var j=new a.Checkbox({text:"邮件存证",checkedchange:function(){var b=this;if(!c.notary){try{var d=$L("module.compose.ComposeNotary",this)}catch(e){return e}var f=new d(c);f.init(),c.notary=f}c.notary.toggle({click:!0})||b.setChecked(!1,!0),v.cache({cl_notary:"1"},a.EMPTYFUNC)}});d.set({component:"notary",value:j}),i=j.html()}var k=new a.Checkbox({text:"纯文本",title:"把邮件内容切换成纯文本，它将无法插入表情，图片以及将丢失正文颜色等",checkedchange:function(){var b=this.getChecked();this.setChecked(!1,!0),e.switchText({text:b,click:!0}),v.cache({cl_text:"1"},a.EMPTYFUNC)}});d.set({component:"text",value:k});var l=new a.Checkbox({text:"定时发送",checkedchange:function(){var b=this;if(!c.schedule){try{var d=$L("module.compose.ComposeSchedule",this)}catch(e){return e}var f=new d(c);f.init(),c.schedule=f}c.schedule.toggle({click:!0})||b.setChecked(!1,!0),v.cache({cl_schedule:"1"},a.EMPTYFUNC)}});d.set({component:"schedule",value:l});var m=new a.Checkbox({text:"邮件加密",checkedchange:function(){if(!c.encrypt){try{var b=$L("module.compose.ComposeEncrypt",this)}catch(d){return d}var e=new b(c);e.init(),c.encrypt=e}c.encrypt.toggle({click:!0})||this.setChecked(!1,!0),v.cache({cl_encrypt:"1"},a.EMPTYFUNC)}});d.set({component:"encrypt",value:m});var n="",o="";if(w.ynote){var p=new a.Checkbox({text:"保存到有道云笔记"});d.set({component:"ynote",value:p}),o=p.html();var q=x.getUrl("ynote",!0),r=new a.Link({cls:"nui-fIBlock",icon:"help",link:q,title:"什么是有道云笔记?",attrs:"style = 'margin:8px 0 0 -8px;'",target:"_blank"}).html();o+=r}var s=g.html()+h.html()+i+k.html()+l.html()+m.html()+n+o;f.dom.firstChild.innerHTML=s,a.Component.setEvents()}function n(){var b=this,c=b.module;if(!c.notary){try{var d=$L("module.compose.ComposeNotary",this)}catch(e){return e}var f=new d(c);f.init(),c.notary=f}c.notary.toggle({click:!0})||this.setChecked(!1,!0),v.cache({cl_notary:"2"},a.EMPTYFUNC)}function o(b){var c=this;c.module;var d=c.base,e="1"==b;return e?a.Frame.fullScreen():a.Frame.fullScreen("hfull"),d.addTimer("layout",function(){c.attach.layout()},300),!0}function p(b){b=b||{};var c=this,d=c.module,e=c.base,f=c.data,g=f.get({status:"showSide"}),h=d._child;return b.show==g?!1:(g?a.Frame.setViewType("normal"):(h?a.SM.show(h):a.SM.go({module:"address.AddressModule",noDragbar:!0,reset:!1,parent:d}),a.Frame.setViewType("l-r",d)),f.set({status:"showSide",value:!g}),e.addTimer("layout",function(){c.attach.layout()},300),!0)}function q(){a.Menu.hideAllMenu()}function r(b){var c=this,d=c.base,e=c.data,f=e.get({moduleId:"attachDrag"}),g=e.get({moduleId:"attachDragClose"}),h="none"!=f.dom.style.display;if(b.toggle)return h?c.setDragArea({hide:!0,force:!0}):c.setDragArea({show:!0,close:!0}),void 0;if(b.show)return h||(b.close?(f.set("dragType","close"),g.show()):(f.set("dragType","auto"),g.hide()),c.setDragArea({auto:!0}),f.show()),a.Browser.ie()&&!b.close,void 0;if(b.hide){var i=!1;return h&&("close"==f.get("dragType")?b.force&&(i=!0):i=!0),i&&d.addTimer("dragarea",function(){f.hide()},a.Browser.ie()?0:500),a.Browser.ie(),void 0}if(b.auto){var j=0;j+=282;var k=j+"px";return f.css({height:k,lineHeight:k}),void 0}}try{var s=$L("module.compose.Compose")}catch(t){return t}var u=a.Object;a.Tab;var v=a.Log,w=a.Ext;a.Ud;var x=a.Uri,y=a.createClass($N("module.compose.ComposeEvent"));u.inherit(y,s),u.extend(y.prototype,{initialize:c,init:d,fireBar:e,setTo:f,setCc:g,setBcc:h,setSeparate:i,createRev:j,getLink:k,extActive:l,extCreate:m,switchNotary:n,switchNav:o,switchSide:p,hideFloat:q,setDragArea:r})}($,window),function(a){function b(a){var b=this;C.extend(b,{element:{priority:null,receipt:null,text:null,sms:null},fixData:{},fixElement:{}}),G.superClass.initialize.call(b,a)}function c(){var a=this;G.superClass.init.call(a)}function d(b){var c,d,e,f=this,g=f.data,h=$I("init.SenderList"),i=g.get({component:"sender"});if("string"==typeof b&&(b=F.matchEmail(b)),b){c=b.address,d=b.name;var j=h.getList();a.Array.each(j,function(b,d){return d.address==c?(e=d,a.BREAK):void 0}),e&&(d&&(e.name=d),i.setValue(e))}}function e(){var a=this,b=a.data.get({component:"sender"}),c=b.getValue();return c}function f(a,b){if(!C.isArray(a)||0!==a.length){var c=this,d=c.getContainer(b,!0);d.addItem(a)}}function g(a,b,c){var d=this,e=d.getContainer(b,!0);if(a)if(c){var f=[];try{for(var g=0,h=a.length;h>g;g+=1){var i,j=F.getEmails(a[g],null,!0),k=j.match;k.length>0&&(i=k[0],f.push(i))}}catch(l){}for(var m,n=A.mappingEmails(f,c),o=[],p=n.data,g=0,h=p.length;h>g;g+=1)m=p[g],o.push(new E(m.address,m.name));e.setItem(o)}else e.setItem(a);else e.clearItem()}function h(b,c){var d=this,e=d.getContainer(c);if(e){if("build"==b){var f=e.get("suc");return a.Array.each(f,function(a,b){if(b.name&&-1!=b.name.indexOf('"'))if(-1!=b.name.indexOf('\\"')){var c=b.name.replace(/\\"/g,"§");c=c.replace(/"/g,""),b.name=c.replace(/§/g,'\\"')}else b.name=b.name.replace(/"/g,"");f[a]=b.toString()}),f}return e.get(b)}var g;switch(b){case"object":g={suc:[],fail:[]};break;case"array":case"suc":case"build":case"fail":g=[];break;case"empty":g=!0;break;case"dom":g=null}return g}function i(a,b){var c=this,d=c.getContainer(b);d&&d.delItem(a)}function j(a,b,c){var d=this,e=d.getContainer(b);e&&e.setItemValid(a,c)}function k(b){var c=this;c.choose(b);var d={to:"收件人",cc:"抄送人",bcc:"密送人",separate:"群发单显"},e=d[b];$E(["component.contact.SelectContact"],function(d){var f=c.getContact("suc",b);d.show({exist:f,title:e,data:A.data,callback:function(d){var e=[];a.Array.each(d,function(a,b){e.push(b)}),c.setContact(e,b),c.focus(b)},cancel:function(){c.focus(b)}})})}function l(a,b){var c=this,d=c.data,e=c.event;a||(a=d.get({status:"inputChoose"}));var f=d.get({component:a});return!f&&b&&e.createRev(a),d.get({component:a})}function m(a){var b=this,c=b.data;if(D.contactCorrect){a||(a=c.get({status:"inputChoose"}));var d=b.getContact("build",a),e=c.change;if(e.composeInfo){var f="separate"==a?"to":a;if(!C.isEqual(d,e.composeInfo[f])){e.composeInfo[f]=d;for(var g=c.get({component:a}),h=g.get("array"),i=[],j=0;j<h.length;j++)i.push(h[j].address);var k={"var":{input:i},callback:function(c){b.remindShow(a,c)}};b.action.contactCorrect(k)}}}}function n(b,c){var d=this,e=d.base,f=d.data,g=c.responseText,h=a.Eval.get(g);if(h&&200==h.code){var i=h.data,j=i.wrongbob,k=i.wrongdomain;if(C.isEmpty(j)&&C.isEmpty(k))return;d.fixElement[b]||(d.fixElement[b]={},d.fixElement[b].child={});var l=d.fixElement[b];C.each(j,function(a,b){d.fixData[a]={address:b,type:0}}),C.each(k,function(b,c){if(d.fixData[b])return a.CONTINUE;var e=b.split("@")[0]+"@"+c;d.fixData[b]={domain:c,address:e,type:1}});var m=l.component,n=f.get({component:b});m?(m.empty(),m.show()):(m=a.Element.create("DIV"),m.setClass("bK0"),n.getEl().after(m.dom),l.component=m);var o=a.Element.create("P");o.html("我们发现您输入的地址可能有误，请选择修改："),m.append(o.dom),C.each(d.fixData,function(c,e){var f=e.type,g=e.address,h=n.findItem(c);if(!h)return a.CONTINUE;h.setWarn(f);var i=a.Element.create("P"),j=a.Element.create("SPAN");j.html(c+" →");var k=a.Element.create("A");k.attr({href:"javascript:void(0)"}),k.setClass("nui-txt-link");var o=0===f?g:e.domain;k.html(o),k.listen("click",function(e){h.fixWarn({address:g}),d.remindRemove(b,c),a.Event.cancel(e)}),i.append(j.dom),i.append(k.dom),m.append(i.dom);var p=c.toLowerCase();l.child[p]=i}),new a.Link({text:"关闭该提醒功能",cls:"nui-txt-link",renderTo:m,click:function(){m.empty(),m.hide(),e.setOption({field:"ntes_letter",flag:"remindShow",value:"1"},!0),D.contactCorrect=!1,C.each(d.fixData,function(b){var c=n.findItem(b);return c?(c.fixWarn({address:c.address}),void 0):a.CONTINUE})}})}}function o(a,b){var c=this,d=c.fixElement[a];b=b.toLowerCase(),d.child[b].remove(),delete d.child[b],C.isEmpty(d.child)&&(d.component.empty(),d.component.hide())}function p(a){var b=this,c=b.data.get({component:"subject"});try{c.fireRender(),c.setValue(a)}catch(d){}b.module.setText(a)}function q(){var a=this,b=a.data.get({component:"subject"});return b.getValue()}function r(a){var b=this,c=b.data,d=c.get({component:a});return d?d.getChecked():c.get({status:a})}function s(a,b,c){var d=this,e=d.data;e.set({status:a,value:b});var f=e.get({component:a});f||(d.event.extActive(),f=e.get({component:a})),f.setChecked(b,c)}function t(a){var b=this,c=b.data;a?"subject"==a||b.choose(a):a=c.get({status:"inputChoose"});var d=c.get({component:a});d&&d.focus()}function u(a){var b=this,c=b.data;c.set({status:"inputChoose",value:a})}function v(a){var b=this;a||(a=b.data.get({status:"inputChoose"})),b.data.get({component:a}).blur()}function w(b){var c=this,d=c.data,e="iU2",f=" iT1",g=d.get({element:b});g.listen("mouseover",function(){var b=a(this);b.hasClass(e)||b.addClass(f)}),g.listen("mouseout",function(){var b=a(this);b.removeClass(f)})}function x(a){var b=this,c=b.data,d="iU2",e=c.get({element:a});e.addClass(d)}function y(a){var b=this,c=b.data,d="iU2",e=c.get({element:a});e.removeClass(d)}try{var z=$L("module.compose.Compose"),A=$L("support.AddressSupport")}catch(B){return B}var C=a.Object,D=a.Ext,E=a.Email,F=a.Uri,G=a.createClass($N("module.compose.ComposeForm"));C.inherit(G,z),C.extend(G.prototype,{initialize:b,init:c,setSender:d,getSender:e,addContact:f,setContact:g,getContact:h,removeContact:i,modifyContact:j,showContact:k,getContainer:l,remindValid:m,remindShow:n,remindRemove:o,setSubject:p,getSubject:q,getCheckbox:r,setCheckbox:s,addHoverEvent:w,addFocusCls:x,removeFocusCls:y,focus:t,choose:u,blur:v})}($,window),function(a){function b(a){var b=this;i.extend(b,{cid:"",did:"",mid:"",tid:"",ids:null,obj:{},con:[]}),j.superClass.initialize.call(b,a)}function c(){var a=this;j.superClass.init.call(a)}function d(a){a=a||{};var b=this;"object"==typeof a.obj&&(b.obj=a.obj,a.obj.id&&(a.cid=a.obj.id)),"string"==typeof a.cid&&(b.cid=a.cid),"string"==typeof a.did&&(b.did=a.did),"string"==typeof a.mid&&(b.mid=a.mid),"string"==typeof a.tid&&(b.tid=a.tid),"object"==typeof a.ids&&(b.ids=a.ids),"object"==typeof a.con&&(b.con=a.con)}function e(a){a=a||{};var b=this;return a.cid?b.cid:a.did?b.did:a.mid?b.mid:a.tid?b.tid:a.ids?b.ids:a.obj?b.obj:a.con?b.con:void 0}function f(){var a;try{a=$I("util.Misc").getTime(0)}catch(b){a=new Date}return["c",a.valueOf()].join(":")}try{var g=$L("module.compose.Compose")}catch(h){return h}var i=a.Object,j=a.createClass($N("module.compose.ComposeInfo"));i.inherit(j,g),i.extend(j.prototype,{initialize:b,init:c,set:d,get:e,getClientId:f})}($,window),function(a){function b(a){var b=this;t.extend(b,{component:{schedule:null},element:{area:null,year:null,month:null,day:null,hour:null,minute:null,focus:null,info:null},status:{fill:!1,date:null}}),s.superClass.initialize.call(b,a)}function c(){var a=this;s.superClass.init.call(a),a.render()}function d(){var a=this;s.superClass.clear.call(a.element),s.superClass.clear.call(a)}function e(){var b=this,c=b.module,d=b.data,e=b.element;e.area=d.get({element:"schedule"});var f='发送时间：<select id="'+c.createId("scheduleYear")+'"></select> 年 '+'<select id="'+c.createId("scheduleMonth")+'"></select> 月 '+'<select id="'+c.createId("scheduleDay")+'"></select> 日 '+'<select id="'+c.createId("scheduleHour")+'"></select> 时 '+'<select id="'+c.createId("scheduleMinute")+'"></select> 分 '+'<p class="bB0">本邮件将在 <strong id="'+c.createId("scheduleInfo")+'"></strong> 发送到对方邮箱</p>'+'<a id="'+c.createId("scheduleFocus")+'" href="javascript:void(0)" hidefocus="hidefocus" style="text-decoration:none;display:none">　</a>';e.area.html(f),new a.Link({cls:"nui-block-close nui-close",icon:"close",renderTo:e.area,click:function(){var a=d.get({component:"schedule"});a.setChecked(!1)}}),e.year=d.get({moduleId:"scheduleYear"}),e.month=d.get({moduleId:"scheduleMonth"}),e.day=d.get({moduleId:"scheduleDay"}),e.hour=d.get({moduleId:"scheduleHour"}),e.minute=d.get({moduleId:"scheduleMinute"}),e.focus=d.get({moduleId:"scheduleFocus"}),e.info=d.get({moduleId:"scheduleInfo"});var g=function(){b.setChange()};a.Array.each(["year","month","day","hour","minute"],function(a,b){e[b].listen("change",g)})}function f(a){a=a||{};var b=this;return"string"==typeof a.status?b.status[a.status]:b.get({status:"date"})}function g(a){a=a||{};var b=0,c=a.year,d=a.month;if(a.date&&(c=a.date.getFullYear(),d=a.date.getMonth()+1),!c||!d)return b;if((0===c%4&&0!==c%100||0===c%400)&&2==d)b=29;else switch(d){case 1:case 3:case 5:case 7:case 8:case 10:case 12:b=31;break;case 2:b=28;break;case 4:case 6:case 9:case 11:b=30}return b}function h(a){a=a||{};var b=this;a.date?(b.set({status:"date",value:a.date}),b.update({sync:!0})):"string"==typeof a.status?b.status[a.status]=a.value:(b.setDefault(a),b.toggle({open:!0}))}function i(){var b=this,c=b.element,d=[];a.Array.each(["year","month","day","hour","minute"],function(a,b){d.push(parseInt(c[b].dom.value,10))});var e=b.getDay({year:d[0],month:d[1]});d[2]>e&&(d[2]=e),d[1]--;var f=new Date(d[0],d[1],d[2],d[3],d[4]);b.set({date:f})}function j(a){var b=this,c=q.getTime(0);return b.fill({date:c}),a?c=a:(c.setDate(c.getDate()+1),c.setHours(0),c.setMinutes(0),c.setSeconds(0,0)),b.set({date:c}),c
}function k(){var b=this;return b.get()<=q.getTime(0)?(new a.Msgbox({content:"定时发信时间不能比当前时间早！"}),!1):!0}function l(b){b=b||{};var c=this;c.module;var d=c.element,e=c.data,f=e.get({status:"showSchedule"}),g=!0;if(b.open&&f)return!1;if(b.close&&!f)return!1;if(g){if(f)d.area.hide();else{if(e.get({status:"useSms"}))return new a.Msgbox({title:'抱歉，"定时发信"功能无法与"短信通知"同时使用。'}),!1;if(e.get({status:"showEncrypt"}))return new a.Msgbox({title:'抱歉，"定时发信"功能无法与"邮件加密"同时使用。'}),!1;if(e.get({status:"showNotary"}))return new a.Msgbox({title:'抱歉，"定时发信"功能无法与"邮件存证"同时使用。'}),!1;c.get({status:"date"})||c.setDefault(),d.area.show(),d.focus.show();try{d.focus.dom.focus(),d.focus.dom.blur()}catch(h){}d.focus.hide()}return e.set({status:"showSchedule",value:!f}),!0}return!1}function m(a){a=a||{};var b=this;if(!b.get({status:"fill"})){for(var c=b.element,d=a.date,e=d.getFullYear(),f=e+5;f>e;e++)c.year.append(b.createOption({value:String(e)}));for(var g=1;12>=g;g++)c.month.append(b.createOption({value:String(g)}));for(var h=1;31>=h;h++)c.day.append(b.createOption({value:String(h)}));for(var i=0;24>i;i++)c.hour.append(b.createOption({value:String(i)}));for(var j=0;60>j;j++)c.minute.append(b.createOption({value:String(j)}));b.set({status:"fill",value:!0})}}function n(b){b=b||{};var c=this,d=c.element,e=c.get({status:"date"});if(b.sync)a.Array.each(["year","month","day","hour","minute"],function(a,b){var f,g=d[b];switch(a){case 0:f=e.getFullYear();try{var h=g.dom.options,i=parseInt(h[h.length-1].value,10);f>i&&g.append(c.createOption({value:String(f)}))}catch(j){}break;case 1:f=e.getMonth()+1;break;case 2:f=e.getDate();break;case 3:f=e.getHours();break;case 4:f=e.getMinutes();break;default:f=0}var k=String(f);g.dom.value!=k&&(g.dom.value=k)}),c.update({day:!0}),c.update({info:!0});else if(b.day){var f=d.day,g=c.getDay({date:e}),h=f.dom.options.length;if(g!=h){var i;if(g>h)for(i=h+1;g>=i;i++)f.append(c.createOption({value:String(i)}));else for(i=h;i>g;i--)new a.Element(f.dom.options[i-1]).remove()}}else if(b.info){var j="",k=e.getFullYear(),l=e.getMonth()+1,m=e.getDate(),n=e.getHours(),o=e.getMinutes(),p=q.getTime(0);p.setHours(0,0,0,0);var r=p.getDay();0===r&&(r=7);var s=new Date(e.valueOf());s.setHours(0,0,0,0);var t=s.valueOf()-p.valueOf();switch(t/=864e5){case-2:j="前天";break;case-1:j="昨天";break;case 0:j="今天";break;case 1:j="明天";break;case 2:j="后天";break;default:var u=a.Date.getWeek(e);t>=1-r&&7-r>=t?j="本周"+u:t>7-r&&14-r>=t?j="下周"+u:t>-7-r&&1-r>t?j="上周"+u:(k!=p.getFullYear()&&(j=k+"年"),j+=k==p.getFullYear()&&e.getMonth()==p.getMonth()?"本月":l+"月",j+=m+"日周"+u)}6>n?j+="凌晨":11>n||11==n&&30>o?j+="早上":13>n||13==n&&30>o?j+="中午":18>n?j+="下午":24>n&&(j+="晚上"),j+=n+" : ",10>o&&(j+="0"),j+=o,d.info.dom.innerHTML=j}}function o(a){a=a||{};var b=a.value||"",c=a.text||b,d=document.createElement("option");return d.innerHTML=c,d.value=b,d}try{var p=$L("module.compose.Compose"),q=$I("util.Misc")}catch(r){return r}var s=a.createClass($N("module.compose.ComposeSchedule")),t=a.Object;t.inherit(s,p),t.extend(s.prototype,{initialize:b,init:c,clear:d,render:e,get:f,getDay:g,set:h,setChange:i,setDefault:j,verify:k,toggle:l,fill:m,update:n,createOption:o})}($,window),function(a){function b(a){var b=this;y.extend(b,{signData:{text:null,card:null,graph:null,linkedin:null},fill:{text:-1,card:-1,graph:-1,linkedin:-1}}),C.superClass.initialize.call(b,a)}function c(){var a=this;C.superClass.init.call(a)}function d(){var a=this,b=a.data;b.get({status:"initSign"})!==!0&&(b.set({status:"initSign",value:!0}),v.getSignList(function(b){if($S("isCorp")){var c=$G.attrs.letterAngle;if(c&&1==c.langle_apply){var d=c.langle_position,e=c.langle_content;a.fillLetterAngle(e,d)}}var f=!1;b&&(a.set({text:b}),a.selectDefault({text:!0})),f=a.getStationery(),$S("isFree")||$S("isCorp")?a.getCardList(function(b){a.set({card:b}),f||a.selectDefault({card:!0})}):$S("isVip")&&a.getGraphList(function(b){a.set({graph:b}),f||a.selectDefault({graph:!0})}),B.linkedin&&w.getSign(function(b){b&&(b.id=1,a.set({linkedin:[b]}),a.selectDefault({linkedin:!0}))})}))}function e(a){var b=this,c=b.signData;a.text?c.text=a.text:a.card?c.card=a.card:a.graph?c.graph=a.graph:a.linkedin&&(c.linkedin=a.linkedin)}function f(a){var b=this,c=b.signData;return a.text?c.text:a.card?c.card:a.graph?c.graph:a.linkedin?c.linkedin:void 0}function g(b){var c=this,d=null;return b.call=function(c,e){return b["default"]&&(e.isDefault||e.defaultCard)||b.index==c||b.id==e.id?(d=e,a.BREAK):void 0},c.each(b),d}function h(){var b=this,c=b.base,d=b.data,e=b.form;if(e.getCheckbox("text"));else{var f=d.get({status:"fromEntry"});if("compose"==f){var g=z.get({field:"ntes_compose",flag:"letter"});if("1"==g)return a.Ajax.jsonp(A.getUrl("letterpaper_default"),function(a){a&&a.html&&b.stationery.select({item:a,callback:function(){c.changeSync()}})},"jsonp"),!0}}return!1}function i(b){var c=this,c=this,d=c.base,e=z.get({field:"ntes_compose",flag:"card"});if("1"==e||"2"==e){var f=d.getCallName(function(a){"success"==a.result&&b(a.msg)},!0),g=a.String.uriAddParam(A.getUrl("compose_ecard",!0),"callback=window."+f);return a.Ajax.request({url:g,requestType:a.Ajax.SCRIPT}),!0}return!1}function j(b){var c=this,d=c.base,e=d.getCallName(function(a){a&&a.length&&b(a)},!0),f=a.String.uriAddParam(A.getUrl("compose_graphsign"),"func=window."+e);a.Ajax.request({url:f,charset:"gbk",requestType:a.Ajax.SCRIPT})}function k(b){var c=this,d=c.get(b);d&&a.Array.each(d,b.call)}function l(b){var c=this,d=c.base,e=c.data,f=c.getItem(b);if(f){var g=e.get({status:"useSign"})||{};if(b.text){g.text=f;var h=f.content;!f.isHtml&&h&&(h=a.String.escapeHTML(f.content)),c.fillText(h)}else if(b.card)g.card==f||(g.card=f,c.attach.cardSync(f)),c.fillCard(f.html);else if(b.graph)g.graph=f,c.fillGraph(f.str);else if(b.linkedin){g.text=f;var h=f.content;c.fillText(h)}return b["default"]&&(g["default"]=f,d.changeSync()),e.set({status:"useSign",value:g}),!0}return!1}function m(a){var b=this,c=b.form,d=b.data,e=b.editor;if(!c.getCheckbox("text")){var f=d.get({status:"fromEntry"});if("compose"==f);else if("reply"==f||"forward"==f){if("reply"==f&&"1"==z.get({field:"ntes_option",flag:"replySign"}))return;if("forward"==f&&"0"==z.get({field:"ntes_option",flag:"forwardSign"}))return}else{if("timeset"!=f)return"draft"==f?void 0:"edit"==f?void 0:void 0;if(b.fillHas())return;if(a.card&&b.attach.cardHas())return}if(!d.get({status:"useSign"})){var g=b.fillData(a);if(-1!=g?a.id=g:a["default"]=!0,b.select(a),"compose"==d.get({status:"fromEntry"})){var h=e.get();d.set({status:"defaultContent",value:h})}}}}function n(a){var b=this,c=b.editor,d=!1;if(a){var e="";if(a.text?e="spnEditorSign":a.card?e="divEditorGraphSign":a.graph&&(e="divNeteaseMailCard"),e)try{var f=c.get({id:e});f&&f.dom.innerHTML&&(d=!0)}catch(g){}}else(b.fillHas({text:!0})||b.fillHas({card:!0})||b.fillHas({graph:!0}))&&(d=!0);return d}function o(a){var b=this,c=b.fill;if("boolean"==typeof a.text&&a.text)return c.text;if("number"==typeof a.text)b.fill.text=a.text;else{if("boolean"==typeof a.card&&a.card)return c.card;if("number"==typeof a.card)c.card=a.card;else{if("boolean"==typeof a.graph&&a.graph)return c.graph;if("number"==typeof a.graph)c.graph=a.graph;else{if("boolean"==typeof a.linkedin&&a.linkedin)return c.linkedin;"number"==typeof a.linkedin&&(c.linkedin=a.linkedin)}}}}function p(b){var c=this,d=c.editor;if(b==a.String.stripTags(b)&&(b=b.replace(/ /g,"&nbsp;"),b=b.replace(/\n/g,"<br>")),-1!=b.indexOf("$date$")){var e=$I("util.Misc").getTime(!0),f=a.Date.format(e,"yyyy年M月d日");b=b.replace(/\$date\$/g,f)}b="--<br>"+b+'<div style="clear:both"></div>';var g=d.get({html:!0});if(-1!=g.indexOf("spnEditorSign"))try{var h=d.get({id:"spnEditorSign"});h&&h.html(b)}catch(i){}else g=[g,d.getBreakLine(5),'<div id="spnEditorSign" style="position:relative;zoom:1">',b,"</div>"].join(""),d.set(g)}function q(a){var b=this,c=b.editor,d=c.get({html:!0});if(-1!=d.indexOf("divNeteaseMailCard"))try{var e=c.get({id:"divNeteaseMailCard"});e&&e.html(a)}catch(f){}else d=[d,c.getBreakLine(5),'<div id="divNeteaseMailCard">',a,"</div>"].join(""),c.set(d)}function r(a){var b=this,c=b.editor,d=c.get({html:!0});if(-1!=d.indexOf("divEditorGraphSign"))try{var e=c.get({id:"divEditorGraphSign"});e&&e.html(a)}catch(f){}else d=[d,c.getBreakLine(5),'<div id="divEditorGraphSign">',a,"</div>"].join(""),c.set(d)}function s(a,b){var c=this,d=c.editor,e=d.get({html:!0});if(-1!=e.indexOf("dvLetterAngle"))try{var f=d.get({id:"dvLetterAngle"});f&&f.html(a)}catch(g){}else{var h,e=d.get({html:!0}),i='<div id="dvLetterAngle">'+a+"</div>",j='<div id="spnEditorSign" style="position:relative;zoom:1"></div>';h=0===b?[e,d.getBreakLine(5),i,j]:[e,d.getBreakLine(5),j,i],e=h.join(""),d.set(e)}}function t(){var a=this;$E(["interface.OptionInterface"],function(b){b.showSignList(function(b){b&&a.fillText(b)})})}try{var u=$L("module.compose.Compose"),v=$L("support.OptionSupport"),w=$L("product.Linkedin")}catch(x){return x}var y=a.Object;a.Function;var z=a.Ud,A=a.Uri,B=a.Ext,C=a.createClass($N("module.compose.ComposeSign"));y.inherit(C,u),y.extend(C.prototype,{initialize:b,init:c,load:d,set:e,get:f,getItem:g,getStationery:h,getCardList:i,getGraphList:j,each:k,select:l,selectDefault:m,fillHas:n,fillData:o,fillText:p,fillCard:q,fillGraph:r,fillLetterAngle:s,showCustom:t})}($,window),function(a){function b(a){var b=this;B.extend(b,{component:{category:null},element:{content:null,btn:null,list:null,page:null}}),E.superClass.initialize.call(b,a)}function c(){var a=this;a.element,E.superClass.init.call(a)}function d(){var a=this;E.superClass.clear.call(a.element),E.superClass.clear.call(a)}function e(){var b=this,c=b.data,d=c.letterpaper,e=b.element;if(b.component,c.get({status:"initStationery"})===!0)return!0;if(!d.category){var f=arguments.callee,g=C.getUrl("letterpaper_get")+"&pageSize=11";return a.Ajax.jsonp(g,function(a){d.category=a.category,"string"!=typeof d.curId&&(d.curId=""),d.curCategory=a.curCategory,d.curPage=a.curPage,d.curData=a.letterPaper,d.nonUse=a.nonUse,d.ver=a.date,d.pageSize=a.pageSize,f.call(b)},"jsonp"),!1}e.content=c.get({moduleId:"paperContent"}),e.btn=c.get({moduleId:"paperBtn"}),e.list=c.get({moduleId:"paperList"}),e.page=c.get({moduleId:"paperPage"}),b.fill(),c.set({status:"initStationery",value:!0})}function f(){var a=this,b=a.data,c=b.letterpaper;return c}function g(){var a=this,b=a.getObj();return b.ver||""}function h(){var a=this,b=a.getObj();return b.nonUse}function i(){var a=this,b=a.getObj();return b.pageSize}function j(b){var c=this;if("undefined"==typeof b){var d=c.getObj();return d.category}var e=null,f=c.getCategory();return f&&a.Array.each(f,function(c,d){return d.id==b?(e=d,a.BREAK):void 0}),e}function k(b){var c=this,d=null;if("0"==b)d=c.getNon();else{var e=c.getCurList();a.Array.each(e,function(c,e){return e.id==b?(d=e,a.BREAK):void 0})}return d}function l(){var b=this,c=b.getCurId(),d=[],e=[b.getNon()].concat(b.getCurList());return a.Array.each(e,function(a,b){var e={id:b.id,title:b.name||"",src:b.wmIconUrl||b.iconUrl,active:!1};"0"==b.id&&""===c&&(e.active=!0),b.id==c&&(e.active=!0),d.push(e)}),d}function m(){var a=this,b=a.getObj(),c=b.curId||"";return c}function n(){var a=this,b=a.getObj(),c=b.curData;return c}function o(){var a=this,b=a.getObj(),c=b.curCategory;return c}function p(){var a=this,b=a.getObj(),c=b.curPage;return c}function q(){var a=this,b=a.getCurCategory(),c=b.pageCount;return c}function r(a){var b=this,c=b.getObj();c.curCategory=a.curCategory,c.curPage=a.curPage,c.curData=a.letterPaper}function s(a){var b=this;b.element;var c=b.data,d=b.getObj(),e=b.getVer();d.curId=a,e&&(c.log.letterId=e+"_"+a)}function t(b){var c=this;c.data;var d=c.getObj();c.element;var e=c.component,f=c.getCategory(b);d.curCategory=f,e.category.setText(f.name),c.setCurPage(1),D.cache({cl_stationery_category:b},a.EMPTYFUNC)}function u(b){var c=this,d=C.getUrl("letterpaper_get");d+="&categoryValue="+c.getCurCategory().id,d+="&nextPage="+b,d+="&pageSize="+c.getPageSize(),a.Ajax.jsonp(d,function(a){c.setObj(a),c.render()},"jsonp")}function v(b){var c=this,d=b.index,e=c.getCurPage();if(b.prev||b.next){var f=c.getCurPageCount();b.prev?(d=e-1,1>d&&(d=f)):(d=e+1,d>f&&(d=1))}c.setCurPage(d),D.cache({cl_stationery_page:""+d},a.EMPTYFUNC)}function w(a){function b(b){if(f.html){var g=f.html;b&&(g=g.replace(f.imageUrl,b));var i=g.split("<STATIONERY><STATIONERY>"),k=i[0]+"<STATIONERY>",l="<STATIONERY>"+i[1];h=[k,"<div>",j,"</div>",l].join("")}else h="<div>"+j+"</div>";d.set({html:h});var m=d.get({tag:"STATIONERY"});m?d.focus({element:m}):d.focus(),c.setCurId(e),"function"==typeof a.callback&&a.callback()}var c=this,d=c.editor,e=null,f=null;a.item?(f=a.item,e=f.id):a.id&&(e=a.id,f=c.getItem(e));var g=c.getCurId();if(e==g)return!1;var h="";try{h=d.get({html:!0})}catch(i){}var j="",k=new RegExp("<STATIONERY>","i"),l="<br><br><br><br><br><br><br><br><br><br>";if(""===g&&k.test(h)&&(g="draft"),""===g||"0"==g){j=h;var m=!1;try{var n=d.get({id:"spnEditorSign"});n&&n.innerHTML&&(m=!0)}catch(i){}m||(j+=l)}else{var o=h.split(k);o&&o.length&&o[1]&&(j=o[1],"0"==e&&(j=j.replace(new RegExp(l,"i"),""))),"undefined"!=j&&j||(j=h)}return"custom"==f.imageType?c.attach.stationerySync(f,function(a){a&&b(a)}):(c.attach.stationeryClear(),b()),!0}function x(){var b=this,c=b.module;b.data;var d=c.createId("paperBtn"),e=[],f=b.getCategory();a.Array.each(f,function(a,c){var d={text:c.name,click:function(){c.id!=b.getCurCategory().id&&b.setCurCategory(c.id)}};e.push(d)});var g={renderTo:d,delegateTo:"self",text:"全部",subclass:"dropdownBtn",menu:{xtype:"menu",groups:[{items:e}]}},h=b.component;if(h.category=new a.Button(g),!$S("isCorp")){var i={renderTo:d,text:"自创信纸",icon:"add",click:function(){D.cache({cl_stationery_define:"1"},a.EMPTYFUNC),$E(["interface.OptionInterface"],function(a){a.entry({module:"options.OptionOutLinkModule",linkName:"letterpaper_create"})})}};new a.Button(i)}b.render()}function y(){var b=this,c=b.element,d=b.getContent();c.list.empty();var e="N0";a.Array.each(d,function(d,f){var g=a.Element.create("LI");g.addClass("dm0");var h=a.Element.create("A");h.addClass("bP0"),h.dom.title=f.title,h.dom.href="javascript:void(0)";var i=a.Element.create("IMG");i.addClass("bR0"),i.dom.src=f.src;var j=a.Element.create("SPAN");j.addClass("bA0"),h.append(i.dom),h.append(j.dom),g.append(h.dom),f.active&&g.addClass(e),h.listen("click",function(){b.select({id:f.id,click:!0});var d=c.list.find("."+e);d&&d.removeClass(e),a(this).addClass("N0"),D.cache({cl_stationery_paper:f.id},a.EMPTYFUNC)}),c.list.append(g.dom)}),c.page.empty();var f=b.getCurPageCount(),g=b.getCurPage();if(f>1){var h=a.Element.create("A");h.dom.href="javascript:void(0)",h.dom.innerHTML="上页",h.listen("click",function(){var a={click:!0,prev:!0};b.page(a)}),c.page.append(h.dom)}for(var i=[],j=1;f>=j;j++){var k={text:j+"/"+f,value:j};j==g&&(k.checked=!0),i.push(k)}var l={options:i,subclass:"simpleSelect",delegateTo:"self",renderTo:c.page.dom,selectedchange:function(){var a={click:!0,index:this.value};b.page(a)}},m=b.component;if(m.select=new a.Select(l),f>1){var n=a.Element.create("A");n.dom.href="javascript:void(0)",n.dom.innerHTML="下页",n.listen("click",function(){var a={click:!0,next:!0};b.page(a)}),c.page.append(n.dom)}}try{var z=$L("module.compose.Compose")}catch(A){return A}var B=a.Object,C=a.Uri,D=a.Log,E=a.createClass($N("module.compose.ComposeStationery"));B.inherit(E,z),B.extend(E,{pageLimit:12,pageLimit2:4}),B.extend(E.prototype,{initialize:b,init:c,clear:d,load:e,getObj:f,getVer:g,getNon:h,getPageSize:i,getCategory:j,getItem:k,getContent:l,getCurId:m,getCurList:n,getCurCategory:o,getCurPage:p,getCurPageCount:q,setObj:r,setCurId:s,setCurCategory:t,setCurPage:u,page:v,select:w,fill:x,render:y})}($,window),function(a,b){function c(a){var b=this;K.extend(b,{saveContact:{}}),S.superClass.initialize.call(b,a)}function d(){var a=this;S.superClass.init.call(a)}function e(b,c){var d=this,e=d.base,f=d.module;f.removeChildMod=!0,f._child=null,f.cacheModule=!1,f.cacheByVar=!0;try{d.fillAll(b,c)}catch(g){}if(d.sync(),a.Context.module==f&&a.Frame.setViewType("normal"),e.setPage("success"),d.showJust(),"1"!=Q.get({field:"ntes_compose",flag:"undo_send"})&&$S("isFree")&&!N.smspack)try{d.smsActive(b,c)}catch(g){}if($S("isVip")&&d.vipSms(),N.smspack)try{d.smsCharge()}catch(g){}}function f(){var b=this;b.base;var c=b.data,d=c.get({component:"sendMsgBox"});if(d)try{d.close(),c.set({component:"sendMsgBox",value:null})}catch(e){}b.setMboxFlag(),a.Tips.show({hidden:!0})}function g(a){var b=this,c=b.data,d=b.module;b.fillTop(a);var e=b.fillTips(a);b.fillStamp(a),b.fillContact(a),c.get({status:"showNotary"})&&0===d.notary.userpro?(b.fillNotary(a),e=!0):b.fillAd(),e||b.fillAdTips(),"1"==Q.get({field:"ntes_compose",flag:"undo_send"})?b.fillCancel(a):b.fillSendAd(a),b.save2YNote(a)}function h(b){var c=this,d=c.module;c.base;var e=c.data,f=c.info,g=e.get({status:"sendParam"}),h="发送成功";"schedule"==g.action&&(h="定时发信设置成功");var i=e.get({moduleId:"succInfo"}),j='<b class="nui-ico se0 pv1"></b>'+h;i.html(j);var k=e.get({moduleId:"succOperate"}),l=f.get({mid:!0});if(l?new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 ov0"></b>返回该邮件',click:function(){O.cache({sl_back:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){d.extend.history?I.entry(d.extend.history):I.entry({id:l,from:"compose"})})}}):new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 ov0"></b>返回收件箱',click:function(){O.cache({sl_inbox:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){G.entry({fid:1})})}}),"deliver"==g.action){var m=f.get({obj:!0});m.saveSentCopy&&(b.saveSentFailed||b.saveSentIgnored||(c.sentLink=new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 pw1"></b>查看已发邮件',click:function(){O.cache({sl_view:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){var a=e.get({status:"saveSentAndDel"});a?G.entry({fid:3}):I.entry({id:b.savedSent.msid?[b.savedSent.msid,b.savedSent.mid].join(":"):b.savedSent.mid})})}})))}new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 oM0"></b>继续写信',click:function(){O.cache({sl_continue:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){F.compose()})}})}function i(b){var c=this,d=c.data,e=c.info,f=d.get({status:"sendParam"}),g=e.get({obj:!0}),h=d.get({moduleId:"succTips"}),i=null,j=null;if("schedule"==f.action){var k=a.Date.format(g.scheduleDate,"邮件将在yyyy年M月d日 H:mm发送")+"，邮件发送前，暂时保存在";i=[{html:"<span>"+k+"</span>"},{xtype:"link",text:"草稿箱",click:function(){O.cache({sl_draft:"1"},a.EMPTYFUNC),G.entry({fid:2})}}]}else if("deliver"==f.action){if(g.saveSentCopy){if(b.saveSentFailed);else if(b.saveSentIgnored){var k="<span>因为邮箱容量已满，未能保存到“已发送”文件夹 </span>";if($S("isVip")){var l=!1,m=$S("attrs").subcos,n=m.split(",");$S("isvip")?a.Array.has(n,"90")&&(l=!0):$S("is188")?a.Array.has(n,"35")&&(l=!0):$S("is126vip")&&a.Array.has(n,"29")&&(l=!0);var o={xtype:"link",text:"升级容量",click:function(){$E("interface.OutlinkInterface",function(a){a.goOutlink({key:"option_viptype"})})}},p={xtype:"link",text:"清理邮件",click:function(){$E("interface.OutlinkInterface",function(a){a.goOutlink({key:"optimizer_full"})})}};i=[{html:k},{html:"<span> 建议您 </span>"}],l?i.push(p):(i.push(o),i.push({html:"<span> 或者 </span>"}),i.push(p))}else i=[{html:k}]}else if(b.saveSentId&&0===$S("attrs").user.save_sent)if(b.savedSent){var k="<span>邮件大小超过了 <b>1M</b>，正文已保存到“已发送”，附件未保存。</span>";i=[{html:k},{xtype:"link",text:"保存该邮件",click:function(){O.cache({sl_save:"1"},a.EMPTYFUNC),c.action.saveSentAndDel({saveMid:b.saveSentId,delMid:b.savedSent.msid?[b.savedSent.msid,b.savedSent.mid].join(":"):b.savedSent.mid,callback:function(b){if(b.code==P){j.hide();var e={renderTo:h,extcls:"sZ1",subclass:"assistBlock",params:"hasClose",content:"保存成功！同时已为你设置发信后邮件全部自动保存。"};new a.Block(e),c.setSaveSend(),d.set({status:"saveSentAndDel",value:!0})}else{var f,g=b["var"][0].code;switch(g){case"FA_MAIL_NOT_FOUND":f="确认超时，系统未能保存该邮件！";break;case"FA_INVALID_PARAMETER":f="格式错误，系统未能保存该邮件！";break;default:f="异常错误，系统未能保存该邮件！"}a.Msgbox.show({title:f})}}})}}]}else{var k="<span>邮件大小超过了 <b>1M</b>，没有保存到“已发送”，</span>";i=[{html:k},{xtype:"link",text:"保存该邮件",click:function(){O.cache({sl_save:"1"},a.EMPTYFUNC),c.action.saveSent({mid:b.saveSentId,callback:function(b){if(b.code==P){j.hide();var d='<span>保存成功！<span class="nui-txt-tips">您可以设置自动保存以后所有已发送邮件</span> </span>',e={renderTo:h,extcls:"sZ1",subclass:"assistBlock",params:"hasClose",items:[{html:d},{xtype:"link",text:"自动保存",bracket:!0,click:function(){O.cache({sl_setsave:"2"},a.EMPTYFUNC),c.setSaveSend(this)}}]};new a.Block(e)}else{var f;switch(b.code){case"FA_MAIL_NOT_FOUND":f="确认超时，系统未能保存该邮件！";break;case"FA_INVALID_PARAMETER":f="格式错误，系统未能保存该邮件！";break;default:f="异常错误，系统未能保存该邮件！"}a.Msgbox.show({title:f})}}})}}]}}else{var k="<span>邮件未保存&nbsp;</span>";i=[{html:k},{xtype:"link",text:"设置自动保存",click:function(){O.cache({sl_setsave:"1"},a.EMPTYFUNC),H.entry({module:"BaseSetModule",inputName:"afterSendRule"})}}]}if(d.get({status:"showEncrypt"})){var q=c.module.encrypt,k='<span>&nbsp;邮件已加密，密码为：<strong class="nui-txt-impt">'+a.String.escapeHTML(q.get())+"</strong></span>",r={html:k};i?i.push(r):i=[r]}}if(i){var s={renderTo:h,extcls:"sZ1",subclass:"assistBlock",params:"hasClose",items:i};return j=new a.Block(s),h.show(),!0}}function j(){var b=this,c=b.data,d=b.info,e=c.get({status:"sendParam"});if("deliver"==e.action&&N.stamp){var f=c.get({moduleId:"succStamp"}),g="";a.Array.each(d.get({con:!0}),function(b,c){var d=c.replace(/^.*<|>$/g,"").toLowerCase(),e=d.split("@")[1];return"163.com"==e||"126.com"==e?(g=d,a.BREAK):void 0});var h=R.getUrl("compose_stamp_get");h+="&mid="+(new Date).valueOf(),g&&(h+="&to="+g);var i=d.get({obj:!0});h+="&subject="+encodeURIComponent(i.subject);var j=a.Element.create("iframe");j.setClass("qg1"),j.attr({frameBorder:0,allowTransparency:!0,tabIndex:"-1",src:h}),f.append(j.dom),f.show()}}function k(b){function c(b){var c=b.name?'"'+b.name+'"<'+b.address+">":b.address;return a.String.escapeHTML(c)}function d(){var b=a.Event.getTarget();try{var c=a.Element.inside(b,m.dom)||a.Element.inside(b,l.getEl().dom);c||(m.hide(),l.getEl().removeClass("lO1"))}catch(d){}}function e(){f.click2Hide||(f.click2Hide=d,a(document).listen("click",f.click2Hide))}var f=this,g=f.data,h=f.info,i=g.get({status:"sendParam"});if("deliver"==i.action){if(b.pabResult){try{E.addExtContact(b.pabResult)}catch(j){}try{a.Array.each(b.pabResult,function(a,b){"added"==b.action&&(f.saveContact[b.item["EMAIL;PREF"].toLowerCase()]=b.item)})}catch(j){}}var k=a.Element.create("DIV");k.setClass("fI1");var l=new a.Link({cls:"cZ1",renderTo:k,tabindex:"1",click:function(){O.cache({sl_contact:"0"},a.EMPTYFUNC),"none"==m.dom.style.display?(this.getEl().addClass("cA1"),m.show(),e()):(this.getEl().removeClass("cA1"),m.hide())}}),m=a.Element.create("DIV");m.setClass("cY1"),m.css({display:"none"});var n={},o=0,p=h.get({con:!0});a.Array.each(p,function(b,d){if(!d)return a.CONTINUE;var e=R.matchEmail(d);if(!e)return a.CONTINUE;if(e.key=e.address.toLowerCase(),!n[e.key]){if(n[e.key]=e,e.added=f.saveContact[e.key],e.exist=E.data.extDataMap.email[e.key],e.id="",e.phone="",e.added){var g=e.added;e.id=g.id}else if(e.exist){var g=e.exist[0];e.id=g[L],e.name=E.getGivenName(g),e.phone=g[M]||"",e.groups=g.groups||[]}else o++;e.name==e.address&&(e.name=e.name.split("@")[0]);var h=a.Element.create("DIV");h.setClass("bC1");var i=a.Element.create("SPAN");i.setClass("U1"),i.html(c(e)),h.append(i.dom),m.append(h.dom);var j=null;j=new a.Link({renderTo:h,cls:"T1 nui-txt-cLink",text:e.added||e.exist?'<b class="nui-ico se0 px1"></b>编辑':'<b class="nui-ico se0 qo1"></b>添加',click:function(){e.added||e.exist?(O.cache({sl_edit:"1"},a.EMPTYFUNC),E.contactDialog({type:"modify",addr:{id:e.id},callback:function(a){i.html(c(a))}})):(O.cache({sl_add:"1"},a.EMPTYFUNC),E.contactDialog({type:"add",addr:{name:e.name,email:e.address},callback:function(a){e.id=a.id,e.added=a,i.html(c(a)),j.update({text:'<b class="nui-ico se0 px1"></b>编辑'});var b='<b class="nui-ico se0 qm1"></b>';f.newCount--,f.newCount>0?(b+=f.newCount+"个收件人不在通讯录中",f.linkRev=l):b+="已成功发送到收件人("+f.allCount+")",l.update({text:b})}}))}}),h.listen("mouseover",function(){h.addClass("dF1")}),h.listen("mouseout",function(){h.removeClass("dF1")})}});var q='<b class="nui-ico se0 qm1"></b>',r=K.count(n);o?(q+=o+"个收件人不在通讯录中",f.newCount=o,f.allCount=r,f.linkRev=l):q+="已成功发送到收件人("+r+")",l.update({text:q});var s=a.Element.create("DIV");s.setClass("br1");var t="",u="0",v="";1==$S("attrs").user.aftersend_saveaddr?(v="已自动添加到通讯录",t="取消自动添加"):(v="尚未设置自动添加收件人到通讯录",t="设置自动添加",u="1"),new a.Link({id:"compose_success_saveaddr",cls:"T1 nui-txt-cLink",renderTo:s,text:t,click:function(){O.cache({sl_setaddress:u},a.EMPTYFUNC),f.setSaveAddress(this)}}),$S("isFree")&&K.count(n)>=3&&new a.Link({renderTo:s,text:"加入邮件列表",cls:"T1 nui-txt-cLink",click:function(){O.cache({sl_list:"1"},a.EMPTYFUNC),f.setMailList(n)}});var w=a.Element.create("SPAN");w.html(v),s.append(w.dom),m.append(s.dom),k.append(m.dom);var x=g.get({moduleId:"succOperate"});x.append(k.dom)}}function l(a){var b=this,c=b.data,d=a.savedSent.msid?[a.savedSent.msid,a.savedSent.mid].join(":"):a.savedSent.mid,e=c.get({moduleId:"succAd"}),f="",g=R.getUrl("compose_notary_suc")+"&mid="+d;f='<iframe src="'+g+'"  allowTransparency="true" frameborder="0" scrolling="no" width="100%" height="400"></iframe>',e.setClass(""),e.html(f)}function m(){if($S("isFree")&&"ud"!=$S("ad").userType){var a=this,c=a.data,d=c.get({moduleId:"succAd"});try{var e=a.info,f=e.get({obj:!0}),g=b.fAdComposeSendTips(f);g&&d.before(g)}catch(h){var i="http://adpmt.mail.163.com/beacon/redirect.htm?domain="+$S("domain")+"&area=composeTip&uid="+$S("orgUid"),j=i+"&pid=10031&page=yixin_download",k="http://hd1.mail.163.com/giftbag/index.jsp?from=huangtiao",g='<div style="padding:4px 12px;margin:12px 0;color:#CE0000" class="nui-assistBlock nui-block nui-txt-s18 nui-txt-bold">你想快速看到对方回复吗？安装易信，1秒就看到对方邮件 - <a href="'+j+'" target="_blank">马上安装</a>&nbsp;&nbsp;'+'<a href="'+k+'" target="_blank">领取签到礼包</a>'+"</div>";d.before(g)}}}function n(){var a=this,b=a.data,c=b.get({moduleId:"succAd"}),d="";if($S("isFree"))if("ud"==$S("ad").userType){var e=R.getUrl("compose_ud_suc",!0);try{var f=a.info.get({con:!0});e+="#n="+f.length}catch(g){}d='<iframe src="'+e+'"  allowTransparency="true" frameborder="0" scrolling="no" width="100%" height="400"></iframe>',c.setClass(""),c.html(d)}else{var h,i;h=gAd.get("compose"),h&&(h='<div class="sE1">'+h+"</div>");try{i=gAd.get("composeBanner")}catch(g){}i&&(i='<div class="sD1">'+i+"</div>"),h&&(d+=h),i&&(d+=i),d&&(d+='<div class="nF1"></div>',c.html(d))}else if($S("isVip")){var e=R.getUrl("compose_vip_suc",!0);try{var f=a.info.get({con:!0});e+="#n="+f.length}catch(g){}d='<iframe src="'+e+'"  allowTransparency="true" frameborder="0" scrolling="no" width="100%" height="400"></iframe>',c.setClass(""),c.html(d)}else d=gAd.get("compose"),d||(d='<div class="xz0" style="background-image:url(http://mimg.127.net/ggimg/all/img17/131204_qiyeyixin_790x400.jpg)"><a class="qA1" href="javascript:void(0)" onclick="$E(\'interface.AppCenterInterface\', function (AI) {AI.gotoCorpApp({name: \'易信提醒\',url: \'apps_yixin\'});});"  hidefocus="true"></a><a class="pg2" href="http://qiye.163.com/mobile/yixin/" hidefocus="true" target="_blank"></a></div>'),c.html(d),c.setClass("")}function o(c){function d(){var a={tinfo:c.sentTInfo,callback:e,error:f};i.cancelDeliver(a)}function e(c){b.clearInterval(p),l.hide(),a.MultiTab.removeTab(function(){var b={id:c["var"].draftMid,cancel:!0};F.draft(b),a.Tips.show("发送撤销成功")})}function f(){m.setText("重试"),a.Tips.show("撤销失败，请重试")}function g(){o>0?(o--,n.html("("+o+")")):(b.clearInterval(p),l.hide(),h.fillSendAd())}var h=this,i=h.action;h.base;var j=h.data,k=j.get({moduleId:"succInfo"}),l=a.Element.create("SPAN");l.css({fontSize:"14px",marginLeft:"5px"}),k.append(l.dom);var m=null,n=null,o=30,p=null;c.sentTInfo?(m=new a.Link({renderTo:l,text:"取消发送",cls:"nui-txt-link",click:function(){c.saveSentId&&0===$S("attrs").user.save_sent?i.saveSent({mid:c.saveSentId,callback:function(b){if(b.code==P)d();else{var c;switch(b.code){case"FA_MAIL_NOT_FOUND":c="确认超时，系统未能保存该邮件！";break;case"FA_INVALID_PARAMETER":c="格式错误，系统未能保存该邮件！";break;default:c="异常错误，系统未能保存该邮件！"}a.Tips.show(c)}}}):d()}}),n=a.Element.create("SPAN"),n.setClass("nui-txt-aside"),n.html("("+o+")"),l.append(n.dom),p=b.setInterval(g,1e3)):l.hide()}function p(){function b(c,d){var e=R.getUrl("yxds_sms_send",!0)+"&mobile="+c;d&&(e+="&verify_code="+d),a.Ajax.jsonp(e,function(d){if(j.hide(),1==d)a.Tips.show({succ:!0,text:"短信发送成功！"});else if(-16==d){var e=R.getUrl("yxds_sms_verify",!0)+"?time="+(new Date).valueOf(),f='<img id="imgMsgBoxVerify" src="'+e+'" /><a id="aMsgBoxVerify" href="javascript:void(0)" class="nui-txt-link">看不清楚？换一个</a>';a.Msgbox.show({type:"prompt",title:"请输入验证码",header:"下载网易邮箱大师",content:f,inputWidth:"180px",top:"100px",ok:function(d){var e=a.String.trim(d);return e?(b(c,e),void 0):"验证码不能为空"}});var g=a("#aMsgBoxVerify"),h=a("#imgMsgBoxVerify");g.listen("click",function(){var a=h.dom.src,b=new RegExp("time=.*|$","i");return a=a.replace(b,"time="+(new Date).valueOf()),h.dom.src=a,!1})}else{var i={"-1":"参数错误","-2":"无效手机号","-3":"不在允许接收短信时间段内","-4":"超过本时间段允许接收短信量","-6":"号码当天收到短信量已超过网关限制","-7":"非法产品号","-8":"当天对同一手机发送短信条数超过限制","-11":"该号码在SMS的黑名单列表中，信息不予发送","-12":"信息内容包含敏感词汇","-13":"24小时内本产品向同一手机号码下发过多","-14":"24小时内同一ip请求次数过多","-15":"24小时内本产品下发总次数过多"},k=i[d]||"系统错误,请稍后重试";a.Msgbox.show({title:k})}})}if($S("isFree")){var c=this,d=c.module,e=c.data,f=e.get({moduleId:"succInfo"}),g=a.Element.create("SPAN");g.css({fontSize:"14px",marginLeft:"5px"}),f.append(g.dom);var h,i=D.getMobile();i&&(h=i.address.split("@")[0]);var j,k=null;k=new a.Link({renderTo:g,text:"可用手机接收回复",cls:"nui-txt-link",click:function(){O.cache({sl_sendyxds1:"1"},a.EMPTYFUNC),j=new a.Layer({renderTo:d.container,pointTo:g,extcls:"zS0",items:[{html:"<img src='http://mimg.126.net/xm/webmail/img/yxds1.png' width='92'height='92'/>"},{xtype:"component",extcls:"tT2",items:[{html:"<h3>下载网易邮箱大师</h3>"},{xtype:"component",items:[{xtype:"input",placeholder:"请输入手机号码",value:h}]},{xtype:"button",text:"发送下载链接到手机",extcls:"nui-mainBtn",click:function(){O.cache({sl_sendyxds2:"1"},a.EMPTYFUNC);var c=this.getRoot().find("input")[0],d=c.getValue();return a.Email.checkMobile(d)?(b(d),void 0):(c.showTips("请输入正确的手机号码"),void 0)}}]}],params:"hasArr arrUp hasClose",doNotHide:!0})}})}}function q(b){var c=this,d=c.action;c.base;var e=c.data,f=e.get({status:"save2YNote"});if(f){var g="保存到有道云笔记失败，请手动保存。",h=b.code;if(h==P){var i=[b.savedSent.msid,b.savedSent.mid].join(":");d.save2YNote({mid:i,callback:function(){a.Tips.show({succ:!0,text:"邮件成功保存到有道云笔记"})},error:function(b){if(h=b.code,"S_PARTIAL_OK"==h){var c=b["var"],d="";
if(c&&c.fails&&c.fails.length)for(var e=c.fails,f=0;f<e.length;f++)d+=a.String.escapeHTML(e[f].resource)+"<br/>";a.Msgbox.show({header:"邮件部分保存成功！<br/>以下附件因类型受限，无法保存：",title:d})}else a.Msgbox.show({title:g})}})}else a.Msgbox.show({title:g})}}function r(b){var c="邮箱参数设置成功";1!=Q.get({field:"save_sent"})?Q.set({field:"save_sent",value:1,call:function(){b&&b.setText("取消自动保存"),a.Tips.show({succ:!0,text:c})}}):Q.set({field:"save_sent",value:2,call:function(){b&&b.setText("自动保存"),a.Tips.show({succ:!0,text:c})}})}function s(b){var c=b.getEl(),d="邮箱参数设置成功",e=["设置自动添加","取消自动添加"];c.html()==e[1]?Q.set({field:"aftersend_saveaddr",value:0,call:function(){c.html(e[0]),a.Tips.show({succ:!0,text:d})}}):Q.set({field:"aftersend_saveaddr",value:1,call:function(){c.html(e[1]),a.Tips.show({succ:!0,text:d})}})}function t(a){var b={dp:"addt",t:"m"},c=[];K.each(a,function(a,b){c.push(b.address)}),b.members=c.join(","),$E(["interface.AddressInterface"],function(a){a.entry({action:"mailgroups",param:b})})}function u(){var b=this,c=b.info,d=b.data.get({status:"fromEntry"}),e="";if("reply"==d)e="replied";else{if("forward"!=d)return;e="forwarded"}var f=c.get({mid:!0}),g=c.get({ids:!0});f?G.setReFw(f,e):g&&a.Array.each(g,function(a,b){G.setReFw(b,e)})}function v(){var b=this,c=b.data;b.form,b.info;var d=c.get({moduleId:"succInfo"}),e=a.Element.create("SPAN");d.append(e.dom),$I("init.Support").getNotaryStatus(function(b){b&&(e.css({fontSize:"14px",marginLeft:"5px"}),new a.Link({cls:"nui-txt-link",renderTo:e,text:'<b class="nui-ico nui-ico-sms nui-ico-gzy" style="margin-bottom:2px"></b>公正邮将为您存证</a>',click:function(){$E("interface.AppCenterInterface",function(a){a.gotoApp(147e3)}),O.cache({sl_just:"1"},a.EMPTYFUNC)}}))})}function w(){var b=this,c=b.data,d=c.get({status:"sendParam"});if("deliver"==d.action){var e=$I("module.compose.ComposeModule"),f=c.get({moduleId:"succInfo"}),g=a.Element.create("SPAN");g.css({fontSize:"14px",marginLeft:"5px"}),f.append(g.dom),2==e.sms_bind?new a.Link({cls:"nui-txt-link",renderTo:g,text:'<b class="nui-ico nui-ico-sms" style="margin-top:-9px"></b>短信通知收件人',click:function(){b.smsPriority("compose_vip_sms")}}):new a.Link({cls:"nui-txt-link",renderTo:g,text:'<b class="nui-ico nui-ico-sms" style="margin-top:-9px"></b>Ta若回邮件，短信提醒我',click:function(){$I("util.CustomAppManager").goOutLink("eaw",{param:{source:"open_eaw_write2"}})}})}}function x(){var b=this,c=b.data;b.form,b.info,$I("util.Misc");var d=c.get({status:"sendParam"});if("deliver"==d.action){var e=c.get({moduleId:"succInfo"}),f=a.Element.create("SPAN");f.css({fontSize:"14px",marginLeft:"5px"}),e.append(f.dom),new a.Link({cls:"nui-txt-link",renderTo:f,text:'<b class="nui-ico nui-ico-sms nui-ico-sms" style="margin-bottom: 10px;"></b>短信通知收件人',click:function(){b.smsPriority("compose_sms_flash")}})}}function y(){var b=this,c=b.data,d=b.form,e=b.info,f=$I("util.Misc"),g=c.get({status:"sendParam"});if("deliver"==g.action){var h=e.get({obj:!0});if(1!=h.priority){var i=d.getSender().address,j=i.split("@")[1].toLowerCase();if("163.com"==j||"126.com"==j||"yeah.net"==j){var k=R.getUrl("compose_sms_free"),l=h.subject,m="multi",n="",o="",p="",q=e.get({con:!0});if(1==q.length){var r=R.matchEmail(q[0]);if(r&&(m=r.address,!D.isSender(m))){n=r.name;var s=E.getAddrObj(m);s&&(o=s[L],p=s[M]||"");var t,u=D.getMobile(),v="",w=D.getName();try{t=f.getTime(0)}catch(x){t=new Date}var y=t.getHours();if(u){v=u.address;var z=m.split("@");z[0];var A=z[1].toLowerCase();if("vip.163.com"==A||"vip.126.com"==A||"188.com"==A)return;if(8>y||y>22)return}var B={tid:m,tname:n,mobile:v,tmobile:p,title:l,from:"compose",cid:o,sender:i,sender_nick:w};for(var C in B)k+="&"+C+"="+encodeURIComponent(B[C]);var F=t.valueOf()+"",G=S.encrypt(F);k+="&mid="+encodeURIComponent(F)+"&sign="+encodeURIComponent(G);var H=c.get({moduleId:"succInfo"}),I=a.Element.create("SPAN");I.css({fontSize:"14px",marginLeft:"5px"}),H.append(I.dom),new a.Link({cls:"nui-txt-link",renderTo:I,text:'<b class="nui-ico nui-ico-sms nui-ico-sms" style="margin-bottom: 10px;"></b>免费短信通知',click:function(){a.Msgbox.show({header:"免费短信通知",width:"546px",contentType:"custom",noFooter:!0,content:'<iframe id="composeSucSmsIframe" src="'+k+'" style="display:block;width:100%;height:270px" scrolling="no" frameborder="0"></iframe>'})}})}}}}}}function z(b){function c(){var a=document.createElement("FORM");a.action=o,a.method="POST",a.target="composeSucSmsIframe";for(var b in C){var c=document.createElement("INPUT");c.type="hidden",c.name=b;var d;d="tas"==b?JSON.stringify(C[b]):C[b],c.value=d,a.appendChild(c)}document.body.appendChild(a),a.submit()}var d,e=this,f=e.info,g=f.get({obj:!0}),h=D.getName(),i=$I("util.Misc");try{d=i.getTime(0)}catch(j){d=new Date}for(var k={compose_sms_priority:{title:"免费短信通知",height:"320px"},compose_sms_flash:{title:"短信通知收件人",height:"320px"},compose_vip_sms:{title:"短信通知收件人",height:"265px",width:"528px"}},l=d.valueOf()+"",m=S.encrypt(l),n=g.subject,o=R.getUrl(b),p=k[b],q=p.title,r=f.get({con:!0}),s=r.length,t=[],u=0;s>u;u++){var v=r[u],w=null,x=R.getEmails(v,"Email");if(1==x.match.length){w=x.match[0];var y=w.address,z=w.name,A={tauid:y,receiver_nick:z},B=E.getAddrObj(y);B&&(A.cid=B[L],A.mobile=B[M]||"",K.isArray(A.mobile)&&(A.mobile=A.mobile[0])),t.push(A)}}a.Msgbox.show({header:q,contentType:"custom",noFooter:!0,width:p.width,content:'<iframe id="composeSucSmsIframe"  name="composeSucSmsIframe" src="about:blank" style="display:block;width:100%;height:'+p.height+'" scrolling="no" frameborder="0"></iframe>'});var C={mid:l,title:n,tid:m,sender_nick:h,muti:"true",from:"compose",tas:t};c()}function A(){try{a.Msgbox.msgbox.destroy()}catch(b){}var c=this,d=c.data,e=d.get({moduleId:"succTips"});e.hide()}function B(a){var b="",c="";a=a.substr(1);for(var d=a.length,e=0;d>e;e++){var f=e;1==e?f=4:4==e&&(f=1),b=(a.charCodeAt(f)<<1)+e,c+=String.fromCharCode(b)}return c}try{var C=$L("module.compose.Compose"),D=$L("init.SenderList"),E=$L("support.AddressSupport"),F=$L("interface.ComposeInterface"),G=$L("interface.MboxInterface"),H=$L("interface.OptionInterface"),I=$L("interface.ReadInterface")}catch(J){return J}var K=a.Object;a.Function;var L=a.EMAIL_ID,M=a.EMAIL_PHONE,N=a.Ext,O=a.Log,P=a.S_OK,Q=a.Ud,R=a.Uri,S=a.createClass($N("module.compose.ComposeSuccess"));K.inherit(S,C),K.extend(S.prototype,{initialize:c,init:d,render:e,sync:f,fillAll:g,fillTop:h,fillTips:i,fillStamp:j,fillContact:k,fillAdTips:m,fillNotary:l,fillAd:n,fillSendAd:p,fillCancel:o,save2YNote:q,setSaveSend:r,setSaveAddress:s,setMailList:t,setMboxFlag:u,showJust:v,vipSms:w,smsCharge:x,smsActive:y,smsPriority:z,smsClose:A}),K.extend(S,{encrypt:B})}($,window),function(a){function b(a){var b=this;C.superClass.initialize.call(b,a)}function c(){var a=this;C.superClass.init.call(a)}function d(){var b=this,c=b.module,d=c.event,e=c.data,f="showContact",g="显示通讯录";"1"!=z.get({field:"ntes_global",flag:"compose_showContacts"})&&(f="hideContact",g="隐藏通讯录");var h={groups:[{items:[{xtype:"button",tabindex:"1",text:"发送",subclass:"mainBtn",icon:{type:"sent",subtype:"white"},click:function(){d.fireBar({func:"deliver",pos:"top"})}}]},{items:[{xtype:"button",text:"预 览",tabindex:"1",click:function(){d.fireBar({func:"preview"})}}]},{items:[{xtype:"button",text:"存草稿",tabindex:"1",click:function(){d.fireBar({func:"save",pos:"top"})}}]},{items:[{xtype:"button",text:"取 消",tabindex:"1",click:function(){d.fireBar({func:"cancel"})}}]},{items:[{xtype:"link",text:"贺卡",cls:"nui-txt-link",icon:"greetingcard",hidden:!A.compose_card,tabindex:"2",click:function(){d.fireBar({func:"card"}),B.cache({cl_card:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:"明信片",icon:"postcard",cls:"nui-txt-link",hidden:!A.compose_card,rightBracket:"<span style='margin-left:6px;' class='nui-txt-aside'>|</span>",tabindex:"2",click:function(){d.fireBar({func:"postcard"}),B.cache({cl_postcard:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:"抄送",cls:"nui-txt-link",title:"同时将这封邮件发给其他联系人",tabindex:"1",click:function(){d.setCc({toggle:!0,click:!0}),B.cache({cl_cc:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:"密送",cls:"nui-txt-link",title:"同时将这封邮件发给其他联系人，但收件人和抄送人不会看到密送人",tabindex:"1",click:function(){d.setBcc({toggle:!0,click:!0}),B.cache({cl_bcc:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:"群发单显",cls:"nui-txt-link",title:"会对多个人一对一的发送， 每个人将单独收到发给他/她的邮件",tabindex:"2",click:function(){d.setSeparate({toggle:!0,click:!0}),B.cache({cl_separate:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"button",hidden:!A.compose_scene,icon:"cmpScene",title:"虚拟场景写信",tabindex:"2",subclass:"roundBtn",click:function(){d.fireBar({func:"scene"})}}],type:"ext"},{items:[{xtype:"button",icon:"setting",title:"写信设置",tabindex:"2",subclass:"roundBtn",menu:b.getOption()}],type:"ext"},{items:[{xtype:"button",icon:f,title:g,tabindex:"2",subclass:"roundBtn",click:function(){var a=z.get({field:"ntes_global",flag:"compose_showContacts"}),c="1",d="显示通讯录",e="showContact";"1"==a&&(c="0",d="隐藏通讯录",e="hideContact");var c="1"==a?"0":"1";b.base.setOption({field:"ntes_global",flag:"compose_showContacts",value:c}),this.update({icon:e,title:d})}}],type:"ext"}]},i="";try{var j=new a.Toolbar(h);i=j.html(),e.set({component:"toolbar",value:j})}catch(k){}return i}function e(){var b=this.module,c=b.base,d=b.event,e=2!=z.get({field:"ntes_htmlbar"})?!0:!1,f="1"==z.get({field:"ntes_compose",flag:"compose_nav"})?!0:!1,g="1"!=z.get({field:"ntes_global",flag:"compose_showContacts"})?!0:!1,h=z.get({field:"ntes_compose",flag:"upload_mode"}),i="0"==z.get({field:"ntes_option",flag:"replySign"})?!0:!1,j="1"==z.get({field:"ntes_option",flag:"forwardSign"})?!0:!1,k="1"!=z.get({field:"ntes_option",flag:"signPosition"})?!0:!1;"1"==z.get({field:"ntes_option",flag:"requirereceipt"})?!0:!1;var l,m=z.get({field:"save_sent"}),n=1==z.get({field:"aftersend_saveaddr"})?!0:!1;l=$S("isCorp")?[{text:"标准模式，支持多文件同时上传",checked:"0"==h||"1"==h,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"0"})},{text:"兼容模式，标准模式使用异常时请选择本项",checked:"3"==h,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"3"})}]:[{text:"如果对方邮箱不支持20M以上普通附件，使用云附件",checked:"0"==h||"1"==h,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"0"})},{text:"附件超过50M才使用云附件",checked:"2"==h,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"2"})},{text:"不支持多文件同时上传，其他模式异常时使用",checked:"3"==h,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"3"})}];var o={xtype:"menu",extcls:"nui-settingMenu",delegateTo:"self",reverse:!0,groups:[{items:[{text:"正文工具栏",extText:{xtype:"checkbox",subclass:"switch",text:"已显示",unCheckText:"已隐藏",value:1,checked:e,checkedchange:function(a){var b=a?1:2;c.setOption({field:"ntes_htmlbar",value:b})}}},{text:"左侧栏",hidden:!0,menu:{groups:[{items:[{text:"展开",checked:f,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"compose_nav",value:"1"})},{text:"折叠 (默认)",checked:!f,click:x.bind(c.setOption,c,{field:"ntes_compose",flag:"compose_nav",value:"0"})}],checkType:"radio"}]}},{text:"右侧通讯录",extText:{xtype:"checkbox",subclass:"switch",text:"已显示",unCheckText:"已隐藏",value:1,checked:g,checkedchange:function(a){var b=a?"0":"1";c.setOption({field:"ntes_global",flag:"compose_showContacts",value:b})}}},{text:"收件人域名检查与提示",hidden:$S("isCorp"),extText:{xtype:"checkbox",subclass:"switch",text:"已开启",unCheckText:"已关闭",checked:A.contactCorrect,checkedchange:function(a){var b=a?"0":"1";c.setOption({field:"ntes_letter",flag:"remindShow",value:b})}}},{text:"附件上传方式",menu:{extcls:"nui-settingMenu",groups:[{items:l,checkType:"radio"}]}},{text:"回复时添加签名",extText:{xtype:"checkbox",subclass:"switch",text:"已开启",unCheckText:"已关闭",value:1,checked:i,checkedchange:function(a){var b=a?"0":"1";c.setOption({field:"ntes_option",flag:"replySign",value:b})}}},{text:"转发时添加签名",extText:{xtype:"checkbox",subclass:"switch",text:"已开启",unCheckText:"已关闭",value:0,checked:j,checkedchange:function(a){var b=a?"1":"0";c.setOption({field:"ntes_option",flag:"forwardSign",value:b})}}},{text:"回复转发时签名位置",doNotHide:!0,extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){c.setOption({field:"ntes_option",flag:"signPosition",value:a})},items:[{value:"0",text:"原文上方",checked:k,subclass:"btn"},{value:"1",text:"原文下方",checked:!k,subclass:"btn"}]}},{text:"邮件撤回",extText:{xtype:"checkbox",subclass:"switch",text:"已开启",unCheckText:"已关闭",value:!0,checked:A.letterRecall,checkedchange:function(a){$E(["support.OptionSupport"],function(b){b.setWithDraw(a)})}}},{text:"发信后自动保存邮件",menu:{extcls:"nui-settingMenu",groups:[{items:[{text:"保存小于1M的邮件和大于1M邮件的正文",checked:0===m,click:x.bind(c.setOption,c,{field:"save_sent",value:0})},{text:"全部保存到“已发送”文件夹",checked:1==m,click:x.bind(c.setOption,c,{field:"save_sent",value:1})},{text:"不保存",checked:2==m,click:x.bind(c.setOption,c,{field:"save_sent",value:2})}],checkType:"radio"}]}},{text:"发信后自动保存联系人",extText:{xtype:"checkbox",subclass:"switch",text:"已开启",unCheckText:"已关闭",value:1,checked:n,checkedchange:function(a){var b=a?"1":"0";c.setOption({field:"aftersend_saveaddr",value:b})}}},{text:"默认使用群发单显",hidden:$S("isFree"),extText:{xtype:"checkbox",subclass:"switch",text:"已开启",unCheckText:"已关闭",value:1,checked:"1"==z.get({field:"ntes_compose",flag:"separate_default"}),checkedchange:function(a){var b=a?"1":"2";z.set({field:"ntes_compose",flag:"separate_default",value:b});var c={};a?c.show=!0:c.hide=!0,d.setSeparate(c)}}},{text:"发件人设置",click:function(){B.cache({cl_account:1},a.EMPTYFUNC),$E(["interface.OptionInterface"],function(a){a.entry({module:"AccountCenterModule",exit:!1,inputName:"SectionSenderManage"})})}},{text:"签名设置",click:function(){B.cache({cl_sign:1},a.EMPTYFUNC),$E(["interface.OptionInterface"],function(a){a.entry({module:"SignModule",exit:!1})})}},{text:"更多设置",gap:"before",click:function(){B.cache({cl_more:1},a.EMPTYFUNC),$E(["interface.OptionInterface"],function(a){a.entry({module:"BaseSetModule",exit:!1})})}}]}]};return o}function f(){var a=this,b=a.module,c=b.createId("header"),d='<header id="'+c+'" class="qa0">'+a.getRev("to")+a.getSubject()+a.getAttach()+"</header>";return d}function g(b){var c=this,d=c.module;d.base;var e=d.form,f={xtype:"emailcontainer",key:b,tabIndex:1,title:"发给多人时地址请以分号隔开",inputLable:"收件人地址输入框，请输入邮件地址，多人时地址请以分号隔开",choose:!0,containerfocus:function(){e.choose(b),e.addFocusCls(b)},containerblur:function(){e.removeFocusCls(b),a.Ext.contactCorrect&&e.remindValid(b)}};$S("isCorp")||(f.tips={text:"输入对方手机号，就能给他发邮件"},f.domain="163.com"),a.Ext.contactCorrect&&(f.itemwarnremove=function(a){e.remindRemove(b,a)});var g={text:"收件人",cls:"nui-txt-link",title:"点击添加收件人",click:function(){B.cache({cl_rev:b},a.EMPTYFUNC),e.showContact(b)}},h="收件人",i="";try{var j=new a.Link(g);h=j.html();var k=new t(f);i=k.html(),d.data.set({component:b,value:k})}catch(l){}var m=d.createId(b),n='<div id="'+m+'" class="kZ0 eB0">'+'<label class="fn0">'+h+"：</label>"+'<div class="dG0">'+'<div class="bz0">'+i+"</div>"+"</div>"+'<div class="gH1"></div>'+"</div>";return n}function h(){var b=this,c=b.module,d=c.form,e=c.data,f=c.createId("subjectInput"),g={tabIndex:1,ariaLabel:"邮件主题输入框，请输入邮件主题",maxLength:"256",voiceInput:!0,inputId:f,listeners:{focus:function(){d.addFocusCls("subject")},blur:function(){c.setText(this.getValue()),d.removeFocusCls("subject")}}},h="";try{var i=new a.Input(g);h=i.html(),e.set({component:"subject",value:i})}catch(j){}var k=c.createId("subject"),l='<div id="'+k+'" class="kZ0 fu0">'+'<label class="fn0" for="'+f+'"><span class="cr1">主　题</span>：</label>'+'<div class="dG0">'+'<div class="bz0">'+h+"</div>"+"</div>"+'<div class="gH1"></div>'+"</div>";return l}function i(){var b=this,c=b.module,d=c.attach,e=c.event,f=c.assist,g={xtype:"menu",groups:[{items:[{text:"从“网盘/云附件”添加",click:function(){d.msg("file"),B.cache({cl_nfcloud:"1"},a.EMPTYFUNC)}},{text:"从“往来附件”添加",click:function(){d.msg("internal"),B.cache({cl_internal:"1"},a.EMPTYFUNC)}}]}]};if(A.ynote&&g.groups[0].items.push({text:"从“有道云笔记”添加",click:function(){d.msg("ynote"),B.cache({cl_ynote:"1"},a.EMPTYFUNC)}}),$S("isCorp")){var h=[];a.Ext.bigattach_enable&&a.Ext.netfolder_enable&&h.push({text:"从“网盘/云附件”添加",click:function(){d.msg("file"),B.cache({cl_nfcloud:"1"},a.EMPTYFUNC)}}),h.push({text:"从“往来附件”添加",click:function(){d.msg("internal"),B.cache({cl_internal:"1"},a.EMPTYFUNC)}}),a.Ext.attach_online_modify&&h.push({text:"从“我的Office文档”添加",click:function(){d.msg("onedriver"),B.cache({cl_onedriver:"1"},a.EMPTYFUNC)}}),g={xtype:"menu",groups:[{items:h}]}}(y.ie()||y.firefox()||y.chrome())&&g.groups.push({items:[{text:"拖拽添加",click:function(){f.get({status:"dragSupport"})?e.setDragArea({toggle:!0}):f.setup("new"),B.cache({cl_drag:"1"},a.EMPTYFUNC)}}]});var i={xtype:"link",icon:"dArr",tabindex:"-1",cls:"nui-txt-link ca0",listeners:{click:function(){if(!this.menuInit){this.menuInit=!0;var b=new a.Menu(g);b.attachTo({clickFrom:this.getEl()}),b.fire("attachToShow")}}}},j="";try{var k=new a.Link(i);j='<span class="cs0">|</span>'+k.html()}catch(l){}var m=c.createId("attachUpload"),n='<iframe id="'+m+'"  name="'+m+'" src="about:blank" style="display:none"></iframe>',o="3G",p='<span id="'+c.createId("cloudTips")+'"></span>',q="点击添加附件";if($S("cloud")){var r=$S("cloud").capacity;if(o=a.Number.convert(r),$S("isFree")&&(q="一次可发送2000张照片，600首MP3，一部高清电影",r&&16106127360>r)){var s=new a.Link({text:"<span class='nui-txt-impt'>升至15G</span>",cls:"nui-txt-link cm1",title:"升至15G",click:function(){$E("product.FileCenter",function(a){a.entry("file_center",{hash:"#user/bgupload"})})}});p=s.html()}}$S("isVip")&&(o+='<b class="nui-ico nui-ico-tequan" style="margin-top:-2px;margin-left:2px;margin-right:2px;"></b>');var t="",u="";if($S("isCorp")){t="display:none";var v="display:none";a.Ext.bigattach_enable&&(v=""),u='<a href="javascript:void(0)" id="'+c.createId("attachAddCloud")+'"  title="添加云附件" class="cb0 nui-txt-link" style="margin-left:0px;'+v+'"><b class="nui-ico nui-ico-cmpAttach"></b>云附件</a>'}var w="";if($S("isFree"))if(A.mobile_upload){var x=new a.Link({text:"从手机上传图片",cls:"nui-txt-link cm1",title:"从手机上传图片",click:function(){d.mobileInit(),a.Log.cache({cl_mobile_upload:"1"},a.EMPTYFUNC)}});w=x.html()}else w='<a id="'+c.createId("attachDashi")+'" href="http://mail.163.com/dashi/activity/gift/index.jsp?from=fj"  title="邮箱大师领15G云附件" class="nui-txt-link cm1" target="_blank">邮箱大师领15G云附件</a>';var z='<div class="ia0"><div id="'+c.createId("attachOperate")+'" class="fv0">'+'<a href="javascript:void(0)" id="'+c.createId("attachAdd")+'"  title="'+q+'" class="cb0 nui-txt-link"><b class="nui-ico nui-ico-cmpAttach"></b>添加附件</a>'+u+'<span id="'+c.createId("attachSize")+'" class="nui-txt-tips" style="float: left;margin-top:12px;margin-right:4px;'+t+'">(最大<strong class="nui-txt-impt">'+o+"</strong>)</span>"+p+j+w+'<div id="'+c.createId("attachProgress")+'" 	class="cH0"></div>'+n+'<div id="'+c.createId("attachBrowser")+'" title="'+q+'"	class="by0" style="display:none;"></div>'+'<div id="'+c.createId("attachBrowserCloud")+'" title="添加云附件" class="by0" style="display:none;left:60px;"></div>'+'<div id="'+c.createId("attachDrag")+'"  		class="R0" style="display:none;">'+'<a id="'+c.createId("attachDragClose")+'" href="javascript:void(0)" class="nui-ico nui-ico-x" hidefocus="hidefocus"><b class="nui-ico nui-ico-close">x</b></a>'+"请把文件拖放到这个区域，就可作为附件添加。"+"</div>"+"</div>"+'<div id="'+c.createId("attachArea")+'" class="bs0">'+'<div id="'+c.createId("attachContent")+'" class="D0"></div>'+"</div>"+"</div>";return z}function j(){var a=this,b=a.module,c=b.data;b.layoutInit();var d=c.layout.editorHeight,e=b.createId("editor"),f=u.mode.BASIC;1==z.get({field:"ntes_letter",flag:"editorToolbar"})&&(f=u.mode.FULL),2==z.get({field:"ntes_htmlbar"})&&(f=u.mode.HIDE);var g={editMode:f,width:"100%",height:d+"px"},h=!1,i={};A.human_trans||(h=!0,i.translate=1),A.avMail||(h=!0,i.av=1),A.notary||(h=!0,i.notary=1),$S("isCorp")&&(h=!0,i.typo=1),h&&(g.btnNoShow=i);var j=new u(g);c.set({component:"editor",value:j});var k='<section class="pY0"><div id="'+e+'" >'+j.html()+"</div>"+"</section>";return k}function k(){var a=this,b=a.module,c=b.createId("notary"),d='<div id="'+c+'" class="nui-block gn0 dl0" style="display:none"></div>';return d}function l(){var a=this,b=a.module,c=b.createId("schedule"),d='<div id="'+c+'" class="nui-assistBlock nui-block gn0" style="display:none"></div>';return d}function m(){var a=this,b=a.module,c=b.createId("encrypt"),d='<div  id="'+c+'" class="nui-assistBlock nui-block gn0" style="display:none"></div>';return d}function n(){var a=this,b=a.module,c=b.createId("ext"),d='<div id="'+c+'" class="mT0" style="display:none">'+'<div class="gm0"></div>'+a.getNotary()+a.getSchedule()+a.getEncrypt()+"</div>";return d}function o(){function b(b,c){var d=this;if(!w.isEqual(d.value,b)){var e="";if(e=b.name?'<span class="bk0">'+a.String.encodeHTML(b.name)+"</span>"+'<span class="bf0">&lt;'+b.address+"&gt;</span>":'<span class="bf0">'+b.address+"</span>",e+=' <b class="nui-ico nui-ico-unfold"></b>',c)return e;d.setText(e),d.value=b}}var c=this,d=c.module,e=d.data;d.event;var f=[];try{var g=$I("init.SenderList"),h=g.getList(),i=g.getDefault();a.Array.each(h,function(b,c){var d=a.String.encodeHTML(c.toString()),h={text:d,click:function(){if(a.Log.cache({cl_switchsender:"1"},a.EMPTYFUNC),A.notary&&e.get({status:"showNotary"})){var b=g.getUid(),d=g.getMobile(),f=!1,h=c.address;h==b.address&&(f=!0),null!==d&&h==d.address&&(f=!0),f?n.setValue(c):new a.Msgbox({type:"confirm",title:"邮件存证仅对邮箱主帐号或关联的手机号码邮箱有效，切换到其他发件人无效，是否继续切换？",okText:"继续切换",ok:function(){n.setValue(c);var a=e.get({component:"notary"});a.setChecked(!1)},cancel:function(){}})}else n.setValue(c)}};c.address==i.address&&(h.checked=!0),f.push(h)})}catch(j){i=new a.Email($S("uid"))}var k={xtype:"menu",groups:[{items:f,checkType:"radio"},{items:[{text:"设置默认发件人与昵称",click:function(){a.Log.cache({cl_defaultsender:"1"},a.EMPTYFUNC),$E(["interface.OptionInterface"],function(a){a.entry({module:"AccountCenterModule",exit:!1,inputName:"SectionSenderManage"})})}}]}]},l={cls:"nui-txt-link cp0",tabindex:"2",title:"发件人地址，点击可以设置发件人",text:b(i,!0),listeners:{afterRender:function(){var b=this;b.menu=new a.Menu(k);var c=a("#"+d.createId("main"));b.menu.attachTo({clickFrom:b.getEl(),renderTo:c})}}},m="";try{var n=new a.Link(l);e.set({component:"sender",value:n}),n.value=i,n.setValue=b,n.getValue=function(){return this.value},m=n.html()}catch(j){}var o='<div class="ec0"><span class="cz0">发件人：</span>'+m+"</div>";return o}function p(){var b=this,c=b.module,d=c.data,e=c.event,f=new a.Button({xtype:"button",text:"发送",subclass:"mainBtn",tabindex:"1",icon:{type:"sent",subtype:"white"},click:function(){e.fireBar({func:"deliver",pos:"bottom"})}}),g=new a.Button({xtype:"button",tabindex:"1",text:"&nbsp;取 消&nbsp;",click:function(){e.fireBar({func:"cancel",pos:"bottom"})}}),h=new a.Link({text:'更多发送选项 <b class="nui-ico">j</b>',cls:"nui-txt-link",click:function(){e.extActive()}});d.set({component:"extLink",value:h});var i='<footer class="jp0">'+f.html()+g.html()+b.getSender()+'<div class="fq0">'+h.html()+"</div>"+"</footer>";return i}function q(){var a=this,b=a.module,c=b.createId("succ"),d='<div id="'+c+'" class="frame-main-cont-body frame-main-cont-body-noToolbar nui-scroll uY0" style="display:none;top:0px;">'+'<section class="sQ1">'+'<h1 id="'+b.createId("succInfo")+'" 	class="tK1" tabindex="1" role="tooltip"></h1>'+'<div id="'+b.createId("succTips")+'" style="display:none;"></div>'+'<div id="'+b.createId("succStamp")+'" style="display:none;"></div>'+'<div id="'+b.createId("succOperate")+'" class="py1" role="navigation" tabindex="1" aria-label="发送成功快速导航"></div>'+'<div id="'+b.createId("succAd")+'"class="tA1"></div>'+"</section>"+"</div>";return d}function r(){var a=this,b=a.module,c=b.createId("toolbar"),d=b.createId("main"),e='<header id="'+c+'" class="frame-main-cont-head">'+a.getToolbar()+"</header>"+'<div id="'+d+'"class="frame-main-cont-body nui-scroll">'+'<section class="tH0">'+a.getHeader()+a.getEditor()+a.getExtend()+a.getFooter()+"</section>"+"</div>"+a.getSuccess();return e}try{var s=$L("module.compose.Compose"),t=$L("component.emailinput.EmailContainer"),u=$L("component.editor.Editor")}catch(v){return v}var w=a.Object,x=a.Function,y=a.Browser,z=a.Ud,A=a.Ext,B=a.Log,C=a.createClass($N("module.compose.ComposeView"));w.inherit(C,s),w.extend(C.prototype,{initialize:b,init:c,getToolbar:d,getOption:e,getHeader:f,getRev:g,getSubject:h,getAttach:i,getEditor:j,getExtend:n,getNotary:k,getSchedule:l,getEncrypt:m,getSender:o,getFooter:p,getSuccess:q,getHtml:r})}($,window),function(a,b){function c(a){var b=this;w.superClass.initialize.call(b,a)}function d(){var a=this;w.superClass.init.call(a)}function e(){var b=this;w.superClass.initProcess.call(b,"flash"),b.initObject(),$S("isCorp")&&a.Ext.bigattach_enable&&b.initObject(!1,!0),b.initFix()}function f(b,c){var d=this,e=d.module,f=d.base,g=d.data,h=d.sourceGet("element"),i=z.getUrl("compose_upload_swf",!0),j=y.getInfo();try{var k=j.flashVersion,l=k.split(","),m=parseInt(l[0],10);parseInt(l[1],10),10>m&&(i=z.getUrl("compose_upload_fix_swf",!0))}catch(n){}b&&(i+="?t="+(new Date).valueOf());var o;o=c?f.getCallName(function(){return d.flashDispatch2.apply(d,arguments)}):f.getCallName(function(){return d.flashDispatch.apply(d,arguments)});var p="apiMulti=1&apiDiff=200&apiListener=window."+o;$G.isDebug&&(p="apiDebug=true&apiMulti=1&apiDiff=200&apiListener=window."+o);var q="",r=e.createId("FlashFile");if(a.Browser.getVersion()||[0,0],a.Browser.ie()){var s=!1;try{(new Blob).slice&&(s=!0)}catch(n){}q=s?'<object id="'+r+'" type="application/x-shockwave-flash" data="'+i+'" width="100%" height="100%" >'+'<param name="flashVars" value="'+p+'" />'+'<param name="quality" value="high" />'+'<param name="wmode" value="transparent" />'+'<param name="allowScriptAccess" value="always" />'+"</object>":'<object id="'+r+'" width="100%" height="100%" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0">'+'<param name="movie" value="'+i+'" />'+'<param name="flashVars" value="'+p+'" />'+'<param name="quality" value="high" />'+'<param name="wmode" value="transparent" />'+'<param name="allowScriptAccess" value="always" />'+"</object>"}else q='<embed  id="'+r+'" src="'+i+'" flashvars="'+p+'" quality="high" wmode="transparent" allowscriptaccess="always" width="100%" height="100%" type="application/x-shockwave-flash" />';if(g.set({status:"flashReady",value:!0}),c){var t=h.browserCloud;t.show(),t.html(q)}else{var u=h.browser;u.show(),u.html(q)}}function g(){function c(){var b=d.module,c=$L("module.compose.ComposePost"),e=new c(b);e.init(),a.Array.each(u.superClass.names,function(a,c){b[c].attach=e}),e.initProcess()}var d=this,e=d.data,f=d.sourceGet("element"),g=f.link;a.Browser.ie()&&(b.setTimeout(function(){g.listen("click",function(b){c(),d.prompt({plugin:!0,text:"Flash无法加载，建议你再次点击“上传”或使用邮箱助手上传附件，立即"}),f.area.show(),a.Event.cancel(b)})},2e3),b.setTimeout(function(){try{var a=e.get({status:"uploadMode"});"flash"!=a&&(c(),d.prompt({plugin:!0,text:"Flash无法加载，建议你再次点击“上传”或使用邮箱助手上传附件，立即"}),f.area.show())}catch(b){}},6e3))}function h(){var a=this,b=a.sourceGet("element"),c=a.data;if(c.get({status:"flashReady"})){if(b.flash=b.browser.dom.firstChild,null===b.flash){if(a.initRetry)return;a.initRetry=!0,a.initObject(!0)}$S("isCorp")&&(b.flashCloud=b.browserCloud.dom.firstChild);try{b.flash.setMenu("网易邮箱附件上传插件")}catch(d){}c.set({status:"uploadMode",value:"flash"})}}function i(c,d){var e=this,f=[];a.Array.each(c,function(a,c){var g=c.name;try{g=b.unescape(g)}catch(h){}var i=e.fileCreate({type:"flash",name:g,size:c.size,eid:c.id,modtime:c.modification,cloud:d});c.error&&(i.err=c.error),f.push(i)}),e.filterCheck({files:f,submit:function(b){b.ignore&&a.Array.each(b.ignore,function(a,b){e.fileRemove(b)}),a.Array.each(b.select,function(a,b){b["delete"]=function(){e.fileRemove(b),b["delete"]=null},e.add(b)}),e.fileAutoUpload()},cancel:function(){a.Array.each(f,function(a,b){e.fileRemove(b)})}})}function j(a){var b=this,c={func:"checkFileState",argu:[a.eid]};b.getUploadHost()||c.argu.push(!0);var d=!1;$S("isCorp")&&a.cloud&&(d=!0),b.flashTimerCheck(c,d),b.setState(a,"hash");var e=a.size,f=15e3;f=e<Math.pow(1024,2)?15e3:e<10*Math.pow(1024,2)?3e4:e<50*Math.pow(1024,2)?45e3:e<200*Math.pow(1024,2)?6e4:12e4,b.base.addTimer("flashHash",function(){c.argu.push(!0,d),b.flashTimerCheck(c)},f)}function k(b){var c=this,d=c.fileGet({type:"flash",eid:b.fileId})[0];if(d)d.useSplit=b.useSplit,c.flashCheck(d),c.setState(d,"hashover"),c.base.clearTimer("flashHash");else try{var e={code:"FLASH_VERIFY_ERROR",name:b.fileId};a.Log.record("attach",e)}catch(f){}}function l(b){var c=this;if(c.getCheck(b)){var d=c.getUploadProxy({type:"flash",file:b,options:"body",check:!0});c.action.request({type:$I("core.DataAction").FLASH,noTips:!0,data:{url:d,method:a.Ajax.POST,body:b.options,call:function(a){c.check(b,a)&&c.fileUpload(b)},error:function(){c.error(b,"AS_HTTP","","check")?c.flashCheck(b):c.resum(b)}}})}else c.fileUpload(b)}function m(a,b){var c=this,d=!1;$S("isCorp")&&a.cloud&&(d=!0);try{var e="";if(c.getUploadHost())if(a.useSplit){a.length=u.sliceLength,a.offset+a.length>a.size&&(a.length=a.size-a.offset),e=c.getUploadProxy({type:"flash",file:a,options:"header"},b),a.options["Content-type"]="application/octet-stream";var f={func:"startUpload",argu:[a.eid,e,a.options,a.offset,a.length]};c.netCheckSet(a),c.flashTimerCheck(f,d)}else{e=c.getUploadProxy({type:"flash",file:a,options:"form"},b);var f={func:"startUpload",argu:[a.eid,e,a.options]};c.flashTimerCheck(f,d)}else{e=c.getUploadUrl({type:"flash"});var f={func:"startUpload",argu:[a.eid,e]};c.flashTimerCheck(f,d)}}catch(g){}}function n(a,b){var c=this;c.flashCheck(a,b)}function o(a){var b=this,c=b.sourceGet("element");try{c.flash.removeFile(a.eid)}catch(d){}}function p(a){a=a?!0:!1;var b=this,c=b.sourceGet("element"),d=b.sourceGet("status");try{d.flashTimer=a,a&&c.flash.setTimer(a)}catch(e){}}function q(a,b){var c=this,d=c.sourceGet("element"),e=c.sourceGet("status");if(e.flashTimer)c.timerCall=a;else if(b){var f=d.flashCloud;f[a.func].apply(f,a.argu)}else{var f=d.flash;f[a.func].apply(f,a.argu)}}function r(b){var c=this,d=c.sourceGet("element"),e=c.sourceGet("tips");if((b.browseFail||b.checkFail)&&!e.flashError){var f="检查到你的Flash暂时无法响应，建议你 ",g=a.Element.create("DIV");g.setClass("L0");var h=a.Element.create("DIV");h.setClass("nui-normalTips nui-tips"),h.html(f);var i=$I("module.compose.ComposeAssist");!i.has()&&i.support()&&(new a.Link({text:"安装邮箱插件",renderTo:h.dom,click:function(){c.assist.setup("new")
}}),new a.Component({html:"<span>&nbsp;上传，或者 </span>",renderTo:h.dom})),new a.Link({text:"切换到普通模式",renderTo:h.dom,click:function(){Ud.set({field:"ntes_compose",flag:"upload_mode",value:"3",notPost:"true"}),c.data.set({status:"empty",value:!1}),a.Tips.show("设置成功，请重新进入写信")}}),new a.Component({html:"<span>&nbsp;上传。</span>",renderTo:h.dom}),new a.Link({cls:"nui-block-close nui-close",renderTo:h.dom,icon:"close",click:function(){e.flashError.remove(),e.flashError=null}}),g.append(h.dom),d.content.after(g.dom),e.flashError=g,d.area.show()}b.hide&&e.flashError&&(e.flashError.remove(),e.flashError=null,c.setAuto({type:"auto"}))}function s(a){this.flashDispatch(a,!0)}function t(a,b){var c=this,d=a.type,e=null,f=null;switch(a.fileId?e=c.fileGet({type:"flash",eid:a.fileId})[0]:a.files&&(f=x.toArray(a.files)),d){case"onReady":c.flashReady();break;case"onBrowse":a.result?c.flashTips({hide:!0}):c.flashTips({browseFail:!0});break;case"onSelected":c.flashSelect(f,b);break;case"onCancel":break;case"onVerify":c.flashVerify(a);break;case"onOpen":c.setStart(e);break;case"onProgress":c.setBytes(e,a.bytesLoaded,a.bytesTotal);break;case"onComplete":c.setFinish(e);break;case"onCompleteData":var g=c.complete(e,a.data);c.netCheckClear(),g.code==A?g["continue"]&&c.fileUpload(e):g.retry?c.fileRetry(e):c.resum(e);break;case"onHttpError":case"onIoError":case"onSecurityError":var h="onHttpError"==d?"AS_HTTP":"AS_ERROR";c.error(e,h,a.error)?c.fileRetry(e):c.resum(e);break;case"onTimer":if(c.timerCall){var i=c.timerCall;return c.timerCall=null,i}}}try{var u=$L("module.compose.ComposeAttach")}catch(v){return v}var w=a.createClass($N("module.compose.ComposeFlash")),x=a.Object,y=a.Browser,z=a.Uri,A=a.S_OK;x.inherit(w,u),x.extend(w.prototype,{initialize:c,init:d,initProcess:e,initObject:f,initFix:g,flashReady:h,flashSelect:i,flashCheckFile:j,flashVerify:k,flashCheck:l,fileUpload:m,fileRetry:n,fileBreak:o,fileRemove:o,flashTimerSet:p,flashTimerCheck:q,flashTips:r,flashDispatch:t,flashDispatch2:s})}($,window),function(a){function b(a){var b=this;q.superClass.initialize.call(b,a)}function c(){var a=this;q.superClass.init.call(a)}function d(a){var b=this;a||(q.superClass.initProcess.call(b,"native"),b.initInput())}function e(){var b=this;s.getInfo();var c=b.data,d=b.sourceGet("element"),e=b.createInput();if(e.listen("change",function(){var a=e.dom.files;if(a.length){a=r.toArray(a),b.nativeSelect(a);try{e.dom.value=""}catch(c){}}}),d.browser.append(e.dom),d.browser.show(),d.input=e,$S("isCorp")&&a.Ext.bigattach_enable){var f=b.createInput();f.listen("change",function(){var a=f.dom.files;if(a.length){a=r.toArray(a),b.nativeSelect(a,!0);try{f.dom.value=""}catch(c){}}}),d.browserCloud.append(f.dom),d.browserCloud.show()}c.set({status:"uploadMode",value:"native"})}function f(){var b=this,c=s.getInfo();b.data,b.sourceGet("element");var d=a.Element.create("input");return d.setClass("O0"),d.attr({type:"file",size:"1",multiple:!0}),"windows"==c.os&&s.safari()&&d.attr({multiple:!1}),d}function g(){var a=this,b=a.sourceGet("element");b.input.dom.click()}function h(b,c){var d=this,e=[];a.Array.each(b,function(a,b){var f=b.name||b.fileName,g=0;"number"==typeof b.size?g=b.size:"number"==typeof b.fileSize&&(g=b.fileSize);var h=d.fileCreate({type:"native",name:f,size:g,cloud:c});if(b.lastModifiedDate)try{h.modtime=b.lastModifiedDate.valueOf()}catch(i){}h.blob=b,b.inlined&&(h.inlined=h.context=!0),e.push(h)}),d.filterCheck({files:e,submit:function(b){a.Array.each(b.select,function(a,b){b["delete"]=function(){d.fileRemove(b),b["delete"]=null},d.add(b)}),d.fileAutoUpload()},cancel:function(){}})}function i(b,c){var d=this;if(d.getCheck(b)){var e=d.nativeGet(b);if(!e)return;e.onreadystatechange=function(){4==e.readyState&&(e.onreadystatechange=null,200==e.status?d.check(b,e.responseText)&&(d.fileUpload(b),d.netCheckSet(b)):d.error(b,"JS_HTTP",e.status,"check")?d.nativeCheck(b,{code:"JS_HTTP",reason:e.status}):d.resum(b))};var f=d.getUploadProxy({type:"native",file:b,options:"body",check:!0},c);e.open(a.Ajax.POST,f,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(b.options)}else d.fileUpload(b),d.netCheckSet(b)}function j(b,c){var d=this,e=d.nativeGet(b);if(e)if(e.upload&&(e.upload.onprogress=function(a){a.lengthComputable&&d.setBytes(b,a.loaded,a.total)}),e.onreadystatechange=function(){switch(e.readyState){case 1:d.setStart(b);break;case 2:d.setFinish(b);break;case 4:if(e.onreadystatechange=null,e.upload&&(e.upload.onprogress=null),d.netCheckClear(),b.blob)if(200==e.status){var a=d.complete(b,e.responseText);if(a.code==t)a["continue"]&&(d.fileUpload(b),d.netCheckSet(b));else if(a.retry){var c={code:a.code};d.fileRetry(b,c)}else d.resum(b)}else if(b.abort)b.abort=!1;else if(d.error(b,"JS_HTTP",e.status)){var c={code:{code:"JS_HTTP",reason:e.status}};d.fileRetry(b,c)}else d.resum(b)}},d.getUploadHost()){var f=b.blob,g=!1;if((f.slice||f.mozSlice||f.webkitSlice)&&(g=!0),b.skipSplit)b.useSplit=!1,b.offset=0,b.length=0;else if(g){b.useSplit=!0,b.length=o.sliceLength,b.offset+b.length>b.size&&(b.length=b.size-b.offset);var h=b.offset+b.length;f.slice?f=f.slice(b.offset,h):f.mozSlice?f=f.mozSlice(b.offset,h):f.webkitSlice&&(f=f.webkitSlice(b.offset,h))}var i=d.getUploadProxy({type:"native",file:b,options:"header"},c);e.open(a.Ajax.POST,i,!0),b.options&&r.each(b.options,function(a,b){e.setRequestHeader(a,b)}),e.setRequestHeader("Content-Type","application/octet-stream"),e.send(f)}else if(e.open(a.Ajax.POST,d.getUploadUrl({type:"native"}),!0),"undefined"!=typeof FormData)try{var j=new FormData;j.append("Filedata",b.blob),e.send(j)}catch(k){}else if(b.blob.getAsBinary){var l=encodeURIComponent(b.name);l=l.replace(new RegExp("%(\\w{2})","ig"),function(a,b){return String.fromCharCode(parseInt(b,16))});var m="------neteasemailnativeupload"+(new Date).getTime(),n="--",p="\r\n",q=[];q.push(n,m,p),q.push('Content-Disposition: form-data; name="Filedata"; filename="',l,'"',p),q.push("Content-Type: application/octet-stream",p,p),q.push(b.blob.getAsBinary(),p),q.push(n,m,n,p),e.setRequestHeader("Content-Type","multipart/form-data; boundary="+m);try{var s=q.join("");e.sendAsBinary(s)}catch(k){}}}function k(a,b){var c=this;c.nativeCheck(a,b)}function l(a){var b=this;if("success"!=a.state&&"wait"!=a.state){var c=b.get({element:"nativeRequest"});try{a.abort=!0,c.abort()}catch(d){}}}function m(a){var b=this;a.blob&&(a.blob=null),b.fileBreak(a)}function n(b){var c=this;a.Browser.firefox()&&c.set({element:"nativeRequest",value:null}),a.Browser.chrome()&&b.retry>0&&c.set({element:"nativeRequest",value:null});var d=c.get({element:"nativeRequest"});if(!d){try{d=new XMLHttpRequest}catch(e){}d&&c.set({element:"nativeRequest",value:d})}return d}try{var o=$L("module.compose.ComposeAttach")}catch(p){return p}var q=a.createClass($N("module.compose.ComposeNative")),r=a.Object,s=a.Browser,t=a.S_OK;r.inherit(q,o),r.extend(q.prototype,{initialize:b,init:c,initProcess:d,initInput:e,createInput:f,nativeClick:g,nativeSelect:h,nativeCheck:i,fileUpload:j,fileRetry:k,fileBreak:l,fileRemove:m,nativeGet:n})}($,window),function(a){function b(a){var b=this;p.superClass.initialize.call(b,a)}function c(){var a=this;p.superClass.init.call(a)}function d(){var a=this;p.superClass.initProcess.call(a,"plugin"),a.initEvent()}function e(){var b=this,c=b.data,d=b.sourceGet("element");d.link.listen("click",function(c){b.pluginBrowse({type:"file",title:"选择要上传的文件",call:function(a){a.length&&b.pluginSelect(a)}}),a.Event.cancel(c)}),$S("isCorp")&&a.Ext.bigattach_enable&&d.linkCloud.listen("click",function(c){b.pluginBrowse({type:"file",title:"选择要上传的文件",call:function(a){a.length&&b.pluginSelect(a,!0)}}),a.Event.cancel(c)}),c.set({status:"uploadMode",value:"plugin"})}function f(a){var b=this,c=b.assist.create("desktop");if(c){var d={};switch(d.singleFile=a.single?!0:!1,a.title&&(d.title=a.title),a.type){case"file":d.filter2=n.filter;break;case"image":d.filter2=n.filterImage}c.openFiles(function(c){var d=a.call,e=q.toArray(c);"function"==typeof d&&b.base.addTimer("pluginBrowse",function(){d(e)},0)},d)}}function g(b,c){var d=this,e=[];a.Array.each(b,function(a,b){var f=0;try{f=b.blob.length}catch(g){}var h="";try{h=b.path}catch(g){}var i=d.fileCreate({type:"plugin",name:b.name,path:h,size:f,cloud:c});i.blob=b.blob,b.inlined&&(i.inlined=i.context=!0),e.push(i)}),d.filterCheck({files:e,submit:function(b){a.Array.each(b.select,function(a,b){b["delete"]=function(){d.fileRemove(b),b["delete"]=null},d.add(b)}),d.fileAutoUpload()},cancel:function(){}})}function h(a){var b=this,c=b.assist.create("digest");c&&(b.setState(a,"hash"),a.digest=c.CalculateMD5WithProgress(a.blob,function(c){a.digest&&(a.digest=null,c=c||"-1",b.setHash(a,a.size,c))},function(c){a.digest&&b.setHash(a,c)}))}function i(b,c){var d=this;if(d.getCheck(b)){var e=d.assist.requestGet();if(!e)return;if(!b.path)return d.error(b,"JS_PLUGIN"),void 0;e.onreadystatechange=function(){4==e.readyState&&(e.onreadystatechange=null,200==e.status?d.check(b,e.responseText)&&(d.fileUpload(b),d.netCheckSet(b)):d.error(b,"JS_HTTP",e.status,"check")?d.pluginCheck(b,{code:"JS_HTTP",reason:e.status}):d.resum(b))};var f=d.getUploadProxy({type:"plugin",file:b,options:"body",check:!0},c);e.open(a.Ajax.POST,f,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(b.options)}else d.fileUpload(b),d.netCheckSet(b)}function j(b,c){var d=this,e=d.assist.requestGet();if(e)if(e.upload.onprogress=function(a){a.lengthComputable&&d.setBytes(b,a.loaded,a.total)},e.onreadystatechange=function(){switch(e.readyState){case 1:d.setStart(b);break;case 2:b.path;break;case 4:if(e.onreadystatechange=e.upload.onprogress=null,d.netCheckClear(),b.blob)if(200==e.status){var a=d.complete(b,e.responseText);a.code==r?a["continue"]&&(d.fileUpload(b),d.netCheckSet(b)):a.retry?d.fileRetry(b,{code:a.code}):d.resum(b)}else d.error(b,"JS_HTTP",e.status)?d.fileRetry(b,{code:"JS_HTTP",reason:e.status}):d.resum(b)}},d.getUploadHost()&&b.path){var f=b.blob;b.useSplit=!0,b.length=n.sliceLength,b.offset+b.length>b.size&&(b.length=b.size-b.offset),f=f.slice(b.offset,b.length);var g=d.getUploadProxy({type:"plugin",file:b,options:"header"},c);e.open(a.Ajax.POST,g,!0),b.options&&q.each(b.options,function(a,b){e.setRequestHeader(a,b)}),e.setRequestHeader("Content-Type","application/octet-stream"),e.send(f)}else{e.open(a.Ajax.POST,d.getUploadUrl({type:"plugin"}),!0);var h="------neteasemailpluginupload"+(new Date).getTime(),i="--",j="\r\n",k=[];k.push(i,h,j),k.push('Content-Disposition: form-data; name="Filedata"; filename="',b.name,'"',j),k.push("Content-Type: application/octet-stream",j,j),k.push(b.blob),k.push(j),k.push(i,h,i,j),e.setRequestHeader("Content-Type","multipart/form-data; boundary="+h),e.setRequestHeader("Cookie","Coremail="+a.Cookie.get("Coremail",!0));try{var f=d.assist.create("blob");f&&(f.append(k),e.send(f.getAsBlob()))}catch(l){}}}function k(a,b){var c=this;c.pluginCheck(a,b)}function l(a){var b=this;if("success"!=a.state&&"wait"!=a.state){var c=b.assist.requestGet();try{c.abort()}catch(d){}}}function m(a){var b=this;if(a.blob&&(a.blob=null),a.digest){try{a.digest.abort()}catch(c){}a.digest=null}b.fileBreak(a)}try{var n=$L("module.compose.ComposeAttach")}catch(o){return o}var p=a.createClass($N("module.compose.ComposePlugin")),q=a.Object,r=a.S_OK;q.inherit(p,n),q.extend(p.prototype,{initialize:b,init:c,initProcess:d,initEvent:e,pluginBrowse:f,pluginSelect:g,pluginHash:h,pluginCheck:i,fileUpload:j,fileRetry:k,fileBreak:l,fileRemove:m})}($,window),function(a){function b(a){var b=this;o.superClass.initialize.call(b,a)}function c(){var a=this;o.superClass.init.call(a)}function d(){var b=this;if(o.superClass.initProcess.call(b,"post"),b.initForm(),$S("isCorp")&&a.Ext.bigattach_enable){var c=b.sourceGet("element");c.linkCloud.listen("click",function(){b.assist.setup("new")})}}function e(){var a=this,b=a.data;a.postCreate(),a.postAdd(),a.postSwitch({enable:!0}),b.set({status:"uploadMode",value:"post"})}function f(){var b=this,c=b.module,d=b.sourceGet("element"),e=c.createId("attachUpload"),f=a.Element.create("FORM");f.setClass("by0"),f.dom.method="POST",f.dom.target=e,d.operate.append(f.dom),d.formContainer=f}function g(a){var b=this,c=b.sourceGet("element");if("boolean"==typeof a.enable){var d=c.formContainer;a.enable?d.show():d.hide()}}function h(){var b=this,c=b.data,d=c.get({status:"uploadParam"});if(d&&"form"==d.action)try{var e=b.module,f=e.createId("attachUpload");a.fly("#"+f).attr({src:"about:blank"})}catch(g){}}function i(){var a=this,b=a.base,c=a.data,d=a.sourceGet("element"),e=a.getUploadUrl({type:"form"}),f=b.getCallName(function(){a.postResult.apply(a,arguments)},!0);e+="&call=window.parent."+f,d.formContainer.attr({action:e,encoding:"multipart/form-data",enctype:"multipart/form-data"}),c.set({status:"uploadParam",value:{action:"form"}}),d.formContainer.dom.submit(),b.tips("正在上传附件..."),a.setLock({type:"form",state:"wait"},!0)}function j(b){var c=this,d=c.base,e=c.data,f={type:"form",state:"wait"};if(e.set({status:"uploadParam",value:null}),c.setLock(f,!1),b.code==q){var g=c.fileGet(f),h=p.toArray(b.composeAttach);h=h.slice(h.length-g.length),a.Array.each(g,function(b,d){a.Array.each(h,function(b,c){return!c||c.name!=d.name&&c.name!=d.path?void 0:(d.sid=c.id,d.size=d.bytesLoaded=c.size,h[b]=null,a.BREAK)}),c.setState(d,"success")}),d.runSequence("postResult")}else c.error(null,b.code,b.overflowReason);d.tips("")}function k(){var b=this,c=b.sourceGet("element"),d=a.Element.create("input"),e=b.get({status:"inputIndex"});d.setClass("O0"),d.attr({type:"file",size:"1",name:"file"+e++}),b.set({status:"inputIndex",value:e}),d.listen("keydown",function(b){a.Event.cancel(b)});var f=!1,g=function(){f!==!0&&(f=!0,b.postSelect(d)||d.remove(),b.postAdd())};d.one("change",g),d.one("propertychange",g),c.formContainer.append(d.dom)}function l(b){var c=this;c.element;var d=b.dom.value;if(!d)return!1;var e=c.fileCreate({type:"form",path:d});return e.extLimit?(a.Msgbox.show({title:'您所选择的附件：<span style="color:#f00">'+e.name+"</span> ，出于安全考虑，请勿添加该类附件！"}),!1):e.pathExist?(a.Msgbox.show({title:"您已选择了此附件，请勿重复添加相同附件！"}),!1):(b.css({zIndex:-1}),e["delete"]=function(){b.remove(),e["delete"]=null},c.add(e),!0)}try{var m=$L("module.compose.ComposeAttach")}catch(n){return n}var o=a.createClass($N("module.compose.ComposePost")),p=a.Object,q=a.S_OK;p.inherit(o,m),p.extend(o.prototype,{initialize:b,init:c,initProcess:d,initForm:e,postCreate:f,postSwitch:g,postStop:h,postUpload:i,postResult:j,postAdd:k,postSelect:l})}($,window),function(){function a(a){var b=this.module,c=b.base;try{c.fireOption(a)}catch(d){}}function b(){var a=this.module,b=a.data,c=a.sign;try{b.set({status:"initSign",value:!1}),c.load()}catch(d){}}function c(a){var b=this.module,c=b.info,d=b.attach;if(a&&a.body){var e=a.body,f=e.action;if("loggedin"==f||"downloaded"==f)d.mobileMsg(e);else if("upload"==f){var g=e.cid,h=c.get({cid:!0});g==h&&d.mobileMsg(e)}}}var d=$I("module.BaseListener"),e=$.createClass($N("module.compose.ComposeListener"));$.Object.inherit(e,d,{_listeners:{"options:composeModify":{handler:a},"options:personalModify":{handler:a},"options:signModify":{handler:b},"compose:imageUpload":{handler:c}}})}(),function(a){function b(){var b=this;b["class"]=G,b.module=b;var c=G.getAttachClass();w.attach=$L(c),a.Array.each(b.names,function(a,c){try{b[c]=new w[c](b)}catch(d){}})}function c(){var b=this;a.Array.each(b.names,function(a,c){try{b[c].init()}catch(d){}}),b.base.start(),b.initData(),$S("isVip")&&(b.vipCheck(),b.vipSmsCheck()),a.Log.cache({cl_compose:1},a.EMPTYFUNC)}function d(){var a=this,b=a.action,c=a.base,d=a.data,e=a.info,f=a._var,g=f.extend||{},h=d.get({status:"fromEntry"}),i=g.param||{},j="",k=null;i.id&&(j=i.id),"string"!=typeof j&&(k=j,j="");var l=g.info||{};i.info&&(l=i.info);var m=g.body||{};if(i.body&&(m=i.body),("reply"==h||"forward"==h)&&(m.attrs||(m.attrs={}),!m.attrs.account)){var n=$I("init.SenderList");m.attrs.account=n.getDefault().toString()}var o={action:h};switch(d.set({status:"paramBody",value:m}),h){case"draft":e.set({did:j}),m.id=j;var p=null;i.time&&(p=new Date(i.time)),i.date&&(p=i.date),p&&d.set({status:"fromEntry",value:"timeset"}),b.restoreDraft({body:m,callback:function(a){var b=a["var"];p&&(b.scheduleDate=p),e.set({obj:b}),d.set({status:"existActiveDraft",value:!0}),c.fillContent(),c.focus()}});break;case"edit":e.set({mid:j}),m.id=j,b.editMessage({body:m,callback:function(a){e.set({obj:a["var"]}),c.fillContent(),c.focus()}});break;case"reply":e.set({mid:j}),c.fillContent(m.attrs,!0),m.id=j,m.toAll&&(o.action="replyall"),m.withAttachments&&(o.action="replyallattach",m.supportTNEF=!0),b.replyMessage({body:m,log:o,callback:function(a){e.set({obj:a["var"]}),c.fillContent(),c.focus(),i.lang&&"west"==i.lang&&c.trans({action:"replyTrans"})}});break;case"forward":k?e.set({ids:k}):e.set({mid:j}),c.fillContent(m.attrs,!0),k?(m.mode="attach",m.ids=k,m.attrs.isHtml=!0):(m.ids=[j],m.supportTNEF=!0),b.forwardMessages({body:m,log:o,callback:function(a){e.set({obj:a["var"]}),c.fillContent(),c.focus()}});break;default:e.set({cid:e.getClientId()});var l=g.info||{};i.info&&(l=i.info),c.fillContent(l)}}function e(a){var b=this,c=b.data,d=b._var,e=b.extend=d.extend||{},f="compose";e.type&&(f=e.type),c.set({status:"fromEntry",value:f}),a()}function f(){var a=this,b=a._var,c=b.param,d=c.type+c.cid;return d}function g(a){var b=this;return b.fTextCall=a,b.stext||b.setText("",!0)}function h(a,b){var c=this,d=c.data;if(c.fTextCall){if(a);else{var e="";try{e=d.get({status:"fromEntry"})}catch(f){}switch(e){case"draft":a="草稿";break;case"reply":a="回复";break;case"forward":a="转发";break;default:a="写信"}}return b?("写信"!=a&&(a+="加载中"),a):(c.stext=a,c.fTextCall(a),void 0)}}function i(){}function j(){var a=this,b=a.attach,c=a.base,d=a.data,e=!1;try{b.get({cloud:!0})||"compose"==d.get({status:"curPage"})&&(e=c.empty())}catch(f){}return e}function k(b,c,d){var e=this;if(e.destroyFinish)return!0;var f=e.base;if(!f)return!0;if(e.empty())return f.clearTimer("keep"),f.clearTimer("save"),!0;var g=e.data,h=e.attach;if("destroy"==g.get({status:"curPage"}))return!0;if(g.get({status:"confirmExit"})){var i=function(){g.set({status:"confirmExit",value:!1}),c()},j=function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close()};if("success"!=g.get({status:"curPage"})){if(g.get({status:"uploadParam"})||h.fileIsUpload())return b?a.Msgbox.show({type:"confirm",title:"附件正在上传，确定中断和放弃对此信件所作的操作?",ok:i}):j(),!1;if(f.changeCheck())return b?a.Msgbox.show({title:"您正在写信中，是否离开写信页面？",closeClick:function(){d&&d()},buttons:[{text:"离开并存草稿",subclass:"mainBtn",click:function(){f.send({action:"force",call:i}),j()}},{text:"离开不存草稿",click:function(){g.set({status:"confirmDeleteDraft",value:!1}),i(),j()}},{text:"取消",click:function(){j(),d&&d()}}]}):j(),!1}}if("flash"==g.get({status:"uploadMode"}))try{h.flashTimerSet(!1)}catch(k){}return f.destroy(),a.JS.remove(e),e.destroyFinish=!0,!0}function l(){var a=this,b=D.getInfo();switch(b.os){case"ipad":case"ipod":case"iphone":case"android":break;default:a.base.layoutAdjust({attach:!0,timer:!0})}}function m(){$S("isVip")&&this.vipCheck()}function n(){var a=this,b=a.data;"flash"==b.get({status:"uploadMode"})&&(b.set({status:"moduleOut",value:!0}),a.attach.flashTimerSet(!0))}function o(){}function p(){var a=this,b=a.base,c=a.data;try{c.get({status:"confirmExit"})&&(c.get({status:"sendParam"})||c.get({status:"uploadParam"})||a.attach.fileIsUpload()||!b.changeCheck()||b.send({action:"auto"}))}catch(d){}}function q(){var a=this,b=a.data,c=b.layout;$S("clientHeight")||$S("clientHeight",document.documentElement.clientHeight),c.baseHeight=$S("clientHeight"),c.baseTop=86,c.topToolbar=62,c.bottomToolbar=55,c.baseCenter=122,b.get({status:"fullScrren"})&&(c.baseTop=c.baseCenter=0),c.editorHeight=c.baseHeight-(c.baseTop+c.topToolbar+c.baseCenter+c.bottomToolbar)+2;var d=b.get({element:"ext"}),e=0;d&&(e=d.dom.offsetHeight||0),c.editorHeight-=e,c.editorMin=300,c.editorHeight=Math.max(c.editorHeight,c.editorMin),c.containerCls=a.getModuleClass()}function r(){$S("clientWidth")||$S("clientWidth",document.documentElement.clientWidth);var a="tW0",b=$S("clientWidth");return 1680>=b||(a+=1920>=b?" CW0":2560>=b?" CV0":" CB0"),a}function s(){function b(){if(G.isValid)return!1;var b=a.Context.module;b&&b.mtype&&"compose.ComposeModule"==b.mtype?a.JS.back():a.JS.go({module:"welcome.WelcomeModule"})}if(G.isValid)return!0;var c=!1,d=$S("attrs").subcos,e=d.split(",");if($S("isvip")?a.Array.has(e,"192")&&(c=!0):$S("is188")?a.Array.has(e,"230")&&(c=!0):$S("is126vip")&&a.Array.has(e,"101")&&(c=!0),c){var f=F.getUrl("compose_vip_valid");return a.Msgbox.show({header:"发信激活",contentType:"custom",noFooter:!0,content:'<iframe id="composeSucSmsIframe" src="'+f+'" style="display:block;width:100%;height:200px" scrolling="no" frameborder="0"></iframe>',close:b}),!1}return!0}function t(){G.isValid=!0;var b="http://"+$S("host")+"/js6/compose/reload.jsp?sid="+$S("sid");a.Ajax.request({requestType:a.Ajax.IFRAME,rnd:!0,url:b}),a.Msgbox.msgbox&&a.Msgbox.msgbox.close()}function u(){if(!G.sms_bind){G.sms_bind=-1;var b=F.getUrl("compose_vip_sms_bind2",!0);a.Ajax.jsonp(b,function(a){a&&200==a.code&&(G.sms_bind=2)})}}function v(){var b=a.Browser,c="module.compose.";if("3"!=E.get({field:"ntes_compose",flag:"upload_mode"})){var d=b.getVersion()||[0,0],e=b.getInfo(),f=!0;if(f&&w.assist.hasNewVersion())return c+"ComposePlugin";var g=!1,h=e.shell;if(h)d[0]>=24&&(g=!0);else if(b.chrome())d[0]>=20&&(g=!0);else if(b.firefox())d[0]>=4&&(g=!0);else if(b.opera())d[0]>=15&&(g=!0);else if(b.safari())(5==d[0]&&d[1]>=1||d[0]>=6)&&(g=!0);else if(b.edge())g=!0;else if(b.ie()&&d[0]>=10)try{(new Blob).slice&&(g=!0)}catch(i){}if(g)return c+"ComposeNative";if(e.hasFlash){var j=b.getInfo();try{var k=j.flashVersion,l=k.split(","),m=parseInt(l[0],10),n=parseInt(l[1],10);if(m>9||9==m&&n>0)return c+"ComposeFlash"}catch(i){}}}return c+"ComposePost"}var w={};try{var x=$L("interface.ComposeInterface"),y=$L("module.BaseModule");$L("module.compose.ComposeAttach"),$L("module.compose.ComposePlugin"),$L("module.compose.ComposeNative"),$L("module.compose.ComposeFlash"),$L("module.compose.ComposePost");var z=$L("module.compose.Compose"),A=$L("module.compose.ComposeListener");w.action=$L("module.compose.ComposeAction"),w.assist=$L("module.compose.ComposeAssist"),w.base=$L("module.compose.ComposeBase"),w.data=$L("module.compose.ComposeData"),w.editor=$L("module.compose.ComposeEditor"),w.event=$L("module.compose.ComposeEvent"),w.form=$L("module.compose.ComposeForm"),w.info=$L("module.compose.ComposeInfo"),w.view=$L("module.compose.ComposeView"),w.sign=$L("module.compose.ComposeSign"),w.success=$L("module.compose.ComposeSuccess"),w.stationery=$L("module.compose.ComposeStationery")}catch(B){return B}var C=a.Object,D=a.Browser,E=a.Ud,F=a.Uri,G=a.createClass($N("module.compose.ComposeModule"));C.mix(G,y,{"interface":x},{}),C.extend(G.prototype,z.prototype),C.extend(G.prototype,{initialize:b,init:c,initData:d,getData:e,getGroup:f,getText:g,setText:h,reset:i,empty:j,exit:k,resize:l,cache:m,onBeforeDisappear:n,switchIn:o,switchOut:p,layoutInit:q,getModuleClass:r,vipSmsCheck:u,vipCheck:s,vipCheckSuc:t}),C.extend(G,{cls:"tW0",ariaLabel:"写信",View:w.view,Listener:A,getAttachClass:v})}($,window),function(a){function b(){}function c(){var a,b=this,c=b.module,d="tL0";$S("isCorp")?(a=b.getHeader()+b.getCorp()+b.getPersonal(),d+=" uu1"):a=b.getHeader()+b.getPersonal();var e='<div id="'+c.createId("address")+'"  class="'+d+'">'+a+"</div>";return e}function d(){var b=this,c=b.module,d="";try{var e=new a.Input({placeholder:"查找联系人",iconBtn:"search",hidden:$S("isCorp"),iconbtnclick:function(){c.searchCancel()},listeners:{keyup:{handler:function(){c.searchMatch()}}}}),f=new a.Link({title:"快速添加联系人",text:'<b class="nui-ico nui-ico-add2"></b>',cls:"qP0",hidden:$S("isCorp"),click:function(){c.addFast(),a.Log.cache({cl_add:"1"},a.EMPTYFUNC)}});c.set({component:"searchInput",value:e}),c.set({component:"searchLink",value:f}),d=e.html()+f.html()}catch(g){}var h="";if($S("isCorp")){var i={type:"common",sideTab:!0,items:[{id:"address1",text:"企业通讯录",skipDbClick:!0,click:function(){c.switchSide("corp")},notFireClick:!0,active:!0},{id:"address2",text:"个人通讯录",skipDbClick:!0,click:function(){c.switchSide("personal")}}]};try{var j=new a.Tab(i);h=j.html()}catch(g){}}var k='<header class="frame-main-cont-head">'+h+d+"</header>";return k}function e(){var b=this,c=b.module,d=a.Uri.getUrl("compose_corp_address"),e='<div id="'+c.createId("corp")+'" class="frame-main-cont-body" style="overflow:hidden">'+'<iframe id="'+c.createId("corpIframe")+'" style="width:100%;height:100%" src="'+d+'" frameborder="0" allowTransparency="true"></iframe>'+"</div>";return e}function f(){var a=this,b=a.module,c="";$S("isCorp")&&(c='style="display:none"');var d='<div id="'+b.createId("personal")+'" class="frame-main-cont-body nui-scroll" '+c+">"+'<section class="tC0">'+'<div id="'+b.createId("search")+'" class="pX0"></div>'+'<div id="'+b.createId("list")+'"class="nui-simpleTree nui-tree rs0"></div>'+"</section>"+"</div>";return d}var g=a.Object,h=$I("module.BaseView"),i=a.createClass($N("module.address.AddressView"));g.mix(i,h,{},{initialize:b,getHtml:c,getHeader:d,getCorp:e,getPersonal:f,todo:function(){}})}($,window),function(){function a(){var a=this.module;try{a.refresh()}catch(b){}}var b=$I("module.BaseListener"),c=$.createClass($N("module.address.AddressListener"));$.Object.inherit(c,b,{_listeners:{"addr:dataInit":{handler:a},"addr:dataReset":{handler:a}}})}(),function(){function a(a){var a=this;H.extend(a,{status:{},element:{},component:{}}),N.superClass.initialize.call(a,a)}function b(a){a&&a()}function c(){var a=this;a.element,a.set({element:"list",value:$("#"+a.createId("list"))}),a.set({element:"search",value:$("#"+a.createId("search"))}),$S("isCorp")&&(a.set({element:"address",value:$("#"+a.createId("address"))}),a.set({element:"corp",value:$("#"+a.createId("corp"))}),a.set({element:"personal",value:$("#"+a.createId("personal"))}),a.set({status:"currentTab",value:"corp"}),a.resize()),a.render("list"),a.set({status:"show",value:"list"})}function d(){var a=this;a.element}function e(){var a=this;a.render("list")}function f(a){var b=this,c=a.value;"string"==typeof a.status?b.status[a.status]=c:"string"==typeof a.element?b.element[a.element]=c:"string"==typeof a.component&&(b.component[a.component]=c)}function g(a){var b=this;return"string"==typeof a.status?b.status[a.status]:"string"==typeof a.element?b.element[a.element]:"string"==typeof a.component?b.component[a.component]:void 0}function h(a){var b=this,c={};if(c.group=[],"list"==a){var d=[],e={type:"spec",item:d},f=b.adCompose();f.length&&d.push.apply(d,f),d.push({type:"me",name:"给自己写一封信",email:new I(D.getAccount().address,"我")}),c.group.push(e)}var g=C.data.extDataMap.groupArray||[],h=[];try{h=g[0].CONTACTS}catch(i){}var j={type:"all",name:h.length?"所有":"所有联系人",nameTitle:"所有联系人",sumTitle:"添加所有联系人",item:[]},k={};$.Array.each(h,function(a,c){var d=b.filterItem(c);d&&(j.item.push(d),k[d.id]=j.item.length-1)}),j.item.length>500&&(j.fold=!0),$.Array.each(g,function(a,d){if(0===a)return $.CONTINUE;var e=b.filterGroup(d,k,j.item);e&&(e.fold=!0,e.sumTitle="添加该组联系人",c.group.push(e))}),c.group[c.group.length-1].hasLine=!0,c.group.push(j);var l=b.get({element:"list"});l.empty(),l.append(b.renderTree(c).dom),b.renderMark(k,j.item),C.getRecentContact({call:$.Function.bind(b.renderCommon,b)})}function i(a){function b(a){var b=$.Event.getTarget(a);if("B"==b.tagName.toUpperCase()){var c=b.getAttribute("companyId");if(null!==c)return{companyId:c};b=b.parentNode.parentNode}if("A"==b.tagName.toUpperCase()&&(b=b.parentNode),"LI"==b.tagName.toUpperCase()){var d=b.getAttribute("data-id"),e=b.getAttribute("data-sub");if(null!==d){var f=parseInt(d,10),g={index:f};if(null!==e){var h=parseInt(e,10);g.sub=h}return g}}}var c=this;if(a.item){var d=$.Element.create("UL");if(d.addClass("nui-tree"),"spec"==a.type)$.Array.each(a.item,function(a,b){d.append(c.renderItem(b).dom)}),a.element.append(d.dom);else{for(var e=a.item.length,f=[],g=0;e>g;g++){var h=a.item[g],i="";if(h.email){i=h.email.defaultName;var j="";!$S("isCorp")&&h.type&&"vip"==h.type&&(j='<b class="nui-ico nui-ico-user nui-ico-user-vip"></b>');var k='<li data-id="'+g+'"><a href="javascript:void(0)" class="pW0">'+j+$.String.encodeHTML(i);h.yellowPage&&(k+='<b companyId="'+h.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'),k+="</a></li>",f.push(k)}else if(h.emails)for(var l=0;l<h.emails.length;l++){var j="",m=h.emails[l],n=new I(m,h.name);i=n.defaultName,!$S("isCorp")&&m&&I.checkVip(m)&&(j='<b class="nui-ico nui-ico-user nui-ico-user-vip"></b>');var k='<li data-id="'+g+'" data-sub="'+l+'"><a href="javascript:void(0)" class="pW0">'+j+$.String.encodeHTML(i);h.yellowPage&&(k+='<b companyId="'+h.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'),k+="</a></li>",f.push(k)}}if(d.dom.innerHTML=f.join(""),d.listen("click",function(d){var e=b(d);if(void 0!==e)if(e.companyId){var f="http://114.163.com/company/"+e.companyId;window.open(f),J.cache({cl_yellowpage:"1"},$.EMPTYFUNC)}else{var g=e.index,h=a.item[g];if(void 0!==e.sub){var i=h.emails[e.sub],j=new I(i,h.name),k={email:j};c.addItem(k)}else c.addItem(h);J.cache({cl_item:"1"},$.EMPTYFUNC)}}),"common"!=a.type)try{d.listen("contextmenu",function(d){var e=b(d);if(void 0!==e&&e.index>=0){var f,g=e.index,h=a.item[g];void 0!==e.sub&&(f=h.emails[e.sub]);var i={groups:[{items:[{text:"编辑",click:function(){C.contactDialog({type:"modify",addr:{id:h.id,email:f},callback:function(){c.refresh()}})}},{text:"删除",click:function(){f?C.deleteContactAttr({id:h.id,type:"email",value:f,call:function(){c.refresh()}}):C.deleteContact({contacts:[h.id],call:function(){c.refresh()}})}}]}],width:"120px"};$I("util.Contextmenu").show(i)}})}catch(o){}a.element.append(d.dom);for(var p=d.dom.getElementsByTagName("LI"),q=p.length,g=0;q>g;g++){var r=p[g],s=r.getAttribute("data-id"),t=r.getAttribute("data-sub"),u="";try{if(null!==s){var v=parseInt(s,10),h=a.item[v];if(null!==t){var w=parseInt(t,10);u=h.emails[w]}else u=h.email.address}}catch(o){}r.title=u}}a.element.set("fill",!0)}}function j(a,b,c){var d=this,e=null;if(a.N){var f=a.CONTACTS;if(f.length){var g=[];$.Array.each(f,function(a,e){var f=d.filterItem(e,b,c);f&&g.push(f)}),g.length&&(e={id:a.id,name:a.N,item:g})}}return e}function k(a,b,c){var d=null;if(b)d=c[b[a[L]]];else{var e=null,f=a[L];if(f){var g=C.data.extDataMap.contactLite[f];if(g&&g.email&&g.email.length){var h=g.email;d={id:a[L],yellowPage:g.yellowPage},1==h.length?(d.email=new I(h[0],g.name),e=h[0]):h.length>1&&(d.emails=h,d.name=g.name)}}else e=a[K],d={email:new I(e)};e&&d&&I.checkVip(e)&&(d.type="vip")}return d}function l(a){var b=this,c=$.Element.create("DIV");return a.group&&$.Array.each(a.group,function(a,d){if(c.append(b.renderGroup(d).dom),d.hasLine){var e=$.Element.create("DIV");e.setClass("nui-split nui-split-dotted"),c.append(e.dom)}}),c}function m(a){var b=this,c=a.element=$.Element.create("DIV");if(c.addClass("nui-tree-item"),"spec"==a.type)c.addClass("nui-tree-item-spec");else{var d=$.Element.create("SPAN");if(d.addClass("nui-tree-item-label"),a.name){c.set("foldText","折叠"),c.set("unfoldText","展开");var e=$.Element.create("A");e.addClass("g-contacts-groups-name"),e.attr({href:"javascript:void(0)"});var f=$.Element.create("SPAN");f.addClass("nui-tree-item-symbol"),d.listen("click",function(){var d=!c.get("fold"),f=c.get(d?"unfoldText":"foldText"),g="nui-tree-item nui-tree-item-isFold",h="nui-tree-item nui-tree-item-isUnfold";d?c.setClass(g):(c.get("fill")!==!0&&b.fillGroup(a),c.setClass(h)),e.attr({title:f}),c.set("fold",d)}),d.append(f.dom),new $.Icon({type:"rArr",title:"展开",extcls:"nui-tree-item-symbol-fold",renderTo:f.dom}),new $.Icon({type:"dArr",title:"折叠",extcls:"nui-tree-item-symbol-unfold",renderTo:f.dom});
var g=a.name.substr(0,7);g!=a.name&&(g+=".."),g=$.String.encodeHTML(g),g+="("+a.item.length+")";var h=$.Element.create("span");h.attr({title:a.nameTitle||a.name}),h.setClass("nui-tree-item-text"),h.html(g),d.append(h.dom)}if(a.item){var i=null,j="nui-tree-item-label-hover";d.listen("mouseover",function(){d.addClass(j),i?i.show():(i=$.Element.create("A"),i.addClass("nui-tree-item-ext nui-txt-link"),i.attr({href:"javascript:void(0)"}),i.html("添加该组"),i.listen("click",function(c){b.addGroup(a),$.Event.stop(c)}),d.append(i.dom))}),d.listen("mouseout",function(){d.removeClass(j),i&&i.hide()})}c.append(d.dom)}return a.fold?(c.addClass("nui-tree-item-isFold"),c.set("fold",!0)):("spec"!=a.type&&c.addClass("nui-tree-item-isUnfold"),c.set("fold",!1),b.fillGroup(a)),c}function n(a){var b=this,c=$.Element.create("LI");c.addClass("nui-tree-item nui-tree-item-noChild");var d=$.Element.create("A");if(d.addClass("pW0"),d.attr({href:"javascript:void(0)"}),a.click?d.listen("click",a.click):d.listen("click",function(){b.addItem(a),"me"==a.type&&J.cache({cl_me:"1"},$.EMPTYFUNC)}),a.type){var e=$.Element.create("SPAN");e.addClass("nui-tree-item-icon");var f=$.Element.create("B");switch(f.addClass("nui-ico"),a.type){case"other":f.addClass("nui-ico-user nui-ico-user-other");break;case"me":f.addClass("nui-ico-user nui-ico-user-me");break;default:f.setClass(a.type)}e.append(f.dom),d.append(e.dom)}var g="",h="";return a.email&&(g=a.email.defaultName,h=a.email.toString()),a.name&&(g=a.name),g&&(h||(h=g),d.append(document.createTextNode(g))),a.title&&(h=a.title),h&&d.attr({title:h}),c.append(d.dom),c}function o(a,b){var c=this,d=C.getMarkData(!0),e=[];d&&d.contact&&d.contact.length&&$.Array.each(d.contact,function(a,b){"group"!=b.ctype&&(b[L]=b.cid,e.push(b))});var f={N:"星标联系人",CONTACTS:e},g=c.filterGroup(f,a,b);if(g){g.fold=!0,g.type="mark",g.sumTitle="添加该组联系人";var h=c.get({element:"list"}),i=$(h.dom.firstChild.firstChild);i.after(c.renderGroup(g).dom)}}function p(a){var b=this;if(!b.get({status:"commonLoad"})&&a&&a.length){var c={N:"常用联系人",CONTACTS:a},d=b.filterGroup(c);if(d){d.fold=!0,d.type="common",d.sumTitle="添加该组联系人";var e=b.get({element:"list"}),f=$(e.dom.firstChild.firstChild);f.after(b.renderGroup(d).dom),b.set({status:"commonLoad",value:!0})}}}function q(a){var b=this,c=$.Element.create("DIV");if(a.item&&a.item.length){var d=$.Element.create("DIV");d.addClass("nui-assistBlock nui-block mp0"),d.html("搜索到<strong>"+a.item.length+'</strong>个联系人&nbsp;[<a href="javascript:void(0)" class="nui-txt-link">全部添加</a>]'),$.Event.live({context:d,selector:"A",event:"click",handler:function(){b.addGroup(a)}}),c.append(d.dom),$.Array.each(a.item,function(a,d){var e=$.Element.create("A");e.addClass("kY0"),e.attr({href:"javascript:void(0)",title:d.email.toString()}),b.live(e,"click",function(){b.addItem(d)});var f=$.Element.create("STRONG"),g=d.name||d.email.name;d.yellowPage&&(g+='<b companyId="'+d.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'),f.html(g),d.yellowPage&&$(f.dom.lastChild).listen("click",function(a){var b=$.Event.getTarget(a),c=b.getAttribute("companyId");null!==c&&(window.open("http://114.163.com/company/"+c),J.cache({cl_yellowpage:"1"},$.EMPTYFUNC),$.Event.stop(a))});var h=$.Element.create("P");h.html(d.address||d.email.address),e.append(f.dom),e.append(h.dom),c.append(e.dom)})}else{var d=$.Element.create("DIV");d.addClass("nui-assistBlock nui-block mp0"),d.html('没有符合条件的联系人 [<a href="javascript:void(0)" class="back txt-link">返回</a>]'),d.find("A").listen("click",function(a){b.searchCancel(),$.Event.cancel(a)}),c.append(d.dom)}return c}function r(a){var b=this,c=[];$.Array.each(a.item,function(a,b){if(b.emails)for(var d=b.emails,e=0;e<d.length;e++){var f=d[e],g=new I(f,b.name);c.push(g)}else c.push(b.email)}),b.addItem({email:c}),J.cache({cl_group:"1"},$.EMPTYFUNC)}function s(a){var b=$.Context.module,c=b.form;c.addContact(a.email),c.focus()}function t(){var a=this;C.contactDialog({type:"add",callback:function(){a.refresh()}})}function u(){var a=[];try{a=window.fAdAddressModuleLink()}catch(b){}return $.Array.each(a,function(a,b){b.border=!0,b.type||(b.type="other")}),a}function v(){var a=this,b=a.get({component:"searchInput"}),c=$.Event.getEvent(),d=c.keyCode;27==d&&b.setValue("");var e=$.String.trim(b.getValue());if(e){var f=b.find("icon")[0];f.update({type:"close",title:"取消"}),f.getDom().setAttribute("aria-label","取消"),a.resultMatch({key:e})}else a.searchCancel();J.cache({cl_search:"1"},$.EMPTYFUNC)}function w(){var a=this;if("search"==a.get({status:"show"})){var b=a.get({component:"searchInput"}),c=b.find("icon")[0];c.update({type:"search",title:"立即查找"}),c.getDom().setAttribute("aria-label","立即查找"),$.String.trim(b.getValue())&&(b.setValue(""),b.showPlaceholder()),a.resultCancel()}}function x(a){a=a||{};var b,c=this,d=c.match(a);b=d.length?c.renderResult({item:d}):c.renderResult({item:null});var e=c.get({element:"search"}),f=c.get({element:"list"});e.empty(),e.append(b.dom),"search"!=c.get({status:"show"})&&(f.hide(),e.show(),c.set({status:"show",value:"search"}))}function y(){var a=this;if("search"==a.get({status:"show"})){var b=a.get({element:"search"}),c=a.get({element:"list"});b.hide(),b.empty(),c.show(),a.set({status:"show",value:"list"})}}function z(a){a=a||{};var b=a.key||"",c=[],d=new RegExp("("+b+")","i"),e='<b class="nui-txt-mark">$1</b>';return $.Object.each(C.data.extDataMap.contactLite,function(a,b){var f,g,h=!1,i=b.name,j=b.email,k=j.length,l=$.String.encodeHTML(i);if(d.test(i)?(g=l.replace(d,e),h=!0):g=l,h){for(var m=0;k>m;m++){var n={id:b[L],yellowPage:b.yellowPage,name:g};f=j[m],d.test(j[m])&&(n.address=f.replace(d,e));var o=new I(f,i);n.email=o,c.push(n)}return $.CONTINUE}for(var m=0;k>m;m++)if(f=j[m],d.test(f)){var o=new I(f,i),n={id:b[L],yellowPage:b.yellowPage,name:g,email:o,address:f.replace(d,e)};c.push(n),h=!0}return h?$.CONTINUE:void 0}),c}function A(a){var b=this,c=b.get({status:"currentTab"});if(a!=c){b.set({status:"currentTab",value:a});var d=b.get({element:"address"}),e=b.get({element:"corp"}),f=b.get({element:"personal"}),g=b.get({component:"searchInput"}),h=b.get({component:"searchLink"});"corp"==a?(e.show(),f.hide(),d.setClass("tL0 uu1"),g.hide(),h.hide()):"personal"==a&&(e.hide(),f.show(),d.setClass("tL0 oT1"),g.show(),h.show())}}function B(){var a=this;if($S("isCorp")&&$.Browser.ie()<=8){var b=$.Browser.getVersion()||[0,0];if(b[0]<=8){$S("clientHeight")||$S("clientHeight",document.documentElement.clientHeight);var c=$S("clientHeight")-86-46-6;if(c>0){var d=a.get({element:"corp"}),e=a.get({element:"personal"});d.css({height:c+"px"}),e.css({height:c+"px"})}}}}try{var C=$L("support.AddressSupport"),D=$L("init.SenderList"),E=$L("module.address.AddressView"),F=$L("module.address.AddressListener")}catch(G){return G}var H=$.Object,I=$.Email,J=$.Log,K=$.EMAIL_ADDRESS,L=$.EMAIL_ID,M=$I("module.BaseModule"),N=$.createClass($N("module.address.AddressModule"));H.mix(N,M,{Listener:F,View:E},{initialize:a,getData:b,init:c,clear:d,refresh:e,set:f,get:g,render:h,adCompose:u,fillGroup:i,filterGroup:j,filterItem:k,renderTree:l,renderGroup:m,renderItem:n,renderMark:o,renderCommon:p,renderResult:q,addGroup:r,addItem:s,addFast:t,searchMatch:v,searchCancel:w,resultMatch:x,resultCancel:y,match:z,switchSide:A,resize:B,todo:function(){}})}();